

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta property="og:title" content="2.4. Fuel Management Input" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://terrapower.github.io/armi/user/inputs/fuel_management.html" />
  <meta property="og:site_name" content="Advanced Reactor Modeling Interface" />
  <meta property="og:description" content="Fuel Management Input: Fuel management in ARMI is specified through custom Python scripts that often reside in the working directory of a run (but can be anywhere if you use full paths). During a n..." />
  <meta property="og:image" content="https://terrapower.github.io/armi/_static/armiSchematicView.png" />
  <meta property="og:image:alt" content="Advanced Reactor Modeling Interface" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>2.4. Fuel Management Input &mdash; ARMI 0.1.7 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5. Settings Report" href="settings_report.html" />
    <link rel="prev" title="2.3. The Facemap Input File" href="facemap_file.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../user_install.html">1. Installation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2. Inputs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="settings.html">2.1. The Settings Input File</a></li>
<li class="toctree-l3"><a class="reference internal" href="blueprints.html">2.2. The Blueprints Input File</a></li>
<li class="toctree-l3"><a class="reference internal" href="facemap_file.html">2.3. The Facemap Input File</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.4. Fuel Management Input</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fuel-management-operations">2.4.1. Fuel Management Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#choosing-assemblies-to-move">2.4.2. Choosing Assemblies to Move</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fuel-management-examples">2.4.3. Fuel Management Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fuel-management-tips">2.4.4. Fuel Management Tips</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-a-branch-search">2.4.5. Running a branch search</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="settings_report.html">2.5. Settings Report</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../outputs/index.html">3. Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manual_data_access.html">4. Accessing Data in ARMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reactor_parameters_report.html">5. Reactor Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core_parameters_report.html">6. Core Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assembly_parameters_report.html">7. Assembly Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../block_parameters_report.html">8. Block Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assorted_guide.html">9. Branch Searching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assorted_guide.html#physics-coupling">10. Physics Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../accessingEntryPoints.html">11. Accessing Entry Points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../blog/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">User Docs</a> &raquo;</li>
        
          <li><a href="index.html">2. Inputs</a> &raquo;</li>
        
      <li>2.4. Fuel Management Input</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/terrapower/armi/blob/master/doc/user/inputs/fuel_management.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="fuel-management-input">
<h1>2.4. Fuel Management Input<a class="headerlink" href="#fuel-management-input" title="Permalink to this headline">¶</a></h1>
<p>Fuel management in ARMI is specified through custom Python scripts that often reside
in the working directory of a run (but can be anywhere if you use full paths). During a normal run,
ARMI checks for two fuel management settings:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">shuffleLogic</span></code></dt><dd><p>The path to the Python source file that contains the user’s custom fuel
management logic</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fuelHandlerName</span></code></dt><dd><p>The name of a FuelHandler class that ARMI will look for in the Fuel Management Input file
pointed to by the <code class="docutils literal notranslate"><span class="pre">shuffleLogic</span></code> path. Since it’s input, it’s the user’s responsibility
to design and place that object in that file.</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We consider the limited syntax needed to express fuel management in Python
code itself     to be sufficiently expressive and simple for non-programmers to
actually use. Indeed, this has been our experience.</p>
</div>
<p>The ARMI Operator will call its fuel handler’s <code class="docutils literal notranslate"><span class="pre">outage</span></code> method before each cycle (and, if requested, during branch
search calculations). The <a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#armi.physics.fuelCycle.fuelHandlers.FuelHandler.outage" title="armi.physics.fuelCycle.fuelHandlers.FuelHandler.outage"><code class="xref py py-meth docutils literal notranslate"><span class="pre">outage()</span></code></a> method
will perform bookkeeping operations, and eventually
call the user-defined <code class="docutils literal notranslate"><span class="pre">chooseSwaps</span></code> method (located in Fuel Management Input). <code class="docutils literal notranslate"><span class="pre">chooseSwaps</span></code> will
generally contain calls to <a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#armi.physics.fuelCycle.fuelHandlers.FuelHandler.findAssembly" title="armi.physics.fuelCycle.fuelHandlers.FuelHandler.findAssembly"><code class="xref py py-meth docutils literal notranslate"><span class="pre">findAssembly()</span></code></a>,
<a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#armi.physics.fuelCycle.fuelHandlers.FuelHandler.swapAssemblies" title="armi.physics.fuelCycle.fuelHandlers.FuelHandler.swapAssemblies"><code class="xref py py-meth docutils literal notranslate"><span class="pre">swapAssemblies()</span></code></a> ,
<a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#armi.physics.fuelCycle.fuelHandlers.FuelHandler.swapCascade" title="armi.physics.fuelCycle.fuelHandlers.FuelHandler.swapCascade"><code class="xref py py-meth docutils literal notranslate"><span class="pre">swapCascade()</span></code></a>, and
<a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#armi.physics.fuelCycle.fuelHandlers.FuelHandler.dischargeSwap" title="armi.physics.fuelCycle.fuelHandlers.FuelHandler.dischargeSwap"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dischargeSwap()</span></code></a>, which are the primary
fuel management operations and can be found in the fuel management module.</p>
<p>Also found in the user-defined Fuel Management Input module is a <code class="docutils literal notranslate"><span class="pre">getFactors</span></code> method, which is used to control which
shuffling routines get called and at which time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a class="reference internal" href="../../.apidocs/armi.physics.fuelCycle.fuelHandlers.html#module-armi.physics.fuelCycle.fuelHandlers" title="armi.physics.fuelCycle.fuelHandlers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">fuelHandlers</span> <span class="pre">module</span></code></a> for more details.</p>
</div>
<div class="section" id="fuel-management-operations">
<h2>2.4.1. Fuel Management Operations<a class="headerlink" href="#fuel-management-operations" title="Permalink to this headline">¶</a></h2>
<p>In the ARMI, the assemblies can be moved as units around the reactor with swapAssemblies,
dischargeSwap, and swapCascade of a <code class="docutils literal notranslate"><span class="pre">FuelHandler</span></code> interface.</p>
<div class="section" id="swapassemblies">
<h3>2.4.1.1. swapAssemblies<a class="headerlink" href="#swapassemblies" title="Permalink to this headline">¶</a></h3>
<p>swapAssemblies is the simplest fuel management operation. Given two assembly objects, this method will switch
their locations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">swapAssemblies</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dischargeswap">
<h3>2.4.1.2. dischargeSwap<a class="headerlink" href="#dischargeswap" title="Permalink to this headline">¶</a></h3>
<p>A discharge swap is a simple operation that puts a new assembly into the reactor while discharging an
outgoing one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">dischargeSwap</span><span class="p">(</span><span class="n">newIncoming</span><span class="p">,</span><span class="n">oldOutgoing</span><span class="p">)</span>
</pre></div>
</div>
<p>This operation keeps track of the outgoing assembly in a AssemblyList object that the Reactor object has access to so you can see how much of what you discharged.</p>
</div>
<div class="section" id="swapcascade">
<h3>2.4.1.3. swapCascade<a class="headerlink" href="#swapcascade" title="Permalink to this headline">¶</a></h3>
<p>SwapCascade is a more powerful swapping function that can swap a list of assemblies in a “daisy-chain” type
of operation. These are useful for doing the main overtone shuffling operations such as convergent shuffling
and/or convergent-divergent shuffling. If we load up the list of assemblies, the first one will be put in the
last one’s position, and all others will shift accordingly.</p>
<p>As an example, consider assemblies 1 through 5 in core positions A through E.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">swapCascade</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="p">,</span><span class="n">a4</span><span class="p">,</span><span class="n">a5</span><span class="p">])</span>
</pre></div>
</div>
<p>This table shows the positions of the assemblies before and after the swap cascade.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 44%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Assembly</p></th>
<th class="head"><p>Position Before Swap Cascade</p></th>
<th class="head"><p>Position After Swap Cascade</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>A</p></td>
<td><p>E</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>B</p></td>
<td><p>A</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>C</p></td>
<td><p>B</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>D</p></td>
<td><p>C</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>E</p></td>
<td><p>D</p></td>
</tr>
</tbody>
</table>
<p>Arbitrarily complex cascades can thusly be assembled by choosing the order of the assemblies passed into swapCascade.</p>
</div>
</div>
<div class="section" id="choosing-assemblies-to-move">
<h2>2.4.2. Choosing Assemblies to Move<a class="headerlink" href="#choosing-assemblies-to-move" title="Permalink to this headline">¶</a></h2>
<p>The methods described in the previous section require known assemblies to shuffle. Choosing these assemblies is
the essence of fuel shuffling design. The single method used for these purposes is the FuelHandler’s <code class="docutils literal notranslate"><span class="pre">findAssembly</span></code>
method. This method is very general purpose, and ranks in the top 3 most important
methods of the ARMI altogether.</p>
<p>To use it, just say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findAssembly</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="s1">&#39;maxPercentBu&#39;</span><span class="p">,</span><span class="n">compareTo</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return the assembly in the reactor that has a maximum burnup closest to 20%. Other
inputs to findAssembly include:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Argument</p></th>
<th class="head"><p>Example</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>targetRing</p></td>
<td><p>6</p></td>
<td><p>Assemblies returned will be close to this ring. How close is determined by the width argument.</p></td>
</tr>
<tr class="row-odd"><td><p>width</p></td>
<td><p>(4,1)</p></td>
<td><p>First number is how many rings away from the targetRing are acceptable. Second number is direction. -1 will return rings lower than the targetRing, 1 will return rings higher than the targetRing, and 0 will return rings on either side of the targetRing.</p></td>
</tr>
<tr class="row-even"><td><p>param</p></td>
<td><p>‘maxPercentBu’</p></td>
<td><p>An assembly-level parameter that will be searched for and compared with the compareTo argument.</p></td>
</tr>
<tr class="row-odd"><td><p>compareTo</p></td>
<td><p>(aRef,0.6) or 20.5</p></td>
<td><p>A value to compare param to. If a single floating point number is given, it will be used a expected. If an (refAssembly, multiplier) tuple is given, the code will search for a value that is multiplier times the refAssembly’s param. For instance, if you want to find an assembly that has a burnup near 50% of another assemblies burnup, you would give (anotherAssembly,0.5).</p></td>
</tr>
<tr class="row-even"><td><p>forceSide</p></td>
<td><p>-1,0, or 1</p></td>
<td><p>Requires the returned assembly to have either 1: higher, 1: lower, or None: either param than what’s in compareTo.</p></td>
</tr>
<tr class="row-odd"><td><p>exclusions</p></td>
<td><p>[a1,a2,a3]</p></td>
<td><p>Won’t return any assembly in this list</p></td>
</tr>
<tr class="row-even"><td><p>minParam</p></td>
<td><p>‘kInf’</p></td>
<td><p>A parameter to compare to minVal for setting lower bounds</p></td>
</tr>
<tr class="row-odd"><td><p>minVal</p></td>
<td><p>0.99</p></td>
<td><p>Sets the lower limit for minParam. The example values show will result in now assemblies with kInf&lt;0.99 will be returned.</p></td>
</tr>
<tr class="row-even"><td><p>maxParam</p></td>
<td><p>‘maxPercentBu’</p></td>
<td><p>A parameter to compare to minVal for setting upper bounds</p></td>
</tr>
<tr class="row-odd"><td><p>maxVal</p></td>
<td><p>20</p></td>
<td><p>Sets the lower limit for maxParam. The example values show will result in now assemblies with burnup&gt;20% will be returned.</p></td>
</tr>
<tr class="row-even"><td><p>mandatoryLocations</p></td>
<td><p>[‘A1010’,’B2001’]</p></td>
<td><p>Will only return assemblies if they are in a location in this list.</p></td>
</tr>
<tr class="row-odd"><td><p>excludedLocations</p></td>
<td><p>[‘A1010’,’B2001’]</p></td>
<td><p>Will only return assemblies that are not in these locations.</p></td>
</tr>
<tr class="row-even"><td><p>coords</p></td>
<td><p>(24.34,23.65)</p></td>
<td><p>Return assembly that is closest to this point in the x-y plane (in cm).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fuel-management-examples">
<h2>2.4.3. Fuel Management Examples<a class="headerlink" href="#fuel-management-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="convergent-divergent">
<h3>2.4.3.1. Convergent-Divergent<a class="headerlink" href="#convergent-divergent" title="Permalink to this headline">¶</a></h3>
<p>Convergent-divergent shuffling is when fresh assemblies march in from the outside until they approach the jump ring,
at which point they jump to the center and diverge until they reach the jump ring again, where they now jump to the
outer periphery of the core, or become discharged.</p>
<p>If the jump ring is 6,  the order of target rings is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">]</span>
</pre></div>
</div>
<p>In this case, assemblies converge from ring 13 to 12, to 11, to 10, …, to 6, and then jump to 1 and diverge
until they get back to 6. In a discharging equilibrium case, the highest burned assembly in the jumpRing should
get discharged and the lowest should jump by calling a dischargeSwap on cascade[0] and a fresh feed after this
cascade is run.</p>
<p>The convergent rings in this case are 7 through 13 and the divergent ones are 1 through 5 are the divergent ones.</p>
</div>
</div>
<div class="section" id="fuel-management-tips">
<h2>2.4.4. Fuel Management Tips<a class="headerlink" href="#fuel-management-tips" title="Permalink to this headline">¶</a></h2>
<p>Some mistakes are common. Follow these tips.</p>
<blockquote>
<div><ul class="simple">
<li><p>Always make sure your assembly-level types in the settings file are up to date with your geometry input file. Otherwise you’ll be moving feeds when you want to move igniters, or something.</p></li>
<li><p>Use the exclusions list! If you move a cascade and then the next cascade tries to run, it will choose your newly-moved assemblies if they fit your criteria in findAssemblies. This leads to very confusing results. Therefore, once you move assemblies, you should default to adding them to the exclusions list.</p></li>
<li><p>Print cascades during debugging. After you’ve built a cascade to swap, print it out and check the locations and types of each assembly in it. Is it what you want?</p></li>
<li><p>Watch typeNum in the database. You can get good intuition about what is getting moved by viewing this parameter.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="running-a-branch-search">
<h2>2.4.5. Running a branch search<a class="headerlink" href="#running-a-branch-search" title="Permalink to this headline">¶</a></h2>
<p>ARMI can perform a branch search where a number of fuel management operations
are performed in parallel and the preferred one is chosen and proceeded with.
The key to any branch search is writing a fuel handler that can interpret
<strong>fuel management factors</strong>, defined as keyed values between 0 and 1.</p>
<p>As an example, a fuel handler may be written to interpret two factors, <code class="docutils literal notranslate"><span class="pre">numDischarges</span></code>
and <code class="docutils literal notranslate"><span class="pre">chargeEnrich</span></code>. One method in the fuel handler would then take
the value of <code class="docutils literal notranslate"><span class="pre">factors['numDischarges']</span></code> and multiply it by the maximum
number of discharges (often set by another user setting) and then discharge
this many assemblies. Similarly, another method would take the <code class="docutils literal notranslate"><span class="pre">factors['chargeEnrich']</span></code>
value (between 0 and 1) and multiply it by the maximum allowable enrichment
(again, usually controlled by a user setting) to determine which enrichment
should be used to fabricate new assemblies.</p>
<p>Given a fuel handler that can thusly interpret factors between 0 and 1, the
concept of branch searches is simple. They simply build uniformly distributed
lists between 0 and 1 across however many CPUs are available and cases on all
of them, passing one of each of the factors to each CPU in parallel. When the cases finish,
the branch search determines the optimal result and selects the corresponding
value of the factor to proceed.</p>
<p>Branch searches are controlled by custom <cite>getFactorList</cite> methods specified in the
<cite>shuffleLogic</cite> input files. This method should return two things:</p>
<blockquote>
<div><ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">defaultFactors</span></code>; a dictionary with user-defined keys and values between
0 and 1 for each key. These factors will be passed to the <code class="docutils literal notranslate"><span class="pre">chooseSwaps</span></code>
method, which is typically overridden by the user in custom fuel handling code.
The fuel handling code should interpret the values and move the fuel
according to what is sent.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">factorSearchFlags</span></code> list, which lists the keys to be branch searched.
The search will optimize the first key first, and then do a second pass
on the second key, holding the optimal first value constant, and so on.</p></li>
</ul>
</div></blockquote>
<p>Such a method may look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getFactorList</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span><span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="c1"># init default shuffling factors</span>
    <span class="n">defaultFactors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;chargeEnrich&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;numDischarges&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
    <span class="n">factorSearchFlags</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># init factors to run branch searches on</span>

    <span class="c1"># determine when to activate various factors / searches</span>
    <span class="k">if</span> <span class="n">cycle</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
        <span class="c1"># shuffling happens before neutronics so skip the first cycle.</span>
        <span class="n">defaultFactors</span><span class="p">[</span><span class="s1">&#39;chargeEnrich&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">defaultFactors</span><span class="p">[</span><span class="s1">&#39;numDischarges&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">factorSearchFlags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;chargeEnrich&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">defaultFactors</span><span class="p">,</span><span class="n">factorSearchFlags</span>
</pre></div>
</div>
<p>Once a proper <code class="docutils literal notranslate"><span class="pre">getFactorList</span></code> method exists and a fuel handler object
exists that can interpret the factors, activate a branch search
during a regular run by selecting the <strong>Branch Search</strong> option on the GUI.</p>
<p>The <strong>best</strong> result from the branch search is determined by comparing the <em>keff</em> values
with the <code class="docutils literal notranslate"><span class="pre">targetK</span></code> setting, which is available for setting in the GUI. The branch
with <em>keff</em> closest to the setting, while still being above 1.0 is chosen.</p>
<p>If you want to do branch searches from within an interface, just call
the <code class="xref py py-meth docutils literal notranslate"><span class="pre">o.branchSearch</span></code> method.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="settings_report.html" class="btn btn-neutral float-right" title="2.5. Settings Report" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="facemap_file.html" class="btn btn-neutral float-left" title="2.3. The Facemap Input File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2021, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2021-10-18.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>