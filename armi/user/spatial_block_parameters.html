

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9. Spatial block parameters" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://terrapower.github.io/armi/user/spatial_block_parameters.html" />
<meta property="og:site_name" content="Advanced Reactor Modeling Interface" />
<meta property="og:description" content="Many parameters assigned on a Block are scalar quantities that are useful for visualization and simple queries (e.g., block with the maximum burnup in an assembly). Spatial parameters in a block, s..." />
<meta property="og:image" content="https://terrapower.github.io/armi/_static/armiSchematicView.png" />
<meta property="og:image:alt" content="Advanced Reactor Modeling Interface" />
<meta name="description" content="Many parameters assigned on a Block are scalar quantities that are useful for visualization and simple queries (e.g., block with the maximum burnup in an assembly). Spatial parameters in a block, s..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>9. Spatial block parameters &mdash; ARMI 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme_fixes.css?v=03c81a6b" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
    <link rel="shortcut icon" href="../_static/armiicon_16x16.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=1dd76d02"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="10. Physics Coupling" href="physics_coupling.html" />
    <link rel="prev" title="8. Block Parameters" href="block_parameters_report.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../index.html" class="icon icon-home">
            ARMI
              <img src="../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Docs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="inputs.html">1. Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="outputs.html">2. Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="manual_data_access.html">3. Accessing Data in ARMI</a></li>
<li class="toctree-l2"><a class="reference internal" href="reactor_parameters_report.html">4. Reactor Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_parameters_report.html">5. Core Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="component_parameters_report.html">6. Component Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="assembly_parameters_report.html">7. Assembly Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="block_parameters_report.html">8. Block Parameters</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">9. Spatial block parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sub-block-spatial-grid">9.1. Sub-block spatial grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#blueprints">9.1.1. Blueprints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#auto-grid">9.1.2. Auto grid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interacting-with-spatial-data">9.2. Interacting with spatial data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#component-locations">9.2.1. Component locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pin-locations">9.2.2. Pin locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pin-parameter-data">9.2.3. Pin parameter data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#block-rotation">9.3. Block rotation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#spatial-locators">9.3.1. Spatial locators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pin-parameters">9.3.2. Pin parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#corners-and-edges">9.3.3. Corners and edges</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-rotated-parameters">9.3.4. Other rotated parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="physics_coupling.html">10. Physics Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="radial_and_axial_expansion.html">11. Radial and Axial Expansion and Contraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="accessingEntryPoints.html">12. Accessing Entry Points</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Docs</a></li>
      <li class="breadcrumb-item active"><span class="section-number">9. </span>Spatial block parameters</li>
  <li class="wy-breadcrumbs-aside">
    
      
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="spatial-block-parameters">
<h1><span class="section-number">9. </span>Spatial block parameters<a class="headerlink" href="#spatial-block-parameters" title="Link to this heading"></a></h1>
<p>Many parameters assigned on a <code class="docutils literal notranslate"><span class="pre">Block</span></code> are scalar quantities that are useful for visualization
and simple queries (e.g., block with the maximum burnup in an assembly). Spatial parameters in
a block, such as power produced by each pin, is also of interest. Especially when communicating
data to physics codes that support sub-block geometric modeling. This page will talk about
how spatial information is assigned to components on a block, how spatial data can be assigned
and accessed, and how those data may or may not be updated by the framework.</p>
<section id="sub-block-spatial-grid">
<h2><span class="section-number">9.1. </span>Sub-block spatial grid<a class="headerlink" href="#sub-block-spatial-grid" title="Link to this heading"></a></h2>
<p>There are two ways to create the block grid: explicitly via blueprints or via an automated builder. The former
is recommended, but the later can work in some specific circumstances.</p>
<section id="blueprints">
<h3><span class="section-number">9.1.1. </span>Blueprints<a class="headerlink" href="#blueprints" title="Link to this heading"></a></h3>
<p>In your blueprints file, you likely have a core grid that defines where assemblies reside in the reactor. Assemblies
are assigned to locations on that grid according to their <code class="docutils literal notranslate"><span class="pre">specifcier</span></code> blueprint attribute. Below is an example
of a “flats up” hexagonal core grid of fuel assemblies with 1/3 symmetry.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">grids</span><span class="p">:</span>
<span class="w">  </span><span class="nt">core</span><span class="p">:</span>
<span class="w">    </span><span class="nt">geom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hex</span>
<span class="w">    </span><span class="nt">symmetry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">third periodic</span>
<span class="w">    </span><span class="nt">lattice map</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">F</span>
<span class="w">       </span><span class="no">F</span>
<span class="w">      </span><span class="no">F F</span>
<span class="w">       </span><span class="no">F</span>
<span class="w">      </span><span class="no">F F</span>
</pre></div>
</div>
<p>We can similarly define a grid for the block with a similar entry in the <code class="docutils literal notranslate"><span class="pre">grids</span></code> portion of the blueprints.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">pins</span><span class="p">:</span>
<span class="w">  </span><span class="nt">geom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hex_corners_up</span>
<span class="w">  </span><span class="nt">symmetry</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
<span class="w">  </span><span class="nt">lattice map</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">     </span><span class="no">- - - - - - - - - 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">      </span><span class="no">- - - - - - - - 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">       </span><span class="no">- - - - - - - 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">        </span><span class="no">- - - - - - 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">         </span><span class="no">- - - - - 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">          </span><span class="no">- - - - 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">           </span><span class="no">- - - 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">            </span><span class="no">- - 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">             </span><span class="no">- 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">              </span><span class="no">1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1</span>
<span class="w">               </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                 </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                  </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                   </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                    </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                     </span><span class="no">1 1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                      </span><span class="no">1 1 1 1 1 1 1 1 1 1 1</span>
<span class="w">                       </span><span class="no">1 1 1 1 1 1 1 1 1 1</span>
</pre></div>
</div>
<p>This creates a ten-ring hexagonal lattice in a “corners up” orientation. While the resulting geometry
may look like a flats up lattice, the individual hexagons that make up a lattice site are corners up.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sub-block grid does not need to be of a different orientation of the parent block. A flats up
hex block can have a flats up pin lattice. In most cases, an assembly full of pins will have a pin
lattice that is off a different type to maximally load pins into the block.</p>
</div>
<p>Say we wanted to have a guide tube at the center lattice site with cladding surrounding void and every other lattice
site to contain a fuel pin. We need to add the following items to our block definition to link the grid, and to
assign components to sites on the grid.</p>
<ol class="arabic simple">
<li><p>The block needs a <code class="docutils literal notranslate"><span class="pre">grid</span> <span class="pre">name</span></code> entry that points to the grid we want to use for this block.</p></li>
<li><p>Each component that wants to be placed on a lattice site needs a <code class="docutils literal notranslate"><span class="pre">latticeIDs</span></code> entry that contains
the IDs, like assembly specifiers in the core grid, for that component.</p></li>
</ol>
<p>In the example above, we have two lattice IDs: <code class="docutils literal notranslate"><span class="pre">0</span></code> for the center site and <code class="docutils literal notranslate"><span class="pre">1</span></code> for the other pins. These
are chosen for brevity but we could have also done <code class="docutils literal notranslate"><span class="pre">fuel</span></code> and <code class="docutils literal notranslate"><span class="pre">guide</span></code> or <code class="docutils literal notranslate"><span class="pre">F</span></code> and <code class="docutils literal notranslate"><span class="pre">G</span></code>. Do what makes sense
for you.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Like with assembly specifiers, keeping the lattice IDs to have the same number of characters will
help the grid render nicer in text editors. This is not a requirement, but it may make life easier
for you and your team.</p>
</div>
<p>Our complete block definition would start like</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">blocks</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;block_fuel</span>
<span class="w">    </span><span class="nt">grid name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pins</span>
<span class="w">    </span><span class="nt">fuel</span><span class="p">:</span>
<span class="w">        </span><span class="nt">shape</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Circle</span>
<span class="w">        </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UO2</span>
<span class="w">        </span><span class="nt">Tinput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">Thot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">od</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.819</span>
<span class="w">        </span><span class="nt">latticeIDs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">clad</span><span class="p">:</span>
<span class="w">        </span><span class="nt">shape</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Circle</span>
<span class="w">        </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UO2</span>
<span class="w">        </span><span class="nt">Tinput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">Thot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.819</span>
<span class="w">        </span><span class="nt">od</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.9</span>
<span class="w">        </span><span class="nt">latticeIDs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">void</span><span class="p">:</span>
<span class="w">        </span><span class="nt">shape</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Circle</span>
<span class="w">        </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Void</span>
<span class="w">        </span><span class="nt">Tinput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">Thot</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">od</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.819</span>
<span class="w">        </span><span class="nt">latticeIDs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Note that we can assign the same component to multiple lattice sites with multiple entries in the <code class="docutils literal notranslate"><span class="pre">latticeIDs</span></code> list.
Also note that we do not need to assign a <code class="docutils literal notranslate"><span class="pre">mult</span></code> entry to these components. Their multiplicity will be determined
based on the number of lattice sites they occupy!</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The <a class="reference internal" href="../tutorials/walkthrough_lwr_inputs.html#walkthrough-lwr"><span class="std std-ref">LWR tutorial</span></a> contains additional examples for working with sub-block grids.</p>
</div>
</section>
<section id="auto-grid">
<h3><span class="section-number">9.1.2. </span>Auto grid<a class="headerlink" href="#auto-grid" title="Link to this heading"></a></h3>
<p>In some cases, you may have an assembly that contains one pin type. The framework provides a mechanism for automatically
constructing a spatial grid for the block based only on the multiplicity of pin-like components. When constructing
a block from blueprints, a grid may be added to the block depending on:</p>
<ol class="arabic simple">
<li><p>The existence of an explicitly defined block grid, like in the previously discussed section, and</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">autoGenerateBlockGrids</span></code> setting is active.</p></li>
</ol>
<p>Should either of these conditions be met, the framework will attempt to add a grid by calling
<a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.Block.autoCreateSpatialGrids" title="armi.reactor.blocks.Block.autoCreateSpatialGrids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.reactor.blocks.Block.autoCreateSpatialGrids()</span></code></a>. However, this behavior is not generalized and only
implemented on <a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.HexBlock" title="armi.reactor.blocks.HexBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.reactor.blocks.HexBlock</span></code></a>, which makes the following assumptions:</p>
<ol class="arabic simple">
<li><p>You want a corners up hexagonal lattice grid.</p></li>
<li><p>The pitch of your hexagonal lattice is determined by <a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.HexBlock.getPinPitch" title="armi.reactor.blocks.HexBlock.getPinPitch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.reactor.blocks.HexBlock.getPinPitch()</span></code></a> which
may place restrictions on what constitutes a pin.</p></li>
<li><p>The number of pins is determined by <code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.reactor.blocks.HexBlock.getNumPins()</span></code> which may place similar
restrictions on what constitutes a pin.</p></li>
</ol>
<p>If the auto grid creation is successful, components with a multiplicity equal to the number of pins will be assigned
locations on the lattice grid.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Consider subclassing <a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.HexBlock" title="armi.reactor.blocks.HexBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">HexBlock</span></code></a> with specific pin-like methods and
overriding the <a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.HexBlock.autoCreateSpatialGrids" title="armi.reactor.blocks.HexBlock.autoCreateSpatialGrids"><code class="xref py py-meth docutils literal notranslate"><span class="pre">autoCreateSpatialGrids()</span></code></a> if you want complete control
over this process. Alternatively, use an explicit grid in blueprints.</p>
</div>
</section>
</section>
<section id="interacting-with-spatial-data">
<h2><span class="section-number">9.2. </span>Interacting with spatial data<a class="headerlink" href="#interacting-with-spatial-data" title="Link to this heading"></a></h2>
<p>This section will focus on accessing locations of components in the block, locations of specifically
pins, and examples of some pin data that may be assigned to a block’s parameter set.</p>
<section id="component-locations">
<h3><span class="section-number">9.2.1. </span>Component locations<a class="headerlink" href="#component-locations" title="Link to this heading"></a></h3>
<p>Components that live on a spatial grid have a <code class="docutils literal notranslate"><span class="pre">spatialLocator</span></code> attribute to help indicate where that
component exists in space. If we grab the fuel component from the UO2 block in the
<a class="reference internal" href="../tutorials/walkthrough_inputs.html#walkthrough-inputs"><span class="std std-ref">ANL AFCI 177 example</span></a> we can see where it exists in the block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">armi</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">armi</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">armi</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="s2">&quot;anl-afci-177.yaml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">r</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelAssem</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span> <span class="o">=</span> <span class="n">fuelAssem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">spatialGrid</span>
<span class="go">&lt;HexGrid -- 2046645914880</span>
<span class="go">Bounds:</span>
<span class="go">None</span>
<span class="go">None</span>
<span class="go">None</span>
<span class="go">Steps:</span>
<span class="go">[ 0.4444 -0.4444  0.    ]</span>
<span class="go">[0.76972338 0.76972338 0.        ]</span>
<span class="go">[0. 0. 0.]</span>
<span class="go">Anchor: &lt;fuel B0009-001 at 008-040-001 XS: C ENV GP: A&gt;</span>
<span class="go">Offset: [0. 0. 0.]</span>
<span class="go">Num Locations: 400&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getChildrenWithFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">)</span>
<span class="go">271</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span>
<span class="go">&lt;MultiIndexLocation with 271 locations&gt;</span>
</pre></div>
</div>
<p>This <code class="xref py py-class docutils literal notranslate"><span class="pre">MultiIndexLocation</span></code> is a way to indicate this Component exists at multiple
sites. Each item in this locator is one location on the underlying grid where we could find this component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">&lt;IndexLocation @ (0,0,0)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
<span class="go">array([0., 0., 0.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coordsFromFuel</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coordsFromFuel</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(271, 3)</span>
</pre></div>
</div>
<p>We get a <code class="docutils literal notranslate"><span class="pre">(271,</span> <span class="pre">3)</span></code> array because we have 271 of these fuel components in the block, and each row contains one
(x, y, z) location for that component. We can do this for every component, though some may only exist at a single
site on the grid and be assigned a <code class="xref py py-class docutils literal notranslate"><span class="pre">CoordinateLocation</span></code> spatial locator instead. The API
is mostly the same, but attempts to signify such an object does not live on the grid e.g., duct or derived shape
objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">duct</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getChildrenWithFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">duct</span><span class="o">.</span><span class="n">spatialLocator</span>
<span class="go">&lt;CoordinateLocation @ (0.0,0.0,0.0)&gt;</span>
</pre></div>
</div>
</section>
<section id="pin-locations">
<h3><span class="section-number">9.2.2. </span>Pin locations<a class="headerlink" href="#pin-locations" title="Link to this heading"></a></h3>
<p>Everything in the before section works for finding center points of pins in your assembly. But often times
you have multiple components that may exist at the same lattice site (e.g., fuel, gap, clad, maybe a wire?).
Or you may have multiple cladded-things that count as pins and but exist in multiple components. In some
circumstances, <code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.reactor.blocks.HexBlock.getPinCoordinates()</span></code> may be useful to find
the unique centroids of pins in a block. Using our example above, we get a very similar set of coordinates
when comparing to the coordinates of the fuel pin:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">coordsFromPin</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coordsFromBlock</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getPinCoordinates</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">coordsFromPin</span> <span class="o">==</span> <span class="n">coordsFromBlock</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>In this specific case <code class="xref py py-meth docutils literal notranslate"><span class="pre">getPinCoordinates()</span></code> looks at
components with <code class="docutils literal notranslate"><span class="pre">Flags.CLAD</span></code> and obtains their locations, and we have one cladding component and it
exists at each of the 271 sites we care about. However, if you have multiple cladding components per lattice
site, such as in the <a class="reference internal" href="../tutorials/walkthrough_lwr_inputs.html#walkthrough-lwr"><span class="std std-ref">C5G7 example</span></a>, you may see an incorrect number of locations
returned.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consider making application-specific subclasses of <code class="docutils literal notranslate"><span class="pre">Block</span></code>, <code class="docutils literal notranslate"><span class="pre">HexBlock</span></code>, and/or <code class="docutils literal notranslate"><span class="pre">CartesianBlock</span></code>
with more targeted implementations of <a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.Block.getNumPins" title="armi.reactor.blocks.Block.getNumPins"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getNumPins()</span></code></a>,
<a class="reference internal" href="../.apidocs/armi.reactor.blocks.html#armi.reactor.blocks.Block.getPinPitch" title="armi.reactor.blocks.Block.getPinPitch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getPinPitch()</span></code></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">getPinLocations()</span></code>
and other pin-specific methods.</p>
</div>
</section>
<section id="pin-parameter-data">
<h3><span class="section-number">9.2.3. </span>Pin parameter data<a class="headerlink" href="#pin-parameter-data" title="Link to this heading"></a></h3>
<p>The ARMI framework defines a few parameters that live on the block, but define data for each of
the child pin components. Two examples are <code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin</span></code> and <code class="docutils literal notranslate"><span class="pre">Block.p.pinMgFluxes</span></code>. These
parameters are structured and related to the output of <code class="docutils literal notranslate"><span class="pre">getPinCoordinates</span></code> such that</p>
<ol class="arabic simple">
<li><p>Pin <code class="docutils literal notranslate"><span class="pre">i</span></code> can be found at <code class="docutils literal notranslate"><span class="pre">Block.getPinCoordinates()[i]</span></code>.</p></li>
<li><p>Parameter data for pin <code class="docutils literal notranslate"><span class="pre">i</span></code> can be found at location <code class="docutils literal notranslate"><span class="pre">i</span></code> in the parameter array, e.g.,
<code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin[i]</span></code>.</p></li>
</ol>
<p>Parameters like <code class="docutils literal notranslate"><span class="pre">Block.p.pinMgFluxes</span></code> may be higher dimensional, storing mutli-group flux for each pin.
In this case, the parameter data array has shape <code class="docutils literal notranslate"><span class="pre">(nPins,</span> <span class="pre">nGroups)</span></code> such that <code class="docutils literal notranslate"><span class="pre">Block.p.pinMgFluxes[i,</span> <span class="pre">g]</span></code>
has the group <code class="docutils literal notranslate"><span class="pre">g</span></code> flux in pin <code class="docutils literal notranslate"><span class="pre">i</span></code>, found at <code class="docutils literal notranslate"><span class="pre">Block.getPinCoordinates()[i]</span></code>.</p>
</section>
</section>
<section id="block-rotation">
<h2><span class="section-number">9.3. </span>Block rotation<a class="headerlink" href="#block-rotation" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Rotation is currently only supported for hexagonal blocks</p>
</div>
<p>Using the logic from the previous section on pin parameter data, it may be useful to know how
rotating a block changes the data stored on that block.</p>
<section id="spatial-locators">
<h3><span class="section-number">9.3.1. </span>Spatial locators<a class="headerlink" href="#spatial-locators" title="Link to this heading"></a></h3>
<p>First, rotating a block will update the <code class="docutils literal notranslate"><span class="pre">spatialLocator</span></code> attribute on every child of
the block. For objects defined at the center of the block, they will still be located at the center.
Objects with a <code class="docutils literal notranslate"><span class="pre">MultiIndexLocator</span></code> will have new locations such that <code class="docutils literal notranslate"><span class="pre">spatialLocator[i]</span></code> will
be consistent before and after rotation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="go"># zeroth location is the origin so pick a location that changes through rotation</span>
<span class="go">&gt;&gt;&gt;fuel.spatialLocator[1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">&lt;</span><span class="n">IndexLocation</span> <span class="o">@</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
<span class="go">array([0.4444    , 0.76972338, 0.        ]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&lt;IndexLocation @ (0,1,0)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuel</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
<span class="go">array([-0.4444    ,  0.76972338,  0.        ])</span>
</pre></div>
</div>
<p>Because this sub-block grid is a corners up hex grid, to tightly fit inside the flats up hex block,
one rotation from the north east location, <code class="docutils literal notranslate"><span class="pre">(1,0,0)</span></code>, reflects this pin across the y-axis.</p>
</section>
<section id="pin-parameters">
<h3><span class="section-number">9.3.2. </span>Pin parameters<a class="headerlink" href="#pin-parameters" title="Link to this heading"></a></h3>
<p>Parameter data that are defined on children of the block are not updated. Therefore data for
pin <code class="docutils literal notranslate"><span class="pre">i</span></code> will be found in e.g., <code class="docutils literal notranslate"><span class="pre">Block.p.pinMgFluxes[i]</span></code> before and after rotation.</p>
</section>
<section id="corners-and-edges">
<h3><span class="section-number">9.3.3. </span>Corners and edges<a class="headerlink" href="#corners-and-edges" title="Link to this heading"></a></h3>
<p>Parameters defined on the edges and corners of the block, i.e., those with <code class="xref py py-attr docutils literal notranslate"><span class="pre">armi.reactor.parameters.ParamLocation.CORNERS</span></code>
and <code class="xref py py-attr docutils literal notranslate"><span class="pre">EDGES</span></code> will be shuffled in place to reflect the new
rotation. For hexagonal blocks, these parameters should have six entries, e.g., one value for each corner, starting
at the upper right and moving counter clockwise. Let’s assign some fake data to our fuel block from above
and see what happens:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">cornerFastFlux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">cornerFastFlux</span>
<span class="go">array([0., 1., 2., 3., 4., 5.])</span>
<span class="go"># Two clockwise rotations of 60 degrees</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">cornerFastFlux</span>
<span class="go">array([2., 3., 4., 5., 0., 1.])</span>
</pre></div>
</div>
<p>Visually, the upper right corner, number <code class="docutils literal notranslate"><span class="pre">0</span></code>, has been rotated to the lower right corner, number <code class="docutils literal notranslate"><span class="pre">4</span></code>.
And the corner <code class="docutils literal notranslate"><span class="pre">2</span></code>, the leftmost corner, has been moved to corner <code class="docutils literal notranslate"><span class="pre">0</span></code>, the upper right corner.</p>
</section>
<section id="other-rotated-parameters">
<h3><span class="section-number">9.3.4. </span>Other rotated parameters<a class="headerlink" href="#other-rotated-parameters" title="Link to this heading"></a></h3>
<p>Other parameters may be updated to reflect some geometric state. The second position of
<code class="docutils literal notranslate"><span class="pre">Block.p.orientation</span></code> reflects the cumulative rotation around the z-axis and is updated through
rotation. Displacement parameters like <code class="docutils literal notranslate"><span class="pre">Block.p.displacementX</span></code> are updated as the displacement vector
rotates through space.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="block_parameters_report.html" class="btn btn-neutral float-left" title="8. Block Parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="physics_coupling.html" class="btn btn-neutral float-right" title="10. Physics Coupling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2025, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2025-02-06.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>