

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>armi.bookkeeping.db.database3 module &mdash; ARMI 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/armiicon_16x16.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="armi.bookkeeping.db.factory module" href="armi.bookkeeping.db.factory.html" />
    <link rel="prev" title="armi.bookkeeping.db.database module" href="armi.bookkeeping.db.database.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API Docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="armi.html">armi package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="armi.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="armi.bookkeeping.html">armi.bookkeeping package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.cases.html">armi.cases package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.cli.html">armi.cli package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.localization.html">armi.localization package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.materials.html">armi.materials package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.nucDirectory.html">armi.nucDirectory package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.nuclearDataIO.html">armi.nuclearDataIO package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.operators.html">armi.operators package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.physics.html">armi.physics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.reactor.html">armi.reactor package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.scripts.html">armi.scripts package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.settings.html">armi.settings package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.utils.html">armi.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="armi.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="modules.html">armi</a> &raquo;</li>
        
          <li><a href="armi.html">armi package</a> &raquo;</li>
        
          <li><a href="armi.bookkeeping.html">armi.bookkeeping package</a> &raquo;</li>
        
          <li><a href="armi.bookkeeping.db.html">armi.bookkeeping.db package</a> &raquo;</li>
        
      <li>armi.bookkeeping.db.database3 module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/.apidocs/armi.bookkeeping.db.database3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-armi.bookkeeping.db.database3">
<span id="armi-bookkeeping-db-database3-module"></span><h1>armi.bookkeeping.db.database3 module<a class="headerlink" href="#module-armi.bookkeeping.db.database3" title="Permalink to this headline">¶</a></h1>
<p>ARMI Database implementation, version 3.</p>
<p>This Implementation of the database is a significant departure from the previous. One of
the foundational concepts in this version is that a reactor model should be fully
recoverable from the database itself; all the way down to the component level. As a
result, the structure of the underlying data is bound to the hierarchical Composite
Reactor Model, rather than an ad hoc collection of Block parameter fields and other
parameters. Furthermore, this format is intended to be more dynamic, permitting as-yet
undeveloped levels and classes in the Composite Reactor Model to be supported as they
are added. More high-level discussion is contained in <a class="reference internal" href="../user/outputs/database.html"><span class="doc">The Database File</span></a>.</p>
<p>The most important contents of this module are the <a class="reference internal" href="#armi.bookkeeping.db.database3.DatabaseInterface" title="armi.bookkeeping.db.database3.DatabaseInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseInterface</span></code></a>, the
<a class="reference internal" href="#armi.bookkeeping.db.database3.Database3" title="armi.bookkeeping.db.database3.Database3"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database3</span></code></a> class, the <a class="reference internal" href="#armi.bookkeeping.db.database3.Layout" title="armi.bookkeeping.db.database3.Layout"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layout</span></code></a> class, and the special data
packing/unpacking functions. The <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class contains most of the functionality
for interacting with the underlying data. This includes things like dumping a Reactor
state to the database and loading it back again, as well as extracting historical data
for a given object or collection of object from the database file. When interacting with
the database file, the <code class="docutils literal notranslate"><span class="pre">Layout</span></code> class is used to help map the hierarchical Composite
Reactor Model to the flat representation in the database.</p>
<dl class="function">
<dt id="armi.bookkeeping.db.database3.getH5GroupName">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">getH5GroupName</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#getH5GroupName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.getH5GroupName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.describeInterfaces">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">describeInterfaces</code><span class="sig-paren">(</span><em class="sig-param">cs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#describeInterfaces"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.describeInterfaces" title="Permalink to this definition">¶</a></dt>
<dd><p>Function for exposing interface(s) to other code</p>
</dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">DatabaseInterface</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">cs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="armi.interfaces.html#armi.interfaces.Interface" title="armi.interfaces.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.interfaces.Interface</span></code></a></p>
<p>Handles interactions between the ARMI data model and the persistent data storage
system.</p>
<p>This reads/writes the ARMI state to/from the database and helps derive state
information that can be derived.</p>
<p>Construct an interface.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">r</span></code> and <code class="docutils literal notranslate"><span class="pre">cs</span></code> arguments are required, but may be <code class="docutils literal notranslate"><span class="pre">None</span></code>, where
appropriate for the specific <code class="docutils literal notranslate"><span class="pre">Interface</span></code> implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> (<a class="reference internal" href="armi.reactor.reactors.html#armi.reactor.reactors.Reactor" title="armi.reactor.reactors.Reactor"><em>Reactor</em></a>) – A reactor to attach to</p></li>
<li><p><strong>cs</strong> (<a class="reference internal" href="armi.settings.caseSettings.html#armi.settings.caseSettings.Settings" title="armi.settings.caseSettings.Settings"><em>Settings</em></a>) – Settings object to use</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – Interfaces derived from Interface must define their name</p>
</dd>
</dl>
<dl class="attribute">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.name">
<code class="sig-name descname">name</code><em class="property"> = 'database'</em><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.database">
<em class="property">property </em><code class="sig-name descname">database</code><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.database" title="Permalink to this definition">¶</a></dt>
<dd><p>Presents the internal database object, if it exists.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactBOL">
<code class="sig-name descname">interactBOL</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactBOL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactBOL" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the database if the main interface was not available.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.initDB">
<code class="sig-name descname">initDB</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.initDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.initDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Open the underlying database to be written to, and write input files to DB.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Main Interface calls this so that the database is available as early as
possible in the run. The database interface interacts near the end of the
interface stack (so that all the parameters have been updated) while the Main
Interface interacts first.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEveryNode">
<code class="sig-name descname">interactEveryNode</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">node</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEveryNode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEveryNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Write to database.</p>
<p>DBs should receive the state information of the run at each node.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEOC">
<code class="sig-name descname">interactEOC</code><span class="sig-paren">(</span><em class="sig-param">cycle=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEOC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEOC" title="Permalink to this definition">¶</a></dt>
<dd><p>In case anything changed since last cycle (e.g. rxSwing), update DB.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEOL">
<code class="sig-name descname">interactEOL</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEOL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEOL" title="Permalink to this definition">¶</a></dt>
<dd><p>DB’s should be closed at run’s end.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactError">
<code class="sig-name descname">interactError</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactError" title="Permalink to this definition">¶</a></dt>
<dd><p>Get shutdown state information even if the run encounters an error</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.distributable">
<code class="sig-name descname">distributable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.distributable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.distributable" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if this can be MPI broadcast.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Cases where this isn’t possible include the database interface,
where the SQL driver cannot be distributed.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.prepRestartRun">
<code class="sig-name descname">prepRestartRun</code><span class="sig-paren">(</span><em class="sig-param">dbCycle</em>, <em class="sig-param">dbNode</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.prepRestartRun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.prepRestartRun" title="Permalink to this definition">¶</a></dt>
<dd><p>Load the data history from the database being restarted from.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.loadState">
<code class="sig-name descname">loadState</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">timeStepName=''</em>, <em class="sig-param">fileName=None</em>, <em class="sig-param">updateGlobalAssemNum=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.loadState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.loadState" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a fresh reactor and applies it to the Operator.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>timeStepName is not currently supportred by database load.
Will load preferentially from the <cite>fileName</cite> if passed. Otherwise will load from
existing database in memory or <cite>cs[“reloadDBName”]</cite> in that order.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>RuntimeError</strong> – If fileName is specified and that  file does not have the time step.
    If fileName is not specified and neither the database in memory, nor the
    <cite>cs[“reloadDBName”]</cite> have the time step specified.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.getHistory">
<code class="sig-name descname">getHistory</code><span class="sig-paren">(</span><em class="sig-param">comp: armi.reactor.composites.ArmiObject</em>, <em class="sig-param">params: Optional[Sequence[str]] = None</em>, <em class="sig-param">timeSteps: Optional[MutableSequence[Tuple[int</em>, <em class="sig-param">int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[str, Dict[Tuple[int, int], Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.getHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.getHistory" title="Permalink to this definition">¶</a></dt>
<dd><p>Get historical parameter values for a single object.</p>
<p>This is mostly a wrapper around the same function on the <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class,
but knows how to return the current value as well.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.Database3.getHistory" title="armi.bookkeeping.db.database3.Database3.getHistory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Database3.getHistory()</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.getHistories">
<code class="sig-name descname">getHistories</code><span class="sig-paren">(</span><em class="sig-param">comps: Sequence[armi.reactor.composites.ArmiObject], params: Optional[Sequence[str]] = None, timeSteps: Optional[MutableSequence[Tuple[int, int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[armi.reactor.composites.ArmiObject, Dict[str, Dict[Tuple[int, int], Any]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.getHistories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.getHistories" title="Permalink to this definition">¶</a></dt>
<dd><p>Get historical parameter values for one or more objects.</p>
<p>This is mostly a wrapper around the same fumction on the <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class,
but knows how to return the current value as well.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.Database3.getHistories" title="armi.bookkeeping.db.database3.Database3.getHistories"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Database3.getHistories()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.Database3">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">Database3</code><span class="sig-paren">(</span><em class="sig-param">fileName: str</em>, <em class="sig-param">permission: str</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="armi.bookkeeping.db.database.html#armi.bookkeeping.db.database.Database" title="armi.bookkeeping.db.database.Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.bookkeeping.db.database.Database</span></code></a></p>
<p>Version 3 of the ARMI Database, handling serialization and loading of Reactor states.</p>
<p>This implementation of the database pushes all objects in the Composite Reactor
Model into the database. This process is aided by the <code class="docutils literal notranslate"><span class="pre">Layout</span></code> class, which
handles the packing and unpacking of the structure of the objects, their
relationships, and their non-parameter attributes.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><cite>doc/user/outputs/database</cite> for more details.</p>
</div>
<p>Create a new Database3 object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fileName</strong> – name of the file</p></li>
<li><p><strong>permission</strong> – file permissions, write (“w”) or read (“r”)</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="armi.bookkeeping.db.database3.Database3.version">
<code class="sig-name descname">version</code><em class="property"> = '3'</em><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.version" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="armi.bookkeeping.db.database3.Database3.timeNodeGroupPattern">
<code class="sig-name descname">timeNodeGroupPattern</code><em class="property"> = re.compile('^c(\\d\\d)n(\\d\\d)$')</em><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.timeNodeGroupPattern" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.open">
<code class="sig-name descname">open</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.open"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.open" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param">completedSuccessfully=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Close the DB and perform cleanups and auto-conversions.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Visualization tools like XTVIEW are still using DB format 2, so this
will (for now) auto-generate a full XTVIEW-compatible database
upon closing. It does this here because, in remote runs, this is where
the I/O is fastest.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.splitDatabase">
<code class="sig-name descname">splitDatabase</code><span class="sig-paren">(</span><em class="sig-param">keepTimeSteps: Sequence[Tuple[int, int]], label: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.splitDatabase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.splitDatabase" title="Permalink to this definition">¶</a></dt>
<dd><p>Discard all data except for specific time steps, retaining old data in a separate file.</p>
<p>This is useful when performing more exotic analyses, where each “time step” may
not represent a specific point in time, but something more nuanced. For example,
equilibrium cases store a new “cycle” for each iteration as it attempts to
converge the equilibrium cycle. At the end of the run, the last “cycle” is the
converged equilibrium cycle, whereas the previous cycles constitute the path to
convergence, which we typically wish to discard before further analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keepTimeSteps</strong> – A collection of the time steps to retain</p></li>
<li><p><strong>label</strong> – An informative label for the backed-up database. Usually something like
“-all-iterations”. Will be interposed between the source name and the “.h5”
extension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The name of the new, backed-up database file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.fileName">
<em class="property">property </em><code class="sig-name descname">fileName</code><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.fileName" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadCS">
<code class="sig-name descname">loadCS</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadCS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadCS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadBlueprints">
<code class="sig-name descname">loadBlueprints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadBlueprints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadBlueprints" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadGeometry">
<code class="sig-name descname">loadGeometry</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadGeometry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadGeometry" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.writeInputsToDB">
<code class="sig-name descname">writeInputsToDB</code><span class="sig-paren">(</span><em class="sig-param">cs</em>, <em class="sig-param">csString=None</em>, <em class="sig-param">geomString=None</em>, <em class="sig-param">bpString=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.writeInputsToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.writeInputsToDB" title="Permalink to this definition">¶</a></dt>
<dd><p>Write inputs into the database based the CaseSettings.</p>
<p>This is not DRY on purpose. The goal is that any particular Database
implementation should be very stable, so we dont want it to be easy to change
one Database implementation’s behavior when trying to change another’s.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This is hard-coded to read the entire file contents into memory and write that
directly into the database. We could have the cs/blueprints/geom write to a
string, however the ARMI log file contains a hash of each files’ contents. In
the future, we will be able to reproduce calculation showing that the inputs are
identical.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.readInputsFromDB">
<code class="sig-name descname">readInputsFromDB</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.readInputsFromDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.readInputsFromDB" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.mergeHistory">
<code class="sig-name descname">mergeHistory</code><span class="sig-paren">(</span><em class="sig-param">inputDB</em>, <em class="sig-param">startCycle</em>, <em class="sig-param">startNode</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.mergeHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.mergeHistory" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy time step data up to, but not including the passed cycle and node.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This is used for restart runs with the standard operator for example.
The current time step (being loaded from) should not be copied, as that
time steps data will be written at the end of the time step.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.__enter__">
<code class="sig-name descname">__enter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.__enter__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.__enter__" title="Permalink to this definition">¶</a></dt>
<dd><p>Context management support</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.__exit__">
<code class="sig-name descname">__exit__</code><span class="sig-paren">(</span><em class="sig-param">type</em>, <em class="sig-param">value</em>, <em class="sig-param">traceback</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.__exit__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.__exit__" title="Permalink to this definition">¶</a></dt>
<dd><p>Typically we don’t care why it broke but we want the DB to close</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genTimeStepGroups">
<code class="sig-name descname">genTimeStepGroups</code><span class="sig-paren">(</span><em class="sig-param">timeSteps: Sequence[Tuple[int</em>, <em class="sig-param">int]] = None</em><span class="sig-paren">)</span> &#x2192; Generator[h5py._hl.group.Group, None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genTimeStepGroups"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genTimeStepGroups" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a generator of HDF5 Groups for all time nodes, or for the passed selection.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genTimeSteps">
<code class="sig-name descname">genTimeSteps</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Generator[Tuple[int, int], None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genTimeSteps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genTimeSteps" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a generator of (cycle, node) tuples that are present in the DB.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genAuxiliaryData">
<code class="sig-name descname">genAuxiliaryData</code><span class="sig-paren">(</span><em class="sig-param">ts: Tuple[int, int]</em><span class="sig-paren">)</span> &#x2192; Generator[str, None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genAuxiliaryData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genAuxiliaryData" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a generator of names of auxiliary data on the requested time point.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getAuxiliaryDataPath">
<code class="sig-name descname">getAuxiliaryDataPath</code><span class="sig-paren">(</span><em class="sig-param">ts: Tuple[int, int], name: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getAuxiliaryDataPath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getAuxiliaryDataPath" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a string describing a path to an auxiliary data location.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> – The time step that the auxiliary data belongs to</p></li>
<li><p><strong>name</strong> – The name of the auxiliary data</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An absolute location for storing auxiliary data with the given name for the
given time step</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.keys">
<code class="sig-name descname">keys</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.keys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getH5Group">
<code class="sig-name descname">getH5Group</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getH5Group"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getH5Group" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the H5Group for the current ARMI timestep.</p>
<p>This method can be used to allow other interfaces to place data into the database
at the correct timestep.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.hasTimeStep">
<code class="sig-name descname">hasTimeStep</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">statePointName=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.hasTimeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.hasTimeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if (cycle, timeNode, statePointName) is contained in the database.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.writeToDB">
<code class="sig-name descname">writeToDB</code><span class="sig-paren">(</span><em class="sig-param">reactor</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.writeToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.writeToDB" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">node</em>, <em class="sig-param">cs=None</em>, <em class="sig-param">bp=None</em>, <em class="sig-param">geom=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.load" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a new reactor from (cycle, node).</p>
<p>Case settings, blueprints, and geom can be provided by the client, or read from
the database itself. Providing these from the client could be useful when
performing snapshot runs or the like, where it is expected to use results from a
run using different settings, then continue with new settings. Even in this
case, the blueprints and geom should probably be the same as the original run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cycle</strong> (<em>int</em>) – cycle number</p></li>
<li><p><strong>node</strong> (<em>int</em>) – time node</p></li>
<li><p><strong>cs</strong> (<em>armi.settings.Settings</em><em> (</em><em>optional</em><em>)</em>) – if not provided one is read from the database</p></li>
<li><p><strong>bp</strong> (<em>armi.reactor.Blueprints</em><em> (</em><em>Optional</em><em>)</em>) – if not provided one is read from the database</p></li>
<li><p><strong>geom</strong> (<em>armi.geometry.Geometry</em><em> (</em><em>Optional</em><em>)</em>) – if not provided one is read from the database</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistory">
<code class="sig-name descname">getHistory</code><span class="sig-paren">(</span><em class="sig-param">comp: armi.reactor.composites.ArmiObject</em>, <em class="sig-param">params: Sequence[str] = None</em>, <em class="sig-param">timeSteps: Sequence[Tuple[int</em>, <em class="sig-param">int]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[str, Dict[Tuple[int, int], Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistory" title="Permalink to this definition">¶</a></dt>
<dd><p>Get parameter history for a single ARMI Object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comps</strong> – An individual ArmiObject</p></li>
<li><p><strong>params</strong> – parameters to gather</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary of str/list pairs.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistories">
<code class="sig-name descname">getHistories</code><span class="sig-paren">(</span><em class="sig-param">comps: Sequence[armi.reactor.composites.ArmiObject], params: Optional[Sequence[str]] = None, timeSteps: Optional[Sequence[Tuple[int, int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[armi.reactor.composites.ArmiObject, Dict[str, Dict[Tuple[int, int], Any]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistories" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the parameter histories for a sequence of ARMI Objects.</p>
<p>This implementation is unaware of the state of the reactor outside of the
database itself, and is therefore not usually what client code should be calling
directly. It only knows about historical data that actually exists in the
database. Usually one wants to be able to get historical, plus current data, for
which the similar method on the DatabaseInterface is more useful.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comps</strong> – Something that is iterable multiple times</p></li>
<li><p><strong>params</strong> – parameters to gather.</p></li>
<li><p><strong>timeSteps</strong> – Selection of time nodes to get data for. If omitted, return full history</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary ArmiObject (input): dict of str/list pairs containing ((cycle,
node), value).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.Layout">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">Layout</code><span class="sig-paren">(</span><em class="sig-param">h5group=None</em>, <em class="sig-param">comp=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The Layout class describes the hierarchical layout of the composite structure in a flat representation.</p>
<p>A Layout is built up by starting at the root of a composite tree and recursively
appending each node in the tree to the list of data. So for a typical Reactor model,
the data will be ordered something like [r, c, a1, a1b1, a1b1c1, a1b1c2, a1b2,
a1b2c1, …, a2, …]</p>
<p>The layout is also responsible for storing Component attributes, like location,
material, and temperatures (from blueprints), which aren’t stored as Parameters.
Temperatures, specifically, are rather complicated beasts in ARMI, and more
fundamental changes to how we deal with them may allow us to remove them from
Layout.</p>
<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout.writeToDB">
<code class="sig-name descname">writeToDB</code><span class="sig-paren">(</span><em class="sig-param">h5group</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout.writeToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout.writeToDB" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.allSubclasses">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">allSubclasses</code><span class="sig-paren">(</span><em class="sig-param">cls</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#allSubclasses"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.allSubclasses" title="Permalink to this definition">¶</a></dt>
<dd><p>This currently include Materials… and it should not.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.packSpecialData">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">packSpecialData</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; Tuple[Optional[numpy.ndarray], Dict[str, Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#packSpecialData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.packSpecialData" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduce data that wouldn’t otherwise play nicely with HDF5/numpy arrays to a format
that will.</p>
<p>This is the main entry point for conforming “strange” data into something that will
both fit into a numpy array/HDF5 dataset, and be recoverable to its original-ish
state when reading it back in. This is accomplished by detecting a handful of known
offenders and using various HDF5 attributes to store necessary auxiliary data. It is
important to keep in mind that the data that is passed in has already been converted
to a numpy array, so the top dimension is always representing the collection of
composites that are storing the parameters. For instance, if we are dealing with a
Block parameter, the first index in the numpy array of data is the block index; so
if each block has a parameter that is a dictionary, <code class="docutils literal notranslate"><span class="pre">data</span></code> would be a ndarray,
where each element is a dictionary. This routine supports a number of different
“strange” things:
* Dict[str, float]: These are stored by finding the set of all keys for all</p>
<blockquote>
<div><p>instances, and storing those keys as a list in an attribute. The data themselves
are stored as arrays indexed by object, then key index. Dictionaries lacking data
for a key store a nan in it’s place. This will work well in instances where most
objects have data for most keys.</p>
</div></blockquote>
<ul class="simple">
<li><p>Jagged arrays: These are stored by concatenating all of the data into a single,
one-dimensional array, and storing attributes to describe the shapes of each
object’s data, and an offset into the beginning of each object’s data.</p></li>
<li><p>Arrays with <code class="docutils literal notranslate"><span class="pre">None</span></code> in them: These are stored by replacing each instance of
<code class="docutils literal notranslate"><span class="pre">None</span></code> with a magical value that shouldn’t be encountered in realistic
scenarios.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – An ndarray storing the data that we want to stuff into the database. These are
usually dtype=Object, which is how we usually end up here in the first place.</p></li>
<li><p><strong>paramName</strong> – The parameter name that we are trying to store data for. This is mostly used for
diagnostics.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.unpackSpecialData" title="armi.bookkeeping.db.database3.unpackSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpackSpecialData()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.unpackSpecialData">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">unpackSpecialData</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">attrs</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#unpackSpecialData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.unpackSpecialData" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract data from a specially-formatted HDF5 dataset into a numpy array.</p>
<p>This should invert the operations performed by <a class="reference internal" href="#armi.bookkeeping.db.database3.packSpecialData" title="armi.bookkeeping.db.database3.packSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">packSpecialData()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – Specially-formatted data array straight from the database.</p></li>
<li><p><strong>attrs</strong> – The attributes associated with the dataset that contained the data.</p></li>
<li><p><strong>paramName</strong> – The name of the parameter that is being unpacked. Only used for diagnostics.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An ndarray containing the closest possible representation of the data that was
originally written to the database.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.packSpecialData" title="armi.bookkeeping.db.database3.packSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">packSpecialData()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.replaceNonsenseWithNones">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">replaceNonsenseWithNones</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#replaceNonsenseWithNones"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.replaceNonsenseWithNones" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace special nonsense values with <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>This essentially reverses the operations performed by
<a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="armi.bookkeeping.db.database3.replaceNonesWithNonsense"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonesWithNonsense()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – The array from the database that contains special <code class="docutils literal notranslate"><span class="pre">None</span></code> nonsense values.</p></li>
<li><p><strong>paramName</strong> – The param name who’s data we are dealing with. Only used for diagnostics.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="armi.bookkeeping.db.database3.replaceNonesWithNonsense"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonesWithNonsense()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.replaceNonesWithNonsense">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">replaceNonesWithNonsense</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em>, <em class="sig-param">nones: numpy.ndarray = None</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#replaceNonesWithNonsense"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="Permalink to this definition">¶</a></dt>
<dd><p>Replace instances of <code class="docutils literal notranslate"><span class="pre">None</span></code> with nonsense values that can be detected/recovered
when reading.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – The numpy array containing <code class="docutils literal notranslate"><span class="pre">None</span></code> values that need to be replaced.</p></li>
<li><p><strong>paramName</strong> – The name of the parameter who’s data we are treating. Only used for diagnostics.</p></li>
<li><p><strong>nones</strong> – An array containing the index locations on the <code class="docutils literal notranslate"><span class="pre">None</span></code> elements. It is a little
strange to pass these, in but we find these indices to determine whether we need
to call this function in the first place, so might as well pass it in, so that
we don’t need to perform the operation again.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This only supports situations where the data is a straight-up <code class="docutils literal notranslate"><span class="pre">None</span></code>, or a valid,
database-storable numpy array (or easily convertable to one (e.g. tuples/lists with
numerical values)). This does not support, for instance, a numpy ndarray with some
Nones in it.</p>
<p>For example, the following is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
</pre></div>
</div>
<p>However, the following is not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonsenseWithNones" title="armi.bookkeeping.db.database3.replaceNonsenseWithNones"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonsenseWithNones()</span></code></a></dt><dd><p>Reverses this operation.</p>
</dd>
</dl>
</div>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="armi.bookkeeping.db.factory.html" class="btn btn-neutral float-right" title="armi.bookkeeping.db.factory module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="armi.bookkeeping.db.database.html" class="btn btn-neutral float-left" title="armi.bookkeeping.db.database module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2019, TerraPower, LLC
      <span class="lastupdated">
        Last updated on 2019-11-05.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>