

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta property="og:title" content="armi.bookkeeping.db.database3 module" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://terrapower.github.io/armi/.apidocs/armi.bookkeeping.db.database3.html" />
  <meta property="og:site_name" content="Advanced Reactor Modeling Interface" />
  <meta property="og:description" content="ARMI Database implementation, version 3. This Implementation of the database is a significant departure from the previous. One of the foundational concepts in this version is that a reactor model s..." />
  <meta property="og:image" content="https://terrapower.github.io/armi/_static/armiSchematicView.png" />
  <meta property="og:image:alt" content="Advanced Reactor Modeling Interface" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.bookkeeping.db.database3 module &mdash; ARMI 0.1.7 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="armi.bookkeeping.db.factory module" href="armi.bookkeeping.db.factory.html" />
    <link rel="prev" title="armi.bookkeeping.db.database module" href="armi.bookkeeping.db.database.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../blog/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API Docs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="armi.html">armi package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="armi.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="armi.bookkeeping.html">armi.bookkeeping package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.cases.html">armi.cases package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.cli.html">armi.cli package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.materials.html">armi.materials package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.nucDirectory.html">armi.nucDirectory package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.nuclearDataIO.html">armi.nuclearDataIO package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.operators.html">armi.operators package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.physics.html">armi.physics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.reactor.html">armi.reactor package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.scripts.html">armi.scripts package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.settings.html">armi.settings package</a></li>
<li class="toctree-l4"><a class="reference internal" href="armi.utils.html">armi.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="armi.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">armi</a> &raquo;</li>
        
          <li><a href="armi.html">armi package</a> &raquo;</li>
        
          <li><a href="armi.bookkeeping.html">armi.bookkeeping package</a> &raquo;</li>
        
          <li><a href="armi.bookkeeping.db.html">armi.bookkeeping.db package</a> &raquo;</li>
        
      <li>armi.bookkeeping.db.database3 module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/terrapower/armi/blob/master/doc/.apidocs/armi.bookkeeping.db.database3.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-armi.bookkeeping.db.database3">
<span id="armi-bookkeeping-db-database3-module"></span><h1>armi.bookkeeping.db.database3 module<a class="headerlink" href="#module-armi.bookkeeping.db.database3" title="Permalink to this headline">Â¶</a></h1>
<p>ARMI Database implementation, version 3.</p>
<p>This Implementation of the database is a significant departure from the previous. One of
the foundational concepts in this version is that a reactor model should be fully
recoverable from the database itself; all the way down to the component level. As a
result, the structure of the underlying data is bound to the hierarchical Composite
Reactor Model, rather than an ad hoc collection of Block parameter fields and other
parameters. Furthermore, this format is intended to be more dynamic, permitting as-yet
undeveloped levels and classes in the Composite Reactor Model to be supported as they
are added. More high-level discussion is contained in <a class="reference internal" href="../user/outputs/database.html"><span class="doc">The Database File</span></a>.</p>
<p>The most important contents of this module are the <a class="reference internal" href="#armi.bookkeeping.db.database3.DatabaseInterface" title="armi.bookkeeping.db.database3.DatabaseInterface"><code class="xref py py-class docutils literal notranslate"><span class="pre">DatabaseInterface</span></code></a>, the
<a class="reference internal" href="#armi.bookkeeping.db.database3.Database3" title="armi.bookkeeping.db.database3.Database3"><code class="xref py py-class docutils literal notranslate"><span class="pre">Database3</span></code></a> class, the <a class="reference internal" href="#armi.bookkeeping.db.database3.Layout" title="armi.bookkeeping.db.database3.Layout"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layout</span></code></a> class, and the special data
packing/unpacking functions. The <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class contains most of the functionality
for interacting with the underlying data. This includes things like dumping a Reactor
state to the database and loading it back again, as well as extracting historical data
for a given object or collection of object from the database file. When interacting with
the database file, the <code class="docutils literal notranslate"><span class="pre">Layout</span></code> class is used to help map the hierarchical Composite
Reactor Model to the flat representation in the database.</p>
<p>Refer to <a class="reference internal" href="armi.bookkeeping.db.html#module-armi.bookkeeping.db" title="armi.bookkeeping.db"><code class="xref py py-mod docutils literal notranslate"><span class="pre">armi.bookkeeping.db</span></code></a> for notes about versioning.</p>
<div class="section" id="minor-revision-changelog">
<h2>Minor revision changelog<a class="headerlink" href="#minor-revision-changelog" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>3.1: Improve the handling of reading/writing grids.</p></li>
<li><p>3.2: Change the strategy for storing large attributes from using an Object Reference
to an external dataset to using a special string starting with an â&#64;â symbol (e.g.,
â&#64;/c00n00/attrs/5_linkedDimsâ). This was done to support copying time node datasets
from one file to another without invalidating the references. Support is maintained
for reading previous versions, and for performing a <code class="docutils literal notranslate"><span class="pre">mergeHistory()</span></code> and converting
to the new reference strategy, but the old version cannot be written.</p></li>
<li><p>3.3: Compress the way locations are stored in the database and allow MultiIndex
locations to be read and written.</p></li>
<li><p>3.4: Modified the way that locations are stored in the database to include complete
indices for indices that can be composed from multiple grids. This was done since the
space is already being used to be able to store them, and because having complete
indices allows for more efficient means of extracting information based on location
without having to compose the full model.</p></li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="armi.bookkeeping.db.database3.getH5GroupName">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">getH5GroupName</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#getH5GroupName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.getH5GroupName" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.describeInterfaces">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">describeInterfaces</code><span class="sig-paren">(</span><em class="sig-param">cs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#describeInterfaces"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.describeInterfaces" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Function for exposing interface(s) to other code</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.updateGlobalAssemblyNum">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">updateGlobalAssemblyNum</code><span class="sig-paren">(</span><em class="sig-param">r</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#updateGlobalAssemblyNum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.updateGlobalAssemblyNum" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">DatabaseInterface</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">cs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="armi.interfaces.html#armi.interfaces.Interface" title="armi.interfaces.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.interfaces.Interface</span></code></a></p>
<p>Handles interactions between the ARMI data model and the persistent data storage
system.</p>
<p>This reads/writes the ARMI state to/from the database and helps derive state
information that can be derived.</p>
<p>Construct an interface.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">r</span></code> and <code class="docutils literal notranslate"><span class="pre">cs</span></code> arguments are required, but may be <code class="docutils literal notranslate"><span class="pre">None</span></code>, where
appropriate for the specific <code class="docutils literal notranslate"><span class="pre">Interface</span></code> implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> (<a class="reference internal" href="armi.reactor.reactors.html#armi.reactor.reactors.Reactor" title="armi.reactor.reactors.Reactor"><em>Reactor</em></a>) â A reactor to attach to</p></li>
<li><p><strong>cs</strong> (<a class="reference internal" href="armi.settings.caseSettings.html#armi.settings.caseSettings.Settings" title="armi.settings.caseSettings.Settings"><em>Settings</em></a>) â Settings object to use</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.10)"><strong>RuntimeError</strong></a> â Interfaces derived from Interface must define their name</p>
</dd>
</dl>
<dl class="attribute">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.name">
<code class="sig-name descname">name</code><em class="property"> = 'database'</em><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.name" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.database">
<em class="property">property </em><code class="sig-name descname">database</code><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.database" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Presents the internal database object, if it exists.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactBOL">
<code class="sig-name descname">interactBOL</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactBOL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactBOL" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Initialize the database if the main interface was not available. (Begining of Life)</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.initDB">
<code class="sig-name descname">initDB</code><span class="sig-paren">(</span><em class="sig-param">fName: Optional[os.PathLike] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.initDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.initDB" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Open the underlying database to be written to, and write input files to DB.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Main Interface calls this so that the database is available as early as
possible in the run. The database interface interacts near the end of the
interface stack (so that all the parameters have been updated) while the Main
Interface interacts first.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEveryNode">
<code class="sig-name descname">interactEveryNode</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">node</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEveryNode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEveryNode" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Write to database.</p>
<p>DBs should receive the state information of the run at each node.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEOC">
<code class="sig-name descname">interactEOC</code><span class="sig-paren">(</span><em class="sig-param">cycle=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEOC"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEOC" title="Permalink to this definition">Â¶</a></dt>
<dd><p>In case anything changed since last cycle (e.g. rxSwing), update DB. (End of Cycle)</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactEOL">
<code class="sig-name descname">interactEOL</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactEOL"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactEOL" title="Permalink to this definition">Â¶</a></dt>
<dd><p>DBâs should be closed at runâs end. (End of Life)</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactError">
<code class="sig-name descname">interactError</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactError" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get shutdown state information even if the run encounters an error</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.interactDistributeState">
<code class="sig-name descname">interactDistributeState</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; None<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.interactDistributeState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.interactDistributeState" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Reconnect to pre-existing database.</p>
<p>DB is created and managed by the master node only but we can still connect to it
from workers to enable things like history tracking.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.distributable">
<code class="sig-name descname">distributable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.distributable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.distributable" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return true if this can be MPI broadcast.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Cases where this isnât possible include the database interface,
where the SQL driver cannot be distributed.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.prepRestartRun">
<code class="sig-name descname">prepRestartRun</code><span class="sig-paren">(</span><em class="sig-param">dbCycle</em>, <em class="sig-param">dbNode</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.prepRestartRun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.prepRestartRun" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Load the data history from the database being restarted from.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface._getLoadDB">
<code class="sig-name descname">_getLoadDB</code><span class="sig-paren">(</span><em class="sig-param">fileName</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface._getLoadDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface._getLoadDB" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return the database to load from in order of preference.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>If filename is present only returns one database since specifically instructed
to load from that database.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.loadState">
<code class="sig-name descname">loadState</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">timeStepName=''</em>, <em class="sig-param">fileName=None</em>, <em class="sig-param">updateGlobalAssemNum=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.loadState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.loadState" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Loads a fresh reactor and applies it to the Operator.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Will load preferentially from the <cite>fileName</cite> if passed. Otherwise will load from
existing database in memory or <cite>cs[âreloadDBNameâ]</cite> in that order.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.10)"><strong>RuntimeError</strong></a> â If fileName is specified and that  file does not have the time step.
    If fileName is not specified and neither the database in memory, nor the
    <cite>cs[âreloadDBNameâ]</cite> have the time step specified.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.getHistory">
<code class="sig-name descname">getHistory</code><span class="sig-paren">(</span><em class="sig-param">comp: armi.reactor.composites.ArmiObject</em>, <em class="sig-param">params: Optional[Sequence[str]] = None</em>, <em class="sig-param">timeSteps: Optional[MutableSequence[Tuple[int</em>, <em class="sig-param">int]]] = None</em>, <em class="sig-param">byLocation: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict[str, Dict[Tuple[int, int], Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.getHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.getHistory" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get historical parameter values for a single object.</p>
<p>This is mostly a wrapper around the same function on the <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class,
but knows how to return the current value as well.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.Database3.getHistory" title="armi.bookkeeping.db.database3.Database3.getHistory"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Database3.getHistory()</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.DatabaseInterface.getHistories">
<code class="sig-name descname">getHistories</code><span class="sig-paren">(</span><em class="sig-param">comps: Sequence[armi.reactor.composites.ArmiObject], params: Optional[Sequence[str]] = None, timeSteps: Optional[MutableSequence[Tuple[int, int]]] = None, byLocation: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict[armi.reactor.composites.ArmiObject, Dict[str, Dict[Tuple[int, int], Any]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#DatabaseInterface.getHistories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.DatabaseInterface.getHistories" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get historical parameter values for one or more objects.</p>
<p>This is mostly a wrapper around the same function on the <code class="docutils literal notranslate"><span class="pre">Database3</span></code> class,
but knows how to return the current value as well.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.Database3.getHistories" title="armi.bookkeeping.db.database3.Database3.getHistories"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Database3.getHistories()</span></code></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.Database3">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">Database3</code><span class="sig-paren">(</span><em class="sig-param">fileName: os.PathLike</em>, <em class="sig-param">permission: str</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="armi.bookkeeping.db.database.html#armi.bookkeeping.db.database.Database" title="armi.bookkeeping.db.database.Database"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.bookkeeping.db.database.Database</span></code></a></p>
<p>Version 3 of the ARMI Database, handling serialization and loading of Reactor states.</p>
<p>This implementation of the database pushes all objects in the Composite Reactor
Model into the database. This process is aided by the <code class="docutils literal notranslate"><span class="pre">Layout</span></code> class, which
handles the packing and unpacking of the structure of the objects, their
relationships, and their non-parameter attributes.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><cite>doc/user/outputs/database</cite> for more details.</p>
</div>
<p>Create a new Database3 object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fileName</strong> â name of the file</p></li>
<li><p><strong>permission</strong> â file permissions, write (âwâ) or read (ârâ)</p></li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="armi.bookkeeping.db.database3.Database3.timeNodeGroupPattern">
<code class="sig-name descname">timeNodeGroupPattern</code><em class="property"> = re.compile('^c(\\d\\d)n(\\d\\d)$')</em><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.timeNodeGroupPattern" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.version">
<em class="property">property </em><code class="sig-name descname">version</code><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.version" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.versionMajor">
<em class="property">property </em><code class="sig-name descname">versionMajor</code><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.versionMajor" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.versionMinor">
<em class="property">property </em><code class="sig-name descname">versionMinor</code><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.versionMinor" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.open">
<code class="sig-name descname">open</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.open"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.open" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.grabLocalCommitHash">
<em class="property">static </em><code class="sig-name descname">grabLocalCommitHash</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.grabLocalCommitHash"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.grabLocalCommitHash" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Try to determine the local Git commit.</p>
<p>We have to be sure to handle the errors where the code is run on a system that
doesnât have Git installed. Or if the code is simply not run from inside a repo.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The commit hash if it exists, otherwise âunknownâ.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.close">
<code class="sig-name descname">close</code><span class="sig-paren">(</span><em class="sig-param">completedSuccessfully=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.close" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Close the DB and perform cleanups and auto-conversions.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.splitDatabase">
<code class="sig-name descname">splitDatabase</code><span class="sig-paren">(</span><em class="sig-param">keepTimeSteps: Sequence[Tuple[int, int]], label: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.splitDatabase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.splitDatabase" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Discard all data except for specific time steps, retaining old data in a separate file.</p>
<p>This is useful when performing more exotic analyses, where each âtime stepâ may
not represent a specific point in time, but something more nuanced. For example,
equilibrium cases store a new âcycleâ for each iteration as it attempts to
converge the equilibrium cycle. At the end of the run, the last âcycleâ is the
converged equilibrium cycle, whereas the previous cycles constitute the path to
convergence, which we typically wish to discard before further analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keepTimeSteps</strong> â A collection of the time steps to retain</p></li>
<li><p><strong>label</strong> â An informative label for the backed-up database. Usually something like
â-all-iterationsâ. Will be interposed between the source name and the â.h5â
extension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The name of the new, backed-up database file.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.fileName">
<em class="property">property </em><code class="sig-name descname">fileName</code><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.fileName" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadCS">
<code class="sig-name descname">loadCS</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadCS"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadCS" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Attempt to load settings from the database file</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>There are no guarantees here. If the database was written from a different version of ARMI than you are using,
these results may not be usable. For instance, the database could have been written from a vastly old or future
version of ARMI from the code you are using.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadBlueprints">
<code class="sig-name descname">loadBlueprints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadBlueprints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadBlueprints" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Attempt to load reactor blueprints from the database file</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>There are no guarantees here. If the database was written from a different version of ARMI than you are using,
these results may not be usable. For instance, the database could have been written from a vastly old or future
version of ARMI from the code you are using.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.loadGeometry">
<code class="sig-name descname">loadGeometry</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.loadGeometry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.loadGeometry" title="Permalink to this definition">Â¶</a></dt>
<dd><p>This is primarily just used for migrations.
The âgeometry filesâ were replaced by <code class="docutils literal notranslate"><span class="pre">systems:</span></code> and <code class="docutils literal notranslate"><span class="pre">grids:</span></code> sections of <code class="docutils literal notranslate"><span class="pre">Blueprints</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.writeInputsToDB">
<code class="sig-name descname">writeInputsToDB</code><span class="sig-paren">(</span><em class="sig-param">cs</em>, <em class="sig-param">csString=None</em>, <em class="sig-param">geomString=None</em>, <em class="sig-param">bpString=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.writeInputsToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.writeInputsToDB" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Write inputs into the database based the CaseSettings.</p>
<p>This is not DRY on purpose. The goal is that any particular Database
implementation should be very stable, so we dont want it to be easy to change
one Database implementationâs behavior when trying to change anotherâs.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This is hard-coded to read the entire file contents into memory and write that
directly into the database. We could have the cs/blueprints/geom write to a
string, however the ARMI log file contains a hash of each filesâ contents. In
the future, we should be able to reproduce a calculation with confidence that
the inputs are identical.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.readInputsFromDB">
<code class="sig-name descname">readInputsFromDB</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.readInputsFromDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.readInputsFromDB" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.mergeHistory">
<code class="sig-name descname">mergeHistory</code><span class="sig-paren">(</span><em class="sig-param">inputDB</em>, <em class="sig-param">startCycle</em>, <em class="sig-param">startNode</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.mergeHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.mergeHistory" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Copy time step data up to, but not including the passed cycle and node.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This is used for restart runs with the standard operator for example.
The current time step (being loaded from) should not be copied, as that
time steps data will be written at the end of the time step.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.__enter__">
<code class="sig-name descname">__enter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.__enter__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.__enter__" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Context management support</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.__exit__">
<code class="sig-name descname">__exit__</code><span class="sig-paren">(</span><em class="sig-param">type</em>, <em class="sig-param">value</em>, <em class="sig-param">traceback</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.__exit__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.__exit__" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Typically we donât care why it broke but we want the DB to close</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genTimeStepGroups">
<code class="sig-name descname">genTimeStepGroups</code><span class="sig-paren">(</span><em class="sig-param">timeSteps: Sequence[Tuple[int</em>, <em class="sig-param">int]] = None</em><span class="sig-paren">)</span> &#x2192; Generator[h5py._hl.group.Group, None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genTimeStepGroups"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genTimeStepGroups" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Returns a generator of HDF5 Groups for all time nodes, or for the passed selection.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getLayout">
<code class="sig-name descname">getLayout</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">node</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getLayout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getLayout" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return a Layout object representing the requested cycle and time node.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genTimeSteps">
<code class="sig-name descname">genTimeSteps</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Generator[Tuple[int, int], None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genTimeSteps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genTimeSteps" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Returns a generator of (cycle, node) tuples that are present in the DB.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.genAuxiliaryData">
<code class="sig-name descname">genAuxiliaryData</code><span class="sig-paren">(</span><em class="sig-param">ts: Tuple[int, int]</em><span class="sig-paren">)</span> &#x2192; Generator[str, None, None]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.genAuxiliaryData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.genAuxiliaryData" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Returns a generator of names of auxiliary data on the requested time point.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getAuxiliaryDataPath">
<code class="sig-name descname">getAuxiliaryDataPath</code><span class="sig-paren">(</span><em class="sig-param">ts: Tuple[int, int], name: str</em><span class="sig-paren">)</span> &#x2192; str<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getAuxiliaryDataPath"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getAuxiliaryDataPath" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get a string describing a path to an auxiliary data location.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> â The time step that the auxiliary data belongs to</p></li>
<li><p><strong>name</strong> â The name of the auxiliary data</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An absolute location for storing auxiliary data with the given name for the
given time step</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.keys">
<code class="sig-name descname">keys</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.keys"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.keys" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getH5Group">
<code class="sig-name descname">getH5Group</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getH5Group"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getH5Group" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get the H5Group for the current ARMI timestep.</p>
<p>This method can be used to allow other interfaces to place data into the database
at the correct timestep.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.hasTimeStep">
<code class="sig-name descname">hasTimeStep</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">timeNode</em>, <em class="sig-param">statePointName=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.hasTimeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.hasTimeStep" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Returns True if (cycle, timeNode, statePointName) is contained in the database.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.writeToDB">
<code class="sig-name descname">writeToDB</code><span class="sig-paren">(</span><em class="sig-param">reactor</em>, <em class="sig-param">statePointName=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.writeToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.writeToDB" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Write reactor data to the DB</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.syncToSharedFolder">
<code class="sig-name descname">syncToSharedFolder</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.syncToSharedFolder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.syncToSharedFolder" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Copy DB to run working directory.</p>
<p>Needed when multiple MPI processes need to read the same db, for example
when a history is needed from independent runs (e.g. for fuel performance on
a variety of assemblies).</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>At some future point, we may implement a client-server like DB system which
would render this kind of operation unnecessary.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param">cycle</em>, <em class="sig-param">node</em>, <em class="sig-param">cs=None</em>, <em class="sig-param">bp=None</em>, <em class="sig-param">statePointName=None</em>, <em class="sig-param">allowMissing=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.load"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.load" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Load a new reactor from (cycle, node).</p>
<p>Case settings, blueprints, and geom can be provided by the client, or read from
the database itself. Providing these from the client could be useful when
performing snapshot runs or the like, where it is expected to use results from a
run using different settings, then continue with new settings. Even in this
case, the blueprints and geom should probably be the same as the original run.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cycle</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) â cycle number</p></li>
<li><p><strong>node</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) â time node</p></li>
<li><p><strong>cs</strong> (<em>armi.settings.Settings</em><em> (</em><em>optional</em><em>)</em>) â if not provided one is read from the database</p></li>
<li><p><strong>bp</strong> (<em>armi.reactor.Blueprints</em><em> (</em><em>Optional</em><em>)</em>) â if not provided one is read from the database</p></li>
<li><p><strong>statePointName</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) â Optional arbitrary statepoint name (e.g., âspecialâ for âc00n00-special/â)</p></li>
<li><p><strong>allowMissing</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) â Whether to emit a warning, rather than crash if reading a database
with undefined parameters. Default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>root</strong> â The top-level object stored in the database; usually a Reactor.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="armi.reactor.composites.html#armi.reactor.composites.ArmiObject" title="armi.reactor.composites.ArmiObject">ArmiObject</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3._assignBlueprintsParams">
<em class="property">static </em><code class="sig-name descname">_assignBlueprintsParams</code><span class="sig-paren">(</span><em class="sig-param">blueprints</em>, <em class="sig-param">groupedComps</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3._assignBlueprintsParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3._assignBlueprintsParams" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3._compose">
<code class="sig-name descname">_compose</code><span class="sig-paren">(</span><em class="sig-param">comps</em>, <em class="sig-param">cs</em>, <em class="sig-param">parent=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3._compose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3._compose" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Given a flat collection of all of the ArmiObjects in the model, reconstitute the hierarchy.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3._writeParams">
<code class="sig-name descname">_writeParams</code><span class="sig-paren">(</span><em class="sig-param">h5group</em>, <em class="sig-param">comps</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3._writeParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3._writeParams" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3._addHomogenizedNumberDensityParams">
<em class="property">static </em><code class="sig-name descname">_addHomogenizedNumberDensityParams</code><span class="sig-paren">(</span><em class="sig-param">blocks</em>, <em class="sig-param">h5group</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3._addHomogenizedNumberDensityParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3._addHomogenizedNumberDensityParams" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Create on-the-fly block homog. number density params for XTVIEW viewing.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.collectBlockNumberDensities" title="armi.bookkeeping.db.database3.collectBlockNumberDensities"><code class="xref py py-meth docutils literal notranslate"><span class="pre">collectBlockNumberDensities()</span></code></a></p>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3._readParams">
<em class="property">static </em><code class="sig-name descname">_readParams</code><span class="sig-paren">(</span><em class="sig-param">h5group</em>, <em class="sig-param">compTypeName</em>, <em class="sig-param">comps</em>, <em class="sig-param">allowMissing=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3._readParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3._readParams" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistoryByLocation">
<code class="sig-name descname">getHistoryByLocation</code><span class="sig-paren">(</span><em class="sig-param">comp: armi.reactor.composites.ArmiObject</em>, <em class="sig-param">params: Optional[List[str]] = None</em>, <em class="sig-param">timeSteps: Optional[Sequence[Tuple[int</em>, <em class="sig-param">int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[str, Dict[Tuple[int, int], Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistoryByLocation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistoryByLocation" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get the parameter histories at a specific location.</p>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistoriesByLocation">
<code class="sig-name descname">getHistoriesByLocation</code><span class="sig-paren">(</span><em class="sig-param">comps: Sequence[armi.reactor.composites.ArmiObject], params: Optional[List[str]] = None, timeSteps: Optional[Sequence[Tuple[int, int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[armi.reactor.composites.ArmiObject, Dict[str, Dict[Tuple[int, int], Any]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistoriesByLocation"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistoriesByLocation" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get the parameter histories at specific locations.</p>
<dl class="simple">
<dt>This has a number of limitations, which should in practice not be too limiting:</dt><dd><ul class="simple">
<li><p>The passed objects must have IndexLocations. This type of operation doesnât
make much sense otherwise.</p></li>
<li><p>The passed objects must exist in a hierarchy that leads to a Core
object, which serves as an anchor that can fully define all index locations.
This could possibly be made more general by extending grids, but that gets a
little more complicated.</p></li>
<li><p>All requested objects must exist under the <strong>same</strong> anchor object, and at the
same depth below it.</p></li>
<li><p>All requested objects must have the same type.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comps</strong> (<em>list of ArmiObject</em>) â The components/composites that currently occupy the location that you want
histories at. ArmiObjects are passed, rather than locations, because this
makes it easier to figure out things related to layout.</p></li>
<li><p><strong>params</strong> (<em>List of str</em><em>, </em><em>optional</em>) â The parameter names for the parameters that we want the history of. If None,
all parameter history is given</p></li>
<li><p><strong>timeSteps</strong> (<em>List of</em><em> (</em><em>cycle</em><em>, </em><em>node</em><em>) </em><em>tuples</em><em>, </em><em>optional</em>) â The time nodes that you want history for. If None, all available time nodes
will be returned.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistory">
<code class="sig-name descname">getHistory</code><span class="sig-paren">(</span><em class="sig-param">comp: armi.reactor.composites.ArmiObject</em>, <em class="sig-param">params: Optional[Sequence[str]] = None</em>, <em class="sig-param">timeSteps: Optional[Sequence[Tuple[int</em>, <em class="sig-param">int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[str, Dict[Tuple[int, int], Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistory" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get parameter history for a single ARMI Object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comps</strong> â An individual ArmiObject</p></li>
<li><p><strong>params</strong> â parameters to gather</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary of str/list pairs.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Database3.getHistories">
<code class="sig-name descname">getHistories</code><span class="sig-paren">(</span><em class="sig-param">comps: Sequence[armi.reactor.composites.ArmiObject], params: Optional[Sequence[str]] = None, timeSteps: Optional[Sequence[Tuple[int, int]]] = None</em><span class="sig-paren">)</span> &#x2192; Dict[armi.reactor.composites.ArmiObject, Dict[str, Dict[Tuple[int, int], Any]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Database3.getHistories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Database3.getHistories" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Get the parameter histories for a sequence of ARMI Objects.</p>
<p>This implementation is unaware of the state of the reactor outside of the
database itself, and is therefore not usually what client code should be calling
directly during normal ARMI operation. It only knows about historical data that
have actually been written to the database. Usually one wants to be able to get
historical, plus current data, for which the similar method on the
DatabaseInterface may be more useful.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comps</strong> â Something that is iterable multiple times</p></li>
<li><p><strong>params</strong> â parameters to gather.</p></li>
<li><p><strong>timeSteps</strong> â Selection of time nodes to get data for. If omitted, return full history</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary ArmiObject (input): dict of str/list pairs containing ((cycle,
node), value).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._packLocations">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_packLocations</code><span class="sig-paren">(</span><em class="sig-param">locations: List[armi.reactor.grids.LocationBase], minorVersion: int = 4</em><span class="sig-paren">)</span> &#x2192; Tuple[List[str], List[Tuple[int, int, int]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_packLocations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._packLocations" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Extract information from a location needed to write it to this DB.</p>
<p>Each locator has one locationType and up to N location-defining datums,
where N is the number of entries in a possible multiindex, or just 1
for everything else.</p>
<p>Shrink grid locator names for storage efficiency.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>Contains some conditionals to still load databases made before
db version 3.3 which can be removed once no users care about
those DBs anymore.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._packLocationsV1">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_packLocationsV1</code><span class="sig-paren">(</span><em class="sig-param">locations: List[armi.reactor.grids.LocationBase]</em><span class="sig-paren">)</span> &#x2192; Tuple[List[str], List[Tuple[int, int, int]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_packLocationsV1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._packLocationsV1" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Delete when reading v &lt;=3.2 DBâs no longer wanted.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._packLocationsV2">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_packLocationsV2</code><span class="sig-paren">(</span><em class="sig-param">locations: List[armi.reactor.grids.LocationBase]</em><span class="sig-paren">)</span> &#x2192; Tuple[List[str], List[Tuple[int, int, int]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_packLocationsV2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._packLocationsV2" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Location packing implementation for minor version 3. See release notes above.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._packLocationsV3">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_packLocationsV3</code><span class="sig-paren">(</span><em class="sig-param">locations: List[armi.reactor.grids.LocationBase]</em><span class="sig-paren">)</span> &#x2192; Tuple[List[str], List[Tuple[int, int, int]]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_packLocationsV3"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._packLocationsV3" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Location packing implementation for minor version 4. See release notes above.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._unpackLocations">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_unpackLocations</code><span class="sig-paren">(</span><em class="sig-param">locationTypes</em>, <em class="sig-param">locData</em>, <em class="sig-param">minorVersion: int = 4</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_unpackLocations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._unpackLocations" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Convert location data as read from DB back into data structure for building reactor model.</p>
<p>location and locationType will only have different lengths when multiindex locations
are used.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._unpackLocationsV1">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_unpackLocationsV1</code><span class="sig-paren">(</span><em class="sig-param">locationTypes</em>, <em class="sig-param">locData</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_unpackLocationsV1"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._unpackLocationsV1" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Delete when reading v &lt;=3.2 DBâs no longer wanted.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._unpackLocationsV2">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_unpackLocationsV2</code><span class="sig-paren">(</span><em class="sig-param">locationTypes</em>, <em class="sig-param">locData</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_unpackLocationsV2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._unpackLocationsV2" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Location unpacking implementation for minor version 3+. See release notes above.</p>
</dd></dl>

<dl class="class">
<dt id="armi.bookkeeping.db.database3.Layout">
<em class="property">class </em><code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">Layout</code><span class="sig-paren">(</span><em class="sig-param">version: Tuple[int, int], h5group=None, comp=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>The Layout class describes the hierarchical layout of the composite Reactor model in a flat representation.</p>
<p>A Layout is built up by starting at the root of a composite tree and recursively
appending each node in the tree to the list of data. So for a typical Reactor model,
the data will be ordered by depth-first search: [r, c, a1, a1b1, a1b1c1, a1b1c2, a1b2,
a1b2c1, â¦, a2, â¦].</p>
<p>The layout is also responsible for storing Component attributes, like location,
material, and temperatures (from blueprints), which arenât stored as Parameters.
Temperatures, specifically, are rather complicated beasts in ARMI, and more
fundamental changes to how we deal with them may allow us to remove them from
Layout.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>As this format is liable to be consumed by other code, it is important to specify
its structure so that code attempting to read/write Layouts can make safe
assumptions. Below is a list of things to be aware of. More will be added as issues
arise or things become more precise:</p>
<blockquote>
<div><ul class="simple">
<li><p>Elements in Layout are stored in depth-first order. This permits use of
algorithms such as Pre-Order Tree Traversal for efficient traversal of regions of
the model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">indexInData</span></code> increases monotonically within each object <code class="docutils literal notranslate"><span class="pre">type</span></code>. This means
that, for instance, the data for all <code class="docutils literal notranslate"><span class="pre">HexBlock</span></code> children of a given parent
are stored contiguously within the <code class="docutils literal notranslate"><span class="pre">HexBlock</span></code> group, and will not be
interleaved with data from the <code class="docutils literal notranslate"><span class="pre">HexBlock</span></code> children of any of the parentâs
siblings.</p></li>
<li><p>Aside from the hierarchy itself, there is no guarantee what order objects are
stored in the layout.  â<cite>The</cite> <code class="docutils literal notranslate"><span class="pre">Core</span></code>â is not necessarily the first child of the
<code class="docutils literal notranslate"><span class="pre">Reactor</span></code>, and is not guaranteed to use the zeroth grid.</p></li>
</ul>
</div></blockquote>
</div>
<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout._createLayout">
<code class="sig-name descname">_createLayout</code><span class="sig-paren">(</span><em class="sig-param">comp</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout._createLayout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout._createLayout" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Populate a hierarchical representation and group the reactor model items by type.</p>
<p>This is used when writing a reactor model to the database.</p>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This is recursive.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#armi.bookkeeping.db.database3.Layout._readLayout" title="armi.bookkeeping.db.database3.Layout._readLayout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_readLayout()</span></code></a></dt><dd><p>does the opposite</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout._readLayout">
<code class="sig-name descname">_readLayout</code><span class="sig-paren">(</span><em class="sig-param">h5group</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout._readLayout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout._readLayout" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Populate a hierarchical representation and group the reactor model items by type.</p>
<p>This is used when reading a reactor model from a database.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#armi.bookkeeping.db.database3.Layout._createLayout" title="armi.bookkeeping.db.database3.Layout._createLayout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">_createLayout()</span></code></a></dt><dd><p>does the opposite</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout._initComps">
<code class="sig-name descname">_initComps</code><span class="sig-paren">(</span><em class="sig-param">caseTitle</em>, <em class="sig-param">bp</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout._initComps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout._initComps" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout.writeToDB">
<code class="sig-name descname">writeToDB</code><span class="sig-paren">(</span><em class="sig-param">h5group</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout.writeToDB"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout.writeToDB" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="armi.bookkeeping.db.database3.Layout.computeAncestors">
<em class="property">static </em><code class="sig-name descname">computeAncestors</code><span class="sig-paren">(</span><em class="sig-param">serialNum</em>, <em class="sig-param">numChildren</em>, <em class="sig-param">depth=1</em><span class="sig-paren">)</span> &#x2192; List[Optional[int]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#Layout.computeAncestors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.Layout.computeAncestors" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return a list containing the serial number of the parent corresponding to each
object at the given depth.</p>
<p>Depth in this case means how many layers to reach up to find the desired
ancestor. A depth of 1 will yield the direct parent of each element, depth of 2
would yield the elemenâs parentâs parent, and so on.</p>
<p>The zero-th element will always be None, as the first object is the root element
and so has no parent. Subsequent depths will result in more Nones.</p>
<p>This function is useful for forming a lightweight sense of how the database
contents stitch together, without having to go to the trouble of fully unpacking
the Reactor model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>serialNum</strong> (<em>List of int</em>) â List of serial numbers for each object/element, as laid out in Layout</p></li>
<li><p><strong>numChildren</strong> (<em>List of int</em>) â List of numbers of children for each object/element, as laid out in Layout</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is not using a recursive approach for a couple of reasons. First, the
iterative form isnât so bad; we just need two stacks. Second, the interface of
the recursive function would be pretty unwieldy. We are progressively
consuming two lists, of which we would need to keep passing down with an
index/cursor, or progressively slice them as we go, which would be pretty
inefficient.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.allSubclasses">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">allSubclasses</code><span class="sig-paren">(</span><em class="sig-param">cls</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#allSubclasses"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.allSubclasses" title="Permalink to this definition">Â¶</a></dt>
<dd><p>This currently include Materialsâ¦ and it should not.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.packSpecialData">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">packSpecialData</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; Tuple[Optional[numpy.ndarray], Dict[str, Any]]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#packSpecialData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.packSpecialData" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Reduce data that wouldnât otherwise play nicely with HDF5/numpy arrays to a format
that will.</p>
<p>This is the main entry point for conforming âstrangeâ data into something that will
both fit into a numpy array/HDF5 dataset, and be recoverable to its original-ish
state when reading it back in. This is accomplished by detecting a handful of known
offenders and using various HDF5 attributes to store necessary auxiliary data. It is
important to keep in mind that the data that is passed in has already been converted
to a numpy array, so the top dimension is always representing the collection of
composites that are storing the parameters. For instance, if we are dealing with a
Block parameter, the first index in the numpy array of data is the block index; so
if each block has a parameter that is a dictionary, <code class="docutils literal notranslate"><span class="pre">data</span></code> would be a ndarray,
where each element is a dictionary. This routine supports a number of different
âstrangeâ things:
* Dict[str, float]: These are stored by finding the set of all keys for all</p>
<blockquote>
<div><p>instances, and storing those keys as a list in an attribute. The data themselves
are stored as arrays indexed by object, then key index. Dictionaries lacking data
for a key store a nan in itâs place. This will work well in instances where most
objects have data for most keys.</p>
</div></blockquote>
<ul class="simple">
<li><p>Jagged arrays: These are stored by concatenating all of the data into a single,
one-dimensional array, and storing attributes to describe the shapes of each
objectâs data, and an offset into the beginning of each objectâs data.</p></li>
<li><p>Arrays with <code class="docutils literal notranslate"><span class="pre">None</span></code> in them: These are stored by replacing each instance of
<code class="docutils literal notranslate"><span class="pre">None</span></code> with a magical value that shouldnât be encountered in realistic
scenarios.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> â An ndarray storing the data that we want to stuff into the database. These are
usually dtype=Object, which is how we usually end up here in the first place.</p></li>
<li><p><strong>paramName</strong> â The parameter name that we are trying to store data for. This is mostly used for
diagnostics.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.unpackSpecialData" title="armi.bookkeeping.db.database3.unpackSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">unpackSpecialData()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.unpackSpecialData">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">unpackSpecialData</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">attrs</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#unpackSpecialData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.unpackSpecialData" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Extract data from a specially-formatted HDF5 dataset into a numpy array.</p>
<p>This should invert the operations performed by <a class="reference internal" href="#armi.bookkeeping.db.database3.packSpecialData" title="armi.bookkeeping.db.database3.packSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">packSpecialData()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> â Specially-formatted data array straight from the database.</p></li>
<li><p><strong>attrs</strong> â The attributes associated with the dataset that contained the data.</p></li>
<li><p><strong>paramName</strong> â The name of the parameter that is being unpacked. Only used for diagnostics.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An ndarray containing the closest possible representation of the data that was
originally written to the database.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.packSpecialData" title="armi.bookkeeping.db.database3.packSpecialData"><code class="xref py py-func docutils literal notranslate"><span class="pre">packSpecialData()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.replaceNonsenseWithNones">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">replaceNonsenseWithNones</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#replaceNonsenseWithNones"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.replaceNonsenseWithNones" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Replace special nonsense values with <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>This essentially reverses the operations performed by
<a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="armi.bookkeeping.db.database3.replaceNonesWithNonsense"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonesWithNonsense()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> â The array from the database that contains special <code class="docutils literal notranslate"><span class="pre">None</span></code> nonsense values.</p></li>
<li><p><strong>paramName</strong> â The param name whoâs data we are dealing with. Only used for diagnostics.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="armi.bookkeeping.db.database3.replaceNonesWithNonsense"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonesWithNonsense()</span></code></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.replaceNonesWithNonsense">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">replaceNonesWithNonsense</code><span class="sig-paren">(</span><em class="sig-param">data: numpy.ndarray</em>, <em class="sig-param">paramName: str</em>, <em class="sig-param">nones: numpy.ndarray = None</em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#replaceNonesWithNonsense"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.replaceNonesWithNonsense" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Replace instances of <code class="docutils literal notranslate"><span class="pre">None</span></code> with nonsense values that can be detected/recovered
when reading.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> â The numpy array containing <code class="docutils literal notranslate"><span class="pre">None</span></code> values that need to be replaced.</p></li>
<li><p><strong>paramName</strong> â The name of the parameter whoâs data we are treating. Only used for diagnostics.</p></li>
<li><p><strong>nones</strong> â An array containing the index locations on the <code class="docutils literal notranslate"><span class="pre">None</span></code> elements. It is a little
strange to pass these, in but we find these indices to determine whether we need
to call this function in the first place, so might as well pass it in, so that
we donât need to perform the operation again.</p></li>
</ul>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>This only supports situations where the data is a straight-up <code class="docutils literal notranslate"><span class="pre">None</span></code>, or a valid,
database-storable numpy array (or easily convertable to one (e.g. tuples/lists with
numerical values)). This does not support, for instance, a numpy ndarray with some
Nones in it.</p>
<p>For example, the following is supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
</pre></div>
</div>
<p>However, the following is not:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#armi.bookkeeping.db.database3.replaceNonsenseWithNones" title="armi.bookkeeping.db.database3.replaceNonsenseWithNones"><code class="xref py py-func docutils literal notranslate"><span class="pre">replaceNonsenseWithNones()</span></code></a></dt><dd><p>Reverses this operation.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._writeAttrs">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_writeAttrs</code><span class="sig-paren">(</span><em class="sig-param">obj</em>, <em class="sig-param">group</em>, <em class="sig-param">attrs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_writeAttrs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._writeAttrs" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Handle safely writing attributes to a dataset, handling large data if necessary.</p>
<p>This will attempt to store attributes directly onto an HDF5 object if possible,
falling back to proper datasets and reference attributes if necessary. This is
needed because HDF5 tries to fit attributes into the object header, which has
limited space. If an attribute is too large, h5py raises a RuntimeError.
In such cases, this will store the attribute data in a proper dataset and
place a reference to that dataset in the attribute instead.</p>
<p>In practice, this takes <code class="docutils literal notranslate"><span class="pre">linkedDims</span></code> attrs from a particular component type (like
<code class="docutils literal notranslate"><span class="pre">c00n00/Circle/id</span></code>) and stores them in new datasets (like
<code class="docutils literal notranslate"><span class="pre">c00n00/attrs/1_linkedDims</span></code>, <code class="docutils literal notranslate"><span class="pre">c00n00/attrs/2_linkedDims</span></code>) and then sets the
objectâs attrs to links to those datasets.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3._resolveAttrs">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">_resolveAttrs</code><span class="sig-paren">(</span><em class="sig-param">attrs</em>, <em class="sig-param">group</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#_resolveAttrs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3._resolveAttrs" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Reverse the action of _writeAttrs.</p>
<p>This reads actual attrs and looks for the real data
in the datasets that the attrs were pointing to.</p>
</dd></dl>

<dl class="function">
<dt id="armi.bookkeeping.db.database3.collectBlockNumberDensities">
<code class="sig-prename descclassname">armi.bookkeeping.db.database3.</code><code class="sig-name descname">collectBlockNumberDensities</code><span class="sig-paren">(</span><em class="sig-param">blocks</em><span class="sig-paren">)</span> &#x2192; Dict[str, numpy.ndarray]<a class="reference internal" href="../_modules/armi/bookkeeping/db/database3.html#collectBlockNumberDensities"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#armi.bookkeeping.db.database3.collectBlockNumberDensities" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Collect block-by-block homogenized number densities for each nuclide.</p>
<p>Long ago, composition was stored on block params. No longer; they are on the
component numberDensity params. These block-level params, are still useful to see
compositions in some visualization tools. Rather than keep them on the reactor
model, we dynamically compute them here and slap them in the database. These are
ignored upon reading and will not affect the results.</p>
<p>Remove this once a better viz tool can view composition distributions. Also remove
the try/except in <code class="docutils literal notranslate"><span class="pre">_readParams</span></code></p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="armi.bookkeeping.db.factory.html" class="btn btn-neutral float-right" title="armi.bookkeeping.db.factory module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="armi.bookkeeping.db.database.html" class="btn btn-neutral float-left" title="armi.bookkeeping.db.database module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2021, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2021-11-19.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>