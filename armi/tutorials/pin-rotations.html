

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="6. Pin data, selection, and rotation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://terrapower.github.io/armi/tutorials/pin-rotations.html" />
<meta property="og:site_name" content="Advanced Reactor Modeling Interface" />
<meta property="og:description" content="This tutorial is here to help make sense of how ARMI stores data on a Block for things that exist within the Block. For example, the parameter Block.p.linPowByPin is a(N, ) vector of linear pin pow..." />
<meta property="og:image" content="https://terrapower.github.io/armi/_static/armiSchematicView.png" />
<meta property="og:image:alt" content="Advanced Reactor Modeling Interface" />
<meta name="description" content="This tutorial is here to help make sense of how ARMI stores data on a Block for things that exist within the Block. For example, the parameter Block.p.linPowByPin is a(N, ) vector of linear pin pow..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>6. Pin data, selection, and rotation &mdash; ARMI 0.6.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme_fixes.css?v=2b77b304" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=e5fbc548" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_style.css?v=678fb11e" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/modern.css?v=803738c0" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-test-results/common.css?v=9ec2c1d5" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="../_static/armiicon_16x16.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=8fa8b3e9"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
      <script src="../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
      <script src="../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
      <script src="../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
      <script src="../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Release Notes" href="../release/index.html" />
    <link rel="prev" title="5. Parameter sweeps" href="param_sweep.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../index.html" class="icon icon-home">
            ARMI
              <img src="../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="walkthrough_inputs.html">1. Building input files for a fast reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough_lwr_inputs.html">2. Building input files for a thermal reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_model.html">3. Hands-on at the ARMI Terminal</a></li>
<li class="toctree-l2"><a class="reference internal" href="making_your_first_app.html">4. Making your first ARMI-based App</a></li>
<li class="toctree-l2"><a class="reference internal" href="param_sweep.html">5. Parameter sweeps</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6. Pin data, selection, and rotation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Single-pin-demonstration">6.1. Single pin demonstration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Rotation">6.2. Rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Component-level-powers">6.3. Component-level powers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Multi-pin-example">6.4. Multi-pin example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Bringing-it-all-together.">6.5. Bringing it all together.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qa_docs/index.html">QA Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active"><span class="section-number">6. </span>Pin data, selection, and rotation</li>
  <li class="wy-breadcrumbs-aside">
    
      
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Pin-data,-selection,-and-rotation">
<h1><span class="section-number">6. </span>Pin data, selection, and rotation<a class="headerlink" href="#Pin-data,-selection,-and-rotation" title="Link to this heading"></a></h1>
<p>This tutorial is here to help make sense of how ARMI stores data on a <code class="docutils literal notranslate"><span class="pre">Block</span></code> for things that exist within the <code class="docutils literal notranslate"><span class="pre">Block</span></code>. For example, the parameter <code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin</span></code> is a <code class="docutils literal notranslate"><span class="pre">(N,</span> <span class="pre">)</span></code> vector of linear pin powers with one entry per pin. You may be wondering</p>
<ol class="arabic simple">
<li><p>Where do those powers exist in the block?</p></li>
<li><p>What component produces those powers? <code class="docutils literal notranslate"><span class="pre">linPowByPin</span></code> is a <code class="docutils literal notranslate"><span class="pre">Block</span></code> parameter, not a <code class="docutils literal notranslate"><span class="pre">Component</span></code> parameter.</p></li>
<li><p>What happens when the block is rotated?</p></li>
</ol>
<p>By the end of this tutorial, these questions should be answered.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">armi</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">armi</span><span class="o">.</span><span class="n">isConfigured</span><span class="p">():</span>
    <span class="n">armi</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

       +===================================================+
       |            _      ____     __  __    ___          |
       |           / \    |  _ \   |  \/  |  |_ _|         |
       |          / _ \   | |_) |  | |\/| |   | |          |
       |         / ___ \  |  _ &lt;   | |  | |   | |          |
       |        /_/   \_\ |_| \_\  |_|  |_|  |___|         |
       |        Advanced  Reactor  Modeling Interface      |
       |                                                   |
       |                    version 0.5.1                  |
       |                                                   |
       +===================================================+
</pre></div></div>
</div>
<section id="Single-pin-demonstration">
<h2><span class="section-number">6.1. </span>Single pin demonstration<a class="headerlink" href="#Single-pin-demonstration" title="Link to this heading"></a></h2>
<p>This tutorial uses the same <code class="docutils literal notranslate"><span class="pre">anl-afci-177/anl-afci-177.yaml</span></code> inputs that exist for the fast reactor example. We’ll start by initializing the reactor and grabbing a fuel block, it doens’t really matter what one. This reactor has a single fuel pin type which means we won’t immediately see interesting behavior, but it makes for easier discussion on the fundamentals. Towards the end, we’ll look at demonstrative assembly with multiple fuel pin types per block, a more realistic scenario.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">o</span> <span class="o">=</span> <span class="n">armi</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="s2">&quot;../anl-afci-177/anl-afci-177.yaml&quot;</span><span class="p">)</span>
<span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">sortAssemsByRing</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
=========== Settings Validation Checks ===========
=========== Case Information ===========
[info] ---------------------  --------------------------------------------------------------------------------
       Case Title:            anl-afci-177
       Case Description:      ANL-AFCI-177 CR 1.0 metal core but with HALEU instead of TRU
       Run Type:              Standard - Operator
       Current User:          anjohnson
       ARMI Location:         C:\Users\anjohnson\codes\armi\armi
       Working Directory:     c:\Users\anjohnson\codes\armi\armi\tests\anl-afci-177
       Python Interpreter:    3.13.3 (tags/v3.13.3:6280bb5, Apr  8 2025, 14:47:33) [MSC v.1943 64 bit (AMD64)]
       Python Executable:     c:\Users\anjohnson\codes\armi\.venv\armi\Scripts\python.exe
       Master Machine:        TP011870
       Number of Processors:  1
       Date and Time:         Tue Aug 12 15:18:24 2025
       ---------------------  --------------------------------------------------------------------------------
=========== Input File Information ===========
[info] --------------------------------------------------------------------  ------------------------------  ------------
       Input Type                                                            Path                            SHA-1 Hash
       --------------------------------------------------------------------  ------------------------------  ------------
       Case Settings                                                         anl-afci-177.yaml               93a5105368
       Blueprints                                                            anl-afci-177-blueprints.yaml    b7b2c74028
       Included blueprints                                                   anl-afci-177-coreMap.yaml       35ab97dadc
       &lt;Setting shuffleLogic value:anl-afci-177-fuelManagement.py default:&gt;  anl-afci-177-fuelManagement.py  baedb35785
       --------------------------------------------------------------------  ------------------------------  ------------
=========== Machine Information ===========
[info] ---------  ----------------------  -------
       Machine      Number of Processors    Ranks
       ---------  ----------------------  -------
       local                           1        0
       ---------  ----------------------  -------
=========== System Information ===========
[info] OS Name:                   Microsoft Windows 10 Enterprise
       OS Version:                10.0.19045 N/A Build 19045
       Processor(s):              1 Processor(s) Installed.
                                  [01]: Intel64 Family 6 Model 186 Stepping 2 GenuineIntel ~1425 Mhz
=========== Reactor Cycle Information ===========
[info] ---------------------------  -----------------------------------------------------------------
       Reactor Thermal Power (MW):  1000.0
       Number of Cycles:            10
       Cycle Lengths:               411.11, 411.11, 411.11, 411.11, 411.11, 411.11, 411.11, 411.11,
                                    411.11, 411.11
       Availability Factors:        0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9, 0.9
       Power Fractions:             [1.0, 1.0], [1.0, 1.0], [1.0, 1.0], [1.0, 1.0], [1.0, 1.0], [1.0,
                                    1.0], [1.0, 1.0], [1.0, 1.0], [1.0, 1.0], [1.0, 1.0]
       Step Lengths (days):         [184.9995, 184.9995], [184.9995, 184.9995], [184.9995, 184.9995],
                                    [184.9995, 184.9995], [184.9995, 184.9995], [184.9995, 184.9995],
                                    [184.9995, 184.9995], [184.9995, 184.9995], [184.9995, 184.9995],
                                    [184.9995, 184.9995]
       ---------------------------  -----------------------------------------------------------------
=========== Constructing Reactor and Verifying Inputs ===========
[info] Constructing the `core`
=========== Adding Composites to &lt;Core: core id:1902501464784&gt; ===========
[info] Will expand HE, NA, AL, SI, V, CR, MN, FE, CO, NI, ZR, NB, MO, W elementals to have natural isotopics
[info] Constructing assembly `inner fuel`
[warn] Some component was missing in &lt;reflector block-bol-000 at ExCore XS: A ENV GP: A&gt; so pin-to-duct gap not calculated
[warn] The gap between wire wrap and clad in block &lt;plenum block-bol-006 at ExCore XS: A ENV GP: A&gt; was 3.999999999998449e-05 cm. Expected 0.0.
[info] Constructing assembly `middle core fuel`
[warn] Some component was missing in &lt;reflector block-bol-000 at ExCore XS: B ENV GP: A&gt; so pin-to-duct gap not calculated
[warn] The gap between wire wrap and clad in block &lt;plenum block-bol-006 at ExCore XS: B ENV GP: A&gt; was 3.999999999998449e-05 cm. Expected 0.0.
[info] Constructing assembly `outer core fuel`
[warn] Some component was missing in &lt;reflector block-bol-000 at ExCore XS: C ENV GP: A&gt; so pin-to-duct gap not calculated
[warn] The gap between wire wrap and clad in block &lt;plenum block-bol-006 at ExCore XS: C ENV GP: A&gt; was 3.999999999998449e-05 cm. Expected 0.0.
[info] Constructing assembly `radial reflector`
[warn] Some component was missing in &lt;reflector block-bol-000 at ExCore XS: A ENV GP: A&gt; so pin-to-duct gap not calculated
[info] Constructing assembly `radial shield`
[warn] Temperature 597.0 out of range (25 to 500) for B4C linear expansion percent
[info] Constructing assembly `control`
[info] Constructing assembly `ultimate shutdown`
=========== Verifying Assembly Configurations ===========
=========== Applying Geometry Modifications ===========
[info] Resetting the state of the converted reactor core model in &lt;EdgeAssemblyChanger&gt;
[info] Updating spatial grid pitch data for hex geometry
=========== Summarizing Source of Material Data for &lt;Core: core id:1902501464784&gt; ===========
[info] ---------------  -----------------
       Material Name    Source Location
       ---------------  -----------------
       B4C              ARMI
       HT9              ARMI
       Sodium           ARMI
       UZr              ARMI
       Void             ARMI
       ---------------  -----------------
=========== Initializing Mesh, Assembly Zones, and Nuclide Categories ===========
[info] Nuclide categorization for cross section temperature assignments:
       ------------------  -----------------------------------------------------
       Nuclide Category    Nuclides
       ------------------  -----------------------------------------------------
       Fuel                PU236, LFP40, HE4, LFP41, LFP38, DUMP1, AM241, NP237,
                           AM243, U236, PU242, U234, NB93, DUMP2, CM245, LFP39,
                           NP238, U238, ZR90, PU240, U235, ZR91, PU239,
                           CO59, PU238, CM243, CM244, PU241, ZR92, AM242M,
                           ZR96, CM242, CM246, LFP35, ZR94, CM247, AL27
       Coolant             NA23
       Structure           SI29, NI64, MO98, CR54, MO97, FE58, W182, B11, CR53,
                           NI61, MO92, MO94, FE54, SI28, NI62, CR52, MN55,
                           MO96, CR50, MO100, V51, MO95, SI30, NI60, V50,
                           NI58, FE56, C, W183, B10, W184, FE57, W186
       ------------------  -----------------------------------------------------
[info] Constructing the `Spent Fuel Pool`
[warn] Changing the name of the Spent Fuel Pool to &#39;sfp&#39;.
=========== Creating Interfaces ===========
=========== Interface Stack Summary  ===========
[info] -------  ------------------------  ---------------  ----------  ---------  -----------  ------------
         Index  Type                      Name             Function    Enabled    EOL order    BOL forced
       -------  ------------------------  ---------------  ----------  ---------  -----------  ------------
            01  Main                      main                         Yes        Reversed     No
            02  FissionProductModel       fissionProducts              Yes        Normal       No
            03  FuelHandler               fuelHandler                  Yes        Normal       No
            04  CrossSectionGroupManager  xsGroups                     Yes        Normal       No
            05  HistoryTracker            history                      Yes        Normal       No
            06  Report                    report                       Yes        Normal       No
            07  Database                  database                     Yes        Normal       No
            08  MemoryProfiler            memoryProfiler               Yes        Normal       No
            09  Snapshot                  snapshot                     Yes        Normal       No
       -------  ------------------------  ---------------  ----------  ---------  -----------  ------------
===========  Triggering Init Event ===========
=========== 01 - main                           Init            ===========
=========== 02 - fissionProducts                Init            ===========
=========== 03 - fuelHandler                    Init            ===========
=========== 04 - xsGroups                       Init            ===========
=========== 05 - history                        Init            ===========
=========== 06 - report                         Init            ===========
=========== 07 - database                       Init            ===========
=========== 08 - memoryProfiler                 Init            ===========
=========== 09 - snapshot                       Init            ===========
===========  Completed Init Event ===========
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.blocks</span><span class="w"> </span><span class="kn">import</span> <span class="n">HexBlock</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuelBlock</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getFirstBlock</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, assign <em>some</em> power profile to the block. We’ll pick a 2D function <code class="docutils literal notranslate"><span class="pre">p(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code> for each pin centered at <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">y)</span></code>. This way, the rotation of the block be visible.</p>
<p>This introduces the first big point: pin-related data assigned as a block parameter <strong>must</strong> be ordered according to <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations()</span></code>. That is the key connection between how data are ordered, where data exist in space, and what components are associated with those data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">setPinPow</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">HexBlock</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fake a pin power p(x, y) = x + y.&quot;&quot;&quot;</span>
    <span class="n">pinPow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getPinLocations</span><span class="p">()):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
        <span class="n">pinPow</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
    <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">linPowByPin</span> <span class="o">=</span> <span class="n">pinPow</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">setPinPow</span><span class="p">(</span><span class="n">fuelBlock</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span>
</pre></div>
</div>
</div>
<p>To demonstrate this, we’ll make a plot of the block-level pin powers by iterating jointly over the locations in <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations</span></code> and scalar pin values in <code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin</span></code>. It’s not immediately useful because the function above already set that for us. But this will be helpful to show off rotation too.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plotPinPow</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">HexBlock</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">pinPows</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">linPowByPin</span>
    <span class="n">xs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getPinLocations</span><span class="p">()):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pinPows</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
    <span class="c1"># finely tuned scatter plot size to make nice images here</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotPinPow</span><span class="p">(</span><span class="n">fuelBlock</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1baf72d38c0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_13_1.png" src="../_images/tutorials_pin-rotations_13_1.png" />
</div>
</div>
<p>Unsurprisingly, we have a pin power profile that matches our <code class="docutils literal notranslate"><span class="pre">p(x,</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y</span></code>. Pretty!</p>
</section>
<section id="Rotation">
<h2><span class="section-number">6.2. </span>Rotation<a class="headerlink" href="#Rotation" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">HexBlock</span></code> objects have an implemented <code class="docutils literal notranslate"><span class="pre">.rotate</span></code> method that supports CCW rotation in 60 degree increments. Before we rotate this block, make copies of the locations and pin power data arrays to compare before and after rotation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">getPinRingPos</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">HexBlock</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getPinLocations</span><span class="p">()</span>
    <span class="n">allRingPos</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">allRingPos</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ringPosBefore</span> <span class="o">=</span> <span class="n">getPinRingPos</span><span class="p">(</span><span class="n">fuelBlock</span><span class="p">)</span>
<span class="n">pinPowerBefore</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">linPowByPin</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="n">fuelBlock</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotPinPow</span><span class="p">(</span><span class="n">fuelBlock</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1baf95134d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_19_1.png" src="../_images/tutorials_pin-rotations_19_1.png" />
</div>
</div>
<p>As expected, our pin powers have rotated 180 degrees, with the maxima now in the south west direction. So what changed: the locations of pins or the pin power data array?</p>
<p>This introduces the second key concept: with limited and documented exceptions, <code class="docutils literal notranslate"><span class="pre">Block</span></code> parameter data are <strong>not</strong> modified during rotation, the <strong>locations</strong> of objects within the <code class="docutils literal notranslate"><span class="pre">Block</span></code> are updated. See a discussion in</p>
<p>If we compare the post-rotation pin powers and pin locations, this is confirmed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="p">(</span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">linPowByPin</span> <span class="o">==</span> <span class="n">pinPowerBefore</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="p">(</span><span class="n">getPinRingPos</span><span class="p">(</span><span class="n">fuelBlock</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ringPosBefore</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Component-level-powers">
<h2><span class="section-number">6.3. </span>Component-level powers<a class="headerlink" href="#Component-level-powers" title="Link to this heading"></a></h2>
<p>This gets a little trickier to explain because, in our example here, one fuel <code class="docutils literal notranslate"><span class="pre">Component</span></code> occupies the entire fuel lattice. Cases where that may not be the case can follow a similar pattern.</p>
<p>The connection between block level pin powers and the related components is the <code class="docutils literal notranslate"><span class="pre">Circle.getPinIndices()</span></code> method. For a block with <code class="docutils literal notranslate"><span class="pre">N</span></code> pins, a given pin component will have a multiplicity of <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">N</span></code>. <code class="docutils literal notranslate"><span class="pre">Circle.getPinIndices</span></code> will return an <code class="docutils literal notranslate"><span class="pre">(M,</span> <span class="pre">)</span></code> vector of integers that translate between the component and block level data.</p>
<p>For the <code class="docutils literal notranslate"><span class="pre">k</span></code>-th pin reflected in <code class="docutils literal notranslate"><span class="pre">Circle</span></code>, with <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">M</span></code>, <code class="docutils literal notranslate"><span class="pre">kx</span> <span class="pre">=</span> <span class="pre">Circle.getPinIndices()[k]</span></code> is the index in parameters like <code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin[kx]</span></code> for that particular instance of the pin. And this <code class="docutils literal notranslate"><span class="pre">k</span></code>-th instance of the pin is spatially located in <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations()[kx]</span></code>.</p>
<p>To demonstrate, we’ll present the trivial case for a singular fuel <code class="docutils literal notranslate"><span class="pre">Circle</span></code> occupying every lattice site in the grid. Here, we would expect the <code class="docutils literal notranslate"><span class="pre">.getIndices()</span></code> to return what is essentially a <code class="docutils literal notranslate"><span class="pre">numpy.arange</span></code> vector, since every position <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">N)</span></code> is held by this fuel pin.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.components</span><span class="w"> </span><span class="kn">import</span> <span class="n">Circle</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuelPin</span><span class="p">:</span> <span class="n">Circle</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fpIndices</span> <span class="o">=</span> <span class="n">fuelPin</span><span class="o">.</span><span class="n">getPinIndices</span><span class="p">()</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">fpIndices</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fuelPin</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">fpIndices</span>
</pre></div>
</div>
</div>
<p>To help illustrate how to map between component data -&gt; block data -&gt; spatial data, let’s plot pin power assigned to just this component.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">Normalize</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plotCompPinPow</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Circle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">blockLinPowByPin</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">linPowByPin</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">myIndices</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getPinIndices</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">kx</span> <span class="o">=</span> <span class="n">myIndices</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">ps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">blockLinPowByPin</span><span class="p">[</span><span class="n">kx</span><span class="p">])</span>
    <span class="c1"># normalize the color scheme against all the pin powers in the block</span>
    <span class="c1"># not just those for this pin</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">blockLinPowByPin</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">blockLinPowByPin</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">fuelPin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1baf958fc50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_29_1.png" src="../_images/tutorials_pin-rotations_29_1.png" />
</div>
</div>
<p>And one more 60 degree CCW rotation for good measure.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">fuelPin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1baf95f79d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_32_1.png" src="../_images/tutorials_pin-rotations_32_1.png" />
</div>
</div>
</section>
<section id="Multi-pin-example">
<h2><span class="section-number">6.4. </span>Multi-pin example<a class="headerlink" href="#Multi-pin-example" title="Link to this heading"></a></h2>
<p>For the last example, we’ll define a semi-covoluted but demonstrative block that has two fuel pin types existing on the same lattice grid. The use of yaml anchors <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, aliases <code class="docutils literal notranslate"><span class="pre">*</span></code>, and merge keys <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>. This helps use similar fuel and clad definitions (e.g., material, dimension) but overwrite things like <code class="docutils literal notranslate"><span class="pre">latticeIDs</span></code> and <code class="docutils literal notranslate"><span class="pre">flags</span></code> that we want to be specific to each fuel pin type.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">BP_STR</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">blocks:</span>
<span class="s2">    fuel: &amp;fuel_block</span>
<span class="s2">        grid name: fuel grid</span>
<span class="s2">        fuel 1: &amp;fuel_def</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            # Use void material because we don&#39;t need nuclides, just components with flags</span>
<span class="s2">            material: Void</span>
<span class="s2">            od: 0.68</span>
<span class="s2">            Tinput: 25</span>
<span class="s2">            Thot: 600</span>
<span class="s2">            latticeIDs: [1]</span>
<span class="s2">            flags: primary fuel</span>
<span class="s2">        clad 1: &amp;clad_def</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            material: Void</span>
<span class="s2">            id: 0.7</span>
<span class="s2">            od: 0.71</span>
<span class="s2">            Tinput: 600</span>
<span class="s2">            Thot: 450</span>
<span class="s2">            latticeIDs: [1]</span>
<span class="s2">        fuel 2:</span>
<span class="s2">            &lt;&lt;: *fuel_def</span>
<span class="s2">            latticeIDs: [2]</span>
<span class="s2">            flags: secondary fuel</span>
<span class="s2">        clad 2:</span>
<span class="s2">            &lt;&lt;: *clad_def</span>
<span class="s2">            latticeIDs: [2]</span>
<span class="s2">        duct:</span>
<span class="s2">            shape: Hexagon</span>
<span class="s2">            material: Void</span>
<span class="s2">            Tinput: 25</span>
<span class="s2">            Thot: 450</span>
<span class="s2">            ip: 15.3</span>
<span class="s2">            op: 16</span>
<span class="s2">grids:</span>
<span class="s2">    fuel grid:</span>
<span class="s2">        geom: hex_corners_up</span>
<span class="s2">        symmetry: full</span>
<span class="s2">        # Kind of a convoluted map but helps test a lot of edge conditions</span>
<span class="s2">        lattice map: |</span>
<span class="s2">            - - -  1 1 1 1</span>
<span class="s2">              - - 1 1 1 1 1</span>
<span class="s2">               - 1 1 2 2 1 1</span>
<span class="s2">                1 1 2 1 2 1 1</span>
<span class="s2">                 1 1 2 2 1 1</span>
<span class="s2">                  1 1 1 1 1</span>
<span class="s2">                   1 2 1 1</span>
<span class="s2"># Stuff that isn&#39;t germane to this example, but necessary to make the blueprints build correctly</span>
<span class="s2">assemblies:</span>
<span class="s2">    fuel:</span>
<span class="s2">        specifier: F</span>
<span class="s2">        blocks: [*fuel_block]</span>
<span class="s2">        height: [10]</span>
<span class="s2">        axial mesh points: [1]</span>
<span class="s2">        xs types: [A]</span>
<span class="s2">nuclide flags:</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.blueprints</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">buildMultiPinBlock</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">HexBlock</span><span class="p">:</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">()</span>
    <span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprints</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">BP_STR</span><span class="p">)</span>
    <span class="n">bp</span><span class="o">.</span><span class="n">_prepConstruction</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">blockDesigns</span><span class="p">[</span><span class="s2">&quot;fuel&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">bp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">block</span><span class="o">.</span><span class="n">assignPinIndices</span><span class="p">()</span>
    <span class="n">setPinPow</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">block</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multiPinBlock</span> <span class="o">=</span> <span class="n">buildMultiPinBlock</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[info] Will expand HE, NA, AL, SI, V, CR, MN, FE, CO, NI, ZR, NB, MO, W elementals to have natural isotopics
[info] Constructing assembly `fuel`
[info] Block design &lt;fuel block-bol-000 at ExCore XS: A ENV GP: A&gt; is too complicated to verify dimensions. Make sure they are correct!
=========== Verifying Assembly Configurations ===========
[info] Block design &lt;fuel block-bol-000 at ExCore XS: A ENV GP: A&gt; is too complicated to verify dimensions. Make sure they are correct!
</pre></div></div>
</div>
<p>Plotting our block-level pin power shows a similar profile to before.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotPinPow</span><span class="p">(</span><span class="n">multiPinBlock</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.PathCollection at 0x1bafa69ca50&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_39_1.png" src="../_images/tutorials_pin-rotations_39_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primaryFuel</span><span class="p">:</span> <span class="n">Circle</span> <span class="o">=</span> <span class="n">multiPinBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PRIMARY</span><span class="p">)</span>
<span class="n">primaryFuel</span><span class="o">.</span><span class="n">getPinIndices</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29], dtype=uint16)
</pre></div></div>
</div>
<p>The ordering is worth discussing. <code class="docutils literal notranslate"><span class="pre">primaryFuel.getPinIndices()</span></code> being sequential <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">29]</span></code> would imply, at first, that all the <code class="docutils literal notranslate"><span class="pre">primaryFuel</span></code> pins reside in some sequence adjacent to each other. However, the lattice map has <code class="docutils literal notranslate"><span class="pre">primaryFuel</span></code> in the center of the block, and then in the second and third full rings. This ordering is still consistent with <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations</span></code> and is a side-effect of</p>
<ol class="arabic simple">
<li><p>How the hexagonal ascii maps are processed,</p></li>
<li><p>How pin locations are discovered within a block,</p>
<ul class="simple">
<li><p>For each clad component, extend it’s spatial locators</p></li>
</ul>
</li>
</ol>
<p>We can see the first “pin” location in our block is not the center, but the north west pin in the block.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">multiPinBlock</span><span class="o">.</span><span class="n">getPinLocations</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">secondaryFuel</span><span class="p">:</span> <span class="n">Circle</span> <span class="o">=</span> <span class="n">multiPinBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">SECONDARY</span><span class="p">)</span>
<span class="n">secondaryFuel</span><span class="o">.</span><span class="n">getPinIndices</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([30, 31, 32, 33, 34, 35, 36], dtype=uint16)
</pre></div></div>
</div>
<p>The component level pin plotter shows that we can still collect the same power profile by connecting</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Block.getPinLocations</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Circle.getPinIndices</span></code></p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">primaryFuel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
<span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">secondaryFuel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;secondary&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1baf72d34d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_45_1.png" src="../_images/tutorials_pin-rotations_45_1.png" />
</div>
</div>
<p>Rotate 60 degrees CCW or pi/3</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multiPinBlock</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">primaryFuel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
<span class="n">plotCompPinPow</span><span class="p">(</span><span class="n">secondaryFuel</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;secondary&quot;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x1baf73611d0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_pin-rotations_48_1.png" src="../_images/tutorials_pin-rotations_48_1.png" />
</div>
</div>
</section>
<section id="Bringing-it-all-together.">
<h2><span class="section-number">6.5. </span>Bringing it all together.<a class="headerlink" href="#Bringing-it-all-together." title="Link to this heading"></a></h2>
<p>Pin-like parameters are ordered by a pin-index, not strictly a spatial ordering. Therefore they are invariant of rotation; <code class="docutils literal notranslate"><span class="pre">Block.p.linPowByPin[i]</span></code> is the linear power for pin <code class="docutils literal notranslate"><span class="pre">i</span></code>, wherever it may be in the block.</p>
<p>Without looking into the components, pin <code class="docutils literal notranslate"><span class="pre">i</span></code> is located at <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations()[i]</span></code>. If the block is rotated, the locator <code class="docutils literal notranslate"><span class="pre">Block.getPinLocations()[i]</span></code> will indicate a new location, but it still represents pin <code class="docutils literal notranslate"><span class="pre">i</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="param_sweep.html" class="btn btn-neutral float-left" title="5. Parameter sweeps" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../release/index.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2025, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2025-08-26.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>