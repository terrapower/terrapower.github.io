

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4. Making your first ARMI-based App" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://terrapower.github.io/armi/tutorials/making_your_first_app.html" />
<meta property="og:site_name" content="Advanced Reactor Modeling Interface" />
<meta property="og:description" content="In this tutorial we will build a nuclear analysis application that runs (dummy) neutron flux and thermal/hydraulics calculations. Applications that do real analysis can be modeled after this starti..." />
<meta property="og:image" content="https://terrapower.github.io/armi/_static/armiSchematicView.png" />
<meta property="og:image:alt" content="Advanced Reactor Modeling Interface" />
<meta name="description" content="In this tutorial we will build a nuclear analysis application that runs (dummy) neutron flux and thermal/hydraulics calculations. Applications that do real analysis can be modeled after this starti..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4. Making your first ARMI-based App &mdash; ARMI 0.5.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme_fixes.css?v=2b77b304" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=e5fbc548" />
      <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_style.css?v=678fb11e" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-needs/modern.css?v=803738c0" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-test-results/common.css?v=9ec2c1d5" />

  
    <link rel="shortcut icon" href="../_static/armiicon_16x16.ico"/>
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=b9afe91b"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
      <script src="../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
      <script src="../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
      <script src="../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
      <script src="../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Parameter sweeps" href="param_sweep.html" />
    <link rel="prev" title="3. Hands-on at the ARMI Terminal" href="data_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../index.html" class="icon icon-home">
            ARMI
              <img src="../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Gallery</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="walkthrough_inputs.html">1. Building input files for a fast reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough_lwr_inputs.html">2. Building input files for a thermal reactor</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_model.html">3. Hands-on at the ARMI Terminal</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Making your first ARMI-based App</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-a-new-app">4.1. Starting a new app</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registering-the-app-with-armi">4.2. Registering the app with ARMI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-app-class">4.3. Defining the app class</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-the-physics-plugin">4.4. Defining the physics plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-custom-settings">4.5. Defining custom settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-physics-kernels">4.6. Creating the physics kernels</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#making-the-dummy-flux-kernel">4.6.1. Making the (dummy) flux kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#making-the-thermal-hydraulics-kernel">4.6.2. Making the thermal/hydraulics kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#adding-entry-points">4.7. Adding entry points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-the-app-and-debugging">4.8. Running the app and debugging</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-a-new-material">4.8.1. Adding a new material</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#checking-the-output">4.9. Checking the output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bonus-ad-hoc-userplugins">4.10. Bonus: Ad-hoc UserPlugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-the-userplugin-in-python">4.10.1. Define the UserPlugin in Python</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-a-list-of-userplugins-in-the-settings-file">4.10.2. Define a list of UserPlugins in the Settings File</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="param_sweep.html">5. Parameter sweeps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../qa_docs/index.html">QA Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tutorials</a></li>
      <li class="breadcrumb-item active"><span class="section-number">4. </span>Making your first ARMI-based App</li>
  <li class="wy-breadcrumbs-aside">
    
      
        <a href="https://github.com/terrapower/armi/blob/main/doc/tutorials/making_your_first_app.rst" class="fa fa-github"> Edit on GitHub</a>
      
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="making-your-first-armi-based-app">
<span id="armi-make-first-app"></span><h1><span class="section-number">4. </span>Making your first ARMI-based App<a class="headerlink" href="#making-your-first-armi-based-app" title="Link to this heading"></a></h1>
<p>In this tutorial we will build a nuclear analysis application that runs (dummy) neutron
flux and thermal/hydraulics calculations. Applications that do real analysis can be
modeled after this starting point. A complete, working version of this application can
be found <a class="reference external" href="https://github.com/terrapower/armi-example-app">here</a>.</p>
<p>We’ll assume you have the <a class="reference internal" href="../user/user_install.html"><span class="doc">ARMI Framework installed</span></a> already.
You can make sure it is ready by running the following command in a shell prompt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(armi) $ python -c &quot;import armi;armi.configure()&quot;
</pre></div>
</div>
<p>You should see an ARMI splash-screen and an ARMI version print out. If you do, you are ready
to proceed.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are having trouble getting it installed, see <a class="reference internal" href="../index.html#getting-help"><span class="std std-ref">Getting help</span></a>. You may
need to ensure your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> variable includes the armi installation directory.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial is a companion for the <a class="reference internal" href="../developer/making_armi_based_apps.html"><span class="doc">Making ARMI-based Apps</span></a>
developer documentation.</p>
</div>
<section id="starting-a-new-app">
<h2><span class="section-number">4.1. </span>Starting a new app<a class="headerlink" href="#starting-a-new-app" title="Link to this heading"></a></h2>
<p>ARMI-based applications can take on many forms, depending on your workflow. Examples may include:</p>
<ul class="simple">
<li><p>Application and plugins together under one folder</p></li>
<li><p>Application in one folder, plugins in separate ones</p></li>
</ul>
<p>We will build an application that contains one plugin that runs
neutronics and thermal hydraulics in one folder. This architecture will be a good starting
point for many projects, and can always be separated if needed.</p>
<p>From the command line, <code class="docutils literal notranslate"><span class="pre">cd</span></code> into a new directory where you’d like to store your
application code. Make a folder structure that works as a <a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/">normal Python package</a>, and create some empty
files for us to fill in, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_armi_project</span><span class="o">/</span>
    <span class="n">myapp</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">__main__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">app</span><span class="o">.</span><span class="n">py</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">py</span>
        <span class="n">fluxSolver</span><span class="o">.</span><span class="n">py</span>
        <span class="n">materials</span><span class="o">.</span><span class="n">py</span>
        <span class="n">thermalSolver</span><span class="o">.</span><span class="n">py</span>
    <span class="n">doc</span><span class="o">/</span>
    <span class="n">pyproject</span><span class="o">.</span><span class="n">toml</span>
    <span class="n">README</span><span class="o">.</span><span class="n">md</span>
    <span class="n">LICENSE</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<p>These files are:</p>
<ul class="simple">
<li><p>The outer <code class="file docutils literal notranslate"><span class="pre">my_armi_project</span></code> root directory is a container for your app. The name
does not matter to ARMI; you can rename it to anything.</p></li>
<li><p>The inner <code class="file docutils literal notranslate"><span class="pre">myapp</span></code> directory is the actual Python package for your app. Its name is
the Python package name you will use to import anything inside (e.g. <code class="docutils literal notranslate"><span class="pre">myapp.plugin</span></code>).</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/__init__.py</span></code> tells Python that this directory is a Python package. Code
in here runs whenever anything in the package is imported.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code> registers the application with the ARMI framework
and provides one or more entry points for users of your app (including you!)
to start running it. Since code here runs when the package is used as a
main, it generally performs any app-specific configuration.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/app.py</span></code> contains the actual app registration code that will be called by
<code class="file docutils literal notranslate"><span class="pre">__main__.py</span></code>. This can be named anything as long as it is consistent with the
registration code.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/plugin.py</span></code> contains the code that defines the physics plugins we will create</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/fluxSolver.py</span></code> contains the flux solver</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">myapp/thermalSolver.py</span></code> contains the thermal/hydraulics solver</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">pyproject.toml</span></code> the <a class="reference external" href="https://packaging.python.org/en/latest/flow/">python package installation file</a> to help users install your
application.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">README.md</span></code> and <code class="file docutils literal notranslate"><span class="pre">LICENSE.md</span></code> are an optional description and license of your
application that would be prominently featured, e.g. in a GitHub repo, if you were to
put it there.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">doc/</span></code> is an optional folder where your application documentation source may go.
If you choose to use Sphinx you can run <code class="docutils literal notranslate"><span class="pre">sphinx-quickstart</span></code> in that folder to begin
documentation.</p></li>
</ul>
</section>
<section id="registering-the-app-with-armi">
<h2><span class="section-number">4.2. </span>Registering the app with ARMI<a class="headerlink" href="#registering-the-app-with-armi" title="Link to this heading"></a></h2>
<p>The ARMI Framework contains features to run the “main loop” of typical applications. In
order to get access to these, we must register our new app with the ARMI framework. To do
this, we put the following code in the top-level <code class="file docutils literal notranslate"><span class="pre">__main__.py</span></code> module:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code></span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">armi</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span>

<span class="n">armi</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">ExampleApp</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>Similar code will be needed in scripts or other code where you would like your app to be used.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You may find it appropriate to use the plugin registration mechanism in some cases
rather than the app registration. More info on plugins vs. apps coming soon.</p>
</div>
</section>
<section id="defining-the-app-class">
<h2><span class="section-number">4.3. </span>Defining the app class<a class="headerlink" href="#defining-the-app-class" title="Link to this heading"></a></h2>
<p>We define our app in the <code class="file docutils literal notranslate"><span class="pre">myapp/app.py</span></code> module. For this example, the app class is
relatively small: it will just register our one custom plugin. We will actually create
the plugin shortly.</p>
<div class="admonition-apps-vs-plugins-vs-interfaces admonition">
<p class="admonition-title">Apps vs. plugins vs. interfaces</p>
<p>ARMI-based methodologies are broken down into three layers of abstraction. Apps are
collections of plugins intended to perform analysis on a certain type of reactor.
Plugins are independent and mixable collections of relatively arbitrary code that
might bring in special materials, contain certain engineering methodologies, and/or
Interfaces with one or more physics kernels. See <a class="reference internal" href="../developer/guide.html"><span class="doc">Framework Architecture</span></a> for more
info on architecture.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/app.py</span></code></span><a class="headerlink" href="#id2" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Application module&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">armi_version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.apps</span><span class="w"> </span><span class="kn">import</span> <span class="n">App</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">myapp_version</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.plugin</span><span class="w"> </span><span class="kn">import</span> <span class="n">DummyPhysicsPlugin</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ExampleApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;example-app&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># activate all built-in plugins</span>
        <span class="n">App</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># register our plugin with the plugin manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pm</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DummyPhysicsPlugin</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">splashText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;                           </span>
<span class="s2">+===============================================+</span>
<span class="s2">+                                               +</span>
<span class="s2">+                 |\/|   /|                     +</span>
<span class="s2">+                 |  |\//-||)|)                 +</span>
<span class="s2">+                     /    | |                  +</span>
<span class="s2">+                                               +</span>
<span class="s2">+                Version: </span><span class="si">{</span><span class="n">myapp_version</span><span class="si">}</span><span class="s2">                 +</span>
<span class="s2">+                                               +</span>
<span class="s2">+-----------------------------------------------+</span>
<span class="s2">+    Powered by ARMI (R) -- Version: </span><span class="si">{</span><span class="n">armi_version</span><span class="si">}</span><span class="s2">      +</span>
<span class="s2">+===============================================+</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="defining-the-physics-plugin">
<h2><span class="section-number">4.4. </span>Defining the physics plugin<a class="headerlink" href="#defining-the-physics-plugin" title="Link to this heading"></a></h2>
<p>Now we will create the plugin that will coordinate our dummy physics modules.</p>
<div class="admonition-what-are-plugins-again admonition">
<p class="admonition-title">What are plugins again?</p>
<p>Plugins are the basic modular building block of ARMI-based apps. In some cases, one
plugin will be associated with one physics kernel (like COBRA or MCNP). This is a
reasonable practice when you expect to be mixing and matching various combinations of
plugins between related teams. It is also possible to have a plugin that performs a
whole cacophony of analyses using multiple codes, which some smaller research teams
may find preferable. The flexibility is very broad.</p>
<p>See <a class="reference internal" href="../.apidocs/armi.plugins.html#module-armi.plugins" title="armi.plugins"><code class="xref py py-mod docutils literal notranslate"><span class="pre">armi.plugins</span></code></a> more for info.</p>
</div>
<p>Plugin code can exist in any directory structure in an app. In this app we
put it in the <code class="file docutils literal notranslate"><span class="pre">myapp/plugin.py</span></code> file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For “serious” plugins, we recommend mirroring the <code class="docutils literal notranslate"><span class="pre">armi/physics/[subphysics]</span></code>
structure of the ARMI Framework <a class="reference internal" href="../.apidocs/armi.physics.html#module-armi.physics" title="armi.physics"><code class="xref py py-mod docutils literal notranslate"><span class="pre">physics</span> <span class="pre">plugin</span> <span class="pre">subpackage</span></code></a>.</p>
</div>
<p>We will start the plugin by pointing to the two physics kernels we wish to register. We
hook them in and tell ARMI the <code class="docutils literal notranslate"><span class="pre">ORDER</span></code> they should be run in based on the built-in
<code class="docutils literal notranslate"><span class="pre">STACK_ORDER</span></code> attribute (defined and discussed <a class="reference internal" href="../.apidocs/armi.interfaces.html#armi.interfaces.STACK_ORDER" title="armi.interfaces.STACK_ORDER"><code class="xref py py-class docutils literal notranslate"><span class="pre">here</span></code></a>).  We will come back to this plugin definition later on to
add a little more to the plugin.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/plugin.py</span></code></span><a class="headerlink" href="#id3" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">interfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">plugins</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.interfaces</span><span class="w"> </span><span class="kn">import</span> <span class="n">STACK_ORDER</span> <span class="k">as</span> <span class="n">ORDER</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.settings.fwSettings.globalSettings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONF_VERSIONS</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">fluxSolver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp</span><span class="w"> </span><span class="kn">import</span> <span class="n">thermalSolver</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DummyPhysicsPlugin</span><span class="p">(</span><span class="n">plugins</span><span class="o">.</span><span class="n">ArmiPlugin</span><span class="p">):</span>
    <span class="nd">@staticmethod</span>
    <span class="nd">@plugins</span><span class="o">.</span><span class="n">HOOKIMPL</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exposeInterfaces</span><span class="p">(</span><span class="n">cs</span><span class="p">):</span>
        <span class="n">DummyPhysicsPlugin</span><span class="o">.</span><span class="n">setVersionInSettings</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>

        <span class="n">kernels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">interfaces</span><span class="o">.</span><span class="n">InterfaceInfo</span><span class="p">(</span><span class="n">ORDER</span><span class="o">.</span><span class="n">FLUX</span><span class="p">,</span> <span class="n">fluxSolver</span><span class="o">.</span><span class="n">FluxInterface</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">interfaces</span><span class="o">.</span><span class="n">InterfaceInfo</span><span class="p">(</span>
                <span class="n">ORDER</span><span class="o">.</span><span class="n">THERMAL_HYDRAULICS</span><span class="p">,</span> <span class="n">thermalSolver</span><span class="o">.</span><span class="n">ThermalInterface</span><span class="p">,</span> <span class="p">{}</span>
            <span class="p">),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">kernels</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@plugins</span><span class="o">.</span><span class="n">HOOKIMPL</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">defineSettings</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">settings</span><span class="o">.</span><span class="n">defineSettings</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@plugins</span><span class="o">.</span><span class="n">HOOKIMPL</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">defineSettingsValidators</span><span class="p">(</span><span class="n">inspector</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">settings</span><span class="o">.</span><span class="n">defineValidators</span><span class="p">(</span><span class="n">inspector</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@plugins</span><span class="o">.</span><span class="n">HOOKIMPL</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">defineCaseDependencies</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="n">suite</span><span class="p">):</span>
        <span class="n">DummyPhysicsPlugin</span><span class="o">.</span><span class="n">setVersionInSettings</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setVersionInSettings</span><span class="p">(</span><span class="n">cs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to set the version correctly in the Settings file.&quot;&quot;&quot;</span>
        <span class="n">cs</span><span class="p">[</span><span class="n">CONF_VERSIONS</span><span class="p">][</span><span class="s2">&quot;armi-example-app&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__version__</span>
</pre></div>
</div>
</div>
</section>
<section id="defining-custom-settings">
<h2><span class="section-number">4.5. </span>Defining custom settings<a class="headerlink" href="#defining-custom-settings" title="Link to this heading"></a></h2>
<p>An important facet of the above plugin is that it takes custom Settings, and has some
validation built in for those <code class="docutils literal notranslate"><span class="pre">Setting</span></code> values. That is, the plugin registers new
settings that can go in the settings file, and help the user define how the simulation
runs.</p>
<p>The following example boiler plate code defines three settings. We define two simple
number settings (inlet and outlet temperatures), and we use <code class="xref py py-class docutils literal notranslate"><span class="pre">Query</span></code> to define validation on those settings. Here,
the validation isn’t very exciting, we just make sure the temperatures are above zero.
That’s not particularly physically meaningful, but serves as a simple example. The next
setting is a little more complicated, we define a setting <code class="docutils literal notranslate"><span class="pre">myAppVersion</span></code> that defines
a specific version of our app that this setting file is valid for. And if you try to run
a different version you get a nasty warning printed to the screen.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/settings.py</span></code></span><a class="headerlink" href="#id4" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Settings related to the DummyPhysicsPlugin&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi.operators.settingsValidation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Query</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">setting</span>


<span class="n">CONF_INLET_TEMPERATURE</span> <span class="o">=</span> <span class="s2">&quot;inletInC&quot;</span>
<span class="n">CONF_OUTLET_TEMPERATURE</span> <span class="o">=</span> <span class="s2">&quot;outletInC&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">defineSettings</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define DummyPhysicsPlugin settings.&quot;&quot;&quot;</span>
    <span class="n">settings</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">setting</span><span class="o">.</span><span class="n">Setting</span><span class="p">(</span>
            <span class="n">CONF_INLET_TEMPERATURE</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">360.0</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inlet Temperature (Celcius)&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The Inlet Temperature in C, for the TH solver.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">setting</span><span class="o">.</span><span class="n">Setting</span><span class="p">(</span>
            <span class="n">CONF_OUTLET_TEMPERATURE</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">520.0</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Outlet Temperature (Celcius)&quot;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The Outlet Temperature in C, for the TH solver.&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">settings</span>


<span class="k">def</span><span class="w"> </span><span class="nf">defineValidators</span><span class="p">(</span><span class="n">inspector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define validators for the DummyPhysicsPlugin settings.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">Query</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">inspector</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_INLET_TEMPERATURE</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;The inlet temperature is below 0. This is unphysical and will result in unphysical results.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">inspector</span><span class="o">.</span><span class="n">NO_ACTION</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">Query</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">inspector</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_OUTLET_TEMPERATURE</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;The outlet temperature is below 0. This is unphysical and will result in unphysical results.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">inspector</span><span class="o">.</span><span class="n">NO_ACTION</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="creating-the-physics-kernels">
<h2><span class="section-number">4.6. </span>Creating the physics kernels<a class="headerlink" href="#creating-the-physics-kernels" title="Link to this heading"></a></h2>
<p>So far we have basically been weaving an administrative thread to tell ARMI about the code
we want to run. Now we finally get to write the guts of the code that actually does
something. In your real app, this code will run your own industrial or research code, or
perform your own methodology.  Here we just have it make up dummy values representing flux
and temperatures.</p>
<section id="making-the-dummy-flux-kernel">
<h3><span class="section-number">4.6.1. </span>Making the (dummy) flux kernel<a class="headerlink" href="#making-the-dummy-flux-kernel" title="Link to this heading"></a></h3>
<p>In a previous tutorial, we made a function that sets a dummy flux to all parts of the core
based on a radial distance from the origin. Here we will reuse that code but package it
more formally so that ARMI can actually run it for us from a user perspective.</p>
<p>The interface is responsible largely for scheduling activities to run at various time
points. For a flux calculation, we want it to compute at every single time node, so we use
the <a class="reference internal" href="../.apidocs/armi.interfaces.html#armi.interfaces.Interface.interactEveryNode" title="armi.interfaces.Interface.interactEveryNode"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.interfaces.Interface.interactEveryNode()</span></code></a> hook.</p>
<p>These interaction hooks can call arbitrarily complex code. The code could, for example:</p>
<ul class="simple">
<li><p>Run an external executable locally</p></li>
<li><p>Submit an external code to a cloud HPC and wait for it to complete</p></li>
<li><p>Run an internal physics tool</p></li>
</ul>
<p>Here it just does a tiny bit of math locally.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/fluxSolver.py</span></code></span><a class="headerlink" href="#id5" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">interfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FluxInterface</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dummyFlux&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interactEveryNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeNode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing neutron flux and power.&quot;</span><span class="p">)</span>
        <span class="n">setFakePower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setFakePower</span><span class="p">(</span><span class="n">core</span><span class="p">):</span>
    <span class="n">fuelBlocks</span> <span class="o">=</span> <span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
    <span class="n">topFuelZ</span> <span class="o">=</span> <span class="n">fuelBlocks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">bottomFuelZ</span> <span class="o">=</span> <span class="n">fuelBlocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">coreMidPlane</span> <span class="o">=</span> <span class="p">(</span><span class="n">topFuelZ</span> <span class="o">-</span> <span class="n">bottomFuelZ</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">bottomFuelZ</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coreMidPlane</span><span class="p">])</span>
    <span class="n">peakPower</span> <span class="o">=</span> <span class="mf">1e6</span>
    <span class="n">mgFluxBase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">core</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">()</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">center</span><span class="p">))</span>
            <span class="n">fuelFlag</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">isFuel</span><span class="p">()</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">peakPower</span> <span class="o">/</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">fuelFlag</span> <span class="o">/</span> <span class="n">b</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pdens</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">/</span> <span class="n">vol</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span> <span class="o">=</span> <span class="n">mgFluxBase</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pdens</span>
</pre></div>
</div>
</div>
</section>
<section id="making-the-thermal-hydraulics-kernel">
<h3><span class="section-number">4.6.2. </span>Making the thermal/hydraulics kernel<a class="headerlink" href="#making-the-thermal-hydraulics-kernel" title="Link to this heading"></a></h3>
<p>Since we told the ARMI plugin to schedule the flux solver before thermal/hydraulics solver
via the <code class="docutils literal notranslate"><span class="pre">ORDER</span></code> attribute, we can depend on there being up-to-date block-level <code class="docutils literal notranslate"><span class="pre">power</span></code>
state data loaded onto the ARMI reactor by the time this thermal/hydraulics solver gets
called by the ARMI main loop.</p>
<p>We’ll make a somewhat meaningful (but still totally academic) flow solver here that uses
energy conservation to determine an idealized coolant flow rate. To do this it will
compute the total power produced by each assembly to get the required mass flow rate and
then apply that mass flow rate from the bottom of the assembly to the top, computing a
block-level temperature (and flow velocity) distribution as we go.</p>
<div class="math notranslate nohighlight">
\[\dot{Q} = \dot{m} C_p \Delta T\]</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/thermalSolver.py</span></code></span><a class="headerlink" href="#id6" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">interfaces</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONF_INLET_TEMPERATURE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">myapp.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONF_OUTLET_TEMPERATURE</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ThermalInterface</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dummyTH&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">interactEveryNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeNode</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing idealized flow rate&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="p">:</span>
            <span class="n">runThermalHydraulics</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">runThermalHydraulics</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="n">massFlow</span> <span class="o">=</span> <span class="n">computeIdealizedFlow</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="n">computeAxialCoolantTemperature</span><span class="p">(</span><span class="n">assembly</span><span class="p">,</span> <span class="n">massFlow</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">computeIdealizedFlow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="c1"># compute required mass flow rate in assembly to reach target outlet temperature</span>
    <span class="c1"># mass flow rate will be constant in each axial region, regardless of coolant</span>
    <span class="c1"># area (velocity may change)</span>
    <span class="n">coolants</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span>

    <span class="c1"># use ARMI material library to get heat capacity for whatever the user has</span>
    <span class="c1"># defined the coolant as</span>
    <span class="n">tempAvg</span> <span class="o">=</span> <span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_OUTLET_TEMPERATURE</span><span class="p">]</span> <span class="o">+</span> <span class="n">cs</span><span class="p">[</span><span class="n">CONF_INLET_TEMPERATURE</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">coolantProps</span> <span class="o">=</span> <span class="n">coolants</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span>
    <span class="n">heatCapacity</span> <span class="o">=</span> <span class="n">coolantProps</span><span class="o">.</span><span class="n">heatCapacity</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">tempAvg</span><span class="p">)</span>

    <span class="n">deltaT</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">CONF_OUTLET_TEMPERATURE</span><span class="p">]</span> <span class="o">-</span> <span class="n">cs</span><span class="p">[</span><span class="n">CONF_INLET_TEMPERATURE</span><span class="p">]</span>
    <span class="n">massFlowRate</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">calcTotalParam</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">deltaT</span> <span class="o">*</span> <span class="n">heatCapacity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">massFlowRate</span>


<span class="k">def</span><span class="w"> </span><span class="nf">computeAxialCoolantTemperature</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">massFlow</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute block-level coolant inlet/outlet/avg temp and velocity.&quot;&quot;&quot;</span>
    <span class="c1"># solve Qdot = mdot * Cp * dT for dT this time</span>
    <span class="n">inlet</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">CONF_INLET_TEMPERATURE</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcoolantInletT</span> <span class="o">=</span> <span class="n">inlet</span>
        <span class="n">coolant</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span>
        <span class="n">coolantProps</span> <span class="o">=</span> <span class="n">coolant</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span>
        <span class="n">heatCapacity</span> <span class="o">=</span> <span class="n">coolantProps</span><span class="o">.</span><span class="n">heatCapacity</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">inlet</span><span class="p">)</span>
        <span class="n">deltaT</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">/</span> <span class="p">(</span><span class="n">massFlow</span> <span class="o">*</span> <span class="n">heatCapacity</span><span class="p">)</span>
        <span class="n">outlet</span> <span class="o">=</span> <span class="n">inlet</span> <span class="o">+</span> <span class="n">deltaT</span>
        <span class="n">inlet</span> <span class="o">=</span> <span class="n">outlet</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcoolantOutletT</span> <span class="o">=</span> <span class="n">outlet</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcoolantAverageT</span> <span class="o">=</span> <span class="p">(</span><span class="n">outlet</span> <span class="o">+</span> <span class="n">inlet</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="adding-entry-points">
<h2><span class="section-number">4.7. </span>Adding entry points<a class="headerlink" href="#adding-entry-points" title="Link to this heading"></a></h2>
<p>In order to call our application directly, we need to add the <code class="file docutils literal notranslate"><span class="pre">__main__.py</span></code> file to
the package. We could add all manner of <a class="reference internal" href="../.apidocs/armi.cli.entryPoint.html#module-armi.cli.entryPoint" title="armi.cli.entryPoint"><code class="xref py py-mod docutils literal notranslate"><span class="pre">entry</span> <span class="pre">points</span></code></a> here
for different operations we want our application to perform. If you want to add
<a class="reference internal" href="../developer/entrypoints.html"><span class="doc">your own entry points</span></a>, you have to register them with the
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineEntryPoints" title="armi.plugins.ArmiPlugin.defineEntryPoints"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.plugins.ArmiPlugin.defineEntryPoints()</span></code></a> hook. For now, we can just inherit
from the default ARMI entry points (including <code class="docutils literal notranslate"><span class="pre">run</span></code>) by adding the following code
to what we already have in <code class="file docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code></span><a class="headerlink" href="#id7" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArmiCLI</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">ArmiCLI</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Entry points are phenomenal places to put useful analysis scripts
that are limited in scope to the scope of the application.</p>
</div>
</section>
<section id="running-the-app-and-debugging">
<h2><span class="section-number">4.8. </span>Running the app and debugging<a class="headerlink" href="#running-the-app-and-debugging" title="Link to this heading"></a></h2>
<p>We are now ready to execute our application. Even though it still contains an issue, we
will run it now to get a feel for the iterative debugging process (sometimes lovingly
called ARMI whack-a-mole).</p>
<p>We must make sure our <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> contains both the armi framework itself as well as
the directory that contains our app. For testing, an example value for this might be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export PYTHONPATH=/path/to/armi:/path/to/my_armi_project
</pre></div>
</div>
<div class="admonition-windows-tip admonition">
<p class="admonition-title">Windows tip</p>
<p>If you’re using Windows, the slashes will be the other way, you use <code class="docutils literal notranslate"><span class="pre">set</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">export</span></code>, and you use <code class="docutils literal notranslate"><span class="pre">;</span></code> to separate entries (or just use the GUI).</p>
</div>
<div class="admonition-submodule-tip admonition">
<p class="admonition-title">Submodule tip</p>
<p>In development, we have found it convenient to use git submodules to contain the armi
framework and pointers to other plugins you may need. If you do this, you can set
the <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> directly in the <code class="docutils literal notranslate"><span class="pre">__main__</span></code> file and not have to worry about
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> nearly as much.</p>
</div>
<p>Make a run directory with some input files in it. You can use the same SFR input files
we’ve used in previous tutorials for starters (but quickly transition to your own inputs
for your own interests!).</p>
<p>Here are the files you can download into the run directory.</p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="../_downloads/9c053a01d8afa884e836a68063dbf746/anl-afci-177-blueprints.yaml"><code class="xref download docutils literal notranslate"><span class="pre">Blueprints</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/1927c695046644c8636a2ec37628e9dd/anl-afci-177.yaml"><code class="xref download docutils literal notranslate"><span class="pre">Settings</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/9d93d831d336d8f7b637bc7644a55f1a/anl-afci-177-coreMap.yaml"><code class="xref download docutils literal notranslate"><span class="pre">Core</span> <span class="pre">map</span></code></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/953568192ea5a7fb4becdacc30a42738/anl-afci-177-fuelManagement.py"><code class="xref download docutils literal notranslate"><span class="pre">Fuel</span> <span class="pre">management</span></code></a></p></li>
</ul>
<p>Then, run your app!:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(armi) $ python -m myapp run anl-afci-177.yaml
</pre></div>
</div>
<p>The code will run for a while and you will see your physics plugins in the interface
stack, but will run into an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">NotImplementedError</span><span class="p">:</span> <span class="n">Material</span> <span class="n">Sodium</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">implement</span> <span class="n">heatCapacity</span>
</pre></div>
</div>
<p>The included academic Sodium material in the ARMI material library doesn’t have any heat
capacity! Here we can either add heat capacity to the material and submit a pull request
to include it in the ARMI Framework (preferred for generic things), or make our own
material and register it through the plugin.</p>
<div class="admonition-yet-another-way admonition">
<p class="admonition-title">Yet another way</p>
<p>You could alternatively make a separate plugin that only has your team’s special
material properties.</p>
</div>
<section id="adding-a-new-material">
<h3><span class="section-number">4.8.1. </span>Adding a new material<a class="headerlink" href="#adding-a-new-material" title="Link to this heading"></a></h3>
<p>Let’s just add a subclass of sodium in our plugin that has a heat capacity defined. Make
your new material in a new module called <code class="file docutils literal notranslate"><span class="pre">myapp/materials.py</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/materials.py</span></code></span><a class="headerlink" href="#id8" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">materials</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">getTc</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Sodium</span><span class="p">(</span><span class="n">materials</span><span class="o">.</span><span class="n">Sodium</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">heatCapacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tk</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sodium heat capacity in J/kg-K&quot;&quot;&quot;</span>
        <span class="n">Tc</span> <span class="o">=</span> <span class="n">getTc</span><span class="p">(</span><span class="n">Tc</span><span class="p">,</span> <span class="n">Tk</span><span class="p">)</span>
        <span class="c1"># not even temperature dependent for now</span>
        <span class="k">return</span> <span class="mf">1.252</span>
</pre></div>
</div>
</div>
<p>But wait! Now there are <strong>two</strong> materials with the name <em>Sodium</em> in ARMI. Which will be
chosen? ARMI uses a namespace order controlled by
<a class="reference internal" href="../.apidocs/armi.materials.html#armi.materials.setMaterialNamespaceOrder" title="armi.materials.setMaterialNamespaceOrder"><code class="xref py py-func docutils literal notranslate"><span class="pre">armi.materials.setMaterialNamespaceOrder()</span></code></a> which can be set either
programmatically (in an app) or at runtime (via the <code class="docutils literal notranslate"><span class="pre">materialNamespaceOrder</span></code> user
setting). In our case, we want to set it at the app level, so we will yet again add
more to the <code class="file docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code> file:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">myapp/__main__.py</span></code></span><a class="headerlink" href="#id9" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">materials</span>

<span class="n">materials</span><span class="o">.</span><span class="n">setMaterialNamespaceOrder</span><span class="p">([</span><span class="s2">&quot;myapp.materials&quot;</span><span class="p">,</span> <span class="s2">&quot;armi.materials&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="admonition-why-main-py admonition">
<p class="admonition-title">Why <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code>?</p>
<p>We put this line in <code class="docutils literal notranslate"><span class="pre">__main__.py</span></code> rather than <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> so it only activates
when we’re explicitly running our app. If we put it in <code class="docutils literal notranslate"><span class="pre">__init__</span></code> it would
change the order even in situations where code from anywhere within our app
was imported, possibly conflicting with another app’s needs.</p>
</div>
<p>Now ARMI should find our new updated Sodium material and get past that error.  Run it once
again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(armi) $ python -m myapp run anl-afci-177.yaml
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You may want to pipe the output to a log file for convenient viewing with
a command like <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">myapp</span> <span class="pre">run</span> <span class="pre">anl-afci-177.yaml</span> <span class="pre">&gt;</span> <span class="pre">run.stdout</span></code></p>
</div>
</section>
</section>
<section id="checking-the-output">
<h2><span class="section-number">4.9. </span>Checking the output<a class="headerlink" href="#checking-the-output" title="Link to this heading"></a></h2>
<p>Several output files should have been created in the run directory from that past command.
Most important is the <code class="docutils literal notranslate"><span class="pre">anl-afci-177.h5</span></code> HDF5 binary database file. You can use this file
to bring the ARMI state back to any state point from the run for analysis.</p>
<p>To visualize the output in a 3D graphics program like <a class="reference external" href="https://www.paraview.org/Wiki/ParaView">ParaView</a>
or <a class="reference external" href="https://wci.llnl.gov/simulation/computer-codes/visit">VisIT</a>,
you can run the ARMI <code class="docutils literal notranslate"><span class="pre">vis-file</span></code> entry point, like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(armi) $ python -m myapp vis-file -f vtk anl-afci-177.h5
</pre></div>
</div>
<p>This creates several <code class="docutils literal notranslate"><span class="pre">VTK</span></code> files covering different time steps and levels of abstraction
(assembly vs. block params). If you load up the block file and plot one of the output
params (such as <code class="docutils literal notranslate"><span class="pre">THcoolantOutletT</span></code> you can see the outlet temperature going nicely
from 360 °C  to 510 °C (as expected given our simple TH solver).</p>
<figure class="align-center" id="id10">
<img alt="The coolant temperature as seen in ParaView viewing the VTK file." src="../_images/anl-acfi-177-coolant-temperature.jpg" />
<figcaption>
<p><span class="caption-text">The coolant temperature as seen in ParaView viewing the VTK file.</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition-fancy-xdmf-format admonition">
<p class="admonition-title">Fancy XDMF format</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">xdmf</span></code> produces <a class="reference external" href="http://xdmf.org/index.php/XDMF_Model_and_Format">XDMF files</a>
that are lighter-weight than VTK, just pointing the visualization
program to the data in the primary ARMI HDF5 file. However it is slightly more
finicky and has slightly less support in some tools (looking at VisIT).</p>
</div>
<p>A generic description of the outputs is provided in <a class="reference internal" href="../user/outputs.html"><span class="doc">Outputs</span></a>.</p>
<p>You can add your own outputs from your plugins.</p>
</section>
<section id="bonus-ad-hoc-userplugins">
<h2><span class="section-number">4.10. </span>Bonus: Ad-hoc UserPlugins<a class="headerlink" href="#bonus-ad-hoc-userplugins" title="Link to this heading"></a></h2>
<p>It will often be the case that you are not building an ARMI application from scratch, but
you are using a pre-existing ARMI application. And while working with this (potentially
quite large) ARMI application, you want to add a one-off change. Maybe you want to make a
special plot during the run, or do a quick “what-if” modification of the
<a class="reference internal" href="../.apidocs/armi.reactor.reactors.html#armi.reactor.reactors.Reactor" title="armi.reactor.reactors.Reactor"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reactor</span></code></a>. These things come up for scientific
or engineering work: a quick one-off idea you want to test out and probably only use once.</p>
<p>This is where a <a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPlugin</span></code></a> come in.</p>
<p>There are two parts to defining a <a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPlugin</span></code></a>:</p>
<section id="define-the-userplugin-in-python">
<h3><span class="section-number">4.10.1. </span>Define the UserPlugin in Python<a class="headerlink" href="#define-the-userplugin-in-python" title="Link to this heading"></a></h3>
<p>This can be done by subclassing <a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">armi.plugins.UserPlugin</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">plugins</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UserPluginExample</span><span class="p">(</span><span class="n">plugins</span><span class="o">.</span><span class="n">UserPlugin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This plugin flex-tests the onProcessCoreLoading() hook, and</span>
<span class="sd">    arbitrarily adds &quot;1&quot; to the power ever each fuel block.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="nd">@plugins</span><span class="o">.</span><span class="n">HOOKIMPL</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">onProcessCoreLoading</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">dbLoad</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">):</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">+=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>In most ways, <code class="docutils literal notranslate"><span class="pre">UserPluginExample</span></code> above is just a normal
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin" title="armi.plugins.ArmiPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArmiPlugin</span></code></a>. You can implement any of the normal
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin" title="armi.plugins.ArmiPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArmiPlugin</span></code></a> hooks, like:
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.exposeInterfaces" title="armi.plugins.ArmiPlugin.exposeInterfaces"><code class="xref py py-meth docutils literal notranslate"><span class="pre">exposeInterfaces()</span></code></a>,
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineParameters" title="armi.plugins.ArmiPlugin.defineParameters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">defineParameters()</span></code></a>, and so on. The
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPlugin</span></code></a> class is more limited than a
regular plugin though, you cannot implement:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineParameters" title="armi.plugins.ArmiPlugin.defineParameters"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.plugins.ArmiPlugin.defineParameters()</span></code></a></p></li>
<li><p><a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineParameterRenames" title="armi.plugins.ArmiPlugin.defineParameterRenames"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.plugins.ArmiPlugin.defineParameterRenames()</span></code></a></p></li>
<li><p><a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineSettings" title="armi.plugins.ArmiPlugin.defineSettings"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.plugins.ArmiPlugin.defineSettings()</span></code></a></p></li>
<li><p><a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.ArmiPlugin.defineSettingsValidators" title="armi.plugins.ArmiPlugin.defineSettingsValidators"><code class="xref py py-meth docutils literal notranslate"><span class="pre">armi.plugins.ArmiPlugin.defineSettingsValidators()</span></code></a></p></li>
</ul>
</section>
<section id="define-a-list-of-userplugins-in-the-settings-file">
<h3><span class="section-number">4.10.2. </span>Define a list of UserPlugins in the Settings File<a class="headerlink" href="#define-a-list-of-userplugins-in-the-settings-file" title="Link to this heading"></a></h3>
<p>In order for your simulation to know about your custom
<a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPlugin</span></code></a> you need to add a line to your Settings
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">userPlugins</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">armi</span><span class="o">.</span><span class="n">tests</span><span class="o">.</span><span class="n">test_user_plugins</span><span class="o">.</span><span class="n">UserPlugin0</span>
  <span class="o">-</span> <span class="o">//</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my</span><span class="o">/</span><span class="n">pluginz</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="n">UserPlugin1</span>
  <span class="o">-</span> <span class="n">C</span><span class="p">:</span>\\<span class="n">path</span>\<span class="n">to</span>\<span class="n">my</span>\<span class="n">pluginZ</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="n">UserPlugin2</span>
</pre></div>
</div>
<p>What we have above is actually an example of including three different plugins via your
settings YAML file:</p>
<ul class="simple">
<li><p>By providing a <code class="docutils literal notranslate"><span class="pre">.</span></code>-separated ARMI import path (if you included your <a class="reference internal" href="../.apidocs/armi.plugins.html#armi.plugins.UserPlugin" title="armi.plugins.UserPlugin"><code class="xref py py-class docutils literal notranslate"><span class="pre">UserPlugin</span></code></a> in your commit.</p></li>
<li><p>By providing a full Linux/Unix/MacOS file path, then a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), followed by the class name.</p></li>
<li><p>By providing a full Windows file path, then a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), followed by the class name.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="data_model.html" class="btn btn-neutral float-left" title="3. Hands-on at the ARMI Terminal" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="param_sweep.html" class="btn btn-neutral float-right" title="5. Parameter sweeps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2025, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2025-08-12.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>