<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.reactor.converters.blockConverters &mdash; ARMI 0.3.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme_fixes.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/armiicon_16x16.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../../reactor.html">armi.reactor</a></li>
      <li class="breadcrumb-item active">armi.reactor.converters.blockConverters</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.reactor.converters.blockConverters</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Convert block geometry from one to another, etc.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Wedge</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>

<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">blocks</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">grids</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">components</span>
<span class="kn">from</span> <span class="nn">armi.reactor.flags</span> <span class="kn">import</span> <span class="n">Flags</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>

<span class="n">SIN60</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">60.0</span><span class="p">))</span>


<div class="viewcode-block" id="BlockConverter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockConverter">[docs]</a><span class="k">class</span> <span class="nc">BlockConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Converts a block.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sourceBlock : :py:class:`armi.reactor.blocks.Block`</span>
<span class="sd">            An ARMI Block object to convert.</span>
<span class="sd">        quite : boolean, optional</span>
<span class="sd">            If True, less information is output in the runLog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span> <span class="o">=</span> <span class="n">sourceBlock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the new block that is created.</span>

<div class="viewcode-block" id="BlockConverter.dissolveComponentIntoComponent"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockConverter.dissolveComponentIntoComponent">[docs]</a>    <span class="k">def</span> <span class="nf">dissolveComponentIntoComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span><span class="p">,</span> <span class="n">minID</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a new block that homogenized one component into another while conserving number of atoms.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        soluteName : str</span>
<span class="sd">            The name of the solute component in _sourceBlock</span>
<span class="sd">        solventName : str</span>
<span class="sd">            The name of the solvent component in _sourceBlock</span>
<span class="sd">        minID : float</span>
<span class="sd">            The minimum hot temperature diameter allowed for the solvent.</span>
<span class="sd">            This is useful for forcing components to not overlap.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        Nuclides merged into another component will be the temperature of the new component as temperature</span>
<span class="sd">        is stored on the component level. In the solute and solvent are the same temperature this is not an issue.</span>
<span class="sd">        Converted blocks that have dissolved components should avoid having their temperatures changed.</span>
<span class="sd">        This is because the component being merged into retains its old thermal expansion properties and</span>
<span class="sd">        may not be consistent with how the components would behave independently. For this reason it is</span>
<span class="sd">        recommended that these blocks be made right before the physics calculation of interest and be immediately</span>
<span class="sd">        discarded. Attaching them to the reactor is not recommended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
            <span class="s2">&quot;Homogenizing the </span><span class="si">{}</span><span class="s2"> component into the </span><span class="si">{}</span><span class="s2"> component in block </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># break up dimension links since we will be messing with this block&#39;s components</span>
        <span class="n">newBlock</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="p">)</span>
        <span class="c1"># cannot pass components directly since the new block will have new components</span>
        <span class="n">solute</span> <span class="o">=</span> <span class="n">newBlock</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="n">soluteName</span><span class="p">)</span>
        <span class="n">solvent</span> <span class="o">=</span> <span class="n">newBlock</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="n">solventName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkInputs</span><span class="p">(</span><span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">)</span>

        <span class="n">soluteLinks</span> <span class="o">=</span> <span class="n">solute</span><span class="o">.</span><span class="n">getLinkedComponents</span><span class="p">()</span>
        <span class="c1"># the area about to be added by the dimension change can be different than the simple area of the</span>
        <span class="c1"># merged component due to void gaps between components</span>
        <span class="n">oldArea</span> <span class="o">=</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;removing </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solute</span><span class="p">))</span>
        <span class="c1"># skip recomputation of area fractions because the blocks still have 0 height at this stage and derived</span>
        <span class="c1"># shape volume computations will fail</span>
        <span class="n">newBlock</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">solute</span><span class="p">,</span> <span class="n">recomputeAreaFractions</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span> <span class="o">=</span> <span class="n">newBlock</span>

        <span class="c1"># adjust new shape area.</span>
        <span class="k">if</span> <span class="n">solvent</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># If it&#39;s coolant, the auto-fill area system gets it. coolant has no links</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">soluteID</span><span class="p">,</span> <span class="n">soluteOD</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">solute</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                <span class="n">solute</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">soluteID</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Decreasing ID of </span><span class="si">{}</span><span class="s2"> to accommodate </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solvent</span><span class="p">,</span> <span class="n">solute</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">solvent</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">soluteID</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">soluteOD</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Increasing OD of </span><span class="si">{}</span><span class="s2"> to accommodate </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solvent</span><span class="p">,</span> <span class="n">solute</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">solvent</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">,</span> <span class="n">soluteOD</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">minID</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Updating the ID of </span><span class="si">{}</span><span class="s2"> the the specified min ID: </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">solvent</span><span class="p">,</span> <span class="n">minID</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">solvent</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">minID</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">soluteLinks</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restablishLinks</span><span class="p">(</span><span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">soluteLinks</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verifyExpansion</span><span class="p">(</span><span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">)</span>

        <span class="n">solvent</span><span class="o">.</span><span class="n">changeNDensByFactor</span><span class="p">(</span><span class="n">oldArea</span> <span class="o">/</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getArea</span><span class="p">())</span>
        <span class="n">solute</span><span class="o">.</span><span class="n">mergeNuclidesInto</span><span class="p">(</span><span class="n">solvent</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_checkInputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">solute</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">solvent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Block </span><span class="si">{}</span><span class="s2"> must have a </span><span class="si">{}</span><span class="s2"> component and a </span><span class="si">{}</span><span class="s2"> component to homogenize.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="p">,</span> <span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">solvent</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">)</span>
            <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Components are not of compatible shape to be merged &quot;</span>
                <span class="s2">&quot;solute: </span><span class="si">{}</span><span class="s2">, solvent: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">solute</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot merge components if either have negative area. &quot;</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> area: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> area : </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">solute</span><span class="o">.</span><span class="n">getArea</span><span class="p">(),</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>

<div class="viewcode-block" id="BlockConverter.restablishLinks"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockConverter.restablishLinks">[docs]</a>    <span class="k">def</span> <span class="nf">restablishLinks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">soluteLinks</span><span class="p">):</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
            <span class="s2">&quot;Solute is linked to component(s) </span><span class="si">{}</span><span class="s2"> and these links will be reestablished.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">soluteLinks</span>
            <span class="p">),</span>
            <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">linkedC</span> <span class="ow">in</span> <span class="n">soluteLinks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">linkedC</span> <span class="ow">in</span> <span class="n">solvent</span><span class="o">.</span><span class="n">getLinkedComponents</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">linkedC</span><span class="o">.</span><span class="n">containsVoidMaterial</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Non-Void component </span><span class="si">{}</span><span class="s2"> was linked to solute and solvent </span><span class="si">{}</span><span class="s2"> in converted block </span><span class="si">{}</span><span class="s2">. &quot;</span>
                        <span class="s2">&quot;Please dissolve this separately.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">linkedC</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
                    <span class="s2">&quot;Removing void component </span><span class="si">{}</span><span class="s2"> in converted block </span><span class="si">{}</span><span class="s2">.&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">linkedC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">()),</span>
                    <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">linkedC</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dims</span> <span class="o">=</span> <span class="n">linkedC</span><span class="o">.</span><span class="n">getDimensionNamesLinkedTo</span><span class="p">(</span><span class="n">solute</span><span class="p">)</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
                    <span class="s2">&quot;Linking component </span><span class="si">{}</span><span class="s2"> in converted block </span><span class="si">{}</span><span class="s2"> to solvent </span><span class="si">{}</span><span class="s2">.&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">linkedC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">(),</span> <span class="n">solvent</span><span class="p">),</span>
                    <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">dimToChange</span><span class="p">,</span> <span class="n">dimOfOther</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
                    <span class="n">linkedC</span><span class="o">.</span><span class="n">setLink</span><span class="p">(</span><span class="n">dimToChange</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">dimOfOther</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_verifyExpansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">):</span>
        <span class="n">validComponents</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">validComponents</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">c</span> <span class="ow">is</span> <span class="n">solvent</span>
                <span class="ow">or</span> <span class="n">c</span><span class="o">.</span><span class="n">containsVoidMaterial</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isEncapsulatedBy</span><span class="p">(</span><span class="n">solvent</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;There is a non void component </span><span class="si">{}</span><span class="s2"> in the location where component </span><span class="si">{}</span><span class="s2"> was expanded &quot;</span>
                    <span class="s2">&quot;to absorb component solute </span><span class="si">{}</span><span class="s2">. solvent dims </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> comp dims </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">c</span><span class="p">,</span> <span class="n">solvent</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">solvent</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">od</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">od</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Component </span><span class="si">{}</span><span class="s2"> still has negative area after </span><span class="si">{}</span><span class="s2"> was dissolved into </span><span class="si">{}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">),</span>
                    <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

<div class="viewcode-block" id="BlockConverter.convert"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockConverter.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<div class="viewcode-block" id="ComponentMerger"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.ComponentMerger">[docs]</a><span class="k">class</span> <span class="nc">ComponentMerger</span><span class="p">(</span><span class="n">BlockConverter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For a provided block, merged the solute component into the solvent component.</span>

<span class="sd">    .. impl:: Homogenize one component into another.</span>
<span class="sd">        :id: I_ARMI_BLOCKCONV0</span>
<span class="sd">        :implements: R_ARMI_BLOCKCONV</span>

<span class="sd">        This subclass of ``BlockConverter`` is meant as a one-time-use tool, to convert</span>
<span class="sd">        a ``Block`` into one ``Component``. A ``Block`` is a ``Composite`` that may</span>
<span class="sd">        probably has multiple ``Components`` somewhere in it. This means averaging the</span>
<span class="sd">        material properties in the original ``Block``, and ensuring that the final</span>
<span class="sd">        ``Component`` has the same shape and volume as the original ``Block``. This</span>
<span class="sd">        subclass essentially just uses the base class method</span>
<span class="sd">        ``dissolveComponentIntoComponent()`` given prescribed solute and solvent</span>
<span class="sd">        materials, to define the merger.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    It is the job of the developer to determine if merging a Block into one Component</span>
<span class="sd">    will yield valid or sane results.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">,</span> <span class="n">soluteName</span><span class="p">,</span> <span class="n">solventName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sourceBlock : :py:class:`armi.reactor.blocks.Block`</span>
<span class="sd">            An ARMI Block object to convert.</span>
<span class="sd">        soluteName : str</span>
<span class="sd">            The name of the solute component in _sourceBlock</span>
<span class="sd">        solventName : str</span>
<span class="sd">            The name of the solvent component in _sourceBlock</span>
<span class="sd">        quite : boolean, optional</span>
<span class="sd">            If True, less information is output in the runLog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BlockConverter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soluteName</span> <span class="o">=</span> <span class="n">soluteName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solventName</span> <span class="o">=</span> <span class="n">solventName</span>

<div class="viewcode-block" id="ComponentMerger.convert"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.ComponentMerger.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a block with the solute merged into the solvent.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolveComponentIntoComponent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soluteName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solventName</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span></div></div>


<div class="viewcode-block" id="MultipleComponentMerger"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.MultipleComponentMerger">[docs]</a><span class="k">class</span> <span class="nc">MultipleComponentMerger</span><span class="p">(</span><span class="n">BlockConverter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dissolves multiple components and checks validity at end.</span>

<span class="sd">    Doesn&#39;t run _verifyExpansion until the end so that the order the components are dissolved in</span>
<span class="sd">    does not cause a failure. For example if two liners are dissolved into the clad and the farthest</span>
<span class="sd">    liner was dissolved first, this would normally cause a ValueError in _verifyExpansion since the</span>
<span class="sd">    clad would be completely expanded over a non void component.</span>

<span class="sd">    .. impl:: Homogenize multiple components into one.</span>
<span class="sd">        :id: I_ARMI_BLOCKCONV1</span>
<span class="sd">        :implements: R_ARMI_BLOCKCONV</span>

<span class="sd">        This subclass of ``BlockConverter`` is meant as a one-time-use tool, to convert</span>
<span class="sd">        a multiple ``Components`` into one. This means averaging the material</span>
<span class="sd">        properties in the original ``Components``, and ensuring that the final</span>
<span class="sd">        ``Component`` has the same shape and volume as all of the originals. This</span>
<span class="sd">        subclass essentially just uses the base class method</span>
<span class="sd">        ``dissolveComponentIntoComponent()`` given prescribed solute and solvent</span>
<span class="sd">        materials, to define the merger. Though care is taken here to ensure the merger</span>
<span class="sd">        isn&#39;t verified until it is completely finished.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">,</span> <span class="n">soluteNames</span><span class="p">,</span> <span class="n">solventName</span><span class="p">,</span> <span class="n">specifiedMinID</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Standard constructor method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sourceBlock : :py:class:`armi.reactor.blocks.Block`</span>
<span class="sd">            An ARMI Block object to convert.</span>
<span class="sd">        soluteNames : list</span>
<span class="sd">            List of str names of the solute components in _sourceBlock</span>
<span class="sd">        solventName : str</span>
<span class="sd">            The name of the solvent component in _sourceBlock</span>
<span class="sd">        minID : float</span>
<span class="sd">            The minimum hot temperature diameter allowed for the solvent.</span>
<span class="sd">            This is useful for forcing components to not overlap.</span>
<span class="sd">        quite : boolean, optional</span>
<span class="sd">            If True, less information is output in the runLog.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BlockConverter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soluteNames</span> <span class="o">=</span> <span class="n">soluteNames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solventName</span> <span class="o">=</span> <span class="n">solventName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specifiedMinID</span> <span class="o">=</span> <span class="n">specifiedMinID</span>

    <span class="k">def</span> <span class="nf">_verifyExpansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solute</span><span class="p">,</span> <span class="n">solvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait until all components are dissolved to check this.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="MultipleComponentMerger.convert"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.MultipleComponentMerger.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a block with the solute merged into the solvent.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">soluteName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soluteNames</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dissolveComponentIntoComponent</span><span class="p">(</span>
                <span class="n">soluteName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solventName</span><span class="p">,</span> <span class="n">minID</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">specifiedMinID</span>
            <span class="p">)</span>
        <span class="n">solvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solventName</span><span class="p">)</span>
        <span class="n">BlockConverter</span><span class="o">.</span><span class="n">_verifyExpansion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">soluteNames</span><span class="p">,</span> <span class="n">solvent</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span></div></div>


<div class="viewcode-block" id="BlockAvgToCylConverter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockAvgToCylConverter">[docs]</a><span class="k">class</span> <span class="nc">BlockAvgToCylConverter</span><span class="p">(</span><span class="n">BlockConverter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a block and driver block into a block made of a concentric circles using</span>
<span class="sd">    block (homogenized) composition.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This converter is intended for use in building 1-dimensional models of a set of block.</span>
<span class="sd">    numInternalRings controls the number of rings to use for the source block, while the</span>
<span class="sd">    numExternalRings controls the number of rings for the driver fuel block.  The number</span>
<span class="sd">    of blocks to in each ring grows by 6 for each ring in hex geometry and 8 for each ring</span>
<span class="sd">    in Cartesian.</span>

<span class="sd">    This converter is opinionated in that it uses a spatial grid to determine how many</span>
<span class="sd">    blocks to add based on the type of the ``sourceBlock``. For example, if the ``sourceBlock``</span>
<span class="sd">    is a HexBlock then a HexGrid will be used. If the ``sourceBlock`` is a CartesianBlock</span>
<span class="sd">    then a CartesianGrid without an offset will be used.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    HexComponentsToCylConverter: This converter is more useful if the pin lattice is in a</span>
<span class="sd">    hex lattice.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sourceBlock</span><span class="p">,</span>
        <span class="n">driverFuelBlock</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">numInternalRings</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">numExternalRings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="n">BlockConverter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceBlock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span> <span class="o">=</span> <span class="n">driverFuelBlock</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numExternalRings</span> <span class="o">=</span> <span class="n">numExternalRings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">sourceBlock</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;-cyl&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">sourceBlock</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">setLumpedFissionProducts</span><span class="p">(</span>
            <span class="n">sourceBlock</span><span class="o">.</span><span class="n">getLumpedFissionProductCollection</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_numInternalRings</span> <span class="o">=</span> <span class="n">numInternalRings</span>

<div class="viewcode-block" id="BlockAvgToCylConverter.convert"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockAvgToCylConverter.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a block converted into cylindrical geometry, possibly with other block types surrounding it.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addBlockRings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numInternalRings</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addDriverFuelRings</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span></div>

    <span class="k">def</span> <span class="nf">_addBlockRings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">blockToAdd</span><span class="p">,</span> <span class="n">blockName</span><span class="p">,</span> <span class="n">numRingsToAdd</span><span class="p">,</span> <span class="n">firstRing</span><span class="p">,</span> <span class="n">mainComponent</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a homogeneous block ring to the converted block.&quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Converting representative block </span><span class="si">{}</span><span class="s2"> to its equivalent cylindrical model&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">innerDiam</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="p">)</span>
            <span class="k">else</span> <span class="mf">0.0</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">mainComponent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newCompProps</span> <span class="o">=</span> <span class="n">mainComponent</span><span class="o">.</span><span class="n">material</span>
            <span class="n">tempInput</span> <span class="o">=</span> <span class="n">tempHot</span> <span class="o">=</span> <span class="n">mainComponent</span><span class="o">.</span><span class="n">temperatureInC</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># no component specified so just use block vals</span>
            <span class="n">newCompProps</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Custom&quot;</span>  <span class="c1"># this component shouldn&#39;t change temperature anyway</span>
            <span class="p">)</span>
            <span class="n">tempInput</span> <span class="o">=</span> <span class="n">tempHot</span> <span class="o">=</span> <span class="n">blockToAdd</span><span class="o">.</span><span class="n">getAverageTempInC</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blockToAdd</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">):</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blockToAdd</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CartesianBlock</span><span class="p">):</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The `sourceBlock` of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">blockToAdd</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not supported in </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">ringNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">firstRing</span><span class="p">,</span> <span class="n">firstRing</span> <span class="o">+</span> <span class="n">numRingsToAdd</span><span class="p">):</span>
            <span class="n">numFuelBlocksInRing</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="n">ringNum</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">numFuelBlocksInRing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">fuelBlockTotalArea</span> <span class="o">=</span> <span class="n">numFuelBlocksInRing</span> <span class="o">*</span> <span class="n">blockToAdd</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="n">driverOuterDiam</span> <span class="o">=</span> <span class="n">getOuterDiamFromIDAndArea</span><span class="p">(</span><span class="n">innerDiam</span><span class="p">,</span> <span class="n">fuelBlockTotalArea</span><span class="p">)</span>
            <span class="n">driverRing</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="n">blockName</span><span class="p">,</span>
                <span class="n">newCompProps</span><span class="p">,</span>
                <span class="n">tempInput</span><span class="p">,</span>
                <span class="n">tempHot</span><span class="p">,</span>
                <span class="n">od</span><span class="o">=</span><span class="n">driverOuterDiam</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">innerDiam</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">driverRing</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">blockToAdd</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
            <span class="c1"># no flag set here since its block level, and its a block, not component...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">driverRing</span><span class="p">)</span>
            <span class="n">innerDiam</span> <span class="o">=</span> <span class="n">driverOuterDiam</span>

    <span class="k">def</span> <span class="nf">_addDriverFuelRings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add driver fuel blocks as the outer-most surrounding ring.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is intended to be used to drive non-fuel compositions, DU, etc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span><span class="o">.</span><span class="n">isFuel</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Driver block </span><span class="si">{}</span><span class="s2"> must be fuel&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_numExternalRings</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Number of fuel rings is set to </span><span class="si">{}</span><span class="s2">, but must be a positive integer.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_numExternalRings</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">blockName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; driver&quot;</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span><span class="o">.</span><span class="n">getChildrenWithFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)[</span>
            <span class="mi">0</span>
        <span class="p">]</span>  <span class="c1"># used for mat properties and temperature</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_addBlockRings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_driverFuelBlock</span><span class="p">,</span>
            <span class="n">blockName</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numExternalRings</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_numInternalRings</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">mainComponent</span><span class="o">=</span><span class="n">fuel</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="BlockAvgToCylConverter.plotConvertedBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.BlockAvgToCylConverter.plotConvertedBlock">[docs]</a>    <span class="k">def</span> <span class="nf">plotConvertedBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render an image of the converted block.&quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
            <span class="s2">&quot;Plotting equivalent cylindrical block of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">circleComp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="p">:</span>
            <span class="n">innerR</span><span class="p">,</span> <span class="n">outerR</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">circleComp</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">circleComp</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Plotting </span><span class="si">{:40s}</span><span class="s2"> with </span><span class="si">{:10.3f}</span><span class="s2"> </span><span class="si">{:10.3f}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">circleComp</span><span class="p">,</span> <span class="n">innerR</span><span class="p">,</span> <span class="n">outerR</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">circle</span> <span class="o">=</span> <span class="n">Wedge</span><span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">outerR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">outerR</span> <span class="o">-</span> <span class="n">innerR</span><span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circle</span><span class="p">)</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circleComp</span><span class="o">.</span><span class="n">density</span><span class="p">())</span>
        <span class="n">colorMap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">cm</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colorMap</span><span class="o">.</span><span class="n">YlGn</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale_view</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fName</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fName</span></div></div>


<div class="viewcode-block" id="HexComponentsToCylConverter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.HexComponentsToCylConverter">[docs]</a><span class="k">class</span> <span class="nc">HexComponentsToCylConverter</span><span class="p">(</span><span class="n">BlockAvgToCylConverter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a hexagon full of pins into a circle full of concentric circles.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This is intended to capture heterogeneous effects while generating cross sections in</span>
<span class="sd">    MCC3. The resulting 1D cylindrical block will not be used in subsequent core</span>
<span class="sd">    calculations.</span>

<span class="sd">    Repeated pins/coolant rings will be built, followed by the non-pins like</span>
<span class="sd">    duct/intercoolant pinComponentsRing1 | coolant | pinComponentsRing2 | coolant | ... |</span>
<span class="sd">    nonpins ...</span>

<span class="sd">    This converter expects the ``sourceBlock`` and ``driverFuelBlock`` to defined and for</span>
<span class="sd">    the ``sourceBlock`` to have a spatial grid defined. Additionally, both the ``sourceBlock``</span>
<span class="sd">    and ``driverFuelBlock`` must be instances of HexBlocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sourceBlock</span><span class="p">,</span>
        <span class="n">driverFuelBlock</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">numExternalRings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">mergeIntoClad</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">BlockAvgToCylConverter</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">sourceBlock</span><span class="p">,</span>
            <span class="n">driverFuelBlock</span><span class="o">=</span><span class="n">driverFuelBlock</span><span class="p">,</span>
            <span class="n">numExternalRings</span><span class="o">=</span><span class="n">numExternalRings</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourceBlock</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Block </span><span class="si">{}</span><span class="s2"> is not hexagonal and cannot be converted to an equivalent cylinder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sourceBlock</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">sourceBlock</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sourceBlock</span><span class="si">}</span><span class="s2"> has no spatial grid attribute, therefore &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the block conversion with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> cannot proceed.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">driverFuelBlock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">driverFuelBlock</span><span class="p">,</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Block </span><span class="si">{}</span><span class="s2"> is not hexagonal and cannot be converted to an equivalent cylinder&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">driverFuelBlock</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinPitch</span> <span class="o">=</span> <span class="n">sourceBlock</span><span class="o">.</span><span class="n">getPinPitch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mergeIntoClad</span> <span class="o">=</span> <span class="n">mergeIntoClad</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span> <span class="o">=</span> <span class="n">sourceBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remainingCoolantFillArea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Block </span><span class="si">{}</span><span class="s2"> cannot be converted to rings without a `coolant` component&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">sourceBlock</span>
                <span class="p">)</span>
            <span class="p">)</span>

<div class="viewcode-block" id="HexComponentsToCylConverter.convert"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.HexComponentsToCylConverter.convert">[docs]</a>    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the conversion.</span>

<span class="sd">        .. impl:: Convert hex blocks to cylindrical blocks.</span>
<span class="sd">            :id:  I_ARMI_BLOCKCONV_HEX_TO_CYL</span>
<span class="sd">            :implements: R_ARMI_BLOCKCONV_HEX_TO_CYL</span>

<span class="sd">            This method converts a ``HexBlock`` to a cylindrical ``Block``. Obviously,</span>
<span class="sd">            this is not a physically meaningful transition; it is a helpful</span>
<span class="sd">            approximation tool for analysts. This is a subclass of</span>
<span class="sd">            ``BlockAvgToCylConverter`` which is a subclass of ``BlockConverter``. This</span>
<span class="sd">            converter expects the ``sourceBlock`` and ``driverFuelBlock`` to defined</span>
<span class="sd">            and for the ``sourceBlock`` to have a spatial grid defined. Additionally,</span>
<span class="sd">            both the ``sourceBlock`` and ``driverFuelBlock`` must be instances of</span>
<span class="sd">            ``HexBlocks``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Converting representative block </span><span class="si">{}</span><span class="s2"> to its equivalent cylindrical model&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dissolveComponents</span><span class="p">()</span>
        <span class="n">numRings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">getMinimumRings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">pinComponents</span><span class="p">,</span> <span class="n">nonPins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classifyComponents</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buildFirstRing</span><span class="p">(</span><span class="n">pinComponents</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">numRings</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_buildNthRing</span><span class="p">(</span><span class="n">pinComponents</span><span class="p">,</span> <span class="n">ring</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_buildNonPinRings</span><span class="p">(</span><span class="n">nonPins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addDriverFuelRings</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">getComponents</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">comp</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="si">}</span><span class="s2"> has a negative area of </span><span class="si">{</span><span class="n">comp</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Negative areas are not supported.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span></div>

    <span class="k">def</span> <span class="nf">_dissolveComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># always merge wire into coolant.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dissolveComponentIntoComponent</span><span class="p">(</span><span class="s2">&quot;wire&quot;</span><span class="p">,</span> <span class="s2">&quot;coolant&quot;</span><span class="p">)</span>
        <span class="c1"># update coolant area to fill in wire area that was left behind.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span>
            <span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remainingCoolantFillArea</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>

        <span class="c1"># do user-input merges</span>
        <span class="k">for</span> <span class="n">componentName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mergeIntoClad</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dissolveComponentIntoComponent</span><span class="p">(</span><span class="n">componentName</span><span class="p">,</span> <span class="s2">&quot;clad&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_classifyComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Figure out which components are in each pin ring and which are not.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Assumption is that anything with multiplicity equal to numPins is a pin (clad, wire, bond, etc.)</span>
<span class="sd">        Non-pins will include things like coolant, duct, interduct, etc.</span>

<span class="sd">        This skips components that have a negative area, which can exist if a user implements a linked</span>
<span class="sd">        component containing void or non-solid materials (e.g., gaps)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pinComponents</span><span class="p">,</span> <span class="n">nonPins</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="p">:</span>

            <span class="c1"># If the area of the component is negative than this component should be skipped</span>
            <span class="c1"># altogether. If not skipped, the conversion process still works, but this would</span>
            <span class="c1"># result in one or more rings having an outer diameter than is smaller than the</span>
            <span class="c1"># inner diameter.</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getNumComponents</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
                <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
            <span class="p">):</span>
                <span class="n">pinComponents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span>
                <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;coolant&quot;</span>
            <span class="p">):</span>  <span class="c1">#  coolant is addressed in self.interRingComponent</span>
                <span class="n">nonPins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">pinComponents</span><span class="p">)),</span> <span class="n">nonPins</span>

    <span class="k">def</span> <span class="nf">_buildFirstRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pinComponents</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add first ring of components to new block.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">oldC</span> <span class="ow">in</span> <span class="n">pinComponents</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">oldC</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; 1&quot;</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># first ring will have dims of 1 pin</span>
            <span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">oldC</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_buildNthRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pinComponents</span><span class="p">,</span> <span class="n">ringNum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build nth ring of pins and add them to block.</span>

<span class="sd">        Each n-th ring is preceded with a circle of coolant between the previous ring and this one.</span>
<span class="sd">        Since we blended the wire and coolant, the area of this area is supposed to include the wire area.</span>

<span class="sd">        This will be a fuel (or control) meat surrounded on both sides by clad, bond, liner, etc. layers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numPinsInRing</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sourceBlock</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="n">ringNum</span><span class="p">)</span>
        <span class="n">pinRadii</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pinComponents</span><span class="p">]</span>
        <span class="n">bigRingRadii</span> <span class="o">=</span> <span class="n">radiiFromRingOfRods</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pinPitch</span> <span class="o">*</span> <span class="p">(</span><span class="n">ringNum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">numPinsInRing</span><span class="p">,</span> <span class="n">pinRadii</span>
        <span class="p">)</span>
        <span class="n">nameSuffix</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ringNum</span><span class="p">)</span>

        <span class="n">coolantOD</span> <span class="o">=</span> <span class="n">bigRingRadii</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addCoolantRing</span><span class="p">(</span><span class="n">coolantOD</span><span class="p">,</span> <span class="n">nameSuffix</span><span class="p">)</span>
        <span class="n">innerDiameter</span> <span class="o">=</span> <span class="n">coolantOD</span>

        <span class="n">compsToTransformIntoRings</span> <span class="o">=</span> <span class="n">pinComponents</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pinComponents</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">bcs</span><span class="p">,</span> <span class="n">bigRingRadius</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="n">compsToTransformIntoRings</span><span class="p">,</span> <span class="n">bigRingRadii</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="p">):</span>
            <span class="n">outerDiameter</span> <span class="o">=</span> <span class="n">bigRingRadius</span> <span class="o">*</span> <span class="mf">2.0</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">bcs</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">nameSuffix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">bigComponent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addSolidMaterialRing</span><span class="p">(</span>
                <span class="n">bcs</span><span class="p">,</span> <span class="n">innerDiameter</span><span class="p">,</span> <span class="n">outerDiameter</span><span class="p">,</span> <span class="n">name</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bigComponent</span><span class="p">)</span>
            <span class="n">innerDiameter</span> <span class="o">=</span> <span class="n">outerDiameter</span>

    <span class="k">def</span> <span class="nf">_buildNonPinRings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nonPins</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Throw each non-pin component on as an individual outer circle.</span>

<span class="sd">        Also needs to add final coolant layer between the outer pins and the non-pins.</span>
<span class="sd">        Will crash if there are things that are not circles or hexes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># fill in the last ring of coolant using the rest</span>
        <span class="n">coolInnerDiam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span>
        <span class="n">coolantOD</span> <span class="o">=</span> <span class="n">getOuterDiamFromIDAndArea</span><span class="p">(</span>
            <span class="n">coolInnerDiam</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remainingCoolantFillArea</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addCoolantRing</span><span class="p">(</span><span class="n">coolantOD</span><span class="p">,</span> <span class="s2">&quot; outer&quot;</span><span class="p">)</span>

        <span class="n">innerDiameter</span> <span class="o">=</span> <span class="n">coolantOD</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">hexagon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">nonPins</span><span class="p">)):</span>
            <span class="n">outerDiam</span> <span class="o">=</span> <span class="n">getOuterDiamFromIDAndArea</span><span class="p">(</span>
                <span class="n">innerDiameter</span><span class="p">,</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="p">)</span>  <span class="c1"># conserve area of hex.</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">circularHexagon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addSolidMaterialRing</span><span class="p">(</span>
                <span class="n">hexagon</span><span class="p">,</span> <span class="n">innerDiameter</span><span class="p">,</span> <span class="n">outerDiam</span><span class="p">,</span> <span class="n">name</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">circularHexagon</span><span class="p">)</span>
            <span class="n">innerDiameter</span> <span class="o">=</span> <span class="n">outerDiam</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_addSolidMaterialRing</span><span class="p">(</span><span class="n">baseComponent</span><span class="p">,</span> <span class="n">innerDiameter</span><span class="p">,</span> <span class="n">outDiameter</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">baseComponent</span><span class="o">.</span><span class="n">material</span><span class="p">,</span>
            <span class="n">baseComponent</span><span class="o">.</span><span class="n">temperatureInC</span><span class="p">,</span>
            <span class="n">baseComponent</span><span class="o">.</span><span class="n">temperatureInC</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">innerDiameter</span><span class="p">,</span>
            <span class="n">od</span><span class="o">=</span><span class="n">outDiameter</span><span class="p">,</span>
            <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">circle</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">baseComponent</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
        <span class="n">circle</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">baseComponent</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span>
        <span class="k">return</span> <span class="n">circle</span>

    <span class="k">def</span> <span class="nf">_addCoolantRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coolantOD</span><span class="p">,</span> <span class="n">nameSuffix</span><span class="p">):</span>
        <span class="n">innerDiam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span>
        <span class="n">irc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interRingComponent</span>
        <span class="n">interRing</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
            <span class="n">irc</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="n">nameSuffix</span><span class="p">,</span>
            <span class="n">irc</span><span class="o">.</span><span class="n">material</span><span class="p">,</span>
            <span class="n">irc</span><span class="o">.</span><span class="n">temperatureInC</span><span class="p">,</span>
            <span class="n">irc</span><span class="o">.</span><span class="n">temperatureInC</span><span class="p">,</span>
            <span class="n">od</span><span class="o">=</span><span class="n">coolantOD</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">innerDiam</span><span class="p">,</span>
            <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">interRing</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">irc</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
        <span class="n">interRing</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">irc</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convertedBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">interRing</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_remainingCoolantFillArea</span> <span class="o">-=</span> <span class="n">interRing</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span></div>


<div class="viewcode-block" id="getOuterDiamFromIDAndArea"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.getOuterDiamFromIDAndArea">[docs]</a><span class="k">def</span> <span class="nf">getOuterDiamFromIDAndArea</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the outer diameter of an annulus with given inner diameter (ID) and area.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ID</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">area</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># from A = pi *(d ** 2)/4.0</span></div>


<div class="viewcode-block" id="radiiFromHexPitches"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.radiiFromHexPitches">[docs]</a><span class="k">def</span> <span class="nf">radiiFromHexPitches</span><span class="p">(</span><span class="n">pitches</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return list of radii for equivalent-area circles from list of from hexagon flat-to-flat pitches.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">SIN60</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pitches</span><span class="p">]</span></div>


<div class="viewcode-block" id="radiiFromHexSides"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.radiiFromHexSides">[docs]</a><span class="k">def</span> <span class="nf">radiiFromHexSides</span><span class="p">(</span><span class="n">sideLengths</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return list of radii for equivalent-area circles from list of from hexagon side lengths.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span> <span class="o">*</span> <span class="n">SIN60</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sideLengths</span><span class="p">]</span></div>


<div class="viewcode-block" id="radiiFromRingOfRods"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.converters.blockConverters.html#armi.reactor.converters.blockConverters.radiiFromRingOfRods">[docs]</a><span class="k">def</span> <span class="nf">radiiFromRingOfRods</span><span class="p">(</span><span class="n">distToRodCenter</span><span class="p">,</span> <span class="n">numRods</span><span class="p">,</span> <span class="n">rodRadii</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;hexagon&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return list of radii from ring of rods.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    distToRodCenter : float</span>
<span class="sd">        Distance from center of assembly to center of pin.</span>
<span class="sd">    numRods : int</span>
<span class="sd">        Number of rods in the ring of rods</span>
<span class="sd">    rodRadii : list</span>
<span class="sd">        Radii from smallest to largest. Outer radius becomes inner radius of next component.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    radiiList : list</span>
<span class="sd">        List of radii from inner to outer. Components are added on both sides.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    There are two assumptions when making circles:</span>

<span class="sd">    #. The rings are concentric about the ``radToRodCenter``.</span>
<span class="sd">    #. The ring area of the fuel rods are distributed to the inside and outside</span>
<span class="sd">       rings with the same thickness. ``thicknessOnEachSide`` (:math:`t`) is calculated</span>
<span class="sd">       as follows:</span>

<span class="sd">        .. math::</span>
<span class="sd">            :nowrap:</span>

<span class="sd">            \begin{aligned}</span>
<span class="sd">            r_1 &amp;\equiv \text{inner rad that thickness is added to on inside} \\</span>
<span class="sd">            r_2 &amp;\equiv \text{outer rad that thickness is added to on outside} \\</span>
<span class="sd">            \texttt{radToRodCenter} &amp;= \frac{r_1 + r_2}{2} \text{(due to being concentric)} \\</span>
<span class="sd">            \text{Total Area} &amp;= \text{Area of annulus 1} + \text{Area of annulus 2} \\</span>
<span class="sd">            \text{Area of annulus 1} &amp;= \pi r_1^2 -  \pi (r_1 - t)^2 \\</span>
<span class="sd">            \text{Area of annulus 2} &amp;= \pi (r_2 + t)^2 -  \pi r_2^2 \\</span>
<span class="sd">            t &amp;= \frac{\text{Total Area}}{4\pi\times\texttt{radToRodCenter}}</span>
<span class="sd">            \end{aligned}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">layout</span> <span class="o">==</span> <span class="s2">&quot;polygon&quot;</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">numRods</span><span class="p">)</span>
        <span class="n">radToRodCenter</span> <span class="o">=</span> <span class="n">distToRodCenter</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">layout</span> <span class="o">==</span> <span class="s2">&quot;hexagon&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">numRods</span> <span class="o">%</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;numRods (</span><span class="si">{}</span><span class="s2">) must be a multiple of 6.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numRods</span><span class="p">))</span>
        <span class="n">sideLengthOfBigHex</span> <span class="o">=</span> <span class="n">distToRodCenter</span>  <span class="c1"># for equilateral triangle</span>
        <span class="n">radToRodCenter</span> <span class="o">=</span> <span class="n">radiiFromHexSides</span><span class="p">([</span><span class="n">sideLengthOfBigHex</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid layout </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">layout</span><span class="p">))</span>

    <span class="n">radiiFromRodCenter</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rLast</span> <span class="o">=</span> <span class="n">bigRLast</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">rodRadius</span> <span class="ow">in</span> <span class="n">rodRadii</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">rodRadius</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">rLast</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">numRods</span><span class="p">)</span>
        <span class="n">thicknessOnEachSide</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radToRodCenter</span><span class="p">)</span>
        <span class="n">distFromCenterComp</span> <span class="o">=</span> <span class="n">bigRLast</span> <span class="o">+</span> <span class="n">thicknessOnEachSide</span>
        <span class="n">radiiFromRodCenter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radToRodCenter</span> <span class="o">+</span> <span class="n">distFromCenterComp</span><span class="p">)</span>
        <span class="n">radiiFromRodCenter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">radToRodCenter</span> <span class="o">-</span> <span class="n">distFromCenterComp</span>
        <span class="p">)</span>  <span class="c1"># build thickness on both sides</span>
        <span class="n">rLast</span><span class="p">,</span> <span class="n">bigRLast</span> <span class="o">=</span> <span class="n">rodRadius</span><span class="p">,</span> <span class="n">distFromCenterComp</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">radiiFromRodCenter</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2024, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2024-06-15.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>