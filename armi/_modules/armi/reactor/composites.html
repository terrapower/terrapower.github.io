

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.reactor.composites &mdash; ARMI 0.2.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../../_static/assets/jsonview_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/index.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../armi.html">armi</a> &raquo;</li>
        
          <li><a href="../reactor.html">armi.reactor</a> &raquo;</li>
        
      <li>armi.reactor.composites</li>
    
    
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for armi.reactor.composites</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains the basic composite pattern underlying the reactor package.</span>

<span class="sd">This follows the principles of the `Composite Design Pattern</span>
<span class="sd">&lt;https://en.wikipedia.org/wiki/Composite_pattern&gt;`_ to allow the construction of a</span>
<span class="sd">part/whole hierarchy representing a physical nuclear reactor. The composite objects act</span>
<span class="sd">somewhat like lists: they can be indexed, iterated over, appended, extended, inserted,</span>
<span class="sd">etc. Each member of the hierarchy knows its children and its parent, so full access to</span>
<span class="sd">the hierarchy is available from everywhere. This design was chosen because of the close</span>
<span class="sd">analogy of the model to the physical nature of nuclear reactors.</span>

<span class="sd">.. warning:: Because each member of the hierarchy is linked to the entire tree,</span>
<span class="sd">    it is often unsafe to save references to individual members; it can cause</span>
<span class="sd">    large and unexpected memory inefficiencies.</span>

<span class="sd">See Also: :doc:`/developer/index`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">tabulate</span>
<span class="kn">import</span> <span class="nn">six</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">armi.nucDirectory</span> <span class="kn">import</span> <span class="n">elements</span>
<span class="kn">from</span> <span class="nn">armi.nucDirectory</span> <span class="kn">import</span> <span class="n">nucDir</span><span class="p">,</span> <span class="n">nuclideBases</span>
<span class="kn">from</span> <span class="nn">armi.nuclearDataIO</span> <span class="kn">import</span> <span class="n">xsCollections</span>
<span class="kn">from</span> <span class="nn">armi.physics.neutronics.fissionProductModel</span> <span class="kn">import</span> <span class="n">fissionProductModel</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">grids</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">parameters</span>
<span class="kn">from</span> <span class="nn">armi.reactor.flags</span> <span class="kn">import</span> <span class="n">Flags</span><span class="p">,</span> <span class="n">TypeSpec</span>
<span class="kn">from</span> <span class="nn">armi.reactor.parameters</span> <span class="kn">import</span> <span class="n">resolveCollections</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">densityTools</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">armi.utils.densityTools</span> <span class="kn">import</span> <span class="n">calculateNumberDensity</span>


<div class="viewcode-block" id="FlagSerializer"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.FlagSerializer">[docs]</a><span class="k">class</span> <span class="nc">FlagSerializer</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serializer implementation for Flags.</span>

<span class="sd">    This operates by converting each set of Flags (too large to fit in a uint64) into a</span>
<span class="sd">    sequence of enough uint8 elements to represent all flags. These constitute a</span>
<span class="sd">    dimension of a 2-D numpy array containing all Flags for all objects provided to the</span>
<span class="sd">    ``pack()`` function.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>

<div class="viewcode-block" id="FlagSerializer.pack"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.FlagSerializer.pack">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">pack</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flags are represented as a 2-D numpy array of uint8 (single-byte, unsigned</span>
<span class="sd">        integers), where each row contains the bytes representing a single Flags</span>
<span class="sd">        instance. We also store the list of field names so that we can verify that the</span>
<span class="sd">        reader and the writer can agree on the meaning of each bit.</span>

<span class="sd">        Under the hood, this calls the private implementation providing the</span>
<span class="sd">        :py:class:`armi.reactor.flags.Flags` class as the target output class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FlagSerializer</span><span class="o">.</span><span class="n">_packImpl</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">Flags</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_packImpl</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">flagCls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">Flag</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the pack operation given a target output Flag class.</span>

<span class="sd">        This is kept separate from the public interface to permit testing of the</span>
<span class="sd">        functionality without having to do unholy things to ARMI&#39;s actual set of</span>
<span class="sd">        ``reactor.flags.Flags``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">npa</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">()],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span>
        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">flagCls</span><span class="o">.</span><span class="n">width</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">npa</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;flag_order&quot;</span><span class="p">:</span> <span class="n">flagCls</span><span class="o">.</span><span class="n">sortedFields</span><span class="p">()}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remapBits</span><span class="p">(</span><span class="n">inp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an input bitfield, map each bit to the appropriate new bit position based</span>
<span class="sd">        on the passed mapping.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ==========</span>
<span class="sd">        inp : int</span>
<span class="sd">            input bitfield</span>

<span class="sd">        mapping : dict</span>
<span class="sd">            dictionary mapping from old bit position -&gt; new bit position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">inp</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">inp</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">mapping</span><span class="p">[</span><span class="n">bit</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">f</span>

<div class="viewcode-block" id="FlagSerializer.unpack"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.FlagSerializer.unpack">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">unpack</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reverse the pack operation</span>

<span class="sd">        This will allow for some degree of conversion from old flags to a new set of</span>
<span class="sd">        flags, as long as all of the source flags still exist in the current set of</span>
<span class="sd">        flags.</span>

<span class="sd">        Under the hood, this calls the private implementation providing the</span>
<span class="sd">        :py:class:`armi.reactor.flags.Flags` class as the target output class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_unpackImpl</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">Flags</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_unpackImpl</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">flagCls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">Flag</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the unpack operation given a target output Flag class.</span>

<span class="sd">        This is kept separate from the public interface to permit testing of the</span>
<span class="sd">        functionality without having to do unholy things to ARMI&#39;s actual set of</span>
<span class="sd">        ``reactor.flags.Flags``.</span>

<span class="sd">        If the set of flags for the currently-configured App match the input set of</span>
<span class="sd">        flags, they are read in directly, which is good and cheap. However, if the set</span>
<span class="sd">        of flags differ from the input and the current App, we will try to convert them</span>
<span class="sd">        (as long as all of the input flags exist in the current App). Conversion is done</span>
<span class="sd">        by forming a map from all input bit positions to the current-App bit positions</span>
<span class="sd">        of the same meaning. E.g., if FUEL flag used to be the 3rd bit position, but now</span>
<span class="sd">        it is the 6th bit position, the map will contain ``map[3] = 6``. Then for each</span>
<span class="sd">        bitfield that is read in, each bit position is queried and if present, mapped to</span>
<span class="sd">        the proper corresponding new bit position. The result of this mapping is used to</span>
<span class="sd">        construct the Flags object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flagOrderPassed</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;flag_order&quot;</span><span class="p">]</span>
        <span class="n">flagOrderNow</span> <span class="o">=</span> <span class="n">flagCls</span><span class="o">.</span><span class="n">sortedFields</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">version</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The FlagSerializer version used to pack the data (</span><span class="si">{}</span><span class="s2">) does not match &quot;</span>
                <span class="s2">&quot;the current version (</span><span class="si">{}</span><span class="s2">)! This database either needs to be migrated, &quot;</span>
                <span class="s2">&quot;or on-the-fly inter-version conversion needs to be implemented.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">version</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">version</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">flagSetIn</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flagOrderPassed</span><span class="p">)</span>
        <span class="n">flagSetNow</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">flagOrderNow</span><span class="p">)</span>

        <span class="c1"># Make sure that all of the old flags still exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flagSetIn</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">flagSetNow</span><span class="p">):</span>
            <span class="n">missingFlags</span> <span class="o">=</span> <span class="n">flagSetIn</span> <span class="o">-</span> <span class="n">flagSetNow</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The set of flags in the database includes unknown flags. &quot;</span>
                <span class="s2">&quot;Make sure you are using the correct ARMI app. Missing flags:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">missingFlags</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flagOrderPassed</span><span class="p">,</span> <span class="n">flagOrderNow</span><span class="p">)):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">flagCls</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newFlags</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">i</span><span class="p">:</span> <span class="n">flagOrderNow</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">oldFlag</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">oldFlag</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">flagOrderPassed</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">flagCls</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_remapBits</span><span class="p">(</span>
                        <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">),</span> <span class="n">newFlags</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">out</span></div>


<span class="k">def</span> <span class="nf">_defineBaseParameters</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return parameter definitions that all ArmiObjects must have to function properly.</span>

<span class="sd">    For now, this pretty much just includes ``flags``, since these are used throughout</span>
<span class="sd">    the composite model to filter which objects are considered when traversing the</span>
<span class="sd">    reactor model.</span>

<span class="sd">    Note also that the base ParameterCollection class also has a ``serialNum``</span>
<span class="sd">    parameter. These are defined in different locations, since serialNum is a guaranteed</span>
<span class="sd">    feature of a ParameterCollection (for serialization to the database and history</span>
<span class="sd">    tracking), while the ``flags`` parameter is more a feature of the composite model.</span>

<span class="sd">    .. important::</span>
<span class="sd">        Notice that the ``flags`` parameter is not written to the database. This is for</span>
<span class="sd">        a couple of reasons:</span>
<span class="sd">        * Flags are derived from an ArmiObject&#39;s name. Since the name is stored on</span>
<span class="sd">        the DB, it is possible to recover the flags from that.</span>
<span class="sd">        * Storing flags to the DB may be complicated, since it is easier to imagine a</span>
<span class="sd">        number of flags that is greater than the width of natively-supported integer</span>
<span class="sd">        types, requiring some extra tricks to store the flages in an HDF5 file.</span>
<span class="sd">        * Allowing flags to be modified by plugins further complicates things, in that</span>
<span class="sd">        it is important to ensure that the meaning of all bits in the flag value are</span>
<span class="sd">        consistent between a database state and the current ARMI environment. This may</span>
<span class="sd">        require encoding these meanings in to the database as some form of metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pDefs</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ParameterDefinitionCollection</span><span class="p">()</span>

    <span class="n">pDefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">Parameter</span><span class="p">(</span>
            <span class="s2">&quot;flags&quot;</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The type specification of this object&quot;</span><span class="p">,</span>
            <span class="n">location</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">ParamLocation</span><span class="o">.</span><span class="n">AVERAGE</span><span class="p">,</span>
            <span class="n">saveToDB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">Flags</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">setter</span><span class="o">=</span><span class="n">parameters</span><span class="o">.</span><span class="n">NoDefault</span><span class="p">,</span>
            <span class="n">categories</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
            <span class="n">serializer</span><span class="o">=</span><span class="n">FlagSerializer</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">pDefs</span>


<div class="viewcode-block" id="CompositeModelType"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.CompositeModelType">[docs]</a><span class="k">class</span> <span class="nc">CompositeModelType</span><span class="p">(</span><span class="n">resolveCollections</span><span class="o">.</span><span class="n">ResolveParametersMeta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Metaclass for tracking subclasses of ArmiObject subclasses.</span>

<span class="sd">    It is often useful to have an easily-accessible collection of all classes that</span>
<span class="sd">    participate in the ARMI composite reactor model. This metaclass maintains a</span>
<span class="sd">    collection of all defined subclasses, called TYPES.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Dictionary mapping class name -&gt; class object for all subclasses</span>
    <span class="n">TYPES</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="n">newType</span> <span class="o">=</span> <span class="n">resolveCollections</span><span class="o">.</span><span class="n">ResolveParametersMeta</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">attrs</span>
        <span class="p">)</span>

        <span class="n">CompositeModelType</span><span class="o">.</span><span class="n">TYPES</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">newType</span>

        <span class="k">return</span> <span class="n">newType</span></div>


<div class="viewcode-block" id="ArmiObject"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject">[docs]</a><span class="k">class</span> <span class="nc">ArmiObject</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">CompositeModelType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The abstract base class for all composites and leaves.</span>

<span class="sd">    This:</span>

<span class="sd">    * declares the interface for objects in the composition</span>
<span class="sd">    * implements default behavior for the interface common to all</span>
<span class="sd">      classes</span>
<span class="sd">    * Declares an interface for accessing and managing</span>
<span class="sd">      child objects</span>
<span class="sd">    * Defines an interface for accessing parents.</span>

<span class="sd">    Called &quot;component&quot; in gang of four, this is an ArmiObject here because the word</span>
<span class="sd">    component was already taken in ARMI.</span>

<span class="sd">    The :py:class:`armi.reactor.parameters.ResolveParametersMeta` metaclass is used to</span>
<span class="sd">    automatically create ``ParameterCollection`` subclasses for storing parameters</span>
<span class="sd">    associated with any particular subclass of ArmiObject. Defining a ``pDefs`` class</span>
<span class="sd">    attribute in the definition of a subclass of ArmiObject will lead to the creation of</span>
<span class="sd">    a new subclass of py:class:`armi.reactor.parameters.ParameterCollection`, which will</span>
<span class="sd">    contain the definitions from that class&#39;s ``pDefs`` as well as the definitions for</span>
<span class="sd">    all of its parents. A new ``paramCollectionType`` class attribute will be added to</span>
<span class="sd">    the ArmiObject subclass to reflect which type of parameter collection should be</span>
<span class="sd">    used.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        This class has far too many public methods. We are in the midst of a composite</span>
<span class="sd">        tree cleanup that will likely break these out onto a number of separate functional</span>
<span class="sd">        classes grouping things like composition, location, shape/dimensions, and</span>
<span class="sd">        various physics queries. Methods are being collected here from the various</span>
<span class="sd">        specialized subclasses (Block, Assembly) in preparation for this next step.</span>
<span class="sd">        As a result, the public API on this method should be considered unstable.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Object name</span>
<span class="sd">    parent : ArmiObject</span>
<span class="sd">        The object&#39;s parent in a hierarchical tree</span>
<span class="sd">    cached : dict</span>
<span class="sd">        Some cached values for performance</span>
<span class="sd">    p : ParameterCollection</span>
<span class="sd">        The state variables</span>
<span class="sd">    spatialGrid : grids.Grid</span>
<span class="sd">        The spatial grid that this object contains</span>
<span class="sd">    spatialLocator : grids.LocationBase</span>
<span class="sd">        The location of this object in its parent grid, or global space</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    armi.reactor.parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">paramCollectionType</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">parameters</span><span class="o">.</span><span class="n">ParameterCollection</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pDefs</span> <span class="o">=</span> <span class="n">_defineBaseParameters</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backupCache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paramCollectionType</span><span class="p">()</span>
        <span class="c1"># TODO: These are not serialized to the database, and will therefore</span>
        <span class="c1"># lead to surprising behavior when using databases. We need to devise a</span>
        <span class="c1"># way to either represent them in parameters, or otherwise reliably</span>
        <span class="c1"># recover them.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lumpedFissionProducts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the less-than operator.</span>

<span class="sd">        Implementing this on the ArmiObject allows most objects, under most</span>
<span class="sd">        circumstances to be sorted. This is useful from the context of the Database</span>
<span class="sd">        classes, so that they can produce a stable layout of the serialized composite</span>
<span class="sd">        structure.</span>

<span class="sd">        By default, this sorts using the spatial locator, in K, J, I order, which should</span>
<span class="sd">        give a relatively intuitive order. For safety, it makes sure that the objects</span>
<span class="sd">        being sorted live in the same grid, since it probably doesn&#39;t make</span>
<span class="sd">        sense to sort things across containers or scopes. If this ends up being too</span>
<span class="sd">        restrictive, it can probably be relaxed or overridden on specific classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;could not compare </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;One or more of the compared objects have no spatialLocator&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">other</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;could not compare </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Composite grids must be the same to compare:</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;This grid: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Other grid: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">()))</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">()))</span>
            <span class="k">return</span> <span class="n">t1</span> <span class="o">&lt;</span> <span class="n">t2</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;failed to compare </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">spatialLocator</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Python method for reducing data before pickling.</span>

<span class="sd">        This removes links to parent objects, which allows one to, for example, pickle</span>
<span class="sd">        an assembly without pickling the entire reactor. Likewise, one could</span>
<span class="sd">        MPI_COMM.bcast an assembly without broadcasting the entire reactor.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Special treatment of ``parent`` is not enough, since the spatialGrid also</span>
<span class="sd">        contains a reference back to the armiObject. Consequently, the ``spatialGrid``</span>
<span class="sd">        needs to be reassigned in ``__setstate__``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">state</span><span class="p">[</span><span class="s2">&quot;parent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="s2">&quot;r&quot;</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="c1"># XXX: This should never happen, it might make sense to raise an exception.</span>
            <span class="k">del</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">state</span>

    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the state of this ArmiObject.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This ArmiObject may have lost a reference to its parent. If the parent was also</span>
<span class="sd">        pickled (serialized), then the parent should update the ``.parent`` attribute</span>
<span class="sd">        during its own ``__setstate__``. That means within the context of</span>
<span class="sd">        ``__setstate__`` one should not rely upon ``self.parent``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">armiObject</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="c1"># Spatial locators also get disassociated with their grids when detached;</span>
            <span class="c1"># make sure they get hooked back up</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">associate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">)</span>

        <span class="c1"># now &quot;reattach&quot; children</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">spec</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flag that says this is non-zero in a boolean context</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The default behavior for ``not [obj]`` that has a  ``__len__`` defined is to see</span>
<span class="sd">        if the length is zero. However, for these composites, we&#39;d like Assemblies, etc.</span>
<span class="sd">        to be considered non-zero even if they don&#39;t have any blocks. This is important</span>
<span class="sd">        for parent resolution, etc. If one of these objects exists, it is non-zero,</span>
<span class="sd">        regardless of its contents.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">__nonzero__</span> <span class="o">=</span> <span class="fm">__bool__</span>  <span class="c1"># Python 2 compatibility</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of all children in this and another object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()</span>

<div class="viewcode-block" id="ArmiObject.duplicate"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make a clean copy of this object.</span>

<span class="sd">        .. warning:: Be careful with inter-object dependencies. If one object contains a</span>
<span class="sd">            reference to another object which contains links to the entire hierarchical</span>
<span class="sd">            tree, memory can fill up rather rapidly. Weak references are designed to help</span>
<span class="sd">            with this problem.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ArmiObject.clearCache"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.clearCache">[docs]</a>    <span class="k">def</span> <span class="nf">clearCache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the cache so all new values are recomputed.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
            <span class="n">child</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_getCached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>  <span class="c1"># TODO: stop the &quot;returns None&quot; nonsense?</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain a value from the cache.</span>

<span class="sd">        Cached values can be used to temporarily store frequently read but</span>
<span class="sd">        long-to-compute values.  The practice is generally discouraged because it&#39;s</span>
<span class="sd">        challenging to make sure to properly invalidate the cache when the state</span>
<span class="sd">        changes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setCache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>  <span class="c1"># TODO: remove me</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a value in the cache.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        _getCached : returns a previously-cached value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="ArmiObject.copyParamsFrom"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.copyParamsFrom">[docs]</a>    <span class="k">def</span> <span class="nf">copyParamsFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overwrite this object&#39;s params with other object&#39;s</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : ArmiObject</span>
<span class="sd">            The object to copy params from</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="ArmiObject.updateParamsFrom"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.updateParamsFrom">[docs]</a>    <span class="k">def</span> <span class="nf">updateParamsFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update this object&#39;s params with a new object&#39;s.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new : ArmiObject</span>
<span class="sd">            The object to copy params from</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">paramName</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span></div>

<div class="viewcode-block" id="ArmiObject.getChildren"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getChildren">[docs]</a>    <span class="k">def</span> <span class="nf">getChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the children of this object.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ArmiObject.getChildrenWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getChildrenWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">getChildrenWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exactMatch</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all children that have given flags.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ArmiObject.getComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponents">[docs]</a>    <span class="k">def</span> <span class="nf">getComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return all armi.reactor.component.Component within this Composite.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            Component flags. Will restrict Components to specific ones matching the</span>
<span class="sd">            flags specified.</span>

<span class="sd">        exact : bool, optional</span>
<span class="sd">            Only match exact component labels (names). If True, &#39;coolant&#39; will not match</span>
<span class="sd">            &#39;interCoolant&#39;.  This has no impact if compLabel is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of Component</span>
<span class="sd">            items matching compLabel and exact criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArmiObject.iterComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.iterComponents">[docs]</a>    <span class="k">def</span> <span class="nf">iterComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Yield components one by one in a generator.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArmiObject.doChildrenHaveFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.doChildrenHaveFlags">[docs]</a>    <span class="k">def</span> <span class="nf">doChildrenHaveFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generator that yields True if the next child has given flags.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            Requested type of the child</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">deep</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                <span class="k">yield</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ArmiObject.containsAtLeastOneChildWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.containsAtLeastOneChildWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">containsAtLeastOneChildWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if any of the children are of a given type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            Requested type of the children</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        self.doChildrenHaveFlags</span>
<span class="sd">        self.containsOnlyChildrenWithFlags</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doChildrenHaveFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArmiObject.containsOnlyChildrenWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.containsOnlyChildrenWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">containsOnlyChildrenWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if all of the children are of a given type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            Requested type of the children</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        self.doChildrenHaveFlags</span>
<span class="sd">        self.containsAtLeastOneChildWithFlags</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doChildrenHaveFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArmiObject.copyParamsToChildren"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.copyParamsToChildren">[docs]</a>    <span class="k">def</span> <span class="nf">copyParamsToChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy param values in paramNames to all children.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        paramNames : list</span>
<span class="sd">            List of param names to copy to children</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">paramName</span> <span class="ow">in</span> <span class="n">paramNames</span><span class="p">:</span>
            <span class="n">myVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">paramName</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
                <span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">paramName</span><span class="p">]</span> <span class="o">=</span> <span class="n">myVal</span></div>

<div class="viewcode-block" id="ArmiObject.getParameterCollection"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getParameterCollection">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getParameterCollection</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a new instance of the specific ParameterCollection type associated with this object.</span>

<span class="sd">        This has the same effect as ``obj.paramCollectionType()``. Getting a new</span>
<span class="sd">        instance through a class method like this is useful in situations where the</span>
<span class="sd">        ``paramCollectionType`` is not a top-level object and therefore cannot be</span>
<span class="sd">        trivially pickled. Since we know that by the time we want to make any instances</span>
<span class="sd">        of/unpickle a given ``ArmiObject``, such a class attribute will have been</span>
<span class="sd">        created and associated. So, we use this top-level class method to dig</span>
<span class="sd">        dynamically down to the underlying parameter collection type.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :py:meth:`armi.reactor.parameters.parameterCollections.ParameterCollection.__reduce__`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">paramCollectionType</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArmiObject.getParamNames"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getParamNames">[docs]</a>    <span class="k">def</span> <span class="nf">getParamNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of parameters keys that are available on this object.</span>

<span class="sd">        Will not have any corner, edge, or timenode dependence.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArmiObject.nameContains"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.nameContains">[docs]</a>    <span class="k">def</span> <span class="nf">nameContains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        True if s is in this object&#39;s name (eg. nameContains(&#39;fuel&#39;)==True for &#39;testfuel&#39;</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Case insensitive (all gets converted to lower)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name</span></div>

<div class="viewcode-block" id="ArmiObject.getName"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="ArmiObject.setName"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setName">[docs]</a>    <span class="k">def</span> <span class="nf">setName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="ArmiObject.hasFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.hasFlags">[docs]</a>    <span class="k">def</span> <span class="nf">hasFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeID</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if this object is of a certain type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeID : TypeSpec</span>
<span class="sd">            Flags to test the object against, to see if it contains them. If a list is</span>
<span class="sd">            provided, each element is treated as a &quot;candidate&quot; set of flags. Return True</span>
<span class="sd">            if any of candidates match. When exact is True, the object must match one of</span>
<span class="sd">            the candidates exactly. If exact is False, the object must have at least the</span>
<span class="sd">            flags contained in a candidate for that candidate to be a match; extra flags</span>
<span class="sd">            on the object are permitted. None matches all objects if exact is False, or</span>
<span class="sd">            no objects if exact is True.</span>

<span class="sd">        exact : bool, optional</span>
<span class="sd">            Require the type of the object to fully match the provided typeID(s)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hasFlags : bool</span>
<span class="sd">            True if this object is in the typeID list.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Type comparisons use bitwise comparisons using valid flags.</span>

<span class="sd">        If you have an &#39;inner control&#39; assembly, then this will evaluate True for the</span>
<span class="sd">        INNER | CONTROL flag combination. If you just want all FUEL, simply use FUEL</span>
<span class="sd">        with no additional qualifiers. For more complex comparisons, use bitwise</span>
<span class="sd">        operations.</span>

<span class="sd">        Always returns true if typeID is none and exact is False, allowing for default</span>
<span class="sd">        parameters to be passed in when the method does not care about the object type.</span>
<span class="sd">        If the typeID is none and exact is True, this will always return False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        If you have an object with the ``INNER``, ``DRIVER``, and ``FUEL`` flags, then</span>

<span class="sd">        &gt;&gt;&gt; obj.getType()</span>
<span class="sd">        [some integer]</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags(Flags.FUEL)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags(Flags.INNER | Flags.DRIVER | Flags.FUEL)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags(Flags.OUTER | Flags.DRIVER | Flags.FUEL)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags(Flags.INNER | Flags.FUEL)</span>
<span class="sd">        True</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags(Flags.INNER | Flags.FUEL, exact=True)</span>
<span class="sd">        False</span>

<span class="sd">        &gt;&gt;&gt; obj.hasFlags([Flags.INNER | Flags.DRIVER | Flags.FUEL,</span>
<span class="sd">        ... Flags.OUTER | Flags.DRIVER | Flags.FUEL], exact=True)</span>
<span class="sd">        False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">typeID</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">exact</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typeID</span><span class="p">,</span> <span class="n">six</span><span class="o">.</span><span class="n">string_types</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Must pass Flags, or an iterable of Flags; Strings are no longer &quot;</span>
                <span class="s2">&quot;supported&quot;</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typeID</span><span class="p">,</span> <span class="n">Flags</span><span class="p">):</span>
            <span class="c1"># list behavior gives a spec1 OR spec2 OR ... behavior.</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeIDi</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">)</span> <span class="k">for</span> <span class="n">typeIDi</span> <span class="ow">in</span> <span class="n">typeID</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
            <span class="c1"># default still set, or null flag. Do down here so we get proper error</span>
            <span class="c1"># handling of invalid typeSpecs</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">exact</span><span class="p">:</span>
            <span class="c1"># all bits must be identical for exact match</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">==</span> <span class="n">typeID</span>

        <span class="c1"># all bits that are 1s in the typeID must be present</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">typeID</span> <span class="o">==</span> <span class="n">typeID</span></div>

<div class="viewcode-block" id="ArmiObject.getType"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getType">[docs]</a>    <span class="k">def</span> <span class="nf">getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the object type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">type</span></div>

<div class="viewcode-block" id="ArmiObject.setType"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setType">[docs]</a>    <span class="k">def</span> <span class="nf">setType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Flags</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the object type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ : str</span>
<span class="sd">            The desired &quot;type&quot; for the object. Type describes the general class of the</span>
<span class="sd">            object, and typically corresponds to the name of the blueprint that created</span>
<span class="sd">            it.</span>

<span class="sd">        flags : Flags, optional</span>
<span class="sd">            The set of Flags to apply to the object. If these are omitted, then Flags</span>
<span class="sd">            will be derived from the ``typ``.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        We are in the process of developing more robust definitions for things like</span>
<span class="sd">        &quot;name&quot; and &quot;type&quot;. &quot;type&quot; will generally refer to the name of the blueprint that</span>
<span class="sd">        created a particular object. When present, a &quot;name&quot; will refer to a specific</span>
<span class="sd">        instance of an object of a particular &quot;type&quot;. Think unique names for each</span>
<span class="sd">        assembly in a core, even if they are all created from the same blueprint and</span>
<span class="sd">        therefore have the same &quot;type&quot;. When this work is complete, it will be strongly</span>
<span class="sd">        discouraged, or even disallowed to change the type of an object after it has</span>
<span class="sd">        been created, and ``setType()`` may be removed entirely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span> <span class="ow">or</span> <span class="n">Flags</span><span class="o">.</span><span class="n">fromStringIgnoreErrors</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">typ</span></div>

<div class="viewcode-block" id="ArmiObject.getVolume"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getArea"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getArea">[docs]</a>    <span class="k">def</span> <span class="nf">getArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getArea</span><span class="p">(</span><span class="n">cold</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_updateVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recompute and store volume.&quot;&quot;&quot;</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()</span>
        <span class="c1"># Derived shapes must come last so we temporarily change the order if we</span>
        <span class="c1"># have one.</span>
        <span class="kn">from</span> <span class="nn">armi.reactor.components</span> <span class="kn">import</span> <span class="n">DerivedShape</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">[:]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">DerivedShape</span><span class="p">):</span>
                <span class="n">children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_updateVolume</span><span class="p">()</span>

<div class="viewcode-block" id="ArmiObject.getVolumeFractions"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getVolumeFractions">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumeFractions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return volume fractions of each child.</span>

<span class="sd">        Sets volume or area of missing piece (like coolant) if it exists.  Caching would</span>
<span class="sd">        be nice here.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fracs : list</span>
<span class="sd">            list of (component, volFrac) tuples</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        test_block.Block_TestCase.test_consistentAreaWithOverlappingComponents</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        void areas can be negative in gaps between fuel/clad/liner(s), but these</span>
<span class="sd">        negative areas are intended to account for overlapping positive areas to insure</span>
<span class="sd">        the total area of components inside the clad is accurate. See</span>
<span class="sd">        test_block.Block_TestCase.test_consistentAreaWithOverlappingComponents</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">denom</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>

        <span class="n">fracs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ci</span><span class="p">,</span> <span class="n">nu</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span> <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">nu</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">numerator</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">fracs</span></div>

<div class="viewcode-block" id="ArmiObject.getVolumeFraction"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getVolumeFraction">[docs]</a>    <span class="k">def</span> <span class="nf">getVolumeFraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the volume fraction that this object takes up in its parent.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No parent is defined for </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">. Cannot compute its volume fraction.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">frac</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">frac</span></div>

<div class="viewcode-block" id="ArmiObject.getMaxArea"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMaxArea">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;</span>
<span class="sd">        The maximum area of this object if it were totally full.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.reactor.blocks.HexBlock.getMaxArea</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArmiObject.getMaxVolume"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMaxVolume">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The maximum volume of this object if it were totally full.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vol : float</span>
<span class="sd">            volume in cm^3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArmiObject.getMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMass">[docs]</a>    <span class="k">def</span> <span class="nf">getMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclideNames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the mass in grams of nuclide(s) and/or elements in this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nuclideNames : str, optional</span>
<span class="sd">            The nuclide/element specifier to get the mass of in the object.</span>
<span class="sd">            If omitted, total mass is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mass : float</span>
<span class="sd">            The mass in grams.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuclideNames</span><span class="o">=</span><span class="n">nuclideNames</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()]</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getMassFrac"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMassFrac">[docs]</a>    <span class="k">def</span> <span class="nf">getMassFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the mass fraction of a nuclide.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If you need multiple mass fractions, use ``getMassFracs``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nuclideNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getNuclidesFromSpecifier</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMassFracs</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">nuclideNames</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getMicroSuffix"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMicroSuffix">[docs]</a>    <span class="k">def</span> <span class="nf">getMicroSuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_getNuclidesFromSpecifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucSpec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a nuclide specification to a list of valid nuclide/element keys.</span>

<span class="sd">        nucSpec : nuclide specifier</span>
<span class="sd">            Can be a string name of a nuclide or element, or a list of such strings.</span>

<span class="sd">        This might get Zr isotopes when ZR is passed in if they exist, or it will get</span>
<span class="sd">        elemental ZR if that exists. When expanding elements, all known nuclides are</span>
<span class="sd">        returned, not just the natural ones.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allNuclidesHere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nucSpec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">allNuclidesHere</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucSpec</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
            <span class="n">nuclideNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">nucSpec</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucSpec</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">nuclideNames</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">nucSpec</span><span class="p">:</span>
                <span class="n">nuclideNames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getNuclidesFromSpecifier</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;nucSpec=</span><span class="si">{0}</span><span class="s2"> is an invalid specifier. It is a </span><span class="si">{1}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucSpec</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">nucSpec</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># expand elementals if appropriate.</span>
        <span class="n">convertedNucNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">nuclideNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">allNuclidesHere</span><span class="p">:</span>
                <span class="n">convertedNucNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Need all nuclide bases, not just natural isotopics because, e.g. PU</span>
                <span class="c1"># has no natural isotopics!</span>
                <span class="n">nucs</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">nb</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">bySymbol</span><span class="p">[</span><span class="n">nucName</span><span class="p">]</span><span class="o">.</span><span class="n">nuclideBases</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">NaturalNuclideBase</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">convertedNucNames</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">nucs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">convertedNucNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">convertedNucNames</span><span class="p">))</span>

<div class="viewcode-block" id="ArmiObject.getMassFracs"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMassFracs">[docs]</a>    <span class="k">def</span> <span class="nf">getMassFracs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get mass fractions of all nuclides in object.</span>

<span class="sd">        Ni [1/cm3] * Ai [g/mole]  ~ mass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numDensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">densityTools</span><span class="o">.</span><span class="n">getMassFractions</span><span class="p">(</span><span class="n">numDensities</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.setMassFrac"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setMassFrac">[docs]</a>    <span class="k">def</span> <span class="nf">setMassFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the composition of this object so the mass fraction of nucName is val.</span>

<span class="sd">        See Also</span>
<span class="sd">        ---------</span>
<span class="sd">        setMassFracs : efficiently set multiple mass fractions at the same time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMassFracs</span><span class="p">({</span><span class="n">nucName</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span></div>

<div class="viewcode-block" id="ArmiObject.setMassFracs"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setMassFracs">[docs]</a>    <span class="k">def</span> <span class="nf">setMassFracs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">massFracs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply one or more adjusted mass fractions.</span>

<span class="sd">        This will adjust the total mass of the object, as the mass of everything</span>
<span class="sd">        designated will change, while anything else will not.</span>

<span class="sd">        .. math::</span>

<span class="sd">            m_i = \frac{M_i}{\sum_j(M_j)}</span>

<span class="sd">            (M_{j \ne i} + M_i) m_i = M_i</span>

<span class="sd">            \frac{m_i M_{j \ne i}}{1-m_i} = M_i</span>

<span class="sd">            \frac{m_i M_{j \ne i}}{V(1-m_i)} = M_i/V = m_i \rho</span>

<span class="sd">            N_i = \frac{m_i \rho N_A}{A_i}</span>

<span class="sd">            N_i = \frac{m_i M_{j \ne i} N_A}{V (1-m_i) {A_i}}</span>

<span class="sd">            \frac{M_{j \ne i}}{V} = m_{j \ne i} \rho</span>

<span class="sd">            m_{j \ne i} = 1 - m_i</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        You can&#39;t just change one mass fraction though, you have scale all others to</span>
<span class="sd">        fill the remaining frac.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        massFracs: dict</span>
<span class="sd">            nucName : new mass fraction pairs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rho</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot set mass fractions on </span><span class="si">{}</span><span class="s2"> because the mass density is zero.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">oldMassFracs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMassFracs</span><span class="p">()</span>
        <span class="n">totalFracSet</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">massFrac</span> <span class="ow">in</span> <span class="n">massFracs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span>
                <span class="n">nucName</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">massFrac</span>
                    <span class="o">*</span> <span class="n">rho</span>
                    <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
                    <span class="o">/</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">oldMassFracs</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">oldMassFracs</span><span class="p">[</span><span class="n">nucName</span><span class="p">]</span>
            <span class="n">totalFracSet</span> <span class="o">+=</span> <span class="n">massFrac</span>
        <span class="n">totalOther</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">oldMassFracs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">totalOther</span><span class="p">:</span>
            <span class="c1"># we normalize the remaining mass fractions so their concentrations relative</span>
            <span class="c1"># to each other stay constant.</span>
            <span class="n">normalizedOtherMassFracs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">nucNameOther</span><span class="p">:</span> <span class="n">val</span> <span class="o">/</span> <span class="n">totalOther</span>
                <span class="k">for</span> <span class="n">nucNameOther</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">oldMassFracs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">nucNameOther</span><span class="p">,</span> <span class="n">massFracOther</span> <span class="ow">in</span> <span class="n">normalizedOtherMassFracs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span>
                    <span class="n">nucNameOther</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">totalFracSet</span><span class="p">)</span>
                        <span class="o">*</span> <span class="n">massFracOther</span>
                        <span class="o">*</span> <span class="n">rho</span>
                        <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
                        <span class="o">/</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nucNameOther</span><span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.adjustMassFrac"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.adjustMassFrac">[docs]</a>    <span class="k">def</span> <span class="nf">adjustMassFrac</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nuclideToAdjust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">elementToAdjust</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nuclideToHoldConstant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">elementToHoldConstant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial Zr mass fraction while maintaining Uranium enrichment, but general purpose.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nuclideToAdjust : str, optional</span>
<span class="sd">            The nuclide name to adjust</span>
<span class="sd">        elementToAdjust : str, optional</span>
<span class="sd">            The element to adjust. All isotopes in this element will adjust</span>
<span class="sd">        nuclideToHoldconstant : str, optional</span>
<span class="sd">            A nuclide to hold constant</span>
<span class="sd">        elementToHoldConstant : str</span>
<span class="sd">            Same</span>
<span class="sd">        val : float</span>
<span class="sd">            The value to set the adjust mass fraction to be.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If you use this for two elements one after the other, you will probably get</span>
<span class="sd">        something wrong. For instance, if you have U-10Zr and add Pu at 10% mass</span>
<span class="sd">        fraction, the Zr fraction will drop below 10% of the total. The U-Zr fractions</span>
<span class="sd">        will remain constant though. So this is mostly useful if you have U-10Zr and</span>
<span class="sd">        want to change it to U-5Zr.</span>

<span class="sd">        Theory:</span>

<span class="sd">        Mass fraction of each nuclide to be adjusted = Ai where A1+A2+A...+AI = A</span>
<span class="sd">        Mass fraction of nuclides to be held constant = Ci where sum = C</span>
<span class="sd">        Mass fraction of other nuclides is Oi, sum = O</span>
<span class="sd">        new value for A is v</span>

<span class="sd">        A+C+O = 1.0</span>
<span class="sd">        A&#39;=v. If A&gt;0, then A&#39;=A*f1=v where f1 = v/A</span>
<span class="sd">        If A=0, then Ai&#39; = v/len(A), distributing the value evenly among isotopes</span>

<span class="sd">        Now, to adjust the other nuclides, we know</span>
<span class="sd">        A&#39;+C+O&#39; = 1.0 , or v+C+O&#39; = 1.0</span>
<span class="sd">        So, O&#39;= 1.0-v-C</span>
<span class="sd">        We can scale each Oi evenly by multiplying by the factor f2</span>
<span class="sd">        Oi&#39; = Oi * (1-C-v)/O = Oi * f2  where f2= (1-C-v)</span>

<span class="sd">        Since massFracs is not necessarily normalized, A+C+O actually =</span>
<span class="sd">        self.p.massFracNorm</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        setMassFrac</span>
<span class="sd">        getMassFrac</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>  <span class="c1"># don&#39;t keep densities around or anything.</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Invalid mass fraction </span><span class="si">{0}</span><span class="s2"> for </span><span class="si">{1}</span><span class="s2">/</span><span class="si">{2}</span><span class="s2"> in </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">val</span><span class="p">,</span> <span class="n">nuclideToAdjust</span><span class="p">,</span> <span class="n">elementToAdjust</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nuclideToAdjust</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">elementToAdjust</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Must provide a nuclide or element to adjust to adjustMassFrac&quot;</span>
            <span class="p">)</span>

        <span class="c1"># sum of other nuclide mass fractions before change is Y</span>
        <span class="c1"># need Yx+newZr = 1.0 where x is a scaling factor</span>
        <span class="c1"># so x=(1-newZr)/Y</span>

        <span class="c1"># determine nuclides to hold constant</span>
        <span class="n">nuclides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">nuclideToHoldConstant</span> <span class="ow">or</span> <span class="n">elementToHoldConstant</span><span class="p">:</span>
            <span class="c1"># note that if these arguments are false, you&#39;ll get ALL nuclides in the</span>
            <span class="c1"># material use material.getNuclides to get only non-zero ones.  use</span>
            <span class="c1"># nucDir.getNuclides to get all. Intersect with current nuclides to</span>
            <span class="c1"># eliminate double counting of element/isotopes</span>
            <span class="n">constantNuclides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">nucDir</span><span class="o">.</span><span class="n">getNuclideNames</span><span class="p">(</span>
                    <span class="n">nucName</span><span class="o">=</span><span class="n">nuclideToHoldConstant</span><span class="p">,</span> <span class="n">elementSymbol</span><span class="o">=</span><span class="n">elementToHoldConstant</span>
                <span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">nuclides</span><span class="p">)</span>
            <span class="n">constantSum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMassFrac</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span> <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">constantNuclides</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">constantNuclides</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">constantSum</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># determine which nuclides we&#39;re adjusting.</span>
        <span class="c1"># Rather than calling this material&#39;s getNuclides method, we call the</span>
        <span class="c1"># nucDirectory to do this. this way, even zeroed-out nuclides will get in the</span>
        <span class="c1"># mix</span>
        <span class="n">adjustNuclides</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">nucDir</span><span class="o">.</span><span class="n">getNuclideNames</span><span class="p">(</span>
                <span class="n">nucName</span><span class="o">=</span><span class="n">nuclideToAdjust</span><span class="p">,</span> <span class="n">elementSymbol</span><span class="o">=</span><span class="n">elementToAdjust</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">nuclides</span><span class="p">)</span>
        <span class="c1"># get original mass frac A of those to be adjusted.</span>
        <span class="n">A</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMassFrac</span><span class="p">(</span><span class="n">ni</span><span class="p">)</span> <span class="k">for</span> <span class="n">ni</span> <span class="ow">in</span> <span class="n">adjustNuclides</span><span class="p">)</span>

        <span class="n">factor1</span> <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="n">A</span> <span class="k">if</span> <span class="n">A</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="c1"># set the ones we&#39;re adjusting to their given value.</span>
        <span class="n">numNucs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">adjustNuclides</span><span class="p">)</span>
        <span class="n">newA</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">newMassFracs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">adjustNuclides</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">factor1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># this is for when adjust nuclides have zero mass fractions. Like Zr.</span>
                <span class="c1"># In this case, if there are multiple nuclides, we will distribute them</span>
                <span class="c1"># evenly because we have no other indication of how to adjust them.</span>
                <span class="n">newMassFrac</span> <span class="o">=</span> <span class="n">val</span> <span class="o">/</span> <span class="n">numNucs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># this is for when the nuclides we&#39;re adjusting already exist</span>
                <span class="c1"># with non-zero mass fractions could be Pu vector.</span>
                <span class="n">newMassFrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMassFrac</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor1</span>
            <span class="n">newA</span> <span class="o">+=</span> <span class="n">newMassFrac</span>
            <span class="n">newMassFracs</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="n">newMassFrac</span>
            <span class="k">if</span> <span class="n">nuc</span> <span class="o">==</span> <span class="s2">&quot;ZR&quot;</span><span class="p">:</span>
                <span class="c1"># custom parameter only set here to determine how to behave for UZr</span>
                <span class="c1"># density, linear expansion. Can&#39;t let it roam with each mass frac</span>
                <span class="c1"># &#39;cause then the density roams too and there are &quot;oscillations&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">zrFrac</span> <span class="o">=</span> <span class="n">newMassFrac</span>

        <span class="c1"># error checking.</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">newA</span> <span class="o">-</span> <span class="n">val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Adjust Mass fraction did not adjust </span><span class="si">{0}</span><span class="s2"> from </span><span class="si">{1}</span><span class="s2"> to </span><span class="si">{2}</span><span class="s2">. It got to </span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">adjustNuclides</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">newA</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Failed to adjust mass fraction.&quot;</span><span class="p">)</span>

        <span class="c1"># determine the mass fraction of the nuclides that will be adjusted to</span>
        <span class="c1"># accomodate the requested change</span>
        <span class="n">othersSum</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">A</span> <span class="o">-</span> <span class="n">constantSum</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">othersSum</span><span class="p">:</span>
            <span class="c1"># no others to be modified.</span>
            <span class="n">factor2</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use newA rather than val</span>
            <span class="n">factor2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">newA</span> <span class="o">-</span> <span class="n">constantSum</span><span class="p">)</span> <span class="o">/</span> <span class="n">othersSum</span>

        <span class="c1"># change all the other nuclides using f2 factor</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nuc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">adjustNuclides</span> <span class="ow">and</span> <span class="n">nuc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">constantNuclides</span><span class="p">:</span>
                <span class="n">newMassFracs</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMassFrac</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setMassFracs</span><span class="p">(</span><span class="n">newMassFracs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.adjustMassEnrichment"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.adjustMassEnrichment">[docs]</a>    <span class="k">def</span> <span class="nf">adjustMassEnrichment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">massFraction</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjust the enrichment of this object.</span>

<span class="sd">        If it&#39;s Uranium, enrichment means U-235 fraction.</span>
<span class="sd">        If it&#39;s Boron, enrichment means B-10 fraction, etc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        newEnrich : float</span>
<span class="sd">            The new enrichment as a fraction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ArmiObject.getNumberDensity"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the number density of a nuclide in atoms/barn-cm.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This can get called very frequently and has to do volume computations so should</span>
<span class="sd">        use some kind of caching that is invalidated by any temperature, composition,</span>
<span class="sd">        etc. changes. Even with caching the volume calls are still somewhat expensive so</span>
<span class="sd">        prefer the methods in see also.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        ArmiObject.getNuclideNumberDensities: More efficient for &gt;1 specific nuc density is needed.</span>
<span class="sd">        ArmiObject.getNumberDensities: More efficient for when all nucs in object is needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclideNumberDensities</span><span class="p">([</span><span class="n">nucName</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ArmiObject.getNuclideNumberDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNuclideNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">getNuclideNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of number densities in atoms/barn-cm for the nuc names requested.&quot;&quot;&quot;</span>
        <span class="n">volumes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">parent</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># c x 1</span>
        <span class="n">totalVol</span> <span class="o">=</span> <span class="n">volumes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">totalVol</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="c1"># there are no children so no volume or number density</span>
            <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">nucNames</span><span class="p">)</span>

        <span class="n">nucDensForEachComp</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nucNames</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># c x n</span>
        <span class="k">return</span> <span class="n">volumes</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nucDensForEachComp</span><span class="p">)</span> <span class="o">/</span> <span class="n">totalVol</span></div>

    <span class="k">def</span> <span class="nf">_getNdensHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a number densities dict with unexpanded lfps.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is implemented more simply on the component level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nucNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">nucNames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclideNumberDensities</span><span class="p">(</span><span class="n">nucNames</span><span class="p">)))</span>

<div class="viewcode-block" id="ArmiObject.getNumberDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expandFissionProducts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the number densities in atoms/barn-cm of all nuclides (or those requested) in the object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expandFissionProducts : bool (optional)</span>
<span class="sd">            expand the fission product number densities</span>

<span class="sd">        nuclideNames : iterable (optional)</span>
<span class="sd">            nuclide names to get number densities</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numberDensities : dict</span>
<span class="sd">            nucName keys, number density values (atoms/bn-cm)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numberDensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getNdensHelper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">expandFissionProducts</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expandLFPs</span><span class="p">(</span><span class="n">numberDensities</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numberDensities</span></div>

<div class="viewcode-block" id="ArmiObject.getNeutronEnergyDepositionConstants"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNeutronEnergyDepositionConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getNeutronEnergyDepositionConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the neutron energy deposition group constants for a composite.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energyDepConstants: numpy.array</span>
<span class="sd">            Neutron energy generation group constants (in Joules/cm)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            Reports if a cross section library is not assigned to a reactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get neutron energy deposition group constants without &quot;</span>
                <span class="s2">&quot;a library. Please ensure a library exists.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">xsCollections</span><span class="o">.</span><span class="n">computeNeutronEnergyDepositionConstants</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getGammaEnergyDepositionConstants"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getGammaEnergyDepositionConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getGammaEnergyDepositionConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the gamma energy deposition group constants for a composite.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        energyDepConstants: numpy.array</span>
<span class="sd">            Energy generation group constants (in Joules/cm)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            Reports if a cross section library is not assigned to a reactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get gamma energy deposition group constants without &quot;</span>
                <span class="s2">&quot;a library. Please ensure a library exists.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">xsCollections</span><span class="o">.</span><span class="n">computeGammaEnergyDepositionConstants</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getTotalEnergyGenerationConstants"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getTotalEnergyGenerationConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getTotalEnergyGenerationConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the total energy generation group constants for a composite.</span>

<span class="sd">        Gives the total energy generation rates when multiplied by the multigroup flux.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        totalEnergyGenConstant: numpy.array</span>
<span class="sd">            Total (fission + capture) energy generation group constants (Joules/cm)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getFissionEnergyGenerationConstants</span><span class="p">()</span>
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCaptureEnergyGenerationConstants</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getFissionEnergyGenerationConstants"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getFissionEnergyGenerationConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getFissionEnergyGenerationConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the fission energy generation group constants for a composite.</span>

<span class="sd">        Gives the fission energy generation rates when multiplied by the multigroup</span>
<span class="sd">        flux.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fissionEnergyGenConstant: numpy.array</span>
<span class="sd">            Energy generation group constants (Joules/cm)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            Reports if a cross section library is not assigned to a reactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot compute energy generation group constants without a library&quot;</span>
                <span class="s2">&quot;. Please ensure a library exists.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">xsCollections</span><span class="o">.</span><span class="n">computeFissionEnergyGenerationConstants</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getCaptureEnergyGenerationConstants"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getCaptureEnergyGenerationConstants">[docs]</a>    <span class="k">def</span> <span class="nf">getCaptureEnergyGenerationConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the capture energy generation group constants for a composite.</span>

<span class="sd">        Gives the capture energy generation rates when multiplied by the multigroup</span>
<span class="sd">        flux.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fissionEnergyGenConstant: numpy.array</span>
<span class="sd">            Energy generation group constants (Joules/cm)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError:</span>
<span class="sd">            Reports if a cross section library is not assigned to a reactor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot compute energy generation group constants without a library&quot;</span>
                <span class="s2">&quot;. Please ensure a library exists.&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">xsCollections</span><span class="o">.</span><span class="n">computeCaptureEnergyGenerationConstants</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">()</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_expandLFPs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numberDensities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expand the LFPs on the numberDensities dictionary using this composite&#39;s</span>
<span class="sd">        lumpedFissionProductCollection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lfpCollection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLumpedFissionProductCollection</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">lfpCollection</span><span class="p">:</span>  <span class="c1"># may not have lfps in non-fuel</span>
            <span class="n">lfpDensities</span> <span class="o">=</span> <span class="n">lfpCollection</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">numberDensities</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">nucName</span><span class="p">:</span> <span class="n">numberDensities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">lfpDensities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">numberDensities</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">lfpDensities</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1"># remove LFPs from the result</span>
            <span class="k">for</span> <span class="n">lfpName</span> <span class="ow">in</span> <span class="n">lfpCollection</span><span class="p">:</span>
                <span class="n">numberDensities</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">lfpName</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lfpMass</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">dens</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="n">numberDensities</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nuclideBases</span><span class="o">.</span><span class="n">byName</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">LumpNuclideBase</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">lfpMass</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Composite </span><span class="si">{}</span><span class="s2"> is attempting to expand lumped fission products, but does not have &quot;</span>
                    <span class="s2">&quot;an lfpCollection.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">numberDensities</span>

<div class="viewcode-block" id="ArmiObject.getChildrenWithNuclides"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getChildrenWithNuclides">[docs]</a>    <span class="k">def</span> <span class="nf">getChildrenWithNuclides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return children that contain any nuclides in nucNames.&quot;&quot;&quot;</span>
        <span class="n">nucNames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nucNames</span><span class="p">)</span>  <span class="c1"># only convert to set once</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">child</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">if</span> <span class="n">nucNames</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">())]</span></div>

<div class="viewcode-block" id="ArmiObject.getAncestor"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getAncestor">[docs]</a>    <span class="k">def</span> <span class="nf">getAncestor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first ancestor that satisfies the supplied predicate.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn : Function-like object</span>
<span class="sd">            The predicate used to test the validity of an ancestor. Should return true</span>
<span class="sd">            if the ancestor satisfies the caller&#39;s requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAncestor</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getAncestorAndDistance"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getAncestorAndDistance">[docs]</a>    <span class="k">def</span> <span class="nf">getAncestorAndDistance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">_distance</span><span class="o">=</span><span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="s2">&quot;ArmiObject&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first ancestor that satisfies the supplied predicate, along with how</span>
<span class="sd">        many levels above self the ancestor lies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fn : Function-like object</span>
<span class="sd">            The predicate used to test the validity of an ancestor. Should return true</span>
<span class="sd">            if the ancestor satisfies the caller&#39;s requirements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">,</span> <span class="n">_distance</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAncestorAndDistance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">_distance</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getAncestorWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getAncestorWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">getAncestorWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exactMatch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first ancestor that matches the passed flags.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            A collection of flags to match on candidate parents</span>

<span class="sd">        exactMatch : bool</span>
<span class="sd">            Whether the flags match should be exact</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        armi.composites.ArmiObject</span>
<span class="sd">            the first ancestor up the chain of parents that matches the passed flags</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This will throw an error if no ancestor can be found that matches the typeSpec</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        ArmiObject.hasFlags()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exactMatch</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAncestorWithFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exactMatch</span><span class="o">=</span><span class="n">exactMatch</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getTotalNDens"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getTotalNDens">[docs]</a>    <span class="k">def</span> <span class="nf">getTotalNDens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the total number density of all atoms in this object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nTot : float</span>
<span class="sd">            Total ndens of all nuclides in atoms/bn-cm. Not homogenized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nFPsPerLFP</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fissionProductModel</span><span class="o">.</span><span class="n">NUM_FISSION_PRODUCTS_PER_LFP</span>
        <span class="p">)</span>  <span class="c1"># LFPs count as two! Big deal in non BOL cases.</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">dens</span> <span class="o">*</span> <span class="p">(</span><span class="n">nFPsPerLFP</span> <span class="k">if</span> <span class="s2">&quot;LFP&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.setNumberDensity"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">setNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the number density of this nuclide to this value.</span>

<span class="sd">        This distributes atom density evenly across all children that contain nucName.</span>
<span class="sd">        If the nuclide doesn&#39;t exist in any of the children, then that&#39;s actually an</span>
<span class="sd">        error. This would only happen if some unnatural nuclide like Pu239 built up in</span>
<span class="sd">        fresh UZr. That should be anticipated and dealt with elsewhere.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">activeChildren</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildrenWithNuclides</span><span class="p">({</span><span class="n">nucName</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">activeChildren</span><span class="p">:</span>
            <span class="n">activeVolumeFrac</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;The nuclide </span><span class="si">{}</span><span class="s2"> does not exist in any children of </span><span class="si">{}</span><span class="s2">; &quot;</span>
                    <span class="s2">&quot;cannot set its number density to </span><span class="si">{}</span><span class="s2">. The nuclides here are: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">nucName</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">activeVolumeFrac</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">vf</span> <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">vf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span> <span class="k">if</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">activeChildren</span>
            <span class="p">)</span>
        <span class="n">dehomogenizedNdens</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">val</span> <span class="o">/</span> <span class="n">activeVolumeFrac</span>
        <span class="p">)</span>  <span class="c1"># scale up to dehomogenize on children.</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">activeChildren</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">dehomogenizedNdens</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.setNumberDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">setNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numberDensities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set one or more multiple number densities. Reset any non-listed nuclides to 0.0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        numberDensities : dict</span>
<span class="sd">            nucName: ndens pairs.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        We&#39;d like to not have to call setNumberDensity for each nuclide because we don&#39;t</span>
<span class="sd">        want to call ``getVolumeFractions`` for each nuclide (it&#39;s inefficient).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numberDensities</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="n">nuc</span><span class="p">:</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span> <span class="k">if</span> <span class="n">nuc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">numberDensities</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateNumberDensities</span><span class="p">(</span><span class="n">numberDensities</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.updateNumberDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.updateNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">updateNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numberDensities</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set one or more multiple number densities. Leaves unlisted number densities alone.</span>

<span class="sd">        This changes a nuclide number density only on children that already have that</span>
<span class="sd">        nuclide, thereby allowing, for example, actinides to stay in the fuel component</span>
<span class="sd">        when setting block-level values.</span>

<span class="sd">        The complication is that various number densities are distributed among various</span>
<span class="sd">        components. This sets the number density for each nuclide evenly across all</span>
<span class="sd">        components that contain it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        numberDensities : dict</span>
<span class="sd">            nucName: ndens pairs.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">children</span><span class="p">,</span> <span class="n">volFracs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">())</span>
        <span class="n">childNucs</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">())</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">)</span>

        <span class="n">allDehomogenizedNDens</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

        <span class="c1"># compute potentially-different homogenization factors for each child.  evenly</span>
        <span class="c1"># distribute entire number density over the subset of active children.</span>
        <span class="k">for</span> <span class="n">nuc</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="n">numberDensities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># get &quot;active&quot; indices, i.e., indices of children containing nuc</span>
            <span class="c1"># NOTE: this is one of the rare instances in which (imo), using explicit</span>
            <span class="c1"># indexing clarifies subsequent code since it&#39;s not necessary to zip +</span>
            <span class="c1"># filter + extract individual components (just extract by filtered index).</span>
            <span class="n">indiciesToSet</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nucsInChild</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">childNucs</span><span class="p">)</span> <span class="k">if</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nucsInChild</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">indiciesToSet</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># density is zero, skip</span>
                    <span class="k">continue</span>

                <span class="c1"># This nuc doesn&#39;t exist in any children but is to be set.</span>
                <span class="c1"># Evenly distribute it everywhere.</span>
                <span class="n">childrenToSet</span> <span class="o">=</span> <span class="n">children</span>
                <span class="n">dehomogenizedNDens</span> <span class="o">=</span> <span class="n">dens</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">volFracs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">childrenToSet</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indiciesToSet</span><span class="p">)</span>
                <span class="n">dehomogenizedNDens</span> <span class="o">=</span> <span class="n">dens</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">volFracs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indiciesToSet</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">childrenToSet</span><span class="p">:</span>
                <span class="n">allDehomogenizedNDens</span><span class="p">[</span><span class="n">child</span><span class="p">][</span><span class="n">nuc</span><span class="p">]</span> <span class="o">=</span> <span class="n">dehomogenizedNDens</span>

        <span class="c1"># apply the child-dependent ndens vectors to the children</span>
        <span class="k">for</span> <span class="n">child</span><span class="p">,</span> <span class="n">ndens</span> <span class="ow">in</span> <span class="n">allDehomogenizedNDens</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">child</span><span class="o">.</span><span class="n">updateNumberDensities</span><span class="p">(</span><span class="n">ndens</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.changeNDensByFactor"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.changeNDensByFactor">[docs]</a>    <span class="k">def</span> <span class="nf">changeNDensByFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the number density of all nuclides within the object by a multiplicative factor.&quot;&quot;&quot;</span>
        <span class="n">densitiesScaled</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">nuc</span><span class="p">:</span> <span class="n">val</span> <span class="o">*</span> <span class="n">factor</span> <span class="k">for</span> <span class="n">nuc</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">densitiesScaled</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.clearNumberDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.clearNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">clearNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset all the number densities to nearly zero.</span>

<span class="sd">        Set to almost zero, so components remember which nuclides are where.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="p">{</span><span class="n">nuc</span><span class="p">:</span> <span class="n">units</span><span class="o">.</span><span class="n">TRACE_NUMBER_DENSITY</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">ndens</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.density"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.density">[docs]</a>    <span class="k">def</span> <span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the mass density of the object in g/cc.&quot;&quot;&quot;</span>
        <span class="n">density</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="n">density</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
                <span class="o">*</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">density</span></div>

<div class="viewcode-block" id="ArmiObject.getNumberOfAtoms"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNumberOfAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">getNumberOfAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the number of atoms of nucName in this object.&quot;&quot;&quot;</span>
        <span class="n">numDens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>  <span class="c1"># atoms/bn-cm</span>
        <span class="k">return</span> <span class="n">numDens</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">CM2_PER_BARN</span></div>

<div class="viewcode-block" id="ArmiObject.getLumpedFissionProductCollection"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getLumpedFissionProductCollection">[docs]</a>    <span class="k">def</span> <span class="nf">getLumpedFissionProductCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get collection of LFP objects. Will work for global or block-level LFP models.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfps : LumpedFissionProduct</span>
<span class="sd">            lfpName keys , lfp object values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.physics.neutronics.fissionProductModel.lumpedFissionProduct.LumpedFissionProduct : LFP object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lumpedFissionProducts</span></div>

<div class="viewcode-block" id="ArmiObject.setLumpedFissionProducts"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setLumpedFissionProducts">[docs]</a>    <span class="k">def</span> <span class="nf">setLumpedFissionProducts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lfpCollection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lumpedFissionProducts</span> <span class="o">=</span> <span class="n">lfpCollection</span></div>

<div class="viewcode-block" id="ArmiObject.setChildrenLumpedFissionProducts"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setChildrenLumpedFissionProducts">[docs]</a>    <span class="k">def</span> <span class="nf">setChildrenLumpedFissionProducts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lfpCollection</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setLumpedFissionProducts</span><span class="p">(</span><span class="n">lfpCollection</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getFissileMassEnrich"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getFissileMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">getFissileMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;returns the fissile mass enrichment.&quot;&quot;&quot;</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFissileMass</span><span class="p">()</span> <span class="o">/</span> <span class="n">hm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="ArmiObject.getBoronMassEnrich"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getBoronMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">getBoronMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return B-10 mass fraction.&quot;&quot;&quot;</span>
        <span class="n">b10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;B10&quot;</span><span class="p">)</span>
        <span class="n">b11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;B11&quot;</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">b11</span> <span class="o">+</span> <span class="n">b10</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">b10</span> <span class="o">/</span> <span class="n">total</span></div>

<div class="viewcode-block" id="ArmiObject.getUraniumMassEnrich"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getUraniumMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">getUraniumMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns U-235 mass fraction assuming U-235 and U-238 only.&quot;&quot;&quot;</span>
        <span class="n">u5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u5</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">u8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u5</span> <span class="o">/</span> <span class="p">(</span><span class="n">u8</span> <span class="o">+</span> <span class="n">u5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getUraniumNumEnrich"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getUraniumNumEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">getUraniumNumEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns U-235 number fraction.&quot;&quot;&quot;</span>
        <span class="n">u8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u8</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="n">u5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u5</span> <span class="o">/</span> <span class="p">(</span><span class="n">u8</span> <span class="o">+</span> <span class="n">u5</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getPuN"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getPuN">[docs]</a>    <span class="k">def</span> <span class="nf">getPuN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns total number density of Pu isotopes&quot;&quot;&quot;</span>
        <span class="n">nucNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuc</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">byZ</span><span class="p">[</span><span class="mi">94</span><span class="p">]</span><span class="o">.</span><span class="n">nuclideBases</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNuclideNumberDensities</span><span class="p">(</span><span class="n">nucNames</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArmiObject.calcTotalParam"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.calcTotalParam">[docs]</a>    <span class="k">def</span> <span class="nf">calcTotalParam</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span>
        <span class="n">objs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">volumeIntegrated</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">addSymmetricPositions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">calcBasedOnFullObj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sums up a parameter throughout the object&#39;s children or list of objects.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : str</span>
<span class="sd">            Name of the block parameter to sum</span>

<span class="sd">        objs : iterable, optional</span>
<span class="sd">            A list of objects to sum over. If none, all children in object will be used</span>

<span class="sd">        volumeIntegrated : bool, optional</span>
<span class="sd">            Integrate over volume</span>

<span class="sd">        addSymmetricPositions : bool, optional</span>
<span class="sd">            If True, will multiply by the symmetry factor of the core (3 for 1/3 models,</span>
<span class="sd">            1 for full core models)</span>

<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            object types to restrict to</span>

<span class="sd">        generationNum : int, optional</span>
<span class="sd">            Which generation to consider. 1 means direct children, 2 means children of</span>
<span class="sd">            children. Default: Just return direct children.</span>

<span class="sd">        calcBasedOnFullObj : bool, optional</span>
<span class="sd">            Some assemblies or blocks, such as the center assembly in a third core</span>
<span class="sd">            model, are not modeled as full assemblies or blocks. In the third core model</span>
<span class="sd">            objects at these postions are modeled as having 1/3 the volume and thus 1/3</span>
<span class="sd">            the power. Setting this argument to True will apply the full value of the</span>
<span class="sd">            parameter as if it was a full block or assembly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">objs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">generationNum</span><span class="o">=</span><span class="n">generationNum</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">addSymmetricPositions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">calcBasedOnFullObj</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;AddSymmetricPositions is Incompatable with &quot;</span>
                    <span class="s2">&quot;calcBasedOnFullObj. Will result in double counting.&quot;</span>
                <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">coreMult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">powerMultiplier</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">coreMult</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">powerMultiplier</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">coreMult</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;powerMultiplier is equal to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coreMult</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coreMult</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">mult</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span> <span class="k">if</span> <span class="n">volumeIntegrated</span> <span class="k">else</span> <span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">calcBasedOnFullObj</span><span class="p">:</span>
                <span class="n">mult</span> <span class="o">*=</span> <span class="n">a</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span>

            <span class="n">tot</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">mult</span>

        <span class="k">return</span> <span class="n">tot</span> <span class="o">*</span> <span class="n">coreMult</span></div>

<div class="viewcode-block" id="ArmiObject.calcAvgParam"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.calcAvgParam">[docs]</a>    <span class="k">def</span> <span class="nf">calcAvgParam</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span>
        <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">weightingParam</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">volumeAveraged</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the child-wide average of a parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : str</span>
<span class="sd">            The ARMI block parameter that you want the average from</span>

<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            The child types that should be included in the calculation. Restrict average</span>
<span class="sd">            to a certain child type with this parameter.</span>

<span class="sd">        weightingParam : None or str, optional</span>
<span class="sd">             An optional block param that the average will be weighted against</span>

<span class="sd">        volumeAveraged : bool, optional</span>
<span class="sd">            volume (or height, or area) average this param</span>

<span class="sd">        absolute : bool, optional</span>
<span class="sd">            Returns the average of the absolute value of param</span>

<span class="sd">        generationNum : int, optional</span>
<span class="sd">            Which generation to average over (1 for children, 2 for grandchildren)</span>


<span class="sd">        The weighted sum is:</span>

<span class="sd">        .. math::</span>

<span class="sd">            \left&lt;\text{x}\right&gt; = \frac{\sum_{i} x_i w_i}{\sum_i w_i}</span>

<span class="sd">        where :math:`i` is each child, :math:`x_i` is the param value of the i-th child,</span>
<span class="sd">        and :math:`w_i` is the weighting param value of the i-th child.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If a param is unset/zero on any of the children, this will be included in the</span>
<span class="sd">        average and may significantly perturb results.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The average parameter value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">weightSum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">generationNum</span><span class="o">=</span><span class="n">generationNum</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">weightingParam</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">weightingParam</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Just for conservatism, do not allow negative weights.</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Weighting value (</span><span class="si">{0}</span><span class="s2">,</span><span class="si">{1}</span><span class="s2">) cannot be negative.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">weightingParam</span><span class="p">,</span> <span class="n">weight</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="mf">1.0</span>

                <span class="k">if</span> <span class="n">volumeAveraged</span><span class="p">:</span>
                    <span class="n">weight</span> <span class="o">*=</span> <span class="n">child</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>

                <span class="n">weightSum</span> <span class="o">+=</span> <span class="n">weight</span>
                <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">])</span> <span class="o">*</span> <span class="n">weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">total</span> <span class="o">+=</span> <span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">*</span> <span class="n">weight</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">weightSum</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot calculate </span><span class="si">{0}</span><span class="s2">-weighted average of </span><span class="si">{1}</span><span class="s2"> in </span><span class="si">{2}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Weights sum to zero. typeSpec is </span><span class="si">{3}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">weightingParam</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="n">weightSum</span></div>

<div class="viewcode-block" id="ArmiObject.getMaxParam"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMaxParam">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxParam</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span>
        <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">returnObj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the maximum value for the parameter in this container</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        param : str</span>
<span class="sd">            block parameter that will be sought.</span>

<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            restricts the search to cover a variety of block types.</span>

<span class="sd">        absolute : bool</span>
<span class="sd">            looks for the largest magnitude value, regardless of sign, default: true</span>

<span class="sd">        returnObj : bool, optional</span>
<span class="sd">            If true, returns the child object as well as the value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        maxVal : float</span>
<span class="sd">            The maximum value of the parameter asked for</span>
<span class="sd">        obj : child object</span>
<span class="sd">            The object that has the max (only returned if ``returnObj==True``)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compartor</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxHelper</span><span class="p">(</span>
            <span class="n">param</span><span class="p">,</span>
            <span class="n">typeSpec</span><span class="p">,</span>
            <span class="n">absolute</span><span class="p">,</span>
            <span class="n">generationNum</span><span class="p">,</span>
            <span class="n">returnObj</span><span class="p">,</span>
            <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span>
            <span class="n">compartor</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getMinParam"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMinParam">[docs]</a>    <span class="k">def</span> <span class="nf">getMinParam</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span>
        <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">returnObj</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the minimum value for the parameter in this container.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        getMaxParam : details</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compartor</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minMaxHelper</span><span class="p">(</span>
            <span class="n">param</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">,</span> <span class="n">absolute</span><span class="p">,</span> <span class="n">generationNum</span><span class="p">,</span> <span class="n">returnObj</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="n">compartor</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_minMaxHelper</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">param</span><span class="p">,</span>
        <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span>
        <span class="n">absolute</span><span class="p">,</span>
        <span class="n">generationNum</span><span class="p">,</span>
        <span class="n">returnObj</span><span class="p">,</span>
        <span class="n">startingNum</span><span class="p">,</span>
        <span class="n">compartor</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper for getMinParam and getMaxParam.&quot;&quot;&quot;</span>
        <span class="n">maxP</span> <span class="o">=</span> <span class="p">(</span><span class="n">startingNum</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">realVal</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">generationNum</span><span class="o">=</span><span class="n">generationNum</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">objs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                <span class="k">except</span> <span class="n">parameters</span><span class="o">.</span><span class="n">UnknownParameterError</span><span class="p">:</span>
                    <span class="c1"># No worries; not all Composite types are guaranteed to have the</span>
                    <span class="c1"># relevant parameter. It might be a good idea to more strongly</span>
                    <span class="c1"># type-check this, perhaps by passing the paramDef,</span>
                    <span class="c1"># rather than its name?</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Neither bigger or smaller than anything (also illegal in Python3)</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
                    <span class="n">absVal</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">absVal</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">if</span> <span class="n">compartor</span><span class="p">(</span><span class="n">absVal</span><span class="p">,</span> <span class="n">maxP</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">maxP</span> <span class="o">=</span> <span class="p">(</span><span class="n">absVal</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                    <span class="n">realVal</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">returnObj</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">realVal</span><span class="p">,</span> <span class="n">maxP</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">realVal</span>

<div class="viewcode-block" id="ArmiObject.getChildParamValues"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getChildParamValues">[docs]</a>    <span class="k">def</span> <span class="nf">getChildParamValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the child parameter values in a numpy array.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">])</span></div>

<div class="viewcode-block" id="ArmiObject.isFuel"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.isFuel">[docs]</a>    <span class="k">def</span> <span class="nf">isFuel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if this is a fuel block.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.containsHeavyMetal"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.containsHeavyMetal">[docs]</a>    <span class="k">def</span> <span class="nf">containsHeavyMetal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if this has HM&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="c1"># these already have non-zero density</span>
            <span class="k">if</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">isHeavyMetal</span><span class="p">(</span><span class="n">nucName</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ArmiObject.getNuclides"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNuclides">[docs]</a>    <span class="k">def</span> <span class="nf">getNuclides</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine which nuclides are present in this armi object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">            List of nuclide names that exist in this</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nucs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
            <span class="n">nucs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">nucs</span></div>

<div class="viewcode-block" id="ArmiObject.getFissileMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getFissileMass">[docs]</a>    <span class="k">def</span> <span class="nf">getFissileMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns fissile mass in grams.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuclideBases</span><span class="o">.</span><span class="n">NuclideBase</span><span class="o">.</span><span class="n">fissile</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getHMMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getHMMass">[docs]</a>    <span class="k">def</span> <span class="nf">getHMMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns heavy metal mass in grams&quot;&quot;&quot;</span>
        <span class="n">nucs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">isHeavyMetal</span><span class="p">(</span><span class="n">nucName</span><span class="p">):</span>
                <span class="n">nucs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nucs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mass</span></div>

<div class="viewcode-block" id="ArmiObject.getHMMoles"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getHMMoles">[docs]</a>    <span class="k">def</span> <span class="nf">getHMMoles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of moles of heavy metal in this object in full symmetry.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If an object is on a symmetry line, the number of moles will be scaled up by the</span>
<span class="sd">        symmetry factor. This is done because this is typically used for tracking</span>
<span class="sd">        burnup, and BOL moles are computed in full objects too so there are no</span>
<span class="sd">        complications as things move on and off of symmetry lines.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        getHMMoles is different than every other get mass call since it multiplies by</span>
<span class="sd">        symmetry factor but getVolume() on the block level divides by symmetry factor</span>
<span class="sd">        causing them to cancel out.</span>

<span class="sd">        This was needed so that HM moles mass did not change based on if the</span>
<span class="sd">        block/assembly was on a symmetry line or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">getHMDens</span><span class="p">()</span>
            <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getHMDens"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getHMDens">[docs]</a>    <span class="k">def</span> <span class="nf">getHMDens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the total heavy metal density of this object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        hmDens : float</span>
<span class="sd">            The total heavy metal number (atom) density in atoms/bn-cm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hmNuclides</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">nuclide</span> <span class="k">for</span> <span class="n">nuclide</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span> <span class="k">if</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">isHeavyMetal</span><span class="p">(</span><span class="n">nuclide</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">hmDens</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNuclideNumberDensities</span><span class="p">(</span><span class="n">hmNuclides</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">hmDens</span></div>

<div class="viewcode-block" id="ArmiObject.getPuMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getPuMass">[docs]</a>    <span class="k">def</span> <span class="nf">getPuMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the mass of Pu in this object in grams.&quot;&quot;&quot;</span>
        <span class="n">nucs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="p">[</span><span class="n">nuc</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">byZ</span><span class="p">[</span><span class="mi">94</span><span class="p">]</span><span class="o">.</span><span class="n">nuclideBases</span><span class="p">]:</span>
            <span class="n">nucs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="n">pu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nucs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pu</span></div>

<div class="viewcode-block" id="ArmiObject.getPuFrac"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getPuFrac">[docs]</a>    <span class="k">def</span> <span class="nf">getPuFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Pu/HM mass fraction in this object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        puFrac : float</span>
<span class="sd">            The pu mass fraction in heavy metal in this assembly</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">pu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPuMass</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hm</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pu</span> <span class="o">/</span> <span class="n">hm</span></div>

<div class="viewcode-block" id="ArmiObject.getZrFrac"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getZrFrac">[docs]</a>    <span class="k">def</span> <span class="nf">getZrFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return the total zr/(hm+zr) fraction in this assembly&quot;&quot;&quot;</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">zrNucs</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuc</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">bySymbol</span><span class="p">[</span><span class="s2">&quot;ZR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nuclideBases</span><span class="p">]</span>
        <span class="n">zr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">zrNucs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hm</span> <span class="o">+</span> <span class="n">zr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">zr</span> <span class="o">/</span> <span class="p">(</span><span class="n">hm</span> <span class="o">+</span> <span class="n">zr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="ArmiObject.getMaxUraniumMassEnrich"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMaxUraniumMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxUraniumMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">maxV</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">getUraniumMassEnrich</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="n">maxV</span><span class="p">:</span>
                <span class="n">maxV</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">maxV</span></div>

<div class="viewcode-block" id="ArmiObject.getFPMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getFPMass">[docs]</a>    <span class="k">def</span> <span class="nf">getFPMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns mass of fission products in this block in grams&quot;&quot;&quot;</span>
        <span class="n">nucs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;LFP&quot;</span> <span class="ow">in</span> <span class="n">nucName</span><span class="p">:</span>
                <span class="n">nucs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nucs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mass</span></div>

<div class="viewcode-block" id="ArmiObject.getFuelMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getFuelMass">[docs]</a>    <span class="k">def</span> <span class="nf">getFuelMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns mass of fuel in grams.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">fuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="k">for</span> <span class="n">fuel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)],</span> <span class="mf">0.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.constituentReport"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.constituentReport">[docs]</a>    <span class="k">def</span> <span class="nf">constituentReport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A print out of some pertinent constituent information&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">iterables</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Constituent&quot;</span><span class="p">,</span> <span class="s2">&quot;HMFrac&quot;</span><span class="p">,</span> <span class="s2">&quot;FuelFrac&quot;</span><span class="p">]]</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFuelMass</span><span class="p">()]</span>

        <span class="k">for</span> <span class="n">base_ele</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">,</span> <span class="s2">&quot;PU&quot;</span><span class="p">]:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuclide</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">nuclide</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">bySymbol</span><span class="p">[</span><span class="n">base_ele</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">base_ele</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">total</span><span class="p">])</span>

        <span class="n">fp_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFPMass</span><span class="p">()</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp_total</span><span class="p">,</span> <span class="n">fp_total</span><span class="p">])</span>

        <span class="n">ma_nuclides</span> <span class="o">=</span> <span class="n">iterables</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">ele</span><span class="o">.</span><span class="n">nuclideBases</span>
                <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">byZ</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">byZ</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="mi">94</span>
                <span class="p">]</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ma_total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuclide</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">nuclide</span> <span class="ow">in</span> <span class="n">ma_nuclides</span><span class="p">])</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;MA&quot;</span><span class="p">,</span> <span class="n">ma_total</span><span class="p">,</span> <span class="n">ma_total</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">percent</span> <span class="o">=</span> <span class="n">entry</span> <span class="o">/</span> <span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.0</span>
                    <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">percent</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span>
                <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                    <span class="n">rows</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NaN&quot;</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>  <span class="c1"># trying to divide the string name</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">{:&lt;14}{:&lt;10}{:&lt;10}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">])</span></div>

<div class="viewcode-block" id="ArmiObject.getAtomicWeight"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getAtomicWeight">[docs]</a>    <span class="k">def</span> <span class="nf">getAtomicWeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the atomic weight of this object in g/mole of atoms.</span>

<span class="sd">        .. warning:: This is not the molecular weight, which is grams per mole of</span>
<span class="sd">            molecules (grams/gram-molecule). That requires knowledge of the chemical</span>
<span class="sd">            formula. Don&#39;t be surprised when you run this on UO2 and find it to be 90;</span>
<span class="sd">            there are a lot of Oxygen atoms in UO2.</span>

<span class="sd">        .. math::</span>

<span class="sd">            A =  \frac{\sum_i N_i A_i }{\sum_i N_i}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">numDensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">nDen</span> <span class="ow">in</span> <span class="n">numDensities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">atomicWeight</span> <span class="o">=</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">byName</span><span class="p">[</span><span class="n">nucName</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span>
            <span class="n">numerator</span> <span class="o">+=</span> <span class="n">atomicWeight</span> <span class="o">*</span> <span class="n">nDen</span>
            <span class="n">denominator</span> <span class="o">+=</span> <span class="n">nDen</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span></div>

<div class="viewcode-block" id="ArmiObject.getMasses"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMasses">[docs]</a>    <span class="k">def</span> <span class="nf">getMasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dictionary of masses indexed by their nuclide names.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Implemented to get number densities and then convert to mass</span>
<span class="sd">        because getMass is too slow on a large tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numDensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">()</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">nucName</span><span class="p">:</span> <span class="n">densityTools</span><span class="o">.</span><span class="n">getMassInGrams</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">ndens</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">ndens</span> <span class="ow">in</span> <span class="n">numDensities</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ArmiObject.getIntegratedMgFlux"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getIntegratedMgFlux">[docs]</a>    <span class="k">def</span> <span class="nf">getIntegratedMgFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ArmiObject.getMgFlux"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getMgFlux">[docs]</a>    <span class="k">def</span> <span class="nf">getMgFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">volume</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the multigroup neutron flux in [n/cm^2/s]</span>

<span class="sd">        The first entry is the first energy group (fastest neutrons). Each additional</span>
<span class="sd">        group is the next energy group, as set in the ISOTXS library.</span>

<span class="sd">        On blocks, it is stored integrated over volume on &lt;block&gt;.p.mgFlux</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjoint : bool, optional</span>
<span class="sd">            Return adjoint flux instead of real</span>

<span class="sd">        average : bool, optional</span>
<span class="sd">            If true, will return average flux between latest and previous. Doesn&#39;t work</span>
<span class="sd">            for pin detailed yet</span>

<span class="sd">        volume: float, optional</span>
<span class="sd">            If average=True, the volume-integrated flux is divided by volume before</span>
<span class="sd">            being returned. The user may specify a volume here, or the function will</span>
<span class="sd">            obtain the block volume directly.</span>

<span class="sd">        gamma : bool, optional</span>
<span class="sd">            Whether to return the neutron flux or the gamma flux.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flux : numpy.array</span>
<span class="sd">            multigroup neutron flux in [n/cm^2/s]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">average</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> class has no method for producing average MG flux -- try&quot;</span>
                <span class="s2">&quot;using blocks&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIntegratedMgFlux</span><span class="p">(</span><span class="n">adjoint</span><span class="o">=</span><span class="n">adjoint</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="n">volume</span></div>

<div class="viewcode-block" id="ArmiObject.removeMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.removeMass">[docs]</a>    <span class="k">def</span> <span class="nf">removeMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addMass</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="o">-</span><span class="n">mass</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.addMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.addMass">[docs]</a>    <span class="k">def</span> <span class="nf">addMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucName : str</span>
<span class="sd">            nuclide name e.g. &#39;U235&#39;</span>

<span class="sd">        mass : float</span>
<span class="sd">            mass in grams of nuclide to be added to this armi Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">addedNumberDensity</span> <span class="o">=</span> <span class="n">densityTools</span><span class="o">.</span><span class="n">calculateNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span>
            <span class="n">nucName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span> <span class="o">+</span> <span class="n">addedNumberDensity</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.addMasses"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.addMasses">[docs]</a>    <span class="k">def</span> <span class="nf">addMasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">masses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a vector of masses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        masses : dict</span>
<span class="sd">            a dictionary of masses (g) indexed by nucNames (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span> <span class="ow">in</span> <span class="n">masses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mass</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addMass</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.setMass"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setMass">[docs]</a>    <span class="k">def</span> <span class="nf">setMass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mass in an object by adjusting the ndens of the nuclides.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucName : str</span>
<span class="sd">            Nuclide name to set mass of</span>
<span class="sd">        mass : float</span>
<span class="sd">            Mass in grams to set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">calculateNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getVolume</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.setMasses"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setMasses">[docs]</a>    <span class="k">def</span> <span class="nf">setMasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">masses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a vector of masses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        masses : dict</span>
<span class="sd">            a dictionary of masses (g) indexed by nucNames (string)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span> <span class="ow">in</span> <span class="n">masses</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMass</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getSymmetryFactor"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getSymmetryFactor">[docs]</a>    <span class="k">def</span> <span class="nf">getSymmetryFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a scaling factor due to symmetry on the area of the object or its children.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.reactor.blocks.HexBlock.getSymmetryFactor : concrete implementation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="ArmiObject.getBoundingIndices"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getBoundingIndices">[docs]</a>    <span class="k">def</span> <span class="nf">getBoundingIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the 3-D index bounds (min, max) of all children in the spatial grid of this object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bounds : tuple</span>
<span class="sd">            ((minI, maxI), (minJ, maxJ), (minK, maxK))</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">minI</span> <span class="o">=</span> <span class="n">minJ</span> <span class="o">=</span> <span class="n">minK</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="n">maxI</span> <span class="o">=</span> <span class="n">maxJ</span> <span class="o">=</span> <span class="n">maxK</span> <span class="o">=</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">maxI</span><span class="p">:</span>
                <span class="n">maxI</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">minI</span><span class="p">:</span>
                <span class="n">minI</span> <span class="o">=</span> <span class="n">i</span>

            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">maxJ</span><span class="p">:</span>
                <span class="n">maxJ</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">minJ</span><span class="p">:</span>
                <span class="n">minJ</span> <span class="o">=</span> <span class="n">j</span>

            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">maxK</span><span class="p">:</span>
                <span class="n">maxK</span> <span class="o">=</span> <span class="n">k</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">minK</span><span class="p">:</span>
                <span class="n">minK</span> <span class="o">=</span> <span class="n">k</span>

        <span class="k">return</span> <span class="p">((</span><span class="n">minI</span><span class="p">,</span> <span class="n">maxI</span><span class="p">),</span> <span class="p">(</span><span class="n">minJ</span><span class="p">,</span> <span class="n">maxJ</span><span class="p">),</span> <span class="p">(</span><span class="n">minK</span><span class="p">,</span> <span class="n">maxK</span><span class="p">))</span></div>

<div class="viewcode-block" id="ArmiObject.getComponentNames"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponentNames">[docs]</a>    <span class="k">def</span> <span class="nf">getComponentNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all unique component names of this Composite.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        set or str</span>
<span class="sd">            A set of all unique component names found in this Composite.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">())</span></div>

<div class="viewcode-block" id="ArmiObject.getComponentsOfShape"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponentsOfShape">[docs]</a>    <span class="k">def</span> <span class="nf">getComponentsOfShape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapeClass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of components in this block of a particular shape.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shapeClass : Component</span>
<span class="sd">            The class of component, e.g. Circle, Helix, Hexagon, etc.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        param : list</span>
<span class="sd">            List of components in this block that are of the given shape.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">shapeClass</span><span class="p">)]</span></div>

<div class="viewcode-block" id="ArmiObject.getComponentsOfMaterial"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponentsOfMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">getComponentsOfMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">materialName</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return list of components in this block that are made of a particular material</span>

<span class="sd">        Only one of the selectors may be used</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        material : Material object, optional</span>
<span class="sd">            The material to match</span>
<span class="sd">        materialName : str, optional</span>
<span class="sd">            The material name to match.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        componentsWithThisMat : list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">materialName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">materialName</span> <span class="o">=</span> <span class="n">material</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">),</span> <span class="s2">&quot;Cannot call with more than one selector. Choose one or the other.&quot;</span>

        <span class="n">componentsWithThisMat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">materialName</span><span class="p">:</span>
                <span class="n">componentsWithThisMat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">componentsWithThisMat</span></div>

<div class="viewcode-block" id="ArmiObject.hasComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.hasComponents">[docs]</a>    <span class="k">def</span> <span class="nf">hasComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">TypeSpec</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">TypeSpec</span><span class="p">]],</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return true if components matching all TypeSpec exist in this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : Flags or iterable of Flags</span>
<span class="sd">            Component flags to check for</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Wrap the typeSpec in a tuple if we got a scalar</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">typeSpec</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">typeSpec</span> <span class="o">=</span> <span class="p">(</span><span class="n">typeSpec</span><span class="p">,)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">typeSpec</span><span class="p">:</span>
            <span class="c1"># loop b/c getComponents is a OR operation on the flags, but we need AND</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">exact</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ArmiObject.getComponentByName"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponentByName">[docs]</a>    <span class="k">def</span> <span class="nf">getComponentByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets a particular component from this object, based on its name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The blueprint name of the component to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
        <span class="n">nComp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nComp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">nComp</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;More than one component named &#39;</span><span class="si">{}</span><span class="s2">&#39; in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ArmiObject.getComponent"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getComponent">[docs]</a>    <span class="k">def</span> <span class="nf">getComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a particular component from this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : flags.Flags or list of Flags</span>
<span class="sd">            The type specification of the component to return</span>

<span class="sd">        exact : boolean, optional</span>
<span class="sd">            Demand that the component flags be exactly equal to the typespec. Default: False</span>

<span class="sd">        quiet : boolean, optional</span>
<span class="sd">            Warn if the component is not found. Default: False</span>

<span class="sd">        Careful with multiple similar names in one object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Component : The component that matches the critera or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exact</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No component matched </span><span class="si">{0}</span><span class="s2"> in </span><span class="si">{1}</span><span class="s2">. Returning None&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">typeSpec</span><span class="p">,</span> <span class="bp">self</span>
                    <span class="p">),</span>
                    <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;None component returned instead of </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Multiple components match in </span><span class="si">{}</span><span class="s2"> match typeSpec </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">,</span> <span class="n">results</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getNumComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getNumComponents">[docs]</a>    <span class="k">def</span> <span class="nf">getNumComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of components that have these flags, taking into account multiplicity. Useful</span>
<span class="sd">        for getting nPins even when there are pin detailed cases.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : Flags</span>
<span class="sd">            Expected flags of the component to get. e.g. Flags.FUEL</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        total : int</span>
<span class="sd">            the number of components of this type in this object, including multiplicity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">total</span></div>

<div class="viewcode-block" id="ArmiObject.setComponentDimensionsReport"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.setComponentDimensionsReport">[docs]</a>    <span class="k">def</span> <span class="nf">setComponentDimensionsReport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Makes a summary of the dimensions of the components in this object.&quot;&quot;&quot;</span>
        <span class="n">reportGroups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">():</span>
            <span class="n">reportGroups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">setDimensionReport</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">reportGroups</span></div>

<div class="viewcode-block" id="ArmiObject.printDensities"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.printDensities">[docs]</a>    <span class="k">def</span> <span class="nf">printDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expandFissionProducts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get lines that have the number densities of a object.&quot;&quot;&quot;</span>
        <span class="n">numberDensities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">(</span>
            <span class="n">expandFissionProducts</span><span class="o">=</span><span class="n">expandFissionProducts</span>
        <span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">nucDens</span> <span class="ow">in</span> <span class="n">numberDensities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:6s}</span><span class="s2"> </span><span class="si">{1:.7E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucName</span><span class="p">,</span> <span class="n">nucDens</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="ArmiObject.expandAllElementalsToIsotopics"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.expandAllElementalsToIsotopics">[docs]</a>    <span class="k">def</span> <span class="nf">expandAllElementalsToIsotopics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reactorNucs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">elemental</span> <span class="ow">in</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">nb</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nb</span><span class="p">,</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">NaturalNuclideBase</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">nb</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">reactorNucs</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expandElementalToIsotopics</span><span class="p">(</span><span class="n">elemental</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.expandElementalToIsotopics"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.expandElementalToIsotopics">[docs]</a>    <span class="k">def</span> <span class="nf">expandElementalToIsotopics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elementalNuclide</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Expands the density of a specific elemental nuclides to its natural isotopics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        elementalNuclide : :class:`armi.nucDirectory.nuclideBases.NaturalNuclide`</span>
<span class="sd">            natural nuclide to replace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">natName</span> <span class="o">=</span> <span class="n">elementalNuclide</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">():</span>
            <span class="n">elementalDensity</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">natName</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">elementalDensity</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">component</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="n">natName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># clear the elemental</span>
            <span class="k">del</span> <span class="n">component</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">numberDensities</span><span class="p">[</span><span class="n">natName</span><span class="p">]</span>
            <span class="c1"># add in isotopics</span>
            <span class="k">for</span> <span class="n">natNuc</span> <span class="ow">in</span> <span class="n">elementalNuclide</span><span class="o">.</span><span class="n">getNaturalIsotopics</span><span class="p">():</span>
                <span class="n">component</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span>
                    <span class="n">natNuc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">elementalDensity</span> <span class="o">*</span> <span class="n">natNuc</span><span class="o">.</span><span class="n">abundance</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getAverageTempInC"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getAverageTempInC">[docs]</a>    <span class="k">def</span> <span class="nf">getAverageTempInC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the average temperature of the ArmiObject in C by averaging all components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempNumerator</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">totalVol</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">):</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="n">tempNumerator</span> <span class="o">+=</span> <span class="n">component</span><span class="o">.</span><span class="n">temperatureInC</span> <span class="o">*</span> <span class="n">vol</span>
            <span class="n">totalVol</span> <span class="o">+=</span> <span class="n">vol</span>

        <span class="k">return</span> <span class="n">tempNumerator</span> <span class="o">/</span> <span class="n">totalVol</span></div>

<div class="viewcode-block" id="ArmiObject.resolveLinkedDims"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.resolveLinkedDims">[docs]</a>    <span class="k">def</span> <span class="nf">resolveLinkedDims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">components</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resolve link strings to links on all child components.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">():</span>
            <span class="n">component</span><span class="o">.</span><span class="n">resolveLinkedDims</span><span class="p">(</span><span class="n">components</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArmiObject.getDominantMaterial"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.ArmiObject.getDominantMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">getDominantMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the first sample of the most dominant material (by volume) in this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : Flags or iterable of Flags, optional</span>
<span class="sd">            The types of components to consider (e.g. ``[Flags.FUEL, Flags.CONTROL]``)</span>
<span class="sd">        exact : bool, optional</span>
<span class="sd">            Whether or not the TypeSpec is exact</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mat : Material</span>
<span class="sd">             the first instance of the most dominant material (by volume) in this object.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        getComponentsOfMaterial</span>
<span class="sd">            Gets components that are made of a particular material</span>
<span class="sd">        gatherMaterialsByVolume</span>
<span class="sd">            Classifies all materials by volume</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">getDominantMaterial</span><span class="p">([</span><span class="bp">self</span><span class="p">],</span> <span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Composite"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite">[docs]</a><span class="k">class</span> <span class="nc">Composite</span><span class="p">(</span><span class="n">ArmiObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An ArmiObject that has children.</span>

<span class="sd">    This is a fundamental ARMI state object that generally represents some piece of the</span>
<span class="sd">    nuclear reactor that is made up of other smaller pieces. This object can cache</span>
<span class="sd">    information about its children to help performance.</span>

<span class="sd">    **Details about spatial representation**</span>

<span class="sd">    Spatial representation of a ``Composite`` is handled through a combination of the</span>
<span class="sd">    ``spatialLocator`` and ``spatialGrid`` parameters. The ``spatialLocator`` is a numpy</span>
<span class="sd">    triple representing either:</span>

<span class="sd">    1. Indices in the parent&#39;s ``spatialGrid`` (for lattices, etc.), used when the dtype</span>
<span class="sd">    is int.</span>

<span class="sd">    2. Coordinates in the parent&#39;s universe in cm, used when the dtype is float.</span>

<span class="sd">    The top parent of any composite must have a coordinate-based ``spatialLocator``. For</span>
<span class="sd">    example, a Reactor an a Pump should both have coordinates based on how far apart</span>
<span class="sd">    they are.</span>

<span class="sd">    The traversal of indices and grids is recursive. The Reactor/Core/Assembly/Block</span>
<span class="sd">    model is handled by putting a 2-D grid (either Theta-R, Hex, or Cartesian) on the</span>
<span class="sd">    Core and individual 1-D Z-meshes on the assemblies. Then, Assemblies have 2-D</span>
<span class="sd">    spatialLocators (i,j,0) and Blocks have 1-D spatiaLocators (0,0,k). These get added</span>
<span class="sd">    to form the global indices. This way, if an assembly is moved, all the blocks</span>
<span class="sd">    immediately and naturally move with it. Individual children may have</span>
<span class="sd">    coordinate-based spatialLocators mixed with siblings in a grid. This allows mixing</span>
<span class="sd">    grid-representation with explicit representation, often useful in advanced</span>
<span class="sd">    assemblies and thermal reactors.</span>

<span class="sd">    The traversal of indices and grids is recursive. The</span>
<span class="sd">    Reactor/Core/Assembly/Block model is handled by putting a 2-D grid (either</span>
<span class="sd">    Theta-R, Hex, or Cartesian) on the Core and individual 1-D Z-meshes on the</span>
<span class="sd">    assemblies. Then, Assemblies have 2-D spatialLocators (i,j,0) and Blocks</span>
<span class="sd">    have 1-D spatiaLocators (0,0,k). These get added to form the global indices.</span>
<span class="sd">    This way, if an assembly is moved, all the blocks immediately and naturally</span>
<span class="sd">    move with it. Individual children may have coordinate-based spatialLocators</span>
<span class="sd">    mixed with siblings in a grid. This allows mixing grid-representation with</span>
<span class="sd">    explicit representation, often useful in advanced assemblies and thermal</span>
<span class="sd">    reactors.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">ArmiObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">childrenByLocator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Unsafe to insert elements directly&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Membership check.</span>

<span class="sd">        This does not use quality checks for membership checking because equality</span>
<span class="sd">        operations can be fairly heavy. Rather, this only checks direct identity</span>
<span class="sd">        matches.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">)</span>

<div class="viewcode-block" id="Composite.index"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Obtain the list index of a particular child.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.append"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Append a child to this object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.extend"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a list of children to this object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.add"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add one new child.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add </span><span class="si">{0}</span><span class="s2"> because it has already been added to </span><span class="si">{1}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">obj</span><span class="p">,</span> <span class="bp">self</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.remove"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a particular child.&quot;&quot;&quot;</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">detachedCopy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.moveTo"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.moveTo">[docs]</a>    <span class="k">def</span> <span class="nf">moveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Move to specific location in parent. Often in a grid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">locator</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">armiObject</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot move </span><span class="si">{}</span><span class="s2"> to a location in  </span><span class="si">{}</span><span class="s2">, which is not its parent (</span><span class="si">{}</span><span class="s2">).&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locator</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">armiObject</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">locator</span></div>

<div class="viewcode-block" id="Composite.insert"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert an object into the list of children at a particular index.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot insert </span><span class="si">{0}</span><span class="s2"> because it has already been added to </span><span class="si">{1}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">obj</span><span class="p">,</span> <span class="bp">self</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.removeAll"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.removeAll">[docs]</a>    <span class="k">def</span> <span class="nf">removeAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all children.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">()[:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.setChildren"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.setChildren">[docs]</a>    <span class="k">def</span> <span class="nf">setChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear this container and fills it with new children.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeAll</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.getChildren"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getChildren">[docs]</a>    <span class="k">def</span> <span class="nf">getChildren</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the children objects of this composite.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        deep : boolean, optional</span>
<span class="sd">            Return all children of all levels.</span>

<span class="sd">        generationNum : int, optional</span>
<span class="sd">            Which generation to return. 1 means direct children, 2 means children of</span>
<span class="sd">            children. Setting this parameter will only return children of this</span>
<span class="sd">            generation, not their parents. Default: Just return direct children.</span>

<span class="sd">        includeMaterials : bool, optional</span>
<span class="sd">            Include the material properties</span>

<span class="sd">        predicate : callable, optional</span>
<span class="sd">            An optional unary predicate to use for filtering results. This can be used</span>
<span class="sd">            to request children of specific types, or with desired attributes. Not all</span>
<span class="sd">            ArmiObjects have the same methods and members, so care should be taken to</span>
<span class="sd">            make sure that the predicate executes gracefully in all cases (e.g., use</span>
<span class="sd">            ``getattr(obj, &quot;attribute&quot;, None)`` to access instance attributes). Failure</span>
<span class="sd">            to meet the predicate only affects the object in question; children will</span>
<span class="sd">            still be considered.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; obj.getChildren()</span>
<span class="sd">        [child1, child2, child3]</span>

<span class="sd">        &gt;&gt;&gt; obj.getChildren(generationNum=2)</span>
<span class="sd">        [grandchild1, grandchild2, grandchild3]</span>

<span class="sd">        &gt;&gt;&gt; obj.getChildren(deep=True)</span>
<span class="sd">        [child1, child2, child3, grandchild1, grandchild2, grandchild3]</span>

<span class="sd">        # Assuming that grandchild1 and grandchild3 are Component objects</span>
<span class="sd">        &gt;&gt;&gt; obj.getChildren(deep=True, predicate=lambda o: isinstance(o, Component))</span>
<span class="sd">        [grandchild1, grandchild3]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_pred</span> <span class="o">=</span> <span class="n">predicate</span> <span class="ow">or</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deep</span> <span class="ow">and</span> <span class="n">generationNum</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot get children with a generation number set and the deep flag set&quot;</span>
            <span class="p">)</span>

        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">generationNum</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">deep</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_pred</span><span class="p">(</span><span class="n">child</span><span class="p">):</span>
                    <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">generationNum</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">deep</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span>
                        <span class="n">deep</span><span class="o">=</span><span class="n">deep</span><span class="p">,</span>
                        <span class="n">generationNum</span><span class="o">=</span><span class="n">generationNum</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">includeMaterials</span><span class="o">=</span><span class="n">includeMaterials</span><span class="p">,</span>
                        <span class="n">predicate</span><span class="o">=</span><span class="n">predicate</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">includeMaterials</span><span class="p">:</span>
            <span class="n">material</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;material&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">material</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">children</span></div>

<div class="viewcode-block" id="Composite.getChildrenWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getChildrenWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">getChildrenWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exactMatch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all children of a specific type.&quot;&quot;&quot;</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="n">exactMatch</span><span class="p">):</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span></div>

<div class="viewcode-block" id="Composite.getChildrenOfType"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getChildrenOfType">[docs]</a>    <span class="k">def</span> <span class="nf">getChildrenOfType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get children that have a specific input type name.&quot;&quot;&quot;</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span> <span class="o">==</span> <span class="n">typeName</span><span class="p">:</span>
                <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">children</span></div>

<div class="viewcode-block" id="Composite.getComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getComponents">[docs]</a>    <span class="k">def</span> <span class="nf">getComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">))</span></div>

<div class="viewcode-block" id="Composite.iterComponents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.iterComponents">[docs]</a>    <span class="k">def</span> <span class="nf">iterComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an iterator of armi.reactor.component.Component objects within this Composite.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typeSpec : TypeSpec</span>
<span class="sd">            Component flags. Will restrict Components to specific ones matching the</span>
<span class="sd">            flags specified.</span>

<span class="sd">        exact : bool, optional</span>
<span class="sd">            Only match exact component labels (names). If True, &#39;coolant&#39; will not match</span>
<span class="sd">            &#39;interCoolant&#39;.  This has no impact if typeSpec is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        iterator of Component</span>
<span class="sd">            items matching typeSpec and exact criteria</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">))</span></div>

<div class="viewcode-block" id="Composite.syncMpiState"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.syncMpiState">[docs]</a>    <span class="k">def</span> <span class="nf">syncMpiState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Synchronize all parameters of this object and all children to all worker nodes</span>
<span class="sd">        over the network using MPI.</span>

<span class="sd">        In parallelized runs, if each process has its own copy of the entire reactor</span>
<span class="sd">        hierarchy, this method synchronizes the state of all parameters on all objects.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            number of parameters synchronized over all components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_SIZE</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="n">startTime</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="c1"># sync parameters...</span>
        <span class="n">allComps</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sendBuf</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">getSyncData</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">allComps</span><span class="p">]</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;syncMpiState has </span><span class="si">{}</span><span class="s2"> comps&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allComps</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">MPI_COMM</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>  <span class="c1"># sync up</span>
            <span class="n">allGatherTime</span> <span class="o">=</span> <span class="o">-</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
            <span class="n">allSyncData</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_COMM</span><span class="o">.</span><span class="n">allgather</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">)</span>
            <span class="n">allGatherTime</span> <span class="o">+=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Failure while trying to allgather.&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">compData</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sendBuf</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">compData</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;sendBuf[</span><span class="si">{}</span><span class="s2">]: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">compData</span><span class="p">)]</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="n">errors</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span>
            <span class="nb">list</span>
        <span class="p">)</span>  <span class="c1"># key is (comp, paramName) value is conflicting nodes</span>
        <span class="n">syncCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">compsPerNode</span> <span class="o">=</span> <span class="p">{</span><span class="nb">len</span><span class="p">(</span><span class="n">nodeSyncData</span><span class="p">)</span> <span class="k">for</span> <span class="n">nodeSyncData</span> <span class="ow">in</span> <span class="n">allSyncData</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">compsPerNode</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The workers have different reactor sizes! comp lengths: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">compsPerNode</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">allComps</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">nodeSyncData</span><span class="p">[</span><span class="n">ci</span><span class="p">]</span> <span class="k">for</span> <span class="n">nodeSyncData</span> <span class="ow">in</span> <span class="n">allSyncData</span><span class="p">)</span>
            <span class="n">syncCount</span> <span class="o">+=</span> <span class="n">comp</span><span class="o">.</span><span class="n">_syncParameters</span><span class="p">(</span>  <span class="c1"># pylint: disable=protected-access</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">errors</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
            <span class="n">errorData</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="p">),</span> <span class="n">comp</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">parent</span><span class="p">),</span> <span class="n">paramName</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">paramName</span><span class="p">),</span> <span class="n">nodes</span> <span class="ow">in</span> <span class="n">errors</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Synchronization failed due to overlapping data. Only the first &quot;</span>
                <span class="s2">&quot;duplicates are listed</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
                        <span class="n">errorData</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">[</span>
                            <span class="s2">&quot;Composite&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Composite Type&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;Composite Parent&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;ParameterName&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;NodeRanks&quot;</span><span class="p">,</span>
                        <span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_markSynchronized</span><span class="p">()</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
            <span class="s2">&quot;Synchronized reactor over MPI in </span><span class="si">{:.4f}</span><span class="s2"> seconds, </span><span class="si">{:.4f}</span><span class="s2"> seconds in MPI &quot;</span>
            <span class="s2">&quot;allgather. count:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">allGatherTime</span><span class="p">,</span> <span class="n">syncCount</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">syncCount</span></div>

    <span class="k">def</span> <span class="nf">_syncParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allSyncData</span><span class="p">,</span> <span class="n">errors</span><span class="p">):</span>
        <span class="c1"># ensure no overlap with syncedKeys, use errors to report overlapping data</span>
        <span class="n">syncedKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">nodeRank</span><span class="p">,</span> <span class="n">nodeSyncData</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">allSyncData</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">nodeSyncData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># nodeSyncData is a list of tuples</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">nodeSyncData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">syncedKeys</span><span class="p">:</span>
                    <span class="c1"># TODO: this requires further investigation and should be avoidable.</span>
                    <span class="c1"># this situation results when a composite object is flagged as being</span>
                    <span class="c1"># out of sync, and this parameter was also globally modified and</span>
                    <span class="c1"># readjusted to the original value.</span>
                    <span class="n">curVal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
                        <span class="n">curVal</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
                    <span class="p">):</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="n">curVal</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                            <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeRank</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">curVal</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">errors</span><span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodeRank</span><span class="p">)</span>
                        <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;in </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2"> differ (</span><span class="si">{}</span><span class="s2"> != </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">curVal</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">syncedKeys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">syncedKeys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_markSynchronized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark the composite and child parameters as synchronized across MPI.</span>

<span class="sd">        We clear SINCE_LAST_DISTRIBUTE_STATE so that anything after this point will set</span>
<span class="sd">        the SINCE_LAST_DISTRIBUTE_STATE flag, indicating it has been modified</span>
<span class="sd">        SINCE_LAST_DISTRIBUTE_STATE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paramDefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="c1"># below reads as: assigned &amp; everything_but(SINCE_LAST_DISTRIBUTE_STATE)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">assigned</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">parameters</span><span class="o">.</span><span class="n">SINCE_LAST_DISTRIBUTE_STATE</span>
            <span class="n">paramDefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">paramDefs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">paramDef</span> <span class="ow">in</span> <span class="n">paramDefs</span><span class="p">:</span>
            <span class="n">paramDef</span><span class="o">.</span><span class="n">resetAssignmentFlag</span><span class="p">(</span><span class="n">parameters</span><span class="o">.</span><span class="n">SINCE_LAST_DISTRIBUTE_STATE</span><span class="p">)</span>

<div class="viewcode-block" id="Composite.retainState"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.retainState">[docs]</a>    <span class="k">def</span> <span class="nf">retainState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramsToApply</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restores a state before and after some operation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        paramsToApply : iterable</span>
<span class="sd">            Parameters that should be applied to the state after existing the state</span>
<span class="sd">            retainer. All others will be reverted to their values upon entering.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This should be used in a `with` statement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">StateRetainer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramsToApply</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.backUp"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.backUp">[docs]</a>    <span class="k">def</span> <span class="nf">backUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and store a backup of the state.</span>

<span class="sd">        This needed to be overridden due to linked components which actually have a</span>
<span class="sd">        parameter value of another ARMI component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_backupCache</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupCache</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># don&#39;t .clear(), using reference above!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">backUp</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">backUp</span><span class="p">()</span></div>

<div class="viewcode-block" id="Composite.restoreBackup"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.restoreBackup">[docs]</a>    <span class="k">def</span> <span class="nf">restoreBackup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paramsToApply</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the parameters from previously created backup.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        paramsToApply : list of ParmeterDefinitions</span>
<span class="sd">            restores the state of all parameters not in `paramsToApply`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">restoreBackup</span><span class="p">(</span><span class="n">paramsToApply</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cached</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupCache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backupCache</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">restoreBackup</span><span class="p">()</span></div>

<div class="viewcode-block" id="Composite.getLumpedFissionProductsIfNecessary"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getLumpedFissionProductsIfNecessary">[docs]</a>    <span class="k">def</span> <span class="nf">getLumpedFissionProductsIfNecessary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclides</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return Lumped Fission Product objects that belong to this object or any of its children.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">requiresLumpedFissionProducts</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="n">nuclides</span><span class="p">):</span>
            <span class="n">lfps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLumpedFissionProductCollection</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">lfps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">c</span><span class="o">.</span><span class="n">getLumpedFissionProductsIfNecessary</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="n">nuclides</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">lfps</span>
        <span class="c1"># There are no lumped fission products in the batch so if you use a</span>
        <span class="c1"># dictionary no one will know the difference</span>
        <span class="k">return</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="Composite.getLumpedFissionProductCollection"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getLumpedFissionProductCollection">[docs]</a>    <span class="k">def</span> <span class="nf">getLumpedFissionProductCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get collection of LFP objects. Will work for global or block-level LFP models.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfps : object</span>
<span class="sd">            lfpName keys, lfp object values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.physics.neutronics.fissionProductModel.lumpedFissionProduct.LumpedFissionProduct : LFP object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lfps</span> <span class="o">=</span> <span class="n">ArmiObject</span><span class="o">.</span><span class="n">getLumpedFissionProductCollection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lfps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
                <span class="n">lfps</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getLumpedFissionProductCollection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">lfps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">lfps</span></div>

<div class="viewcode-block" id="Composite.requiresLumpedFissionProducts"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.requiresLumpedFissionProducts">[docs]</a>    <span class="k">def</span> <span class="nf">requiresLumpedFissionProducts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclides</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;True if any of the nuclides in this object are Lumped nuclides.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nuclides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nuclides</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">nuclides</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nuclideBases</span><span class="o">.</span><span class="n">byName</span><span class="p">[</span><span class="n">nucName</span><span class="p">],</span> <span class="n">nuclideBases</span><span class="o">.</span><span class="n">LumpNuclideBase</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Composite.getIntegratedMgFlux"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getIntegratedMgFlux">[docs]</a>    <span class="k">def</span> <span class="nf">getIntegratedMgFlux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the multigroup neutron tracklength in [n-cm/s].</span>

<span class="sd">        The first entry is the first energy group (fastest neutrons). Each additional</span>
<span class="sd">        group is the next energy group, as set in the ISOTXS library.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        adjoint : bool, optional</span>
<span class="sd">            Return adjoint flux instead of real</span>

<span class="sd">        gamma : bool, optional</span>
<span class="sd">            Whether to return the neutron flux or the gamma flux.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        integratedFlux : numpy.array</span>
<span class="sd">            multigroup neutron tracklength in [n-cm/s]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">integratedMgFlux</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">integratedMgFlux</span> <span class="o">=</span> <span class="n">integratedMgFlux</span> <span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="n">getIntegratedMgFlux</span><span class="p">(</span>
                <span class="n">adjoint</span><span class="o">=</span><span class="n">adjoint</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">integratedMgFlux</span></div>

<div class="viewcode-block" id="Composite.getReactionRates"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getReactionRates">[docs]</a>    <span class="k">def</span> <span class="nf">getReactionRates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">nDensity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the reaction rates of a certain nuclide on this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucName - str</span>
<span class="sd">            nuclide name -- e.g. &#39;U235&#39;</span>
<span class="sd">        nDensity - float</span>
<span class="sd">            number Density</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rxnRates : dict</span>
<span class="sd">            reaction rates (1/s) for nG, nF, n2n, nA and nP</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is volume integrated NOT (1/cm3-s)</span>

<span class="sd">        If you set nDensity to 1 this makes 1-group cross section generation easier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rxnRates</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;nG&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nF&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n2n&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n3n&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">armiObject</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rxName</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">armiObject</span><span class="o">.</span><span class="n">getReactionRates</span><span class="p">(</span>
                <span class="n">nucName</span><span class="p">,</span> <span class="n">nDensity</span><span class="o">=</span><span class="n">nDensity</span>
            <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">rxnRates</span><span class="p">[</span><span class="n">rxName</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">rxnRates</span></div>

<div class="viewcode-block" id="Composite.printContents"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.printContents">[docs]</a>    <span class="k">def</span> <span class="nf">printContents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">includeNuclides</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display information about all the comprising children in this object.&quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getChildren</span><span class="p">():</span>
            <span class="n">c</span><span class="o">.</span><span class="n">printContents</span><span class="p">(</span><span class="n">includeNuclides</span><span class="o">=</span><span class="n">includeNuclides</span><span class="p">)</span></div>

<div class="viewcode-block" id="Composite.isOnWhichSymmetryLine"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.isOnWhichSymmetryLine">[docs]</a>    <span class="k">def</span> <span class="nf">isOnWhichSymmetryLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">spatialGrid</span>
        <span class="k">return</span> <span class="n">grid</span><span class="o">.</span><span class="n">overlapsWhichSymmetryLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_genChildByLocationLookupTable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the childByLocation lookup table.&quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="s2">&quot;Generating location-to-child lookup table.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">childrenByLocator</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">childrenByLocator</span><span class="p">[</span><span class="n">child</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">]</span> <span class="o">=</span> <span class="n">child</span>

<div class="viewcode-block" id="Composite.getBoundingCircleOuterDiameter"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Composite.getBoundingCircleOuterDiameter">[docs]</a>    <span class="k">def</span> <span class="nf">getBoundingCircleOuterDiameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sum circle bound.</span>

<span class="sd">        Used to roughly approximate relative size vs. other objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">comp</span><span class="o">.</span><span class="n">getBoundingCircleOuterDiameter</span><span class="p">(</span><span class="n">Tc</span><span class="p">,</span> <span class="n">cold</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="Leaf"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Leaf">[docs]</a><span class="k">class</span> <span class="nc">Leaf</span><span class="p">(</span><span class="n">Composite</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Defines behavior for primitive objects in the composition.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Leaf.getChildren"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Leaf.getChildren">[docs]</a>    <span class="k">def</span> <span class="nf">getChildren</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">deep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">generationNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return empty list, representing that this object has no children.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Leaf.getChildrenWithFlags"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.Leaf.getChildrenWithFlags">[docs]</a>    <span class="k">def</span> <span class="nf">getChildrenWithFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span><span class="p">,</span> <span class="n">exactMatch</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return empty list, representing that this object has no children.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div></div>


<div class="viewcode-block" id="StateRetainer"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.StateRetainer">[docs]</a><span class="k">class</span> <span class="nc">StateRetainer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retains state during some operations.</span>

<span class="sd">    This can be used to temporarily cache state, perform an operation, extract some info, and</span>
<span class="sd">    then revert back to the original state.</span>

<span class="sd">    * A state retainer is faster than restoring state from a database as it reduces</span>
<span class="sd">      the number of IO reads; however, it does use more memory.</span>

<span class="sd">    * This can be used on any object within the composite pattern via with</span>
<span class="sd">      ``[rabc].retainState([list], [of], [parameters], [to], [retain]):``.</span>
<span class="sd">      Use on an object up in the hierarchy applies to all objects below as well.</span>

<span class="sd">    * This is intended to work across MPI, so that if you were to broadcast the</span>
<span class="sd">      reactor the state would be correct; however the exact implication on</span>
<span class="sd">      ``parameters`` may be unclear.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">composite</span><span class="p">,</span> <span class="n">paramsToApply</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an instance of a StateRetainer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        composite: Composite</span>
<span class="sd">            composite object to retain state (recursively)</span>

<span class="sd">        paramsToApply: iterable of parameters.Parameter</span>
<span class="sd">            Iterable of parameters.Parameter to retain updated values after `__exit__`.</span>
<span class="sd">            All other parameters are reverted to the original state, i.e. retained at</span>
<span class="sd">            the original value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">composite</span> <span class="o">=</span> <span class="n">composite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paramsToApply</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">paramsToApply</span> <span class="ow">or</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enterExitHelper</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">backUp</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enterExitHelper</span><span class="p">(</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span> <span class="n">obj</span><span class="o">.</span><span class="n">restoreBackup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paramsToApply</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_enterExitHelper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper method for __enter__ and __exit__. func is a lambda to either backUp() or restoreBackup()&quot;&quot;&quot;</span>
        <span class="n">paramDefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">composite</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">composite</span><span class="o">.</span><span class="n">getChildren</span><span class="p">(</span>
            <span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">includeMaterials</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">):</span>
            <span class="n">paramDefs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">paramDefs</span><span class="p">)</span>
            <span class="n">func</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">paramDef</span> <span class="ow">in</span> <span class="n">paramDefs</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="n">paramDef</span><span class="p">)</span></div>


<div class="viewcode-block" id="gatherMaterialsByVolume"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.gatherMaterialsByVolume">[docs]</a><span class="k">def</span> <span class="nf">gatherMaterialsByVolume</span><span class="p">(</span>
    <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ArmiObject</span><span class="p">],</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the total volume of each material in a set of objects and give samples.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    objects : list of ArmiObject</span>
<span class="sd">        Objects to look within. This argument allows clients to search though some subset</span>
<span class="sd">        of the three (e.g. when you&#39;re looking for all CLADDING components within FUEL blocks)</span>

<span class="sd">    typeSpec : TypeSpec</span>
<span class="sd">        Flags for the components to look at</span>

<span class="sd">    exact : bool</span>
<span class="sd">        Whether or not the TypeSpec is exact</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This helper method is outside the main ArmiObject tree for the special clients that need</span>
<span class="sd">    to filter both by container type (e.g. Block type) with one set of flags, and Components</span>
<span class="sd">    with another set of flags.</span>

<span class="sd">    .. warning:: This is a **composition** related helper method that will likely be filed into</span>
<span class="sd">        classes/modules that deal specifically with the composition of things in the data model.</span>
<span class="sd">        Thus clients that use it from here should expect to need updates soon.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">volumes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">):</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="n">matName</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
            <span class="n">volumes</span><span class="p">[</span><span class="n">matName</span><span class="p">]</span> <span class="o">=</span> <span class="n">volumes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">matName</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">vol</span>
            <span class="k">if</span> <span class="n">matName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">matName</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">material</span>
    <span class="k">return</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">samples</span></div>


<div class="viewcode-block" id="getDominantMaterial"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.composites.html#armi.reactor.composites.getDominantMaterial">[docs]</a><span class="k">def</span> <span class="nf">getDominantMaterial</span><span class="p">(</span>
    <span class="n">objects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ArmiObject</span><span class="p">],</span> <span class="n">typeSpec</span><span class="p">:</span> <span class="n">TypeSpec</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the first sample of the most dominant material (by volume) in a set of objects</span>

<span class="sd">    .. warning:: This is a **composition** related helper method that will likely be filed into</span>
<span class="sd">        classes/modules that deal specifically with the composition of things in the data model.</span>
<span class="sd">        Thus clients that use it from here should expect to need updates soon.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">volumes</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="n">gatherMaterialsByVolume</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">typeSpec</span><span class="p">,</span> <span class="n">exact</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">volumes</span><span class="p">:</span>
        <span class="c1"># find matName with max volume</span>
        <span class="n">maxMatName</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">volumes</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># return this material. Note that if this material</span>
        <span class="c1"># has properties like Zr-frac, enrichment, etc. then this will</span>
        <span class="c1"># just return one in the batch, not an average.</span>
        <span class="k">return</span> <span class="n">samples</span><span class="p">[</span><span class="n">maxMatName</span><span class="p">]</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2022, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2022-07-21.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>