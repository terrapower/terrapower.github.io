<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.reactor.systemLayoutInput &mdash; ARMI 0.3.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme_fixes.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../reactor.html">armi.reactor</a></li>
      <li class="breadcrumb-item active">armi.reactor.systemLayoutInput</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.reactor.systemLayoutInput</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The legacy SystemLayoutInput class and supporting code.</span>

<span class="sd">This module contains the soon-to-be defunct ``SystemLayoutInput`` class, which used to</span>
<span class="sd">be used for specifying assembly locations in the core. This has been replaced by the</span>
<span class="sd">``systems:`` and ``grids:`` sections of ``Blueprints``, but still exists to facilitate</span>
<span class="sd">input migrations.</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">reactor.blueprints.reactorBlueprint</span>
<span class="sd">reactor.blueprints.gridBlueprint</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>

<span class="kn">from</span> <span class="nn">ruamel.yaml</span> <span class="kn">import</span> <span class="n">YAML</span>
<span class="kn">import</span> <span class="nn">voluptuous</span> <span class="k">as</span> <span class="nn">vol</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">grids</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">asciimaps</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">directoryChangers</span>

<span class="n">INP_SYSTEMS</span> <span class="o">=</span> <span class="s2">&quot;reactor&quot;</span>
<span class="n">INP_SYMMETRY</span> <span class="o">=</span> <span class="s2">&quot;symmetry&quot;</span>
<span class="n">INP_GEOM</span> <span class="o">=</span> <span class="s2">&quot;geom&quot;</span>
<span class="n">INP_DISCRETES</span> <span class="o">=</span> <span class="s2">&quot;discretes&quot;</span>
<span class="n">INP_LATTICE</span> <span class="o">=</span> <span class="s2">&quot;lattice&quot;</span>
<span class="n">INP_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;location&quot;</span>
<span class="n">INP_SPEC</span> <span class="o">=</span> <span class="s2">&quot;spec&quot;</span>
<span class="n">INP_FUEL_PATH</span> <span class="o">=</span> <span class="s2">&quot;eqPathIndex&quot;</span>
<span class="n">INP_FUEL_CYCLE</span> <span class="o">=</span> <span class="s2">&quot;eqPathCycle&quot;</span>

<span class="n">LOC_CARTESIAN</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;xi&quot;</span><span class="p">,</span> <span class="s2">&quot;yi&quot;</span><span class="p">)</span>
<span class="n">LOC_HEX</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;ring&quot;</span><span class="p">,</span> <span class="s2">&quot;pos&quot;</span><span class="p">)</span>
<span class="n">LOC_RZ</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;rad1&quot;</span><span class="p">,</span> <span class="s2">&quot;rad2&quot;</span><span class="p">,</span> <span class="s2">&quot;theta1&quot;</span><span class="p">,</span> <span class="s2">&quot;theta2&quot;</span><span class="p">)</span>
<span class="n">MESH_RZ</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;azimuthalMesh&quot;</span><span class="p">,</span> <span class="s2">&quot;radialMesh&quot;</span><span class="p">)</span>

<span class="n">LOC_KEYS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">:</span> <span class="n">LOC_CARTESIAN</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span> <span class="n">LOC_HEX</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">RZ</span><span class="p">:</span> <span class="n">LOC_RZ</span> <span class="o">+</span> <span class="n">MESH_RZ</span><span class="p">,</span>
    <span class="n">geometry</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span> <span class="n">LOC_RZ</span> <span class="o">+</span> <span class="n">MESH_RZ</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">DISCRETE_SCHEMA</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">{</span>
            <span class="n">INP_LOCATION</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="n">vol</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">LOC_CARTESIAN</span> <span class="o">+</span> <span class="n">LOC_HEX</span> <span class="o">+</span> <span class="n">LOC_RZ</span> <span class="o">+</span> <span class="n">MESH_RZ</span><span class="p">):</span> <span class="n">vol</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span>
                        <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">),</span>
            <span class="n">INP_SPEC</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">vol</span><span class="o">.</span><span class="n">Inclusive</span><span class="p">(</span><span class="n">INP_FUEL_PATH</span><span class="p">,</span> <span class="s2">&quot;eq shuffling&quot;</span><span class="p">):</span> <span class="nb">int</span><span class="p">,</span>
            <span class="n">vol</span><span class="o">.</span><span class="n">Inclusive</span><span class="p">(</span><span class="n">INP_FUEL_CYCLE</span><span class="p">,</span> <span class="s2">&quot;eq shuffling&quot;</span><span class="p">):</span> <span class="nb">int</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">INPUT_SCHEMA</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="n">INP_SYSTEMS</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="nb">str</span><span class="p">:</span> <span class="n">vol</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="n">vol</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span><span class="n">INP_GEOM</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">HEX</span><span class="p">):</span> <span class="n">vol</span><span class="o">.</span><span class="n">In</span><span class="p">(</span>
                            <span class="n">geometry</span><span class="o">.</span><span class="n">VALID_GEOMETRY_TYPE</span>
                        <span class="p">),</span>
                        <span class="n">vol</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span>
                            <span class="n">INP_SYMMETRY</span><span class="p">,</span>
                            <span class="n">default</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">THIRD_CORE</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">geometry</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">,</span>
                        <span class="p">):</span> <span class="n">vol</span><span class="o">.</span><span class="n">In</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="o">.</span><span class="n">createValidSymmetryStrings</span><span class="p">()),</span>
                        <span class="n">vol</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span><span class="n">INP_DISCRETES</span><span class="p">):</span> <span class="n">DISCRETE_SCHEMA</span><span class="p">,</span>
                        <span class="n">vol</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span><span class="n">INP_LATTICE</span><span class="p">):</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>


<div class="viewcode-block" id="SystemLayoutInput"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput">[docs]</a><span class="k">class</span> <span class="nc">SystemLayoutInput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Geometry file. Contains 2-D mapping of geometry.</span>

<span class="sd">    This approach to specifying core layout has been deprecated in favor of the</span>
<span class="sd">    :py:class:`armi.reactor.blueprints.gridBlueprints.GridBlueprints` and ``systems:``</span>
<span class="sd">    section of :py:class:`armi.reactor.blueprints.Blueprints`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_GEOM_FILE_EXTENSION</span> <span class="o">=</span> <span class="s2">&quot;.xml&quot;</span>
    <span class="n">ROOT_TAG</span> <span class="o">=</span> <span class="n">INP_SYSTEMS</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiedFileName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">:</span> <span class="nb">str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqPathsHaveBeenModified</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Geometry file </span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fName</span><span class="p">)</span>

<div class="viewcode-block" id="SystemLayoutInput.readGeomFromFile"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.readGeomFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">readGeomFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the 2-d geometry input file.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        fromReactor : Build SystemLayoutInput from a Reactor object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expandvars</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fName</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readGeomFromStream</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="SystemLayoutInput.readGeomFromStream"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.readGeomFromStream">[docs]</a>    <span class="k">def</span> <span class="nf">readGeomFromStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read geometry info from a stream.</span>

<span class="sd">        This populates the object with info from any source.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        There are two formats of geometry: yaml and xml. This tries</span>
<span class="sd">        xml first (legacy), and if it fails it tries yaml.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Warn the user that this feature is schedule for deletion.</span>
        <span class="n">warn</span> <span class="o">=</span> <span class="s2">&quot;XML Geom Files are scheduled to be removed from ARMI, please use blueprint files.&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="n">warn</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readXml</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ET</span><span class="o">.</span><span class="n">ParseError</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readYaml</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span></div>

<div class="viewcode-block" id="SystemLayoutInput.toGridBlueprints"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.toGridBlueprints">[docs]</a>    <span class="k">def</span> <span class="nf">toGridBlueprints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;core&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Migrate old-style SystemLayoutInput to new GridBlueprint.</span>

<span class="sd">        Returns a list of GridBlueprint objects. There will at least be one entry,</span>
<span class="sd">        containing the main core layout. If equilibrium fuel paths are specified, it</span>
<span class="sd">        will occupy the second element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: After moving SystemLayoutInput out of geometry.py, we may be able to</span>
        <span class="c1"># move this back out to top-level without causing blueprint import order issues.</span>
        <span class="kn">from</span> <span class="nn">armi.reactor.blueprints.gridBlueprint</span> <span class="kn">import</span> <span class="n">GridBlueprint</span>

        <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span>
        <span class="n">symmetry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span>
            <span class="c1"># We need a grid in order to go from whats in the input to indices, and to</span>
            <span class="c1"># be able to provide grid bounds to the blueprint.</span>
            <span class="n">rztGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">ThetaRZGrid</span><span class="o">.</span><span class="n">fromGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rztGrid</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;theta&quot;</span><span class="p">:</span> <span class="n">theta</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>

        <span class="n">gridContents</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">indices</span><span class="p">,</span> <span class="n">spec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="o">*</span><span class="n">indices</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rztGrid</span><span class="o">.</span><span class="n">indicesOfBounds</span><span class="p">(</span><span class="o">*</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
            <span class="n">gridContents</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="o">=</span> <span class="n">spec</span>

        <span class="n">bp</span> <span class="o">=</span> <span class="n">GridBlueprint</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">gridContents</span><span class="o">=</span><span class="n">gridContents</span><span class="p">,</span>
            <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span>
            <span class="n">gridBounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">bps</span> <span class="o">=</span> <span class="p">[</span><span class="n">bp</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="c1"># We could probably just copy eqPathInput, but we don&#39;t want to preserve</span>
            <span class="c1"># (None, None) entries.</span>
            <span class="n">eqPathContents</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">eqPath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">eqPath</span> <span class="o">==</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="o">*</span><span class="n">idx</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rztGrid</span><span class="o">.</span><span class="n">indicesOfBounds</span><span class="p">(</span><span class="o">*</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span>
                <span class="n">eqPathContents</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

            <span class="n">pathBp</span> <span class="o">=</span> <span class="n">GridBlueprint</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;EqPath&quot;</span><span class="p">,</span>
                <span class="n">gridContents</span><span class="o">=</span><span class="n">eqPathContents</span><span class="p">,</span>
                <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span>
                <span class="n">symmetry</span><span class="o">=</span><span class="n">symmetry</span><span class="p">,</span>
                <span class="n">gridBounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">bps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pathBp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bps</span></div>

    <span class="k">def</span> <span class="nf">_readXml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getGeomTypeAndSymmetryFromXml</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">assemblyNode</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="n">aType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
            <span class="n">eqPathIndex</span><span class="p">,</span> <span class="n">eqPathCycle</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">LOC_CARTESIAN</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">LOC_RZ</span>
                <span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">MESH_RZ</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># assume hex geom.</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="n">ring</span><span class="p">,</span> <span class="n">_pos</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">LOC_HEX</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">INP_FUEL_PATH</span> <span class="ow">in</span> <span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
                    <span class="c1"># equilibrium geometry info.</span>
                    <span class="n">eqPathIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">INP_FUEL_PATH</span><span class="p">])</span>
                    <span class="n">eqPathCycle</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">assemblyNode</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">INP_FUEL_CYCLE</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">aType</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">eqPathIndex</span><span class="p">,</span> <span class="n">eqPathCycle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_readYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read geometry from yaml.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is intended to replace the XML format as we converge on</span>
<span class="sd">        consistent inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">allow_duplicate_keys</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">INPUT_SCHEMA</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_systemName</span><span class="p">,</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">INP_SYSTEMS</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># no need to check for valid since the schema handled that.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">fromStr</span><span class="p">(</span><span class="n">system</span><span class="p">[</span><span class="n">INP_GEOM</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="o">.</span><span class="n">fromStr</span><span class="p">(</span><span class="n">system</span><span class="p">[</span><span class="n">INP_SYMMETRY</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">INP_DISCRETES</span> <span class="ow">in</span> <span class="n">system</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_read_yaml_discretes</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">INP_LATTICE</span> <span class="ow">in</span> <span class="n">system</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_read_yaml_lattice</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_yaml_discretes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">discrete</span> <span class="ow">in</span> <span class="n">system</span><span class="p">[</span><span class="n">INP_DISCRETES</span><span class="p">]:</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">discrete</span><span class="p">[</span><span class="n">INP_LOCATION</span><span class="p">]</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">LOC_KEYS</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">)])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">RZT</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># assume hex geom.</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">indices</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">discrete</span><span class="p">[</span><span class="n">INP_SPEC</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">discrete</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">INP_FUEL_CYCLE</span><span class="p">),</span>
                <span class="n">discrete</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">INP_FUEL_PATH</span><span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_yaml_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a ascii map string into this object.&quot;&quot;&quot;</span>
        <span class="n">mapTxt</span> <span class="o">=</span> <span class="n">system</span><span class="p">[</span><span class="n">INP_LATTICE</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span>
        <span class="p">):</span>
            <span class="n">asciimap</span> <span class="o">=</span> <span class="n">asciimaps</span><span class="o">.</span><span class="n">AsciiMapHexThirdFlatsUp</span><span class="p">()</span>
            <span class="n">asciimap</span><span class="o">.</span><span class="n">readAscii</span><span class="p">(</span><span class="n">mapTxt</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">spec</span> <span class="ow">in</span> <span class="n">asciimap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">spec</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                    <span class="c1"># skip whitespace placeholders</span>
                    <span class="k">continue</span>
                <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">indicesToRingPos</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)]</span> <span class="o">=</span> <span class="n">spec</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ASCII map reading from geom/domain: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="si">}</span><span class="s2">/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">domain</span><span class="si">}</span><span class="s2"> not supported.&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="SystemLayoutInput.modifyEqPaths"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.modifyEqPaths">[docs]</a>    <span class="k">def</span> <span class="nf">modifyEqPaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifiedPaths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the geometry object by updating the equilibrium path indices and equilibrium path cycles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        modifiedPaths : dict, required</span>
<span class="sd">            This is a dictionary that contains the indices that are mapped to the</span>
<span class="sd">            eqPathIndex and eqPathCycle.  modifiedPath[indices] = (eqPathIndex,</span>
<span class="sd">            eqPathCycle)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="s2">&quot;Modifying the equilibrium paths on </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqPathsHaveBeenModified</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">modifiedPaths</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getModifiedFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">originalFileName</span><span class="p">,</span> <span class="n">suffix</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates the modified geometry file name based on the requested suffix.&quot;&quot;&quot;</span>
        <span class="n">originalFileName</span> <span class="o">=</span> <span class="n">originalFileName</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOM_FILE_EXTENSION</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_GEOM_FILE_EXTENSION</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifiedFileName</span> <span class="o">=</span> <span class="n">originalFileName</span> <span class="o">+</span> <span class="n">suffix</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GEOM_FILE_EXTENSION</span>

<div class="viewcode-block" id="SystemLayoutInput.writeGeom"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.writeGeom">[docs]</a>    <span class="k">def</span> <span class="nf">writeGeom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputFileName</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write data out as a geometry xml file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        outputFileName : str</span>
<span class="sd">            Geometry file name</span>

<span class="sd">        suffix : str</span>
<span class="sd">            Added suffix to the geometry output file name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">suffix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getModifiedFileName</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>
            <span class="n">outputFileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifiedFileName</span>

        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="s2">&quot;Writing reactor geometry file as </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">))</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span>
            <span class="n">INP_SYSTEMS</span><span class="p">,</span>
            <span class="n">attrib</span><span class="o">=</span><span class="p">{</span>
                <span class="n">INP_GEOM</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">),</span>
                <span class="n">INP_SYMMETRY</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="c1"># start at ring 1 pos 1 and go out</span>
        <span class="k">for</span> <span class="n">targetIndices</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">)):</span>
            <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">targetIndices</span>
            <span class="n">assembly</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;assembly&quot;</span><span class="p">)</span>
            <span class="n">assembly</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;ring&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ring</span><span class="p">))</span>
            <span class="n">assembly</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;pos&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
            <span class="n">fuelPath</span><span class="p">,</span> <span class="n">fuelCycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fuelPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># set the equilibrium shuffling info if it exists</span>
                <span class="n">assembly</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">INP_FUEL_PATH</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fuelPath</span><span class="p">))</span>
                <span class="n">assembly</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">INP_FUEL_CYCLE</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">fuelCycle</span><span class="p">))</span>

            <span class="n">aType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">targetIndices</span><span class="p">]</span>
            <span class="n">assembly</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">aType</span><span class="p">)</span>
        <span class="c1"># note: This is ugly and one-line, but that&#39;s ok</span>
        <span class="c1"># since we&#39;re transitioning.</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">outputFileName</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_writeYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">sysName</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the system layout in YAML format.</span>

<span class="sd">        These can eventually either define a type/specifier mapping and then point</span>
<span class="sd">        to a grid definition full of specifiers to be populated, or</span>
<span class="sd">        they can just be a list of &quot;singles&quot; which define indices:specifier.</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        So far, only singles are implemented (analogous to old XML format)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geomData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">)):</span>
            <span class="n">specifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">fuelPath</span><span class="p">,</span> <span class="n">fuelCycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqPathInput</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">LOC_KEYS</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">)]</span>
            <span class="n">dataPoint</span> <span class="o">=</span> <span class="p">{</span><span class="n">INP_LOCATION</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">indices</span><span class="p">)),</span> <span class="n">INP_SPEC</span><span class="p">:</span> <span class="n">specifier</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">fuelPath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dataPoint</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">INP_FUEL_PATH</span><span class="p">:</span> <span class="n">fuelPath</span><span class="p">,</span> <span class="n">INP_FUEL_CYCLE</span><span class="p">:</span> <span class="n">fuelCycle</span><span class="p">})</span>
            <span class="n">geomData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataPoint</span><span class="p">)</span>

        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">default_flow_style</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fullData</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">INP_SYSTEMS</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">sysName</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">INP_GEOM</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">),</span>
                    <span class="n">INP_SYMMETRY</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">),</span>
                    <span class="n">INP_DISCRETES</span><span class="p">:</span> <span class="n">geomData</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">fullData</span> <span class="o">=</span> <span class="n">INPUT_SCHEMA</span><span class="p">(</span><span class="n">fullData</span><span class="p">)</span>  <span class="c1"># validate on the way out</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fullData</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_writeAsciiMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an ASCII map representation.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        This only works for HexGrid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lattice</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">)):</span>
            <span class="n">specifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)]</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="n">lattice</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">specifier</span>

        <span class="n">geomMap</span> <span class="o">=</span> <span class="n">asciimaps</span><span class="o">.</span><span class="n">AsciiMapHexThirdFlatsUp</span><span class="p">()</span>
        <span class="n">geomMap</span><span class="o">.</span><span class="n">asciiLabelByIndices</span> <span class="o">=</span> <span class="n">lattice</span>
        <span class="n">geomMap</span><span class="o">.</span><span class="n">gridContentsToAscii</span><span class="p">()</span>
        <span class="n">geomMap</span><span class="o">.</span><span class="n">writeAscii</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

<div class="viewcode-block" id="SystemLayoutInput.growToFullCore"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.growToFullCore">[docs]</a>    <span class="k">def</span> <span class="nf">growToFullCore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert geometry input to full core.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This only works for Hex 1/3rd core geometry inputs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">domain</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">FULL_CORE</span><span class="p">:</span>
            <span class="c1"># already full core from geometry file. No need to copy symmetry over.</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span>
                <span class="s2">&quot;Detected that full core geometry already exists. Cannot expand.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">domain</span> <span class="o">!=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">boundary</span> <span class="o">!=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot convert shape `</span><span class="si">{}</span><span class="s2">` to full core, must be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                            <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span><span class="p">,</span>
                            <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">_symmetry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span>

        <span class="c1"># need to cast to a list because we will modify during iteration</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span> <span class="n">specifierID</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">symmetricI</span><span class="p">,</span> <span class="n">symmetricJ</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
                <span class="n">symmetricRingPos</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">indicesToRingPos</span><span class="p">(</span>
                    <span class="n">symmetricI</span><span class="p">,</span> <span class="n">symmetricJ</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">symmetricRingPos</span><span class="p">]</span> <span class="o">=</span> <span class="n">specifierID</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">FULL_CORE</span><span class="p">,</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">NO_SYMMETRY</span><span class="p">,</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getGeomTypeAndSymmetryFromXml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read the geometry type and symmetry.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">fromStr</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">INP_GEOM</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># will not execute if the geom was specified as thetarz, cartesian or anything else specific</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not find geometry type. Assuming hex geometry with third core periodic symmetry.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span><span class="p">,</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">inputString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">INP_SYMMETRY</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="o">.</span><span class="n">fromStr</span><span class="p">(</span><span class="n">inputString</span><span class="p">)</span>

<div class="viewcode-block" id="SystemLayoutInput.fromReactor"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.fromReactor">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromReactor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">reactor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build SystemLayoutInput object based on the current state of a Reactor.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        readGeomFromFile : Builds a SystemLayoutInput from an XML file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reading core map from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reactor</span><span class="p">))</span>
        <span class="n">geom</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">reactor</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">geomType</span><span class="p">)</span>
        <span class="n">geom</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">symmetry</span>

        <span class="n">bp</span> <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">blueprints</span>
        <span class="n">assemDesigns</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">assemDesigns</span> <span class="k">if</span> <span class="n">bp</span> <span class="k">else</span> <span class="p">()</span>

        <span class="k">for</span> <span class="n">assembly</span> <span class="ow">in</span> <span class="n">reactor</span><span class="o">.</span><span class="n">core</span><span class="p">:</span>
            <span class="n">aType</span> <span class="o">=</span> <span class="n">assembly</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">aType</span> <span class="ow">in</span> <span class="n">assemDesigns</span><span class="p">:</span>
                <span class="n">aType</span> <span class="o">=</span> <span class="n">assemDesigns</span><span class="p">[</span><span class="n">aType</span><span class="p">]</span><span class="o">.</span><span class="n">specifier</span>

            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span> <span class="o">=</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">reactor</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span>
                <span class="n">assembly</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">geom</span><span class="o">.</span><span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">geom</span><span class="o">.</span><span class="n">maxRings</span><span class="p">)</span>

            <span class="n">geom</span><span class="o">.</span><span class="n">assemTypeByIndices</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">aType</span>

        <span class="k">return</span> <span class="n">geom</span></div>

<div class="viewcode-block" id="SystemLayoutInput.loadFromCs"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.systemLayoutInput.html#armi.reactor.systemLayoutInput.SystemLayoutInput.loadFromCs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">loadFromCs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function to load Geoemtry based on supplied ``Settings``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cs</span><span class="p">[</span><span class="s2">&quot;geomFile&quot;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">directoryChangers</span><span class="o">.</span><span class="n">DirectoryChanger</span><span class="p">(</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">):</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
            <span class="n">geom</span><span class="o">.</span><span class="n">readGeomFromFile</span><span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;geomFile&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">geom</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2024, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2024-03-19.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>