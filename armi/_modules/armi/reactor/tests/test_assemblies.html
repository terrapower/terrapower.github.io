<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.reactor.tests.test_assemblies &mdash; ARMI 0.2.8 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme_fixes.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/assets/jsonview.bundle.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinx-needs/libs/html/datatables.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinx-needs/common.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinx-needs/layouts.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinx-needs/styles.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinx-needs/modern.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/armiicon_16x16.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../../../_static/assets/jsonview_loader.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.2.8
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../../reactor.html">armi.reactor</a></li>
      <li class="breadcrumb-item active">armi.reactor.tests.test_assemblies</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.reactor.tests.test_assemblies</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Tests assemblies.py.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_allclose</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">tests</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">assemblies</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">blueprints</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">components</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">parameters</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">reactors</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">armi.reactor.assemblies</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">blocks</span><span class="p">,</span>
    <span class="n">copy</span><span class="p">,</span>
    <span class="n">Flags</span><span class="p">,</span>
    <span class="n">grids</span><span class="p">,</span>
    <span class="n">HexAssembly</span><span class="p">,</span>
    <span class="n">math</span><span class="p">,</span>
    <span class="n">numpy</span><span class="p">,</span>
    <span class="n">runLog</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">armi.tests</span> <span class="kn">import</span> <span class="n">TEST_ROOT</span><span class="p">,</span> <span class="n">mockRunLogs</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">directoryChangers</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">textProcessors</span>
<span class="kn">from</span> <span class="nn">armi.reactor.tests</span> <span class="kn">import</span> <span class="n">test_reactors</span>
<span class="kn">from</span> <span class="nn">armi.reactor.assemblies</span> <span class="kn">import</span> <span class="n">getAssemNum</span>
<span class="kn">from</span> <span class="nn">armi.reactor.assemblies</span> <span class="kn">import</span> <span class="n">resetAssemNumCounter</span>
<span class="kn">from</span> <span class="nn">armi.physics.neutronics.settings</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONF_LOADING_FILE</span><span class="p">,</span>
    <span class="n">CONF_XS_KERNEL</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">NUM_BLOCKS</span> <span class="o">=</span> <span class="mi">3</span>


<div class="viewcode-block" id="buildTestAssemblies"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.buildTestAssemblies">[docs]</a><span class="k">def</span> <span class="nf">buildTestAssemblies</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build some assembly objects that will be used in testing.</span>

<span class="sd">    This builds 2 HexBlocks:</span>
<span class="sd">        * One with half UZr pins and half UTh pins</span>
<span class="sd">        * One with all UThZr pins</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">caseSetting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">setMasterCs</span><span class="p">(</span><span class="n">caseSetting</span><span class="p">)</span>

    <span class="n">temperature</span> <span class="o">=</span> <span class="mf">273.0</span>
    <span class="n">fuelID</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">fuelOD</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">cladOD</span> <span class="o">=</span> <span class="mf">1.1</span>
    <span class="c1"># generate a reactor with assemblies</span>
    <span class="c1"># generate components with materials</span>
    <span class="n">nPins</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="n">fuelOD</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">fuelID</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">nPins</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">fuelUZr</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>
    <span class="n">fuelUTh</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel UTh&quot;</span><span class="p">,</span> <span class="s2">&quot;ThU&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>

    <span class="n">fuelDims2nPins</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="n">fuelOD</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">fuelID</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nPins</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">fuelUThZr</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel B&quot;</span><span class="p">,</span> <span class="s2">&quot;UThZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims2nPins</span><span class="p">)</span>

    <span class="n">cladDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="n">cladOD</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">fuelOD</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nPins</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">clad</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">cladDims</span><span class="p">)</span>

    <span class="n">interDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">16.8</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">16.0</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">interSodium</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;interCoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">interDims</span><span class="p">)</span>

    <span class="n">block</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
    <span class="n">block2</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuelUZr</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuelUTh</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">interSodium</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">axMesh</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmNow</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">block2</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuelUThZr</span><span class="p">)</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">interSodium</span><span class="p">)</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">axMesh</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">block2</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmNow</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">assemblieObjs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">numBlocks</span><span class="p">,</span> <span class="n">blockTemplate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="n">block</span><span class="p">,</span> <span class="n">block2</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">block</span><span class="p">]):</span>
        <span class="n">assembly</span> <span class="o">=</span> <span class="n">assemblies</span><span class="o">.</span><span class="n">HexAssembly</span><span class="p">(</span><span class="s2">&quot;testAssemblyType&quot;</span><span class="p">)</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">axialUnitGrid</span><span class="p">(</span><span class="n">numBlocks</span><span class="p">)</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">armiObject</span> <span class="o">=</span> <span class="n">assembly</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numBlocks</span><span class="p">):</span>
            <span class="n">newBlock</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">blockTemplate</span><span class="p">)</span>
            <span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newBlock</span><span class="p">)</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">calculateZCoords</span><span class="p">()</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">reestablishBlockOrder</span><span class="p">()</span>
        <span class="n">assemblieObjs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">assemblieObjs</span></div>


<div class="viewcode-block" id="MaterialInAssembly_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.MaterialInAssembly_TestCase">[docs]</a><span class="k">class</span> <span class="nc">MaterialInAssembly_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly3</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly4</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">buildTestAssemblies</span><span class="p">()</span>

<div class="viewcode-block" id="MaterialInAssembly_TestCase.test_sortNoLocator"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.MaterialInAssembly_TestCase.test_sortNoLocator">[docs]</a>    <span class="k">def</span> <span class="nf">test_sortNoLocator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span></div>

<div class="viewcode-block" id="MaterialInAssembly_TestCase.test_UThZrMaterial"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.MaterialInAssembly_TestCase.test_UThZrMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">test_UThZrMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the ternary UThZr material.&quot;&quot;&quot;</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uThZrFuel</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">B</span><span class="p">)</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">uThZrFuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">applyInputParams</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">uThZrFuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">uThZrFuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">uThZrFuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)),</span>
            <span class="mf">0.1</span><span class="p">,</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="makeTestAssembly"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.makeTestAssembly">[docs]</a><span class="k">def</span> <span class="nf">makeTestAssembly</span><span class="p">(</span>
    <span class="n">numBlocks</span><span class="p">,</span> <span class="n">assemNum</span><span class="p">,</span> <span class="n">spatialGrid</span><span class="o">=</span><span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">r</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">coreGrid</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">spatialGrid</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">HexAssembly</span><span class="p">(</span><span class="s2">&quot;TestAssem&quot;</span><span class="p">,</span> <span class="n">assemNum</span><span class="o">=</span><span class="n">assemNum</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">axialUnitGrid</span><span class="p">(</span><span class="n">numBlocks</span><span class="p">)</span>
    <span class="n">a</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">armiObject</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">a</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">coreGrid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">a</span></div>


<div class="viewcode-block" id="Assembly_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase">[docs]</a><span class="k">class</span> <span class="nc">Assembly_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;A0015&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="c1"># Print nothing to the screen that would normally go to the log.</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">setVerbosity</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">getEmptyHexReactor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
            <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="n">NUM_BLOCKS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>

        <span class="c1"># Use these if they are needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockParams</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="s2">&quot;bondRemoved&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;buGroupNum&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;buLimit&quot;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
            <span class="s2">&quot;buRate&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;eqRegion&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">212.0</span><span class="p">,</span>
            <span class="s2">&quot;pdens&quot;</span><span class="p">:</span> <span class="mf">10.0</span><span class="p">,</span>
            <span class="s2">&quot;percentBu&quot;</span><span class="p">:</span> <span class="mf">25.3</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="mf">100000.0</span><span class="p">,</span>
            <span class="s2">&quot;residence&quot;</span><span class="p">:</span> <span class="mf">4.0</span><span class="p">,</span>
            <span class="s2">&quot;smearDensity&quot;</span><span class="p">:</span> <span class="mf">0.6996721711791459</span><span class="p">,</span>
            <span class="s2">&quot;timeToLimit&quot;</span><span class="p">:</span> <span class="mf">2.7e5</span><span class="p">,</span>
            <span class="s2">&quot;xsTypeNum&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
            <span class="s2">&quot;zbottom&quot;</span><span class="p">:</span> <span class="mf">97.3521</span><span class="p">,</span>
            <span class="s2">&quot;ztop&quot;</span><span class="p">:</span> <span class="mf">111.80279999999999</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blockSettings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;axMesh&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;bondBOL&quot;</span><span class="p">:</span> <span class="mf">0.0028698019026172574</span><span class="p">,</span>
            <span class="s2">&quot;buGroup&quot;</span><span class="p">:</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mf">14.4507</span><span class="p">,</span>
            <span class="s2">&quot;molesHmAtBOL&quot;</span><span class="p">:</span> <span class="mf">65.8572895758245</span><span class="p">,</span>
            <span class="s2">&quot;nHMAtBOL&quot;</span><span class="p">:</span> <span class="mf">0.011241485251783766</span><span class="p">,</span>
            <span class="s2">&quot;nPins&quot;</span><span class="p">:</span> <span class="mf">169.0</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;B0011F&quot;</span><span class="p">,</span>
            <span class="s2">&quot;newDPA&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;pitch&quot;</span><span class="p">:</span> <span class="mf">16.79</span><span class="p">,</span>
            <span class="s2">&quot;regName&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;topIndex&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s2">&quot;tsIndex&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;igniter fuel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;xsType&quot;</span><span class="p">:</span> <span class="s2">&quot;C&quot;</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mf">104.57745</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># add some blocks with a component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_BLOCKS</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">)</span>

            <span class="c1"># non-flaggy name important for testing</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;igniter fuel unitst&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">makeName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getNum</span><span class="p">(),</span> <span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">calculateZCoords</span><span class="p">()</span>

<div class="viewcode-block" id="Assembly_TestCase.test_notesParameter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_notesParameter">[docs]</a>    <span class="k">def</span> <span class="nf">test_notesParameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># try to assign a non-string</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">note</span> <span class="o">=</span> <span class="s2">&quot;This is a short, acceptable not about the assembly&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="n">note</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="n">note</span><span class="p">)</span>

        <span class="n">tooLongNote</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span> <span class="o">*</span> <span class="mi">1001</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span> <span class="o">=</span> <span class="n">tooLongNote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">notes</span><span class="p">,</span> <span class="n">tooLongNote</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">])</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_resetAssemNumCounter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_resetAssemNumCounter">[docs]</a>    <span class="k">def</span> <span class="nf">test_resetAssemNumCounter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resetAssemNumCounter</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">getAssemNum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_iter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_iter">[docs]</a>    <span class="k">def</span> <span class="nf">test_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_len"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_len">[docs]</a>    <span class="k">def</span> <span class="nf">test_len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_append"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_append">[docs]</a>    <span class="k">def</span> <span class="nf">test_append</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_extend"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_extend">[docs]</a>    <span class="k">def</span> <span class="nf">test_extend</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">blockList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">blockList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">blockList</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_add"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_add">[docs]</a>    <span class="k">def</span> <span class="nf">test_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_moveTo"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_moveTo">[docs]</a>    <span class="k">def</span> <span class="nf">test_moveTo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">getLocatorFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">locator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">moveTo</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatialLocator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getName"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getName">[docs]</a>    <span class="k">def</span> <span class="nf">test_getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getNum"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getNum">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getNum</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getLocation"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getLocation">[docs]</a>    <span class="k">def</span> <span class="nf">test_getLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getLocation</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;005-003&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getArea"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getArea">[docs]</a>    <span class="k">def</span> <span class="nf">test_getArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getVolume"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getVolume">[docs]</a>    <span class="k">def</span> <span class="nf">test_getVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">NUM_BLOCKS</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_doubleResolution"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_doubleResolution">[docs]</a>    <span class="k">def</span> <span class="nf">test_doubleResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">initialHeight</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">heightBOL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">doubleResolution</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">())</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">initialHeight</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">heightBOL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_adjustResolution"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_adjustResolution">[docs]</a>    <span class="k">def</span> <span class="nf">test_adjustResolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Make a second assembly with 4 times the resolution</span>
        <span class="n">assemNum2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">height2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">assembly2</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="n">assemNum2</span><span class="p">,</span> <span class="n">assemNum2</span><span class="p">)</span>

        <span class="c1"># add some blocks with a component</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">assemNum2</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">height2</span><span class="p">)</span>
            <span class="n">assembly2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">adjustResolution</span><span class="p">(</span><span class="n">assembly2</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">())</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getAxialMesh"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getAxialMesh">[docs]</a>    <span class="k">def</span> <span class="nf">test_getAxialMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getAxialMesh</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NUM_BLOCKS</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_calculateZCoords"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_calculateZCoords">[docs]</a>    <span class="k">def</span> <span class="nf">test_calculateZCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">calculateZCoords</span><span class="p">()</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>

            <span class="n">cur</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">z</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bottom</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

            <span class="n">cur</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">zbottom</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">bottom</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

            <span class="n">cur</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">ztop</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">top</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

            <span class="n">bottom</span> <span class="o">=</span> <span class="n">top</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getTotalHeight"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getTotalHeight">[docs]</a>    <span class="k">def</span> <span class="nf">test_getTotalHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getTotalHeight</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">NUM_BLOCKS</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getHeight"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getHeight">[docs]</a>    <span class="k">def</span> <span class="nf">test_getHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">NUM_BLOCKS</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getReactiveHeight"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getReactiveHeight">[docs]</a>    <span class="k">def</span> <span class="nf">test_getReactiveHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span><span class="o">.</span><span class="n">adjustMassEnrichment</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;PU239&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">bottomElevation</span><span class="p">,</span> <span class="n">reactiveHeight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getReactiveHeight</span><span class="p">(</span>
            <span class="n">enrichThresh</span><span class="o">=</span><span class="mf">0.02</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">bottomElevation</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">reactiveHeight</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getFissileMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getFissileMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFissileMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getFissileMass</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bi</span><span class="o">.</span><span class="n">getMass</span><span class="p">([</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="s2">&quot;PU239&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getPuFrac"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getPuFrac">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPuFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">puAssem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getPuFrac</span><span class="p">()</span>
        <span class="n">fuelBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">puBlock</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getPuFrac</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">puAssem</span><span class="p">,</span> <span class="n">puBlock</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="n">fuelComp</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">fuelComp</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;PU239&quot;</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getPuFrac</span><span class="p">(),</span> <span class="n">puAssem</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">getPuFrac</span><span class="p">(),</span> <span class="n">puAssem</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mass0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="n">mass1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">bi</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">bi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">mass0</span><span class="p">,</span> <span class="n">mass1</span><span class="p">)</span>

        <span class="n">fuelBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">blockU35Mass</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="n">fuelBlock</span><span class="o">.</span><span class="n">setMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">blockU35Mass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">fuelBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">),</span> <span class="n">blockU35Mass</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">),</span> <span class="n">mass0</span> <span class="o">+</span> <span class="n">blockU35Mass</span><span class="p">)</span>

        <span class="n">fuelBlock</span><span class="o">.</span><span class="n">setMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">blockU35Mass</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getZrFrac"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getZrFrac">[docs]</a>    <span class="k">def</span> <span class="nf">test_getZrFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getZrFrac</span><span class="p">(),</span> <span class="mf">0.1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getMaxUraniumMassEnrich"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getMaxUraniumMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMaxUraniumMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">baseEnrich</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getUraniumMassEnrich</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getMaxUraniumMassEnrich</span><span class="p">(),</span> <span class="n">baseEnrich</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="mf">2e-1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getMaxUraniumMassEnrich</span><span class="p">(),</span> <span class="n">baseEnrich</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getAge"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getAge">[docs]</a>    <span class="k">def</span> <span class="nf">test_getAge</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">residence</span> <span class="o">=</span> <span class="n">res</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getAge</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">res</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_makeAxialSnapList"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_makeAxialSnapList">[docs]</a>    <span class="k">def</span> <span class="nf">test_makeAxialSnapList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Make a second assembly with 4 times the resolution</span>
        <span class="n">assemNum2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">height2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">assembly2</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="n">assemNum2</span><span class="p">,</span> <span class="n">assemNum2</span><span class="p">)</span>

        <span class="c1"># add some blocks with a component</span>
        <span class="k">for</span> <span class="n">_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">assemNum2</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">h</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;igniter fuel&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">height2</span><span class="p">)</span>
            <span class="n">assembly2</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">makeAxialSnapList</span><span class="p">(</span><span class="n">assembly2</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">topIndex</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_snapAxialMeshToReference"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_snapAxialMeshToReference">[docs]</a>    <span class="k">def</span> <span class="nf">test_snapAxialMeshToReference</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">)):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">topIndex</span> <span class="o">=</span> <span class="n">i</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">ztop</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_updateFromAssembly"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_updateFromAssembly">[docs]</a>    <span class="k">def</span> <span class="nf">test_updateFromAssembly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assembly2</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;maxPercentBu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;numMoves&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;maxPercentBu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;timeToLimit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.7e5</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arealPd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">110.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;maxDpaPeak&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">14.0</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;kInf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">60.0</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">assembly2</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">updateParamsFrom</span><span class="p">(</span><span class="n">assembly2</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">param</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_setup_blueprints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;refSmallReactor.yaml&quot;</span><span class="p">):</span>
        <span class="c1"># need this for the getAllNuclides call</span>
        <span class="k">with</span> <span class="n">directoryChangers</span><span class="o">.</span><span class="n">DirectoryChanger</span><span class="p">(</span><span class="n">TEST_ROOT</span><span class="p">):</span>
            <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{</span><span class="n">CONF_LOADING_FILE</span><span class="p">:</span> <span class="n">filename</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">textProcessors</span><span class="o">.</span><span class="n">resolveMarkupInclusions</span><span class="p">(</span>
                    <span class="n">y</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">blueprints</span> <span class="o">=</span> <span class="n">blueprints</span><span class="o">.</span><span class="n">Blueprints</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">blueprints</span><span class="o">.</span><span class="n">_prepConstruction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>

<div class="viewcode-block" id="Assembly_TestCase.test_duplicate"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">test_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_blueprints</span><span class="p">()</span>

        <span class="c1"># Perform the copy</span>
        <span class="n">assembly2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">refBlock</span><span class="p">,</span> <span class="n">curBlock</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="n">assembly2</span><span class="p">):</span>
            <span class="n">numNucs</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getAncestorWithFlags</span><span class="p">(</span>
                <span class="n">Flags</span><span class="o">.</span><span class="n">REACTOR</span>
            <span class="p">)</span><span class="o">.</span><span class="n">blueprints</span><span class="o">.</span><span class="n">allNuclidesInProblem</span><span class="p">:</span>
                <span class="n">numNucs</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Block level density</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">refBlock</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">curBlock</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">numNucs</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

            <span class="n">refFracs</span> <span class="o">=</span> <span class="n">refBlock</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>
            <span class="n">curFracs</span> <span class="o">=</span> <span class="n">curBlock</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>

            <span class="c1"># Block level area fractions</span>
            <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">cur</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">refFracs</span><span class="p">,</span> <span class="n">curFracs</span><span class="p">):</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

            <span class="c1"># Block level params</span>
            <span class="k">for</span> <span class="n">refParam</span> <span class="ow">in</span> <span class="n">refBlock</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">refParam</span> <span class="o">==</span> <span class="s2">&quot;serialNum&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">refBlock</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">refParam</span><span class="p">]</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">curBlock</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">refParam</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">((</span><span class="n">cur</span> <span class="o">==</span> <span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">refParam</span> <span class="o">==</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span>
                        <span class="n">ref</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
                        <span class="n">cur</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                        <span class="n">cur</span><span class="p">,</span>
                        <span class="n">ref</span><span class="p">,</span>
                        <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{}</span><span class="s2"> param differs: </span><span class="si">{}</span><span class="s2"> vs. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">refParam</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">ref</span>
                        <span class="p">),</span>
                    <span class="p">)</span>

        <span class="c1"># Block level height</span>
        <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="n">assembly2</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">b2</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
            <span class="n">assert_allclose</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>

        <span class="c1"># Assembly level params</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="o">==</span> <span class="s2">&quot;serialNum&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">assembly2</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">assert_allclose</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="c1"># Block level reactor and parent</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">assembly2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">assembly2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_hasFlags"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_hasFlags">[docs]</a>    <span class="k">def</span> <span class="nf">test_hasFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_renameBlocksAccordingToAssemblyNum"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_renameBlocksAccordingToAssemblyNum">[docs]</a>    <span class="k">def</span> <span class="nf">test_renameBlocksAccordingToAssemblyNum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">assemNum</span> <span class="o">=</span> <span class="mi">55</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">renameBlocksAccordingToAssemblyNum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{0:04d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getNum</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getBlocks"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getBlocks">[docs]</a>    <span class="k">def</span> <span class="nf">test_getBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getFirstBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getFirstBlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFirstBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getFirstBlock</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getFirstBlockByType"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getFirstBlockByType">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFirstBlockByType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getFirstBlockByType</span><span class="p">(</span><span class="s2">&quot;igniter fuel unitst&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getType</span><span class="p">(),</span> <span class="s2">&quot;igniter fuel unitst&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getFirstBlockByType</span><span class="p">(</span><span class="s2">&quot;i do not exist&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getBlockData"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getBlockData">[docs]</a>    <span class="k">def</span> <span class="nf">test_getBlockData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">paramDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timeToLimit&quot;</span><span class="p">:</span> <span class="mf">40.0</span><span class="p">,</span>
            <span class="s2">&quot;fastFluence&quot;</span><span class="p">:</span> <span class="mf">1.01</span><span class="p">,</span>
            <span class="s2">&quot;fastFluencePeak&quot;</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">,</span>
            <span class="s2">&quot;power&quot;</span><span class="p">:</span> <span class="mf">10000.0</span><span class="p">,</span>
            <span class="s2">&quot;buGroup&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="s2">&quot;residence&quot;</span><span class="p">:</span> <span class="mf">3.145</span><span class="p">,</span>
            <span class="s2">&quot;eqRegion&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">299.0</span><span class="p">,</span>
            <span class="s2">&quot;bondRemoved&quot;</span><span class="p">:</span> <span class="mf">0.337</span><span class="p">,</span>
            <span class="s2">&quot;buRate&quot;</span><span class="p">:</span> <span class="mf">42.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Set some params</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">paramVal</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="o">=</span> <span class="n">paramVal</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">paramDict</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getChildParamValues</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">:</span>
                <span class="n">ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blockList</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getMaxParam"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getMaxParam">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMaxParam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">bi</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getMaxParam</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getElevationsMatchingParamValue"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getElevationsMatchingParamValue">[docs]</a>    <span class="k">def</span> <span class="nf">test_getElevationsMatchingParamValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="mf">20.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="mf">10.0</span>

        <span class="n">heights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getElevationsMatchingParamValue</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">heights</span><span class="p">,</span> <span class="p">[</span><span class="mf">12.5</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_calcAvgParam"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_calcAvgParam">[docs]</a>    <span class="k">def</span> <span class="nf">test_calcAvgParam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nums</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">calcAvgParam</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_calcTotalParam"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_calcTotalParam">[docs]</a>    <span class="k">def</span> <span class="nf">test_calcTotalParam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Remake original assembly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">)</span>

        <span class="c1"># add some blocks with a component</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>

            <span class="c1"># Set the 1st block to have higher params than the rest.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockParamsTemp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockParams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockParamsTemp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">val</span> <span class="o">*</span> <span class="n">i</span>
                <span class="p">)</span>  <span class="c1"># Iterate with i in self.assemNum, so higher assemNums get the high values.</span>

            <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">h</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;intercoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">)</span>

            <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockParamsTemp</span><span class="p">:</span>
            <span class="n">tot</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tot</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">tot</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">calcTotalParam</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
                <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_reattach"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_reattach">[docs]</a>    <span class="k">def</span> <span class="nf">test_reattach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Remake original assembly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()))</span>

        <span class="c1"># add some blocks with a component</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>

            <span class="c1"># Set the 1st block to have higher params than the rest.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blockParamsTemp</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockParams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Iterate with i in self.assemNum, so higher assemNums get the high values.</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blockParamsTemp</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span>
                <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">h</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;intercoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemNum</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">getType</span><span class="p">())</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_reestablishBlockOrder"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_reestablishBlockOrder">[docs]</a>    <span class="k">def</span> <span class="nf">test_reestablishBlockOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">indices</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">axialIndices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ai</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axialIndices</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ai</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">reestablishBlockOrder</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;005-003-000&quot;</span><span class="p">,</span> <span class="s2">&quot;005-003-001&quot;</span><span class="p">,</span> <span class="s2">&quot;005-003-002&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_countBlocksOfType"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_countBlocksOfType">[docs]</a>    <span class="k">def</span> <span class="nf">test_countBlocksOfType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">countBlocksWithFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">IGNITER</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getDim"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getDim">[docs]</a>    <span class="k">def</span> <span class="nf">test_getDim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;op&quot;</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hexDims</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">]</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getDominantMaterial"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getDominantMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">test_getDominantMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getDominantMaterial</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;UZr&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getDominantMaterial</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_iteration"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_iteration">[docs]</a>    <span class="k">def</span> <span class="nf">test_iteration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tests the ability to doubly-loop over assemblies (under development).&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span>

        <span class="k">for</span> <span class="n">bi</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">bi2</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">bi2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                            <span class="n">b2</span><span class="p">,</span>
                            <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;First block in new iteration is not the first block of assembly&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">h</span> <span class="o">+=</span> <span class="n">b2</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>

            <span class="c1"># make sure the loop continues with the right counter</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">b</span><span class="p">,</span>
                <span class="n">a</span><span class="p">[</span><span class="n">bi</span><span class="p">],</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;The </span><span class="si">{0}</span><span class="s2">th block in the loop (</span><span class="si">{1}</span><span class="s2">) is not equal to the&quot;</span>
                <span class="s2">&quot; </span><span class="si">{0}</span><span class="s2">th block in the assembly </span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bi</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="s2">&quot;dummy&quot;</span><span class="p">),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getBlocksAndZ"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getBlocksAndZ">[docs]</a>    <span class="k">def</span> <span class="nf">test_getBlocksAndZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">blocksAndCenters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksAndZ</span><span class="p">()</span>
        <span class="n">lastZ</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">blocksAndCenters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">lastZ</span><span class="p">)</span>
            <span class="n">lastZ</span> <span class="o">=</span> <span class="n">c</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksAndZ</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getBlocksBetweenElevations"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getBlocksBetweenElevations">[docs]</a>    <span class="k">def</span> <span class="nf">test_getBlocksBetweenElevations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># assembly should have 3 blocks of 10 cm in it</span>

        <span class="n">blocksAndHeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksBetweenElevations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">10.0</span><span class="p">))</span>

        <span class="n">blocksAndHeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksBetweenElevations</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">5.0</span><span class="p">))</span>

        <span class="n">blocksAndHeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksBetweenElevations</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">4.0</span><span class="p">))</span>

        <span class="n">blocksAndHeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksBetweenElevations</span><span class="p">(</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">21.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">10.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">))</span>

        <span class="n">blocksAndHeights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getBlocksBetweenElevations</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">1000.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocksAndHeights</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="nb">sum</span><span class="p">([</span><span class="n">height</span> <span class="k">for</span> <span class="n">_b</span><span class="p">,</span> <span class="n">height</span> <span class="ow">in</span> <span class="n">blocksAndHeights</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_getParamValuesAtZ"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_getParamValuesAtZ">[docs]</a>    <span class="k">def</span> <span class="nf">test_getParamValuesAtZ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># single value param</span>
        <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">90</span><span class="p">]):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">percentBu</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">percentBuDef</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">paramDefs</span><span class="p">[</span><span class="s2">&quot;percentBu&quot;</span><span class="p">]</span>
        <span class="n">originalLoc</span> <span class="o">=</span> <span class="n">percentBuDef</span><span class="o">.</span><span class="n">location</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="mf">87.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;percentBu&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">percentBuDef</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ParamLocation</span><span class="o">.</span><span class="n">BOTTOM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="mf">82.5</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;percentBu&quot;</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="n">fillValue</span><span class="o">=</span><span class="s2">&quot;extend&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">percentBuDef</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">ParamLocation</span><span class="o">.</span><span class="n">TOP</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="mf">82.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;percentBu&quot;</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">percentBu</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;percentBu&quot;</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="c1"># multiDimensional param</span>
            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">flux</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]):</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span> <span class="o">=</span> <span class="n">flux</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                    <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;mgFlux&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                    <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;mgFlux&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                <span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;mgFlux&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># single value param at corner</span>
            <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">temp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="p">,</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]):</span>
                <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="p">[</span><span class="n">temp</span> <span class="o">+</span> <span class="n">iCorner</span> <span class="k">for</span> <span class="n">iCorner</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getParamValuesAtZ</span><span class="p">(</span><span class="s2">&quot;THcornTemp&quot;</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">([</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">205</span><span class="p">],</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">percentBuDef</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">originalLoc</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_hasContinuousCoolantChannel"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_hasContinuousCoolantChannel">[docs]</a>    <span class="k">def</span> <span class="nf">test_hasContinuousCoolantChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">hasContinuousCoolantChannel</span><span class="p">())</span>
        <span class="n">modifiedAssem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span>
        <span class="n">coolantDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">}</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">(</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">coolantDims</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">modifiedAssem</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">modifiedAssem</span><span class="o">.</span><span class="n">hasContinuousCoolantChannel</span><span class="p">())</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_carestianCoordinates"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_carestianCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">test_carestianCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the coordinates of the assembly within the core with a CarestianGrid.&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span>
            <span class="n">numBlocks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">assemNum</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">spatialGrid</span><span class="o">=</span><span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">coords</span><span class="p">(),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">))</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_pinPlenumVolume"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_pinPlenumVolume">[docs]</a>    <span class="k">def</span> <span class="nf">test_pinPlenumVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the volume of a pin in the assembly&#39;s plenum.&quot;&quot;&quot;</span>
        <span class="n">pinPlenumVolume</span> <span class="o">=</span> <span class="mf">5.951978000285659e-05</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_blueprints</span><span class="p">(</span><span class="s2">&quot;refSmallReactorBase.yaml&quot;</span><span class="p">)</span>
        <span class="n">assembly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">blueprints</span><span class="o">.</span><span class="n">assemblies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;igniter fuel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pinPlenumVolume</span><span class="p">,</span> <span class="n">assembly</span><span class="o">.</span><span class="n">getPinPlenumVolumeInCubicMeters</span><span class="p">())</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_averagePlenumTemperature"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_averagePlenumTemperature">[docs]</a>    <span class="k">def</span> <span class="nf">test_averagePlenumTemperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test an assembly&#39;s average plenum temperature with a single block outlet.&quot;&quot;&quot;</span>
        <span class="n">averagePlenumTemp</span> <span class="o">=</span> <span class="mf">42.0</span>
        <span class="n">plenumBlock</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">plenumBlock</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;plenum&quot;</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span><span class="p">)</span>
        <span class="n">plenumBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcoolantOutletT</span> <span class="o">=</span> <span class="n">averagePlenumTemp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">],</span> <span class="n">conserveMassFlag</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plenumBlock</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">averagePlenumTemp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">assembly</span><span class="o">.</span><span class="n">getAveragePlenumTemperature</span><span class="p">())</span></div>

<div class="viewcode-block" id="Assembly_TestCase.test_rotate"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.Assembly_TestCase.test_rotate">[docs]</a>    <span class="k">def</span> <span class="nf">test_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test rotation of an assembly spatial objects.&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestBlock&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">]</span>
        <span class="n">rotTemp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">]</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementY</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">rotX</span> <span class="o">=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">rotY</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
        <span class="c1"># test list rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span><span class="p">,</span> <span class="n">rotTemp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementX</span><span class="p">,</span> <span class="n">rotX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementY</span><span class="p">,</span> <span class="n">rotY</span><span class="p">)</span>

        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">])</span>
        <span class="n">rotTemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">])</span>
        <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
        <span class="c1"># test np.ndarray rotation</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rotTemp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># test that floats and ints are left alone</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="mf">4.0</span>
        <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getBlocks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">)</span>

        <span class="c1"># check that TypeError is raised for unexpected data type</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="s2">&quot;bad data&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>

        <span class="c1"># check that list of len != 6 ends up in runlog warning</span>
        <span class="c1"># list len=5</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">mockRunLogs</span><span class="o">.</span><span class="n">BufferLog</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;No rotation method defined&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
        <span class="c1"># np.ndarray len=5</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">mockRunLogs</span><span class="o">.</span><span class="n">BufferLog</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;No rotation method defined&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
        <span class="c1"># list len=7</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">700</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">mockRunLogs</span><span class="o">.</span><span class="n">BufferLog</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;No rotation method defined&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
        <span class="c1"># np.ndarray len=7</span>
        <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THcornTemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">700</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">mockRunLogs</span><span class="o">.</span><span class="n">BufferLog</span><span class="p">()</span> <span class="k">as</span> <span class="n">mock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
            <span class="n">a</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;No rotation method defined&quot;</span><span class="p">,</span> <span class="n">mock</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="AssemblyInReactor_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.AssemblyInReactor_TestCase">[docs]</a><span class="k">class</span> <span class="nc">AssemblyInReactor_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">o</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">test_reactors</span><span class="o">.</span><span class="n">loadTestReactor</span><span class="p">(</span><span class="n">TEST_ROOT</span><span class="p">)</span>

<div class="viewcode-block" id="AssemblyInReactor_TestCase.test_snapAxialMeshToReferenceConservingMassBasedOnBlockIgniter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.AssemblyInReactor_TestCase.test_snapAxialMeshToReferenceConservingMassBasedOnBlockIgniter">[docs]</a>    <span class="k">def</span> <span class="nf">test_snapAxialMeshToReferenceConservingMassBasedOnBlockIgniter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">originalMesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">]</span>
        <span class="n">refMesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">26.0</span><span class="p">,</span> <span class="mf">52.0</span><span class="p">,</span> <span class="mf">79.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">]</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span>

        <span class="c1">################################</span>
        <span class="c1"># examine mass change in igniterFuel</span>
        <span class="c1">################################</span>
        <span class="n">igniterFuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">childrenByLocator</span><span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># gridplate, fuel, fuel, fuel, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterMassGrid</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>
        <span class="n">igniterMassGridTotal</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">igniterHMMass1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">igniterZircMass1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;ZR&quot;</span><span class="p">)</span>
        <span class="n">igniterFuelBlockMass</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterPlenumMass</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="c1"># expand the core to the new reference mesh</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">(</span><span class="n">refMesh</span><span class="p">,</span> <span class="n">conserveMassFlag</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="c1">#############################</span>
        <span class="c1"># check igniter mass after expansion</span>
        <span class="c1">#############################</span>
        <span class="c1"># gridplate, fuel, fuel, fuel, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterMassGridAfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">igniterHMMass1AfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">igniterZircMass1AfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;ZR&quot;</span><span class="p">)</span>

        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterPlenumMassAfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterMassGrid</span><span class="p">,</span> <span class="n">igniterMassGridAfterExpand</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterHMMass1</span><span class="p">,</span> <span class="n">igniterHMMass1AfterExpand</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterZircMass1</span><span class="p">,</span> <span class="n">igniterZircMass1AfterExpand</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="c1"># Note the masses are linearly different by the amount that the plenum shrunk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">igniterPlenumMass</span><span class="p">,</span> <span class="n">igniterPlenumMassAfterExpand</span> <span class="o">*</span> <span class="mi">75</span> <span class="o">/</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mi">7</span>
        <span class="p">)</span>

        <span class="c1"># Shrink the core back to the original mesh size to see if mass is conserved</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">(</span><span class="n">originalMesh</span><span class="p">,</span> <span class="n">conserveMassFlag</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="c1">#############################</span>
        <span class="c1"># check igniter mass after shrink to original</span>
        <span class="c1">#############################</span>
        <span class="c1"># gridplate, fuel, fuel, fuel, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterMassGridAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>
        <span class="n">igniterMassGridTotalAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">igniterHMMass1AfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">igniterZircMass1AfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;ZR&quot;</span><span class="p">)</span>
        <span class="n">igniterFuelBlockMassAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">igniterFuel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">igniterPlenumMassAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterMassGrid</span><span class="p">,</span> <span class="n">igniterMassGridAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterMassGridTotal</span><span class="p">,</span> <span class="n">igniterMassGridTotalAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterHMMass1</span><span class="p">,</span> <span class="n">igniterHMMass1AfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterZircMass1</span><span class="p">,</span> <span class="n">igniterZircMass1AfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterFuelBlockMass</span><span class="p">,</span> <span class="n">igniterFuelBlockMassAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">igniterPlenumMass</span><span class="p">,</span> <span class="n">igniterPlenumMassAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span></div>

<div class="viewcode-block" id="AssemblyInReactor_TestCase.test_snapAxialMeshToReferenceConservingMassBasedOnBlockShield"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.AssemblyInReactor_TestCase.test_snapAxialMeshToReferenceConservingMassBasedOnBlockShield">[docs]</a>    <span class="k">def</span> <span class="nf">test_snapAxialMeshToReferenceConservingMassBasedOnBlockShield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">originalMesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">75.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">]</span>
        <span class="n">refMesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">26.0</span><span class="p">,</span> <span class="mf">52.0</span><span class="p">,</span> <span class="mf">79.0</span><span class="p">,</span> <span class="mf">108.0</span><span class="p">,</span> <span class="mf">175.0</span><span class="p">]</span>

        <span class="c1"># access the shield in ring 9, pos 2</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1">################################</span>
        <span class="c1"># examine mass change in radial shield</span>
        <span class="c1">################################</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">childrenByLocator</span><span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
        <span class="c1"># gridplate, axial shield, axial shield, axial shield, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldMassGrid</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldShieldMass</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldPlenumMass</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="c1"># expand the core to the new reference mesh</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">(</span><span class="n">refMesh</span><span class="p">,</span> <span class="n">conserveMassFlag</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="c1">################################</span>
        <span class="c1"># examine mass change in radial shield after expansion</span>
        <span class="c1">################################</span>
        <span class="c1"># gridplate, axial shield, axial shield, axial shield, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldMassGridAfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldShieldMassAfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldPlenumMassAfterExpand</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="c1"># non mass conserving expansions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">shieldMassGrid</span> <span class="o">*</span> <span class="mf">26.0</span> <span class="o">/</span> <span class="mf">25.0</span><span class="p">,</span> <span class="n">shieldMassGridAfterExpand</span><span class="p">,</span> <span class="mi">7</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">shieldShieldMass</span> <span class="o">*</span> <span class="mf">26.0</span> <span class="o">/</span> <span class="mf">25.0</span><span class="p">,</span> <span class="n">shieldShieldMassAfterExpand</span><span class="p">,</span> <span class="mi">7</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">shieldPlenumMass</span><span class="p">,</span> <span class="n">shieldPlenumMassAfterExpand</span> <span class="o">*</span> <span class="mf">75.0</span> <span class="o">/</span> <span class="mf">67.0</span><span class="p">,</span> <span class="mi">7</span>
        <span class="p">)</span>

        <span class="c1"># Shrink the core back to the original mesh size to see if mass is conserved</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">setBlockMesh</span><span class="p">(</span><span class="n">originalMesh</span><span class="p">,</span> <span class="n">conserveMassFlag</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>

        <span class="c1">################################</span>
        <span class="c1"># examine mass change in radial shield after shrink to original</span>
        <span class="c1">################################</span>
        <span class="c1"># gridplate, axial shield, axial shield, axial shield, plenum</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldMassGridAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldShieldMassAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">coolantNucs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">coolMass</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">coolantNucs</span><span class="p">:</span>
            <span class="n">coolMass</span> <span class="o">+=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">shieldPlenumMassAfterShrink</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span> <span class="o">-</span> <span class="n">coolMass</span>

        <span class="c1"># non mass conserving expansions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">shieldMassGrid</span><span class="p">,</span> <span class="n">shieldMassGridAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">shieldShieldMass</span><span class="p">,</span> <span class="n">shieldShieldMassAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">shieldPlenumMass</span><span class="p">,</span> <span class="n">shieldPlenumMassAfterShrink</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AnnularFuelTestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.AnnularFuelTestCase">[docs]</a><span class="k">class</span> <span class="nc">AnnularFuelTestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test fuel with a whole in the center.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{</span><span class="n">CONF_XS_KERNEL</span><span class="p">:</span> <span class="s2">&quot;MC2v2&quot;</span><span class="p">}</span>  <span class="c1"># don&#39;t try to expand elementals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>

        <span class="n">settings</span><span class="o">.</span><span class="n">setMasterCs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">blueprints</span><span class="o">.</span><span class="n">Blueprints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">reactors</span><span class="o">.</span><span class="n">Reactor</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">bp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">reactors</span><span class="o">.</span><span class="n">Core</span><span class="p">(</span><span class="s2">&quot;Core&quot;</span><span class="p">))</span>

        <span class="n">inputStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;blocks:</span>
<span class="s2">    ann fuel: &amp;block_ann_fuel</span>
<span class="s2">        gap:</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            material: Void</span>
<span class="s2">            Tinput: 20.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">            id: 0.0</span>
<span class="s2">            mult: fuel.mult</span>
<span class="s2">            od: fuel.id</span>
<span class="s2">        fuel:</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            material: UZr</span>
<span class="s2">            Tinput: 20.0</span>
<span class="s2">            Thot: 600.0</span>
<span class="s2">            id: 0.1</span>
<span class="s2">            mult: 127</span>
<span class="s2">            od: 0.8</span>
<span class="s2">        gap1:</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            material: Void</span>
<span class="s2">            Tinput: 20.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">            id: fuel.od</span>
<span class="s2">            mult: fuel.mult</span>
<span class="s2">            od: clad.id</span>
<span class="s2">        clad:</span>
<span class="s2">            shape: Circle</span>
<span class="s2">            material: HT9</span>
<span class="s2">            Tinput: 20.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">            id: .85</span>
<span class="s2">            mult: fuel.mult</span>
<span class="s2">            od: .95</span>
<span class="s2">        duct: &amp;component_type2_fuel_duct</span>
<span class="s2">            shape: Hexagon</span>
<span class="s2">            material: HT9</span>
<span class="s2">            Tinput: 20.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">            ip: 13.00</span>
<span class="s2">            op: 13.9</span>
<span class="s2">            mult: 1</span>
<span class="s2">        intercoolant: &amp;component_type2_fuel_intercoolant</span>
<span class="s2">            shape: Hexagon</span>
<span class="s2">            material: Sodium</span>
<span class="s2">            Tinput: 435.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">            ip: duct.op</span>
<span class="s2">            mult: 1</span>
<span class="s2">            op: 16</span>
<span class="s2">        coolant: &amp;component_type2_fuel_coolant</span>
<span class="s2">            shape: DerivedShape</span>
<span class="s2">            material: Sodium</span>
<span class="s2">            Tinput: 435.0</span>
<span class="s2">            Thot: 435.0</span>
<span class="s2">assemblies:</span>
<span class="s2">    heights: &amp;standard_heights [30.0]</span>
<span class="s2">    axial mesh points: &amp;standard_axial_mesh_points [2]</span>
<span class="s2">    ann fuel:</span>
<span class="s2">        specifier: FA</span>
<span class="s2">        blocks: &amp;inner_igniter_fuel_blocks [*block_ann_fuel]</span>
<span class="s2">        height: *standard_heights</span>
<span class="s2">        axial mesh points: *standard_axial_mesh_points</span>
<span class="s2">        hotChannelFactors: TWRPclad</span>
<span class="s2">        xs types:  &amp;inner_igniter_fuel_xs_types [D]</span>
<span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span> <span class="o">=</span> <span class="n">blueprints</span><span class="o">.</span><span class="n">Blueprints</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">inputStr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="o">.</span><span class="n">_prepConstruction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>

<div class="viewcode-block" id="AnnularFuelTestCase.test_areaCheck"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_assemblies.html#armi.reactor.tests.test_assemblies.AnnularFuelTestCase.test_areaCheck">[docs]</a>    <span class="k">def</span> <span class="nf">test_areaCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">assembly</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blueprints</span><span class="o">.</span><span class="n">assemblies</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fuelBlock</span> <span class="o">=</span> <span class="n">assembly</span><span class="o">.</span><span class="n">getFirstBlock</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">intercoolant</span> <span class="o">=</span> <span class="n">fuelBlock</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span>

        <span class="n">bpAssemblyArea</span> <span class="o">=</span> <span class="n">assembly</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">actualAssemblyArea</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">intercoolant</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">op</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">bpAssemblyArea</span><span class="p">,</span> <span class="n">actualAssemblyArea</span><span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2023, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2023-08-17.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>