<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.reactor.tests.test_blocks &mdash; ARMI 0.4.0 documentation</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme_fixes.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../../../_static/armiicon_16x16.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../../reactor.html">armi.reactor</a></li>
      <li class="breadcrumb-item active">armi.reactor.tests.test_blocks</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.reactor.tests.test_blocks</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;Tests blocks.py.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">MagicMock</span><span class="p">,</span> <span class="n">patch</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">numpy.testing</span> <span class="kn">import</span> <span class="n">assert_allclose</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">materials</span><span class="p">,</span> <span class="n">runLog</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">tests</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">blueprints</span>
<span class="kn">from</span> <span class="nn">armi.reactor.components</span> <span class="kn">import</span> <span class="n">basicShapes</span><span class="p">,</span> <span class="n">complexShapes</span>
<span class="kn">from</span> <span class="nn">armi.nucDirectory</span> <span class="kn">import</span> <span class="n">nucDir</span><span class="p">,</span> <span class="n">nuclideBases</span>
<span class="kn">from</span> <span class="nn">armi.nuclearDataIO.cccc</span> <span class="kn">import</span> <span class="n">isotxs</span>
<span class="kn">from</span> <span class="nn">armi.physics.neutronics</span> <span class="kn">import</span> <span class="n">NEUTRON</span><span class="p">,</span> <span class="n">GAMMA</span>
<span class="kn">from</span> <span class="nn">armi.physics.neutronics.settings</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CONF_LOADING_FILE</span><span class="p">,</span>
    <span class="n">CONF_XS_KERNEL</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">grids</span>
<span class="kn">from</span> <span class="nn">armi.reactor.flags</span> <span class="kn">import</span> <span class="n">Flags</span>
<span class="kn">from</span> <span class="nn">armi.reactor.tests.test_assemblies</span> <span class="kn">import</span> <span class="n">makeTestAssembly</span>
<span class="kn">from</span> <span class="nn">armi.tests</span> <span class="kn">import</span> <span class="n">ISOAA_PATH</span><span class="p">,</span> <span class="n">TEST_ROOT</span>
<span class="kn">from</span> <span class="nn">armi.utils</span> <span class="kn">import</span> <span class="n">hexagon</span><span class="p">,</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">armi.utils.units</span> <span class="kn">import</span> <span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
<span class="kn">from</span> <span class="nn">armi.nuclearDataIO</span> <span class="kn">import</span> <span class="n">xsCollections</span>

<span class="n">NUM_PINS_IN_TEST_BLOCK</span> <span class="o">=</span> <span class="mi">217</span>


<div class="viewcode-block" id="buildSimpleFuelBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.buildSimpleFuelBlock">[docs]</a><span class="k">def</span> <span class="nf">buildSimpleFuelBlock</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a simple block containing fuel, clad, duct, and coolant.&quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">127.0</span><span class="p">}</span>
    <span class="n">cladDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.77</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">127.0</span><span class="p">}</span>
    <span class="n">ductDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">15.3</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
    <span class="n">intercoolantDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">17.0</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ductDims</span><span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">],</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">coolDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">}</span>

    <span class="n">fuel</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>
    <span class="n">clad</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">cladDims</span><span class="p">)</span>
    <span class="n">duct</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ductDims</span><span class="p">)</span>
    <span class="n">coolant</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">(</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">coolDims</span><span class="p">)</span>
    <span class="n">intercoolant</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;intercoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">intercoolantDims</span><span class="p">)</span>

    <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">duct</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coolant</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">intercoolant</span><span class="p">)</span>

    <span class="n">b</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>  <span class="c1"># TODO: remove, should be no-op when removed self.cached</span>

    <span class="k">return</span> <span class="n">b</span></div>


<div class="viewcode-block" id="loadTestBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.loadTestBlock">[docs]</a><span class="k">def</span> <span class="nf">loadTestBlock</span><span class="p">(</span><span class="n">cold</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Build an annular test block for evaluating unit tests.&quot;&quot;&quot;</span>
    <span class="n">caseSetting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
    <span class="n">caseSetting</span><span class="p">[</span><span class="n">CONF_XS_KERNEL</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;MC2v2&quot;</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">setVerbosity</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">)</span>
    <span class="n">caseSetting</span><span class="p">[</span><span class="s2">&quot;nCycles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">getEmptyHexReactor</span><span class="p">()</span>

    <span class="n">assemNum</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">block</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;defaultType&quot;</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nPins</span> <span class="o">=</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span>
    <span class="n">assembly</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="n">assemNum</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>

    <span class="c1"># NOTE: temperatures are supposed to be in C</span>
    <span class="n">coldTemp</span> <span class="o">=</span> <span class="mf">25.0</span>
    <span class="n">hotTempCoolant</span> <span class="o">=</span> <span class="mf">430.0</span>
    <span class="n">hotTempStructure</span> <span class="o">=</span> <span class="mf">25.0</span> <span class="k">if</span> <span class="n">cold</span> <span class="k">else</span> <span class="n">hotTempCoolant</span>
    <span class="n">hotTempFuel</span> <span class="o">=</span> <span class="mf">25.0</span> <span class="k">if</span> <span class="n">cold</span> <span class="k">else</span> <span class="mf">600.0</span>

    <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempFuel</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.84</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">fuel</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>

    <span class="n">bondDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempCoolant</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="s2">&quot;fuel.id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">bondDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fuel&quot;</span><span class="p">:</span> <span class="n">fuel</span><span class="p">}</span>
    <span class="n">bond</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;bond&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">bondDims</span><span class="p">)</span>

    <span class="n">annularVoidDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="s2">&quot;bond.id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">annularVoidDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bond&quot;</span><span class="p">:</span> <span class="n">bond</span><span class="p">}</span>
    <span class="n">annularVoid</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;annular void&quot;</span><span class="p">,</span> <span class="s2">&quot;Void&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">annularVoidDims</span><span class="p">)</span>

    <span class="n">innerLinerDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">innerLiner</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;inner liner&quot;</span><span class="p">,</span> <span class="s2">&quot;Graphite&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">innerLinerDims</span><span class="p">)</span>

    <span class="n">fuelLinerGapDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="s2">&quot;inner liner.id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;fuel.od&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">fuelLinerGapDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;inner liner&quot;</span><span class="p">:</span> <span class="n">innerLiner</span><span class="p">,</span> <span class="s2">&quot;fuel&quot;</span><span class="p">:</span> <span class="n">fuel</span><span class="p">}</span>
    <span class="n">fuelLinerGap</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;gap1&quot;</span><span class="p">,</span> <span class="s2">&quot;Void&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelLinerGapDims</span><span class="p">)</span>

    <span class="n">outerLinerDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">outerLiner</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;outer liner&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">outerLinerDims</span><span class="p">)</span>

    <span class="n">linerLinerGapDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="s2">&quot;outer liner.id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;inner liner.od&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">linerLinerGapDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;outer liner&quot;</span><span class="p">:</span> <span class="n">outerLiner</span><span class="p">,</span>
        <span class="s2">&quot;inner liner&quot;</span><span class="p">:</span> <span class="n">innerLiner</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">linerLinerGap</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;gap2&quot;</span><span class="p">,</span> <span class="s2">&quot;Void&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">linerLinerGapDims</span><span class="p">)</span>

    <span class="n">claddingDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">1.05</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">cladding</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">claddingDims</span><span class="p">)</span>

    <span class="n">linerCladGapDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="s2">&quot;clad.id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;outer liner.od&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">linerCladGapDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;clad&quot;</span><span class="p">:</span> <span class="n">cladding</span><span class="p">,</span> <span class="s2">&quot;outer liner&quot;</span><span class="p">:</span> <span class="n">outerLiner</span><span class="p">}</span>
    <span class="n">linerCladGap</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;gap3&quot;</span><span class="p">,</span> <span class="s2">&quot;Void&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">linerCladGapDims</span><span class="p">)</span>

    <span class="n">wireDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;axialPitch&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
        <span class="s2">&quot;helixDiameter&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="n">NUM_PINS_IN_TEST_BLOCK</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">wire</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Helix</span><span class="p">(</span><span class="s2">&quot;wire&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">wireDims</span><span class="p">)</span>

    <span class="n">coolantDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempCoolant</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempCoolant</span><span class="p">}</span>
    <span class="n">coolant</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">(</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">coolantDims</span><span class="p">)</span>

    <span class="n">ductDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempStructure</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">16.6</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">17.3</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">duct</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ductDims</span><span class="p">)</span>

    <span class="n">interDims</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTempCoolant</span><span class="p">,</span>
        <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTempCoolant</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">17.8</span><span class="p">,</span>
        <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="s2">&quot;duct.op&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">interDims</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;duct&quot;</span><span class="p">:</span> <span class="n">duct</span><span class="p">}</span>
    <span class="n">interSodium</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;interCoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">interDims</span><span class="p">)</span>

    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">annularVoid</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bond</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuelLinerGap</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">innerLiner</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">linerLinerGap</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">outerLiner</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">linerCladGap</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cladding</span><span class="p">)</span>

    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wire</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coolant</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">duct</span><span class="p">)</span>
    <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">interSodium</span><span class="p">)</span>

    <span class="n">block</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>  <span class="c1"># TODO: remove, should be no-op when removed self.cached</span>

    <span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">16.0</span><span class="p">)</span>

    <span class="n">block</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span>
    <span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">block</span></div>


<div class="viewcode-block" id="applyDummyData"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.applyDummyData">[docs]</a><span class="k">def</span> <span class="nf">applyDummyData</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add some dummy data to a block for physics-like tests.&quot;&quot;&quot;</span>
    <span class="c1"># typical SFR-ish flux in 1/cm^2/s</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="p">[</span>
        <span class="mf">161720716762.12997</span><span class="p">,</span>
        <span class="mf">2288219224332.647</span><span class="p">,</span>
        <span class="mf">11068159130271.139</span><span class="p">,</span>
        <span class="mf">26473095948525.742</span><span class="p">,</span>
        <span class="mf">45590249703180.945</span><span class="p">,</span>
        <span class="mf">78780459664094.23</span><span class="p">,</span>
        <span class="mf">143729928505629.06</span><span class="p">,</span>
        <span class="mf">224219073208464.06</span><span class="p">,</span>
        <span class="mf">229677567456769.22</span><span class="p">,</span>
        <span class="mf">267303906113313.16</span><span class="p">,</span>
        <span class="mf">220996878365852.22</span><span class="p">,</span>
        <span class="mf">169895433093246.28</span><span class="p">,</span>
        <span class="mf">126750484612975.31</span><span class="p">,</span>
        <span class="mf">143215138794766.53</span><span class="p">,</span>
        <span class="mf">74813432842005.5</span><span class="p">,</span>
        <span class="mf">32130372366225.85</span><span class="p">,</span>
        <span class="mf">21556243034771.582</span><span class="p">,</span>
        <span class="mf">6297567411518.368</span><span class="p">,</span>
        <span class="mf">22365198294698.45</span><span class="p">,</span>
        <span class="mf">12211256796917.86</span><span class="p">,</span>
        <span class="mf">5236367197121.363</span><span class="p">,</span>
        <span class="mf">1490736020048.7847</span><span class="p">,</span>
        <span class="mf">1369603135573.731</span><span class="p">,</span>
        <span class="mf">285579041041.55945</span><span class="p">,</span>
        <span class="mf">73955783965.98692</span><span class="p">,</span>
        <span class="mf">55003146502.73623</span><span class="p">,</span>
        <span class="mf">18564831886.20426</span><span class="p">,</span>
        <span class="mf">4955747691.052108</span><span class="p">,</span>
        <span class="mf">3584030491.076041</span><span class="p">,</span>
        <span class="mf">884015567.3986057</span><span class="p">,</span>
        <span class="mf">4298964991.043116</span><span class="p">,</span>
        <span class="mf">1348809158.0353086</span><span class="p">,</span>
        <span class="mf">601494405.293505</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">xslib</span> <span class="o">=</span> <span class="n">isotxs</span><span class="o">.</span><span class="n">readBinary</span><span class="p">(</span><span class="n">ISOAA_PATH</span><span class="p">)</span>
    <span class="c1"># slight hack here because the test block was created</span>
    <span class="c1"># by hand rather than via blueprints and so elemental expansion</span>
    <span class="c1"># of isotopics did not occur. But, the ISOTXS library being used</span>
    <span class="c1"># did go through an isotopic expansion, so we map nuclides here.</span>
    <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;NAAA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;NA23AA&quot;</span><span class="p">]</span>
    <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;WAA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;W184AA&quot;</span><span class="p">]</span>
    <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;MNAA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xslib</span><span class="o">.</span><span class="n">_nuclides</span><span class="p">[</span><span class="s2">&quot;MN55AA&quot;</span><span class="p">]</span>
    <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span> <span class="o">=</span> <span class="n">flux</span>
    <span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">xslib</span></div>


<div class="viewcode-block" id="getComponentData"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.getComponentData">[docs]</a><span class="k">def</span> <span class="nf">getComponentData</span><span class="p">(</span><span class="n">component</span><span class="p">):</span>
    <span class="n">density</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">component</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
        <span class="n">density</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="n">component</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
        <span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
    <span class="n">mass</span> <span class="o">=</span> <span class="n">component</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">component</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">volume</span><span class="p">,</span> <span class="n">mass</span></div>


<div class="viewcode-block" id="TestDetailedNDensUpdate"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.TestDetailedNDensUpdate">[docs]</a><span class="k">class</span> <span class="nc">TestDetailedNDensUpdate</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestDetailedNDensUpdate.test_updateDetailedNdens"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.TestDetailedNDensUpdate.test_updateDetailedNdens">[docs]</a>    <span class="k">def</span> <span class="nf">test_updateDetailedNdens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">armi.reactor.blueprints.tests.test_blockBlueprints</span> <span class="kn">import</span> <span class="n">FULL_BP</span>

        <span class="n">cs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">FULL_BP</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">bps</span> <span class="o">=</span> <span class="n">blueprints</span><span class="o">.</span><span class="n">Blueprints</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
            <span class="n">bps</span><span class="o">.</span><span class="n">_prepConstruction</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">getEmptyHexReactor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">blueprints</span> <span class="o">=</span> <span class="n">bps</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="n">numBlocks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">assemNum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">buildSimpleFuelBlock</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># get first block in assembly with &#39;fuel&#39; key</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># get nuclides in first component in block</span>
        <span class="n">adjList</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">()</span>
        <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">detailedNDens</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">])</span>
        <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pdensDecay</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">block</span><span class="o">.</span><span class="n">_updateDetailedNdens</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">adjustList</span><span class="o">=</span><span class="n">adjList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pdensDecay</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">detailedNDens</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="Block_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase">[docs]</a><span class="k">class</span> <span class="nc">Block_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">loadTestBlock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hotBlock</span> <span class="o">=</span> <span class="n">loadTestBlock</span><span class="p">(</span><span class="n">cold</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="Block_TestCase.test_getSmearDensity"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getSmearDensity">[docs]</a>    <span class="k">def</span> <span class="nf">test_getSmearDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSmearDensity</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">LINER</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="c1"># test with liner instead of clad</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">LINER</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSmearDensity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">cur</span><span class="p">,</span>
            <span class="n">ref</span><span class="p">,</span>
            <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Incorrect getSmearDensity with liner. Got </span><span class="si">{0}</span><span class="s2">. Should be </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">cur</span><span class="p">,</span> <span class="n">ref</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># test with annular fuel.</span>
        <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
            <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
            <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.87</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">271.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuelComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">LINER</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSmearDensity</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">cur</span><span class="p">,</span>
            <span class="n">ref</span><span class="p">,</span>
            <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Incorrect getSmearDensity with annular fuel. Got </span><span class="si">{0}</span><span class="s2">. Should be </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">cur</span><span class="p">,</span> <span class="n">ref</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getSmearDensityMultipleLiner"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getSmearDensityMultipleLiner">[docs]</a>    <span class="k">def</span> <span class="nf">test_getSmearDensityMultipleLiner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numLiners</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="mi">1</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="k">if</span> <span class="s2">&quot;liner&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="s2">&quot;gap&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">numLiners</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;self.block needs at least 2 liners for this test to be functional.&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSmearDensity</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INNER</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">LINER</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_timeNodeParams"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_timeNodeParams">[docs]</a>    <span class="k">def</span> <span class="nf">test_timeNodeParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;buRate&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[(</span><span class="s2">&quot;buRate&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getType"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getType">[docs]</a>    <span class="k">def</span> <span class="nf">test_getType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;plenum pin&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">PIN</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">PIN</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_hasFlags"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_hasFlags">[docs]</a>    <span class="k">def</span> <span class="nf">test_hasFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;feed fuel&quot;</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FEED</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setType"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setType">[docs]</a>    <span class="k">def</span> <span class="nf">test_setType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;igniter fuel&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s2">&quot;igniter fuel&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getType</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">IGNITER</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;feed fuel&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FEED</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">IGNITER</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_duplicate"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_duplicate">[docs]</a>    <span class="k">def</span> <span class="nf">test_duplicate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Block2</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">Block</span><span class="o">.</span><span class="n">createHomogenizedCopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
        <span class="n">originalComponents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">()</span>
        <span class="n">newComponents</span> <span class="o">=</span> <span class="n">Block2</span><span class="o">.</span><span class="n">getComponents</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">originalComponents</span><span class="p">,</span> <span class="n">newComponents</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">c1</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">c2</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">c1</span><span class="o">.</span><span class="n">getArea</span><span class="p">(),</span> <span class="n">c2</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNot</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="n">a1</span><span class="p">,</span>
                <span class="n">a2</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;The area of </span><span class="si">{0}</span><span class="s2">=</span><span class="si">{1}</span><span class="s2"> but &quot;</span>
                <span class="s2">&quot;the area of </span><span class="si">{2}</span><span class="s2"> in the copy=</span><span class="si">{3}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">a2</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">c2</span><span class="o">.</span><span class="n">DIMENSION_NAMES</span><span class="p">:</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">originalComponents</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">newComponents</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">Block2</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">Block2</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">Block2</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="n">Block2</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_homogenizedMixture"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_homogenizedMixture">[docs]</a>    <span class="k">def</span> <span class="nf">test_homogenizedMixture</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Confirms homogenized blocks have correct properties.</span>

<span class="sd">        .. test:: Homogenize the compositions of a block.</span>
<span class="sd">            :id: T_ARMI_BLOCK_HOMOG</span>
<span class="sd">            :tests: R_ARMI_BLOCK_HOMOG</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>  <span class="c1"># pinSpatialLocator argument</span>
        <span class="n">expectedShapes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">basicShapes</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">],</span>
            <span class="p">[</span><span class="n">basicShapes</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">,</span> <span class="n">basicShapes</span><span class="o">.</span><span class="n">Circle</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">shapes</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">expectedShapes</span><span class="p">):</span>
            <span class="n">homogBlock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">createHomogenizedCopy</span><span class="p">(</span><span class="n">pinSpatialLocators</span><span class="o">=</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">shapeType</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getComponents</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">shapeType</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># didn&#39;t find the homogenized hex in the block copy</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span>
                        <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="si">}</span><span class="s2"> does not have a </span><span class="si">{</span><span class="n">shapeType</span><span class="si">}</span><span class="s2"> component!&quot;</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">arg</span><span class="p">:</span>
                <span class="c1"># check that homogenized block has correct pin coordinates</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nPins</span><span class="p">,</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">nPins</span><span class="p">)</span>
                <span class="n">pinCoords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPinCoordinates</span><span class="p">()</span>
                <span class="n">homogPinCoords</span> <span class="o">=</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getPinCoordinates</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">refXYZ</span><span class="p">,</span> <span class="n">homogXYZ</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pinCoords</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">homogPinCoords</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">refXYZ</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">homogXYZ</span><span class="p">))</span>

            <span class="n">cur</span> <span class="o">=</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(),</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">homogBlock</span><span class="o">.</span><span class="n">getType</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getType</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">homogBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">homogBlock</span><span class="o">.</span><span class="n">macros</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">homogBlock</span><span class="o">.</span><span class="n">_lumpedFissionProducts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">_lumpedFissionProducts</span>
            <span class="p">)</span>

            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

            <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">homogBlock</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getXsType"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getXsType">[docs]</a>    <span class="k">def</span> <span class="nf">test_getXsType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">CONF_LOADING_FILE</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">TEST_ROOT</span><span class="p">,</span> <span class="s2">&quot;refSmallReactor.yaml&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;B&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">_oldBuGroups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;buGroups&quot;</span><span class="p">]</span>
        <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;buGroups&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">]}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;BB&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="s2">&quot;BB&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_27b_setBuGroup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_27b_setBuGroup">[docs]</a>    <span class="k">def</span> <span class="nf">test_27b_setBuGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">type_</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buGroup</span> <span class="o">=</span> <span class="n">type_</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buGroupNum</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">type_</span><span class="p">)</span> <span class="o">-</span> <span class="mi">65</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">typeNumber</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buGroupNum</span> <span class="o">=</span> <span class="n">typeNumber</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buGroup</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">typeNumber</span> <span class="o">+</span> <span class="mi">65</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setZeroHeight"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setZeroHeight">[docs]</a>    <span class="k">def</span> <span class="nf">test_setZeroHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that demonstrates that a block&#39;s height can be set to zero.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">buildSimpleFuelBlock</span><span class="p">()</span>

        <span class="c1"># Check for a DerivedShape component</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">]),</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">nd1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Set height to 0.0</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">nd2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nuc</span><span class="p">,</span> <span class="n">ndens</span> <span class="ow">in</span> <span class="n">nd2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">ndens</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number density of </span><span class="si">{</span><span class="n">nuc</span><span class="si">}</span><span class="s2"> is &quot;</span> <span class="s2">&quot;expected to be zero.&quot;</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="c1"># Set height back to the original height</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>
        <span class="n">m3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">a3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">nd3</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensities</span><span class="p">())</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span> <span class="n">m1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a3</span><span class="p">,</span> <span class="n">a1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">h3</span><span class="p">,</span> <span class="n">h1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">nd3</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">nd3</span><span class="p">[</span><span class="n">nuc</span><span class="p">],</span> <span class="n">nd1</span><span class="p">[</span><span class="n">nuc</span><span class="p">])</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getVolumeFractionsWithZeroHeight"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getVolumeFractionsWithZeroHeight">[docs]</a>    <span class="k">def</span> <span class="nf">test_getVolumeFractionsWithZeroHeight</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests that the component fractions are the same with a zero height block.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">buildSimpleFuelBlock</span><span class="p">()</span>

        <span class="n">h1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">originalVolFracs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_c</span><span class="p">,</span> <span class="n">vf</span> <span class="ow">in</span> <span class="n">originalVolFracs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">volFracs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_c</span><span class="p">,</span> <span class="n">vf1</span><span class="p">),</span> <span class="p">(</span><span class="n">_c</span><span class="p">,</span> <span class="n">vf2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">volFracs</span><span class="p">,</span> <span class="n">originalVolFracs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">vf1</span><span class="p">,</span> <span class="n">vf2</span><span class="p">)</span>

        <span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>
        <span class="n">volFracs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_c</span><span class="p">,</span> <span class="n">vf1</span><span class="p">),</span> <span class="p">(</span><span class="n">_c</span><span class="p">,</span> <span class="n">vf2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">volFracs</span><span class="p">,</span> <span class="n">originalVolFracs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">vf1</span><span class="p">,</span> <span class="n">vf2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getVolumeFractionWithoutParent"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getVolumeFractionWithoutParent">[docs]</a>    <span class="k">def</span> <span class="nf">test_getVolumeFractionWithoutParent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests that the volume fraction of a block with no parent is zero.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">buildSimpleFuelBlock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">getVolumeFraction</span><span class="p">()</span></div>

<div class="viewcode-block" id="Block_TestCase.test_clearDensity"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_clearDensity">[docs]</a>    <span class="k">def</span> <span class="nf">test_clearDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNuclides</span><span class="p">():</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getNumberDensity"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nucKey</span><span class="p">,</span> <span class="n">nucItem</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucKey</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">nucItem</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getMasses"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getMasses">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMasses</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">masses</span><span class="p">),</span> <span class="mi">13</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">masses</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_removeMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_removeMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_removeMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mass0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">mass0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">removeMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="n">mass1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">mass1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">mass0</span><span class="p">,</span> <span class="n">mass1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setNumberDensity"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setNumberDensity">[docs]</a>    <span class="k">def</span> <span class="nf">test_setNumberDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setNumberDensities"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setNumberDensities">[docs]</a>    <span class="k">def</span> <span class="nf">test_setNumberDensities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure we can set multiple number densities at once.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">b</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nucKey</span><span class="p">,</span> <span class="n">nucItem</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucKey</span><span class="p">)</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">nucItem</span>
            <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="c1"># make sure U235 stayed fully contained in the fuel component</span>
        <span class="n">fuelC</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">),</span>
            <span class="n">fuelC</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">fuelC</span><span class="o">.</span><span class="n">getVolumeFraction</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># make sure other vals were zeroed out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;NA23&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="n">nucName</span> <span class="o">=</span> <span class="s2">&quot;U235&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">A</span> <span class="o">/</span> <span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_setMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="n">mass</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="n">nuc</span> <span class="o">=</span> <span class="s2">&quot;U238&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">mass</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nuc</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">/</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getTotalMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getTotalMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_getTotalMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="n">tot</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nucName</span><span class="p">,</span> <span class="n">nucItem</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">nucItem</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">getAtomicWeight</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
            <span class="n">tot</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">A</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">tot</span> <span class="o">*</span> <span class="n">v</span> <span class="o">/</span> <span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_replaceBlockWithBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_replaceBlockWithBlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_replaceBlockWithBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests conservation of mass flag in replaceBlockWithBlock.&quot;&quot;&quot;</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="n">ductBlock</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">)</span>
        <span class="n">ductBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">ductBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">ductBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

        <span class="c1"># get reference data</span>
        <span class="n">refLoc</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">spatialLocator</span>
        <span class="n">refName</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">name</span>
        <span class="n">refHeight</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">height</span>
        <span class="n">ductBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">99</span> <span class="o">*</span> <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">block</span><span class="o">.</span><span class="n">replaceBlockWithBlock</span><span class="p">(</span><span class="n">ductBlock</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">spatialLocator</span><span class="p">,</span> <span class="n">refLoc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">refName</span><span class="p">,</span> <span class="n">block</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">refHeight</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getWettedPerimeter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getWettedPerimeter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWettedPerimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getWettedPerimeter</span><span class="p">()</span>

        <span class="n">wire</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">WIRE</span><span class="p">)</span>
        <span class="n">correctionFactor</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
            <span class="o">*</span> <span class="n">wire</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;helixDiameter&quot;</span><span class="p">)</span>
            <span class="o">/</span> <span class="n">wire</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;axialPitch&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">wireDiameter</span> <span class="o">=</span> <span class="n">wire</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">correctionFactor</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">wireDiameter</span>
        <span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span>
            <span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="mi">3</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getFlowAreaPerPin"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getFlowAreaPerPin">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFlowAreaPerPin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">nPins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFlowAreaPerPin</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">area</span> <span class="o">/</span> <span class="n">nPins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getFlowArea"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getFlowArea">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFlowArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFlowArea</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getHydraulicDiameter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getHydraulicDiameter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getHydraulicDiameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHydraulicDiameter</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFlowArea</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getWettedPerimeter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_adjustUEnrich"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_adjustUEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">test_adjustUEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span><span class="o">.</span><span class="n">getEnrichment</span><span class="p">()</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setLocation"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setLocation">[docs]</a>    <span class="k">def</span> <span class="nf">test_setLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a blocks location.</span>

<span class="sd">        .. test:: Location of a block is retrievable.</span>
<span class="sd">            :id: T_ARMI_BLOCK_POSI0</span>
<span class="sd">            :tests: R_ARMI_BLOCK_POSI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="c1"># a bit obvious, but location is a property now...</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getLocation</span><span class="p">(),</span> <span class="s2">&quot;002-003-000&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># now if we don&#39;t specify axial, it will move to the new xy, location and have original z index</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">(),</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># center blocks have a different symmetry factor for 1/3rd core</span>
        <span class="k">for</span> <span class="n">symmetry</span><span class="p">,</span> <span class="n">powerMult</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">FULL_CORE</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span>
                <span class="p">),</span>
                <span class="mi">3</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="o">.</span><span class="n">fromAny</span><span class="p">(</span><span class="n">symmetry</span><span class="p">)</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">spatialLocator</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">(),</span> <span class="n">powerMult</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setBuLimitInfo"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setBuLimitInfo">[docs]</a>    <span class="k">def</span> <span class="nf">test_setBuLimitInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;igniter fuel&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setBuLimitInfo</span><span class="p">()</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buLimit</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getTotalNDens"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getTotalNDens">[docs]</a>    <span class="k">def</span> <span class="nf">test_getTotalNDens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getTotalNDens</span><span class="p">()</span>

        <span class="n">tot</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ndens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
            <span class="n">tot</span> <span class="o">+=</span> <span class="n">ndens</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="n">tot</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getHMDens"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getHMDens">[docs]</a>    <span class="k">def</span> <span class="nf">test_getHMDens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHMDens</span><span class="p">()</span>

        <span class="n">hmDens</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nuclide</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nucDir</span><span class="o">.</span><span class="n">isHeavyMetal</span><span class="p">(</span><span class="n">nuclide</span><span class="p">):</span>
                <span class="c1"># then nuclide is a HM</span>
                <span class="n">hmDens</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nuclide</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="n">hmDens</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getFissileMassEnrich"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getFissileMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">test_getFissileMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fuelComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuelComponent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFissileMassEnrich</span><span class="p">()</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFissileMass</span><span class="p">()</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHMMass</span><span class="p">()</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fuelComponent</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getMicroSuffix"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getMicroSuffix">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMicroSuffix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">(),</span> <span class="s2">&quot;AA&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">(),</span> <span class="s2">&quot;ZA&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;RS&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">(),</span> <span class="s2">&quot;RS&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">buGroup</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;AB&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMicroSuffix</span><span class="p">()</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getUraniumMassEnrich"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getUraniumMassEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">test_getUraniumMassEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="mf">0.25</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getUraniumMassEnrich</span><span class="p">()</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getUraniumNumEnrich"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getUraniumNumEnrich">[docs]</a>    <span class="k">def</span> <span class="nf">test_getUraniumNumEnrich</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getUraniumNumEnrich</span><span class="p">()</span>

        <span class="n">u8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="n">u5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">u5</span> <span class="o">/</span> <span class="p">(</span><span class="n">u8</span> <span class="o">+</span> <span class="n">u5</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># test the zero edge case</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustUEnrich</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getUraniumNumEnrich</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getNumberOfAtoms"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getNumberOfAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNumberOfAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.00275173784234</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.0217358415457</span><span class="p">,</span>
            <span class="s2">&quot;W182&quot;</span><span class="p">:</span> <span class="mf">1.09115150103e-05</span><span class="p">,</span>
            <span class="s2">&quot;W183&quot;</span><span class="p">:</span> <span class="mf">5.89214392093e-06</span><span class="p">,</span>
            <span class="s2">&quot;W184&quot;</span><span class="p">:</span> <span class="mf">1.26159558164e-05</span><span class="p">,</span>
            <span class="s2">&quot;W186&quot;</span><span class="p">:</span> <span class="mf">1.17057432664e-05</span><span class="p">,</span>
            <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.00709003962772</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span><span class="n">refDict</span><span class="p">)</span>

        <span class="n">nucName</span> <span class="o">=</span> <span class="s2">&quot;U238&quot;</span>
        <span class="n">moles</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">AVOGADROS_NUMBER</span>
        <span class="p">)</span>  <span class="c1"># about 158 moles</span>
        <span class="n">refMoles</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">refDict</span><span class="p">[</span><span class="s2">&quot;U238&quot;</span><span class="p">]</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="o">/</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">moles</span><span class="p">,</span> <span class="n">refMoles</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getPu"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getPu">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">vFrac</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getVolumeFraction</span><span class="p">()</span>
        <span class="n">refDict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;AM241&quot;</span><span class="p">:</span> <span class="mf">2.695633500634074e-05</span><span class="p">,</span>
            <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.015278429635341755</span><span class="p">,</span>
            <span class="s2">&quot;O16&quot;</span><span class="p">:</span> <span class="mf">0.04829586365251901</span><span class="p">,</span>
            <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.004619446966056436</span><span class="p">,</span>
            <span class="s2">&quot;PU239&quot;</span><span class="p">:</span> <span class="mf">0.0032640382635406515</span><span class="p">,</span>
            <span class="s2">&quot;PU238&quot;</span><span class="p">:</span> <span class="mf">4.266845903720035e-06</span><span class="p">,</span>
            <span class="s2">&quot;PU240&quot;</span><span class="p">:</span> <span class="mf">0.000813669265183342</span><span class="p">,</span>
            <span class="s2">&quot;PU241&quot;</span><span class="p">:</span> <span class="mf">0.00011209296581262849</span><span class="p">,</span>
            <span class="s2">&quot;PU242&quot;</span><span class="p">:</span> <span class="mf">2.3078961257395204e-05</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">fuel</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">({</span><span class="n">nuc</span><span class="p">:</span> <span class="n">v</span> <span class="o">/</span> <span class="n">vFrac</span> <span class="k">for</span> <span class="n">nuc</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="c1"># test moles</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPuMoles</span><span class="p">()</span>
        <span class="n">ndens</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="n">refDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">nucName</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PU238&quot;</span><span class="p">,</span> <span class="s2">&quot;PU239&quot;</span><span class="p">,</span> <span class="s2">&quot;PU240&quot;</span><span class="p">,</span> <span class="s2">&quot;PU241&quot;</span><span class="p">,</span> <span class="s2">&quot;PU242&quot;</span><span class="p">]:</span>
                <span class="n">ndens</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">nucName</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ndens</span>
            <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
            <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_adjustDensity"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_adjustDensity">[docs]</a>    <span class="k">def</span> <span class="nf">test_adjustDensity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">u235Dens</span> <span class="o">=</span> <span class="mf">0.003</span>
        <span class="n">u238Dens</span> <span class="o">=</span> <span class="mf">0.010</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="n">u235Dens</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">,</span> <span class="n">u238Dens</span><span class="p">)</span>
        <span class="n">mass1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">([</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="s2">&quot;U238&quot;</span><span class="p">])</span>
        <span class="n">densAdj</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">nucList</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="s2">&quot;U238&quot;</span><span class="p">]</span>
        <span class="n">massDiff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">adjustDensity</span><span class="p">(</span><span class="n">densAdj</span><span class="p">,</span> <span class="n">nucList</span><span class="p">,</span> <span class="n">returnMass</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mass2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">([</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="s2">&quot;U238&quot;</span><span class="p">])</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">densAdj</span> <span class="o">*</span> <span class="n">u235Dens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">densAdj</span> <span class="o">*</span> <span class="n">u238Dens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">mass2</span> <span class="o">-</span> <span class="n">mass1</span><span class="p">,</span> <span class="n">massDiff</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_completeInitialLoading"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_completeInitialLoading">[docs]</a>    <span class="k">def</span> <span class="nf">test_completeInitialLoading</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">height</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">clearNumberDensities</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setNumberDensities</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;U238&quot;</span><span class="p">:</span> <span class="mf">0.018518936996911595</span><span class="p">,</span>
                <span class="s2">&quot;ZR&quot;</span><span class="p">:</span> <span class="mf">0.006040713762820692</span><span class="p">,</span>
                <span class="s2">&quot;U235&quot;</span><span class="p">:</span> <span class="mf">0.0023444806416701184</span><span class="p">,</span>
                <span class="s2">&quot;NA23&quot;</span><span class="p">:</span> <span class="mf">0.009810163826158255</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">completeInitialLoading</span><span class="p">()</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getHMDens</span><span class="p">()</span> <span class="o">/</span> <span class="n">MOLES_PER_CC_TO_ATOMS_PER_BARN_CM</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="n">area</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_add"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_add">[docs]</a>    <span class="k">def</span> <span class="nf">test_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numComps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">())</span>

        <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">127.0</span><span class="p">}</span>

        <span class="n">newComp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newComp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">numComps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">newComp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">newComp</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_hasComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_hasComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_hasComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasComponents</span><span class="p">([</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasComponents</span><span class="p">([</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">DUMMY</span><span class="p">])</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentNames"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentNames">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentNames</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="s2">&quot;annular void&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bond&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inner liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;outer liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clad&quot;</span><span class="p">,</span>
                <span class="s2">&quot;wire&quot;</span><span class="p">,</span>
                <span class="s2">&quot;coolant&quot;</span><span class="p">,</span>
                <span class="s2">&quot;duct&quot;</span><span class="p">,</span>
                <span class="s2">&quot;interCoolant&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cur</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">comps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span>
            <span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inter</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span>
            <span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># case insensitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)])</span>

        <span class="n">cool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cool</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponent"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponent">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">)</span>

        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="c1"># this really isnt the responsibility of block, more of Flags, but until this refactor</span>
            <span class="c1"># is over...</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span>
                <span class="n">Flags</span><span class="o">.</span><span class="n">fromString</span><span class="p">(</span><span class="s2">&quot;intercoolantlala&quot;</span><span class="p">),</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="n">cool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">exact</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">cool</span><span class="p">,</span> <span class="n">components</span><span class="o">.</span><span class="n">Component</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentsOfShape"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentsOfShape">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentsOfShape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;annular void&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bond&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gap1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inner liner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gap2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;outer liner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gap3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;clad&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsOfShape</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ref</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">cur</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentsOfMaterial"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentsOfMaterial">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentsOfMaterial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsOfMaterial</span><span class="p">(</span><span class="n">materials</span><span class="o">.</span><span class="n">UZr</span><span class="p">())</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsOfMaterial</span><span class="p">(</span><span class="n">materials</span><span class="o">.</span><span class="n">HT9</span><span class="p">()),</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">OUTER</span> <span class="o">|</span> <span class="n">Flags</span><span class="o">.</span><span class="n">LINER</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">WIRE</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># test edge case</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsOfMaterial</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ref</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentByName"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentByName">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentByName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test children by name.</span>

<span class="sd">        .. test:: Get children by name.</span>
<span class="sd">            :id: T_ARMI_CMP_BY_NAME0</span>
<span class="sd">            :tests: R_ARMI_CMP_BY_NAME</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s2">&quot;not the droid youre looking for&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="s2">&quot;annular void&quot;</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getSortedComponentsInsideOfComponentClad"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getSortedComponentsInsideOfComponentClad">[docs]</a>    <span class="k">def</span> <span class="nf">test_getSortedComponentsInsideOfComponentClad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that components can be sorted within a block and returned in the correct order.</span>

<span class="sd">        For an arbitrary example: a clad component.</span>

<span class="sd">        .. test:: Get children by name.</span>
<span class="sd">            :id: T_ARMI_CMP_BY_NAME1</span>
<span class="sd">            :tests: R_ARMI_CMP_BY_NAME</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;annular void&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bond&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inner liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;outer liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap3&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="n">clad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">)</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSortedComponentsInsideOfComponent</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getSortedComponentsInsideOfComponentDuct"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getSortedComponentsInsideOfComponentDuct">[docs]</a>    <span class="k">def</span> <span class="nf">test_getSortedComponentsInsideOfComponentDuct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that components can be sorted within a block and returned in the correct order.</span>

<span class="sd">        For an arbitrary example: a duct.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentByName</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;annular void&quot;</span><span class="p">,</span>
                <span class="s2">&quot;bond&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap1&quot;</span><span class="p">,</span>
                <span class="s2">&quot;inner liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap2&quot;</span><span class="p">,</span>
                <span class="s2">&quot;outer liner&quot;</span><span class="p">,</span>
                <span class="s2">&quot;gap3&quot;</span><span class="p">,</span>
                <span class="s2">&quot;clad&quot;</span><span class="p">,</span>
                <span class="s2">&quot;wire&quot;</span><span class="p">,</span>
                <span class="s2">&quot;coolant&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">]</span>
        <span class="n">clad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getSortedComponentsInsideOfComponent</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertListEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getNumComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getNumComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNumComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumComponents</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getNumPins"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getNumPins">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNumPins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that we can get the number of pins from various blocks.</span>

<span class="sd">        .. test:: Retrieve the number of pins from various blocks.</span>
<span class="sd">            :id: T_ARMI_BLOCK_NPINS</span>
<span class="sd">            :tests: R_ARMI_BLOCK_NPINS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">emptyBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;empty&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">emptyBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">holedRectangle</span> <span class="o">=</span> <span class="n">complexShapes</span><span class="o">.</span><span class="n">HoledRectangle</span><span class="p">(</span>
            <span class="s2">&quot;holedRectangle&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="n">holedRectangle</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">Flags</span><span class="o">.</span><span class="n">CONTROL</span><span class="p">)</span>
        <span class="n">emptyBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">holedRectangle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">emptyBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">hexagon</span> <span class="o">=</span> <span class="n">basicShapes</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;hexagon&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">hexagon</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">Flags</span><span class="o">.</span><span class="n">SHIELD</span><span class="p">)</span>
        <span class="n">emptyBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hexagon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">emptyBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">pins</span> <span class="o">=</span> <span class="n">basicShapes</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">pins</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">Flags</span><span class="o">.</span><span class="n">PLENUM</span><span class="p">)</span>
        <span class="n">emptyBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pins</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">emptyBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setLinPowByPin"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setLinPowByPin">[docs]</a>    <span class="k">def</span> <span class="nf">test_setLinPowByPin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numPins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
        <span class="n">neutronPower</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPins</span><span class="p">)]</span>
        <span class="n">gammaPower</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPins</span><span class="p">)]</span>
        <span class="n">totalPower</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">,</span> <span class="n">gammaPower</span><span class="p">)]</span>

        <span class="n">totalPowerKey</span> <span class="o">=</span> <span class="s2">&quot;linPowByPin&quot;</span>
        <span class="n">neutronPowerKey</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;linPowByPin</span><span class="si">{</span><span class="n">NEUTRON</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">gammaPowerKey</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;linPowByPin</span><span class="si">{</span><span class="n">GAMMA</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Try setting gamma power too early and then reset</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">UnboundLocalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">context</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinPowers</span><span class="p">(</span>
                <span class="n">gammaPower</span><span class="p">,</span>
                <span class="n">powerKeySuffix</span><span class="o">=</span><span class="n">GAMMA</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">errorMsg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Neutron power has not been set yet. Cannot set total power for &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">errorMsg</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">exception</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">gammaPowerKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Test with no powerKeySuffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinPowers</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">totalPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">neutronPowerKey</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">gammaPowerKey</span><span class="p">])</span>

        <span class="c1"># Test with neutron powers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinPowers</span><span class="p">(</span>
            <span class="n">neutronPower</span><span class="p">,</span>
            <span class="n">powerKeySuffix</span><span class="o">=</span><span class="n">NEUTRON</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">totalPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">neutronPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">gammaPowerKey</span><span class="p">])</span>

        <span class="c1"># Test with gamma powers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinPowers</span><span class="p">(</span>
            <span class="n">gammaPower</span><span class="p">,</span>
            <span class="n">powerKeySuffix</span><span class="o">=</span><span class="n">GAMMA</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">totalPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">totalPower</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">neutronPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">neutronPower</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="n">gammaPowerKey</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gammaPower</span><span class="p">))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentAreaFrac"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentAreaFrac">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentAreaFrac</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">calcFracManually</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
            <span class="n">tFrac</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">frac</span> <span class="ow">in</span> <span class="n">fracs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                        <span class="n">tFrac</span> <span class="o">+=</span> <span class="n">frac</span>
            <span class="k">return</span> <span class="n">tFrac</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

        <span class="n">refList</span> <span class="o">=</span> <span class="p">[</span><span class="n">Flags</span><span class="o">.</span><span class="n">BOND</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">]</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentAreaFrac</span><span class="p">(</span><span class="n">refList</span><span class="p">)</span>
        <span class="n">fracs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>

        <span class="n">ref</span> <span class="o">=</span> <span class="n">calcFracManually</span><span class="p">((</span><span class="s2">&quot;bond&quot;</span><span class="p">,</span> <span class="s2">&quot;coolant&quot;</span><span class="p">))</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="c1"># allow inexact for things like fuel1, fuel2 or clad vs. cladding</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentAreaFrac</span><span class="p">([</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">])</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">calcFracManually</span><span class="p">([</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;interCoolant&quot;</span><span class="p">])</span>
        <span class="n">refWrong</span> <span class="o">=</span> <span class="n">calcFracManually</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;interCoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;clad&quot;</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># can&#39;t use &#39;clad&#39; b/c ``calcFracManually`` is exact only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotAlmostEqual</span><span class="p">(</span><span class="n">refWrong</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_100_getPinPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_100_getPinPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_100_getPinPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPinPitch</span><span class="p">()</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">WIRE</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">)</span>
        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_101_getPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_101_getPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_101_getPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPitch</span><span class="p">(</span><span class="n">returnComp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDim</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">,</span> <span class="s2">&quot;op&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">newb</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPitch</span><span class="p">(</span><span class="n">returnComp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">p2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">newb</span><span class="o">.</span><span class="n">getPitch</span><span class="p">(</span><span class="n">returnComp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">newb</span><span class="o">.</span><span class="n">getLargestComponent</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">),</span> <span class="n">c2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_102_setPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_102_setPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_102_setPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="mf">17.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPitch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">pitch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">),</span> <span class="n">pitch</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_106_getAreaFractions"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_106_getAreaFractions">[docs]</a>    <span class="k">def</span> <span class="nf">test_106_getAreaFractions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>
        <span class="n">tot</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">areas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">iterComponents</span><span class="p">():</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="n">tot</span> <span class="o">+=</span> <span class="n">a</span>
            <span class="n">areas</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
        <span class="n">fracs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">areas</span><span class="p">:</span>
            <span class="n">fracs</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getName</span><span class="p">()]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">tot</span>

        <span class="n">places</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fracs</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">getName</span><span class="p">()],</span> <span class="n">places</span><span class="o">=</span><span class="n">places</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">fracs</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="nb">sum</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Block_TestCase.test_rotatePins"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_rotatePins">[docs]</a>    <span class="k">def</span> <span class="nf">test_rotatePins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setRotationNum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">justCompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getRotationNum</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># pin 1 is center and never rotates.</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getRotationNum</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinLocation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getRotationNum</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinLocation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># over-rotate to check modulus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getRotationNum</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinLocation</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinLocation</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">rotatePins</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_expandElementalToIsotopics"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_expandElementalToIsotopics">[docs]</a>    <span class="k">def</span> <span class="nf">test_expandElementalToIsotopics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tests the expand to elementals capability.&quot;&quot;&quot;</span>
        <span class="n">initialN</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">initialM</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">elementals</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuclideBases</span><span class="o">.</span><span class="n">byName</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FE&quot;</span><span class="p">,</span> <span class="s2">&quot;CR&quot;</span><span class="p">,</span> <span class="s2">&quot;SI&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;MO&quot;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">elemental</span> <span class="ow">in</span> <span class="n">elementals</span><span class="p">:</span>
            <span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span>
                <span class="n">elemental</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>  <span class="c1"># homogenized</span>
            <span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">elemental</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">elemental</span> <span class="ow">in</span> <span class="n">elementals</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">expandElementalToIsotopics</span><span class="p">(</span><span class="n">elemental</span><span class="p">)</span>
            <span class="n">newDens</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">newMass</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">natNuc</span> <span class="ow">in</span> <span class="n">elemental</span><span class="o">.</span><span class="n">getNaturalIsotopics</span><span class="p">():</span>
                <span class="n">newDens</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">natNuc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">newMass</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">natNuc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span>
                <span class="n">newDens</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Isotopic </span><span class="si">{2}</span><span class="s2"> ndens does not add up to </span><span class="si">{0}</span><span class="s2">. It adds to </span><span class="si">{1}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span> <span class="n">newDens</span><span class="p">,</span> <span class="n">elemental</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span>
                <span class="n">newMass</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Isotopic </span><span class="si">{2}</span><span class="s2"> mass does not add up to </span><span class="si">{0}</span><span class="s2"> g. &quot;</span>
                <span class="s2">&quot;It adds to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span> <span class="n">newMass</span><span class="p">,</span> <span class="n">elemental</span><span class="p">),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_expandAllElementalsToIsotopics"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_expandAllElementalsToIsotopics">[docs]</a>    <span class="k">def</span> <span class="nf">test_expandAllElementalsToIsotopics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tests the expand all elementals simlutaneously capability.&quot;&quot;&quot;</span>
        <span class="n">initialN</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">initialM</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">elementals</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuclideBases</span><span class="o">.</span><span class="n">byName</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;FE&quot;</span><span class="p">,</span> <span class="s2">&quot;CR&quot;</span><span class="p">,</span> <span class="s2">&quot;SI&quot;</span><span class="p">,</span> <span class="s2">&quot;V&quot;</span><span class="p">,</span> <span class="s2">&quot;MO&quot;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">elemental</span> <span class="ow">in</span> <span class="n">elementals</span><span class="p">:</span>
            <span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span>
                <span class="n">elemental</span><span class="o">.</span><span class="n">name</span>
            <span class="p">)</span>  <span class="c1"># homogenized</span>
            <span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">elemental</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">expandAllElementalsToIsotopics</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">elemental</span> <span class="ow">in</span> <span class="n">elementals</span><span class="p">:</span>
            <span class="n">newDens</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">newMass</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">natNuc</span> <span class="ow">in</span> <span class="n">elemental</span><span class="o">.</span><span class="n">getNaturalIsotopics</span><span class="p">():</span>
                <span class="n">newDens</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="n">natNuc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">newMass</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMass</span><span class="p">(</span><span class="n">natNuc</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span>
                <span class="n">newDens</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Isotopic </span><span class="si">{2}</span><span class="s2"> ndens does not add up to </span><span class="si">{0}</span><span class="s2">. It adds to </span><span class="si">{1}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialN</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span> <span class="n">newDens</span><span class="p">,</span> <span class="n">elemental</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span>
                <span class="n">newMass</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Isotopic </span><span class="si">{2}</span><span class="s2"> mass does not add up to </span><span class="si">{0}</span><span class="s2"> g. &quot;</span>
                <span class="s2">&quot;It adds to </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initialM</span><span class="p">[</span><span class="n">elemental</span><span class="p">],</span> <span class="n">newMass</span><span class="p">,</span> <span class="n">elemental</span><span class="p">),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_setPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks consistency after adjusting pitch.</span>

<span class="sd">        Needed to verify fix to Issue #165.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="n">moles1</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setPitch</span><span class="p">(</span><span class="mf">17.5</span><span class="p">)</span>
        <span class="n">moles2</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">moles1</span><span class="p">,</span> <span class="n">moles2</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">setPitch</span><span class="p">(</span><span class="mf">20.0</span><span class="p">)</span>
        <span class="n">moles3</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">molesHmBOL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">moles2</span><span class="p">,</span> <span class="n">moles3</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_setImportantParams"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_setImportantParams">[docs]</a>    <span class="k">def</span> <span class="nf">test_setImportantParams</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Confirm that important block parameters can be set and get.&quot;&quot;&quot;</span>
        <span class="c1"># Test ability to set and get flux</span>
        <span class="n">applyDummyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">161720716762.12997</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">601494405.293505</span><span class="p">)</span>

        <span class="c1"># Test ability to set and get number density</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>

        <span class="n">u235_dens</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">u235_dens</span><span class="p">,</span> <span class="mf">0.003695461770836022</span><span class="p">)</span>

        <span class="n">fuel</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">u235_dens</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">u235_dens</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># TH parameter test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmassFlowRate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmassFlowRate</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmassFlowRate</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getMfp"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getMfp">[docs]</a>    <span class="k">def</span> <span class="nf">test_getMfp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test mean free path.&quot;&quot;&quot;</span>
        <span class="n">applyDummyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
        <span class="c1"># These are unverified numbers, just the result of this calculation.</span>
        <span class="n">mfp</span><span class="p">,</span> <span class="n">mfpAbs</span><span class="p">,</span> <span class="n">diffusionLength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getMfp</span><span class="p">()</span>
        <span class="c1"># no point testing these number to high accuracy.</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="mf">3.9</span><span class="p">,</span> <span class="n">mfp</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="mf">235.0</span><span class="p">,</span> <span class="n">mfpAbs</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="mf">17.0</span><span class="p">,</span> <span class="n">diffusionLength</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_consistentMassDensityVolumeBetweenColdBlockAndColdComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_consistentMassDensityVolumeBetweenColdBlockAndColdComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_consistentMassDensityVolumeBetweenColdBlockAndColdComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span>
        <span class="n">expectedData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actualData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">expectedData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getComponentData</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="n">actualData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">density</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">density</span><span class="p">()</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expectedData</span><span class="p">,</span> <span class="n">actualData</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Data (component, density, volume, mass) for component </span><span class="si">{}</span><span class="s2"> does not match. &quot;</span>
                <span class="s2">&quot;Expected: </span><span class="si">{}</span><span class="s2">, Actual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">expectedVal</span><span class="p">,</span> <span class="n">actualVal</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">expectedVal</span><span class="p">,</span> <span class="n">actualVal</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_consistentMassDensityVolumeBetweenHotBlockAndHotComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_consistentMassDensityVolumeBetweenHotBlockAndHotComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_consistentMassDensityVolumeBetweenHotBlockAndHotComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hotBlock</span>
        <span class="n">expectedData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actualData</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">block</span><span class="p">:</span>
            <span class="n">expectedData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">getComponentData</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="n">actualData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">density</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">density</span><span class="p">()</span> <span class="o">*</span> <span class="n">c</span><span class="o">.</span><span class="n">getVolume</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expectedData</span><span class="p">,</span> <span class="n">actualData</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Data (component, density, volume, mass) for component </span><span class="si">{}</span><span class="s2"> does not match. &quot;</span>
                <span class="s2">&quot;Expected: </span><span class="si">{}</span><span class="s2">, Actual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">expectedVal</span><span class="p">,</span> <span class="n">actualVal</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">expectedVal</span><span class="p">,</span> <span class="n">actualVal</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_consistentAreaWithOverlappingComponents"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_consistentAreaWithOverlappingComponents">[docs]</a>    <span class="k">def</span> <span class="nf">test_consistentAreaWithOverlappingComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that negative gap areas correctly account for area overlapping upon thermal expansion.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This test calculates a reference coolant area by subtracting the areas of the intercoolant,</span>
<span class="sd">        duct, wire wrap, and pins from the total hex block area. The area of the pins is calculated</span>
<span class="sd">        using only the outer radius of the clad. This avoids the use of negative areas as</span>
<span class="sd">        implemented in Block.getVolumeFractions. Na-23 mass will not be conserved as when duct/clad</span>
<span class="sd">        expands sodium is evacuated.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.reactor.blocks.Block.getVolumeFractions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numFE56</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">(</span><span class="s2">&quot;FE56&quot;</span><span class="p">)</span>
        <span class="n">numU235</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">800</span><span class="p">)</span>
        <span class="n">hasNegativeArea</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">hasNegativeArea</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span>  <span class="c1"># sets coolant area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_testDimensionsAreLinked</span><span class="p">()</span>  <span class="c1"># linked dimensions are needed for this test to work</span>

        <span class="n">blockPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPitch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">blockPitch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">totalHexArea</span> <span class="o">=</span> <span class="n">blockPitch</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">clad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">)</span>
        <span class="n">pinArea</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">clad</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">clad</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">totalHexArea</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">WIRE</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
            <span class="o">-</span> <span class="n">pinArea</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">totalHexArea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getArea</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">numFE56</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">(</span><span class="s2">&quot;FE56&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">numU235</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberOfAtoms</span><span class="p">(</span><span class="s2">&quot;U235&quot;</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_testDimensionsAreLinked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">prevC</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsOfShape</span><span class="p">(</span><span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">prevC</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">prevC</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">),</span> <span class="n">c</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">))</span>
            <span class="n">prevC</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">)</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;ip&quot;</span><span class="p">),</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Block_TestCase.test_breakFuelComponentsIntoIndividuals"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_breakFuelComponentsIntoIndividuals">[docs]</a>    <span class="k">def</span> <span class="nf">test_breakFuelComponentsIntoIndividuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">completeInitialLoading</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">breakFuelComponentsIntoIndividuals</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fuel</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_pinMgFluxes"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_pinMgFluxes">[docs]</a>    <span class="k">def</span> <span class="nf">test_pinMgFluxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test setting/getting of pin-wise fluxes.</span>

<span class="sd">        .. warning:: This will likely be pushed to the component level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">33</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinMgFluxes</span><span class="p">(</span><span class="n">fluxes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinMgFluxes</span><span class="p">(</span><span class="n">fluxes</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">adjoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">setPinMgFluxes</span><span class="p">(</span><span class="n">fluxes</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinMgFluxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinMgFluxesAdj</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pinMgFluxesGamma</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="mf">3.0</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getComponentsInLinkedOrder"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getComponentsInLinkedOrder">[docs]</a>    <span class="k">def</span> <span class="nf">test_getComponentsInLinkedOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsInLinkedOrder</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="p">))</span>

        <span class="n">comps</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponentsInLinkedOrder</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_mergeWithBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_mergeWithBlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_mergeWithBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fuel1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">fuel1</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;CM246&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">block2</span> <span class="o">=</span> <span class="n">loadTestBlock</span><span class="p">()</span>
        <span class="n">fuel2</span> <span class="o">=</span> <span class="n">block2</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">fuel2</span><span class="o">.</span><span class="n">setNumberDensity</span><span class="p">(</span><span class="s2">&quot;CM246&quot;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;CM246&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">mergeWithBlock</span><span class="p">(</span><span class="n">block2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;CM246&quot;</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;CM246&quot;</span><span class="p">),</span> <span class="mf">0.02</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getDimensions"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getDimensions">[docs]</a>    <span class="k">def</span> <span class="nf">test_getDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">(</span><span class="s2">&quot;od&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">od</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getPlenumPin"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getPlenumPin">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPlenumPin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getPlenumPin</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_hasPinPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_hasPinPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_hasPinPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">hasPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">hasPinPitch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">hasPitch</span><span class="p">)</span></div>

<div class="viewcode-block" id="Block_TestCase.test_getReactionRates"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.Block_TestCase.test_getReactionRates">[docs]</a>    <span class="k">def</span> <span class="nf">test_getReactionRates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;HexBlock&quot;</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;defaultType&quot;</span><span class="p">)</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">basicShapes</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;hexagon&quot;</span><span class="p">,</span> <span class="s2">&quot;MOX&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">xsType</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">getEmptyHexReactor</span><span class="p">()</span>
        <span class="n">assembly</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
        <span class="n">assembly</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">assembly</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">isotxs</span><span class="o">.</span><span class="n">readBinary</span><span class="p">(</span><span class="n">ISOAA_PATH</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">mgFlux</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">block</span><span class="o">.</span><span class="n">getReactionRates</span><span class="p">(</span><span class="s2">&quot;PU239&quot;</span><span class="p">)[</span><span class="s2">&quot;nG&quot;</span><span class="p">],</span>
            <span class="n">block</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;PU239&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span><span class="p">[</span><span class="s2">&quot;PU39AA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">micros</span><span class="o">.</span><span class="n">nGamma</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># the key is invalid, so should get back all zeros</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">block</span><span class="o">.</span><span class="n">getReactionRates</span><span class="p">(</span><span class="s2">&quot;PU39&quot;</span><span class="p">),</span>
            <span class="p">{</span><span class="s2">&quot;nG&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nF&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n2n&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nA&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;nP&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;n3n&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="BlockEnergyDepositionConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants">[docs]</a><span class="k">class</span> <span class="nc">BlockEnergyDepositionConstants</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests the energy deposition methods.</span>

<span class="sd">    MagicMocks xsCollections.compute*Constants() -- we&#39;re not testing those methods specifically</span>
<span class="sd">    so just make sure they&#39;re hit</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">loadTestBlock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="n">MagicMock</span><span class="p">()</span>

<div class="viewcode-block" id="BlockEnergyDepositionConstants.test_getTotalEnergyGenerationConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants.test_getTotalEnergyGenerationConstants">[docs]</a>    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeFissionEnergyGenerationConstants&quot;</span><span class="p">)</span>
    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeCaptureEnergyGenerationConstants&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getTotalEnergyGenerationConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_capture</span><span class="p">,</span> <span class="n">mock_fission</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mock both xsCollections methods so you get complete coverage.&quot;&quot;&quot;</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getTotalEnergyGenerationConstants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_fission</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_capture</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="BlockEnergyDepositionConstants.test_getFissionEnergyDepositionConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants.test_getFissionEnergyDepositionConstants">[docs]</a>    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeFissionEnergyGenerationConstants&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getFissionEnergyDepositionConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RuntimeError and that it gets to the deposition constant call.&quot;&quot;&quot;</span>
        <span class="c1"># make sure xsCollections.compute* gets hit</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFissionEnergyGenerationConstants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_method</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># set core.lib to None and get RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="c1"># fails because this test reactor does not have a cross-section library</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getFissionEnergyGenerationConstants</span><span class="p">()</span></div>

<div class="viewcode-block" id="BlockEnergyDepositionConstants.test_getCaptureEnergyGenerationConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants.test_getCaptureEnergyGenerationConstants">[docs]</a>    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeCaptureEnergyGenerationConstants&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getCaptureEnergyGenerationConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RuntimeError and that it gets to the deposition constant call.&quot;&quot;&quot;</span>
        <span class="c1"># make sure xsCollections.compute* gets hit</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getCaptureEnergyGenerationConstants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_method</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># set core.lib to None and get RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="c1"># fails because this test reactor does not have a cross-section library</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getCaptureEnergyGenerationConstants</span><span class="p">()</span></div>

<div class="viewcode-block" id="BlockEnergyDepositionConstants.test_getNeutronEnergyDepositionConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants.test_getNeutronEnergyDepositionConstants">[docs]</a>    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeNeutronEnergyDepositionConstants&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getNeutronEnergyDepositionConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RuntimeError and that it gets to the deposition constant call.&quot;&quot;&quot;</span>
        <span class="c1"># make sure xsCollections.compute* gets hit</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNeutronEnergyDepositionConstants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_method</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># set core.lib to None and get RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getNeutronEnergyDepositionConstants</span><span class="p">()</span></div>

<div class="viewcode-block" id="BlockEnergyDepositionConstants.test_getGammaEnergyDepositionConstants"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.BlockEnergyDepositionConstants.test_getGammaEnergyDepositionConstants">[docs]</a>    <span class="nd">@patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">xsCollections</span><span class="p">,</span> <span class="s2">&quot;computeGammaEnergyDepositionConstants&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_getGammaEnergyDepositionConstants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_method</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test RuntimeError and that it gets to the deposition constant call.&quot;&quot;&quot;</span>
        <span class="c1"># make sure xsCollections.compute* gets hit</span>
        <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getGammaEnergyDepositionConstants</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mock_method</span><span class="o">.</span><span class="n">call_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># set core.lib to None and get RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="c1"># fails because this test reactor does not have a cross-section library</span>
            <span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block</span><span class="o">.</span><span class="n">getGammaEnergyDepositionConstants</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TestNegativeVolume"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.TestNegativeVolume">[docs]</a><span class="k">class</span> <span class="nc">TestNegativeVolume</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestNegativeVolume.test_negativeVolume"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.TestNegativeVolume.test_negativeVolume">[docs]</a>    <span class="k">def</span> <span class="nf">test_negativeVolume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build a Block with WAY too many fuel pins &amp; show that the derived volume is negative.&quot;&quot;&quot;</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>

        <span class="n">coldTemp</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">hotTemp</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">coldTemp</span><span class="p">,</span>
            <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTemp</span><span class="p">,</span>
            <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.84</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1000.0</span><span class="p">,</span>  <span class="c1"># pack in too many fuels</span>
        <span class="p">}</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>

        <span class="n">coolantDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTemp</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTemp</span><span class="p">}</span>
        <span class="n">coolant</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">(</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">coolantDims</span><span class="p">)</span>

        <span class="n">interDims</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="n">hotTemp</span><span class="p">,</span>
            <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="n">hotTemp</span><span class="p">,</span>
            <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">17.8</span><span class="p">,</span>
            <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">17.3</span><span class="p">,</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">interSodium</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;interCoolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">interDims</span><span class="p">)</span>

        <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">coolant</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">interSodium</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="mf">16.0</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">block</span><span class="o">.</span><span class="n">getVolumeFractions</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="HexBlock_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase">[docs]</a><span class="k">class</span> <span class="nc">HexBlock_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>
        <span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mf">70.6</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hexComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">hexDims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hexComponent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">od</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mf">169.0</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="s2">&quot;wire&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">od</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mf">169.0</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DerivedShape</span><span class="p">(</span><span class="s2">&quot;coolant&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span> <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">tests</span><span class="o">.</span><span class="n">getEmptyHexReactor</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">makeTestAssembly</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">)</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">loc1</span><span class="p">)</span>

<div class="viewcode-block" id="HexBlock_TestCase.test_getArea"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getArea">[docs]</a>    <span class="k">def</span> <span class="nf">test_getArea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that we can correctly calculate the area of a hexagonal block.</span>

<span class="sd">        .. test:: Users can create blocks that have the correct hexagonal area.</span>
<span class="sd">            :id: T_ARMI_BLOCK_HEX0</span>
<span class="sd">            :tests: R_ARMI_BLOCK_HEX</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Test for various outer and inner pitches for HexBlocks with hex holes</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.4</span><span class="p">,</span> <span class="mf">20.1234</span><span class="p">,</span> <span class="mf">25.001</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0001</span><span class="p">,</span> <span class="mf">7.123</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">):</span>
                <span class="c1"># generate a block with a different outer pitch</span>
                <span class="n">hBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestAreaHexBlock&quot;</span><span class="p">)</span>
                <span class="n">hexDims</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                    <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span>
                    <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">op</span><span class="p">,</span>
                    <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ip</span><span class="p">,</span>
                    <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">hComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">hexDims</span><span class="p">)</span>
                <span class="n">hBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hComponent</span><span class="p">)</span>

                <span class="c1"># verify the area of the hexagon (with a hex hole) is correct</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">hBlock</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">op</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">ref</span> <span class="o">-=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ip</span><span class="o">**</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">places</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">op</span><span class="p">))</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_component_type"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_component_type">[docs]</a>    <span class="k">def</span> <span class="nf">test_component_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that a hex block has the proper &quot;hexagon&quot; __name__.</span>

<span class="sd">        .. test:: Users can create blocks with a hexagonal shape.</span>
<span class="sd">            :id: T_ARMI_BLOCK_HEX1</span>
<span class="sd">            :tests: R_ARMI_BLOCK_HEX</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pitch_comp_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">PITCH_COMPONENT_TYPE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pitch_comp_type</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="s2">&quot;Hexagon&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_coords"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_coords">[docs]</a>    <span class="k">def</span> <span class="nf">test_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that coordinates are retrievable from a block.</span>

<span class="sd">        .. test:: Coordinates of a block are queryable.</span>
<span class="sd">            :id: T_ARMI_BLOCK_POSI1</span>
<span class="sd">            :tests: R_ARMI_BLOCK_POSI</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">core</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">core</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">a</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">loc1</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># symmetric</span>
        <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">loc1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementX</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">displacementY</span> <span class="o">=</span> <span class="mf">0.02</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">coords</span><span class="p">()</span>

        <span class="c1"># make sure displacements are working</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>

        <span class="c1"># make sure location symmetry is working</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="o">-</span><span class="n">x2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="o">-</span><span class="n">y2</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_getNumPins"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getNumPins">[docs]</a>    <span class="k">def</span> <span class="nf">test_getNumPins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">(),</span> <span class="mi">169</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_block_dims"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_block_dims">[docs]</a>    <span class="k">def</span> <span class="nf">test_block_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tests that the block class can provide basic dimensionality information about itself.</span>

<span class="sd">        .. test:: Important block dimensions are retrievable.</span>
<span class="sd">            :id: T_ARMI_BLOCK_DIMS</span>
<span class="sd">            :tests: R_ARMI_BLOCK_DIMS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">4316.582</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getVolume</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">70.6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">4316.582</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getMaxArea</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getDuctIP</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">70.6</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getDuctOP</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">34.273</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinToDuctGap</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinPitch</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">300.889</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getWettedPerimeter</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">4242.184</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getFlowArea</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">56.395</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getHydraulicDiameter</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_symmetryFactor"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_symmetryFactor">[docs]</a>    <span class="k">def</span> <span class="nf">test_symmetryFactor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># full hex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">())</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getVolume</span><span class="p">()</span>
        <span class="n">m0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="c1"># 1/3 symmetric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getVolume</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">m0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getMass</span><span class="p">())</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_retainState"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_retainState">[docs]</a>    <span class="k">def</span> <span class="nf">test_retainState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure retainState restores params and spatialGrids.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;intercoolant&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">retainState</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">setType</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">changePitch</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialGrid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">hasFlags</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">INTERCOOLANT</span><span class="p">))</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_getPinCoords"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getPinCoords">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPinCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">blockPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">()</span>
        <span class="n">pinPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinPitch</span><span class="p">()</span>
        <span class="n">nPins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">()</span>
        <span class="n">side</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">side</span><span class="p">(</span><span class="n">blockPitch</span><span class="p">)</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinCoordinates</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_z</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">xyz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="p">)</span>  <span class="c1"># first two pins should be side by side on top.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotAlmostEqual</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">())</span>

        <span class="c1"># ensure all pins are within the proper bounds of a</span>
        <span class="c1"># flats-up oriented hex block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">blockPitch</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="o">-</span><span class="n">blockPitch</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">-</span><span class="n">side</span><span class="p">)</span>

        <span class="c1"># center pin should be at 0</span>
        <span class="n">mags</span> <span class="o">=</span> <span class="p">[(</span><span class="n">xi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yi</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span> <span class="ow">in</span> <span class="n">xyz</span><span class="p">]</span>
        <span class="n">_centerMag</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># extreme pin should be at proper radius</span>
        <span class="n">cornerMag</span><span class="p">,</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
        <span class="n">nRings</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">numRingsToHoldNumCells</span><span class="p">(</span><span class="n">nPins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cornerMag</span><span class="p">),</span> <span class="n">nRings</span> <span class="o">*</span> <span class="n">pinPitch</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_getPitchHomogeneousBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getPitchHomogeneousBlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPitchHomogeneousBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Demonstrate how to communicate pitch on a hex block with unshaped components.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This assumes there are 3 materials in the homogeneous block, one with half the area</span>
<span class="sd">        fraction, and 2 with 1/4 each.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">desiredPitch</span> <span class="o">=</span> <span class="mf">14.0</span>
        <span class="n">hexTotalArea</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">desiredPitch</span><span class="p">)</span>

        <span class="n">compArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">}</span>
        <span class="n">areaFractions</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>
        <span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">]</span>

        <span class="c1"># There are 2 ways to do this, the first is to pick a component to be the pitch defining</span>
        <span class="c1"># component, and given it the shape of a hexagon to define the pitch. The hexagon outer</span>
        <span class="c1"># pitch (op) is defined by the pitch of the block/assembly. The ip is defined by whatever</span>
        <span class="c1"># thickness is necessary to have the desired area fraction. The second way is shown in the</span>
        <span class="c1"># second half of this test.</span>
        <span class="n">hexBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>

        <span class="n">hexComponentArea</span> <span class="o">=</span> <span class="n">areaFractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">hexTotalArea</span>

        <span class="c1"># Picking 1st material to use for the hex component here, but really the choice is</span>
        <span class="c1"># arbitrary. area grows quadratically with op</span>
        <span class="n">ipNeededForCorrectArea</span> <span class="o">=</span> <span class="n">desiredPitch</span> <span class="o">*</span> <span class="n">areaFractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">hexComponentArea</span><span class="p">,</span> <span class="n">hexTotalArea</span> <span class="o">-</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">ipNeededForCorrectArea</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">hexArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="n">desiredPitch</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="n">ipNeededForCorrectArea</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
        <span class="n">hexArgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compArgs</span><span class="p">)</span>
        <span class="n">pitchDefiningComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span>
            <span class="s2">&quot;pitchComp&quot;</span><span class="p">,</span> <span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">hexArgs</span>
        <span class="p">)</span>
        <span class="n">hexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pitchDefiningComponent</span><span class="p">)</span>

        <span class="c1"># hex component is added, now add the rest as unshaped.</span>
        <span class="k">for</span> <span class="n">aFrac</span><span class="p">,</span> <span class="n">material</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">areaFractions</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">unshapedArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">hexTotalArea</span> <span class="o">*</span> <span class="n">aFrac</span><span class="p">}</span>
            <span class="n">unshapedArgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compArgs</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;unshaped </span><span class="si">{</span><span class="n">material</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">UnshapedComponent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">**</span><span class="n">unshapedArgs</span><span class="p">)</span>
            <span class="n">hexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desiredPitch</span><span class="p">,</span> <span class="n">hexBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">hexTotalArea</span><span class="p">,</span> <span class="n">hexBlock</span><span class="o">.</span><span class="n">getMaxArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hexBlock</span><span class="p">),</span> <span class="n">hexTotalArea</span><span class="p">)</span>

        <span class="c1"># For this second way, we will simply define the 3 components as unshaped, with  the desired</span>
        <span class="c1"># area fractions, and make a 4th component that is an infinitely thin hexagon with the the</span>
        <span class="c1"># desired pitch. The downside of this method is that now the block has a fourth component</span>
        <span class="c1"># with no volume.</span>
        <span class="n">hexBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;TestHexBlock&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aFrac</span><span class="p">,</span> <span class="n">material</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">areaFractions</span><span class="p">,</span> <span class="n">materials</span><span class="p">):</span>
            <span class="n">unshapedArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">hexTotalArea</span> <span class="o">*</span> <span class="n">aFrac</span><span class="p">}</span>
            <span class="n">unshapedArgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compArgs</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;unshaped </span><span class="si">{</span><span class="n">material</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">UnshapedComponent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">**</span><span class="n">unshapedArgs</span><span class="p">)</span>
            <span class="n">hexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="c1"># We haven&#39;t set a pitch defining component this time so set it now with 0 area.</span>
        <span class="n">pitchDefiningComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span>
            <span class="s2">&quot;pitchComp&quot;</span><span class="p">,</span> <span class="s2">&quot;Void&quot;</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">desiredPitch</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="n">desiredPitch</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">compArgs</span>
        <span class="p">)</span>
        <span class="n">hexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pitchDefiningComponent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desiredPitch</span><span class="p">,</span> <span class="n">hexBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">hexTotalArea</span><span class="p">,</span> <span class="n">hexBlock</span><span class="o">.</span><span class="n">getMaxArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hexBlock</span><span class="p">),</span> <span class="n">hexTotalArea</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_getDuctPitch"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getDuctPitch">[docs]</a>    <span class="k">def</span> <span class="nf">test_getDuctPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ductIP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getDuctIP</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">70.0</span><span class="p">,</span> <span class="n">ductIP</span><span class="p">)</span>
        <span class="n">ductOP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getDuctOP</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="mf">70.6</span><span class="p">,</span> <span class="n">ductOP</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_getPinCenterFlatToFlat"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_getPinCenterFlatToFlat">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPinCenterFlatToFlat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">nRings</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">numRingsToHoldNumCells</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getNumPins</span><span class="p">())</span>
        <span class="n">pinPitch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinPitch</span><span class="p">()</span>
        <span class="n">pinCenterCornerToCorner</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">nRings</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">pinPitch</span>
        <span class="n">pinCenterFlatToFlat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">pinCenterCornerToCorner</span>
        <span class="n">f2f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">getPinCenterFlatToFlat</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">pinCenterFlatToFlat</span><span class="p">,</span> <span class="n">f2f</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_gridCreation"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_gridCreation">[docs]</a>    <span class="k">def</span> <span class="nf">test_gridCreation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a grid for a block, and show that it can handle components with multiplicity &gt; 1.</span>

<span class="sd">        .. test:: Grids can handle components with multiplicity &gt; 1.</span>
<span class="sd">            :id: T_ARMI_GRID_MULT</span>
<span class="sd">            :tests: R_ARMI_GRID_MULT</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span>
        <span class="c1"># The block should have a spatial grid at construction,</span>
        <span class="c1"># since it has mults = 1 or 169 from setup</span>
        <span class="n">b</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;mult&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">169</span><span class="p">:</span>
                <span class="c1"># Then it&#39;s spatialLocator must be of size 169</span>
                <span class="n">locations</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">spatialLocator</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">locations</span><span class="p">),</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">)</span>

                <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">uniqueLocations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
                    <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">+</span> <span class="mi">1</span>

                    <span class="c1"># test for the uniqueness of the locations (since mult &gt; 1)</span>
                    <span class="k">if</span> <span class="n">loc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniqueLocations</span><span class="p">:</span>
                        <span class="n">uniqueLocations</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Duplicate location found!&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="mi">169</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_gridNumPinsAndLocations"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_gridNumPinsAndLocations">[docs]</a>    <span class="k">def</span> <span class="nf">test_gridNumPinsAndLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">HexBlock</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

        <span class="n">fuelDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.76</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">168.0</span><span class="p">}</span>
        <span class="n">cladDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span> <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.77</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">168.0</span><span class="p">}</span>
        <span class="n">ductDims</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;op&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;ip&quot;</span><span class="p">:</span> <span class="mf">15.3</span><span class="p">,</span> <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>
        <span class="n">wireDims</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">25.0</span><span class="p">,</span>
            <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
            <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;axialPitch&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
            <span class="s2">&quot;helixDiameter&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">168.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">wire</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Helix</span><span class="p">(</span><span class="s2">&quot;wire&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">wireDims</span><span class="p">)</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;fuel&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">fuelDims</span><span class="p">)</span>
        <span class="n">clad</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">cladDims</span><span class="p">)</span>
        <span class="n">duct</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Hexagon</span><span class="p">(</span><span class="s2">&quot;duct&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">ductDims</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">clad</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">duct</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wire</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">)</span></div>

<div class="viewcode-block" id="HexBlock_TestCase.test_gridNotCreatedMultipleMultiplicities"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.HexBlock_TestCase.test_gridNotCreatedMultipleMultiplicities">[docs]</a>    <span class="k">def</span> <span class="nf">test_gridNotCreatedMultipleMultiplicities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wireDims</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="s2">&quot;od&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="s2">&quot;axialPitch&quot;</span><span class="p">:</span> <span class="mf">30.0</span><span class="p">,</span>
            <span class="s2">&quot;helixDiameter&quot;</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">21.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># add a wire only some places in the block, so grid should not be created.</span>
        <span class="n">wire</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Helix</span><span class="p">(</span><span class="s2">&quot;wire&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">wireDims</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">wire</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialGrid</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># clear existing</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HexBlock</span><span class="o">.</span><span class="n">spatialGrid</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ThRZBlock_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase">[docs]</a><span class="k">class</span> <span class="nc">ThRZBlock_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="p">(</span><span class="s2">&quot;TestThRZBlock&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DifferentialRadialSegment</span><span class="p">(</span>
                <span class="s2">&quot;fuel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;UZr&quot;</span><span class="p">,</span>
                <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">inner_radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">radius_differential</span><span class="o">=</span><span class="mf">40.0</span><span class="p">,</span>
                <span class="n">inner_theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">azimuthal_differential</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">inner_axial</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DifferentialRadialSegment</span><span class="p">(</span>
                <span class="s2">&quot;coolant&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span>
                <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">inner_radius</span><span class="o">=</span><span class="mf">40.0</span><span class="p">,</span>
                <span class="n">radius_differential</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">inner_theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">azimuthal_differential</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">inner_axial</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DifferentialRadialSegment</span><span class="p">(</span>
                <span class="s2">&quot;clad&quot;</span><span class="p">,</span>
                <span class="s2">&quot;HT9&quot;</span><span class="p">,</span>
                <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">inner_radius</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                <span class="n">radius_differential</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span>
                <span class="n">inner_theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">azimuthal_differential</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">inner_axial</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DifferentialRadialSegment</span><span class="p">(</span>
                <span class="s2">&quot;wire&quot;</span><span class="p">,</span>
                <span class="s2">&quot;HT9&quot;</span><span class="p">,</span>
                <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">inner_radius</span><span class="o">=</span><span class="mf">57.0</span><span class="p">,</span>
                <span class="n">radius_differential</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="n">inner_theta</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">azimuthal_differential</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">inner_axial</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># random 1/4 chunk taken out to exercise Theta-RZ block capabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">DifferentialRadialSegment</span><span class="p">(</span>
                <span class="s2">&quot;chunk&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Sodium&quot;</span><span class="p">,</span>
                <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
                <span class="n">inner_radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                <span class="n">radius_differential</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
                <span class="n">inner_theta</span><span class="o">=</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">azimuthal_differential</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">inner_axial</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_radii"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_radii">[docs]</a>    <span class="k">def</span> <span class="nf">test_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">radialInner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">radialInner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">radialInner</span><span class="p">)</span>
        <span class="n">radialOuter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">radialOuter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="n">radialOuter</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_theta"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_theta">[docs]</a>    <span class="k">def</span> <span class="nf">test_theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">thetaInner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">thetaInner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">thetaInner</span><span class="p">)</span>
        <span class="n">thetaOuter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">thetaOuter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">thetaOuter</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_axial"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_axial">[docs]</a>    <span class="k">def</span> <span class="nf">test_axial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">axialInner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">axialInner</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">({</span><span class="mf">5.0</span><span class="p">},</span> <span class="n">axialInner</span><span class="p">)</span>
        <span class="n">axialOuter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">axialOuter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">({</span><span class="mf">15.0</span><span class="p">},</span> <span class="n">axialOuter</span><span class="p">)</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_verifyBlockDims"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_verifyBlockDims">[docs]</a>    <span class="k">def</span> <span class="nf">test_verifyBlockDims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is currently null. It consists of a single line that returns nothing. This</span>
<span class="sd">        test covers that line. If the function is ever implemented, it can be tested here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">verifyBlockDims</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_getThetaRZGrid"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_getThetaRZGrid">[docs]</a>    <span class="k">def</span> <span class="nf">test_getThetaRZGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Since not applicable to ThetaRZ Grids.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_getWettedPerimeter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_getWettedPerimeter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWettedPerimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">getWettedPerimeter</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThRZBlock_TestCase.test_getHydraulicDiameter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.ThRZBlock_TestCase.test_getHydraulicDiameter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getHydraulicDiameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ThRZBlock</span><span class="o">.</span><span class="n">getHydraulicDiameter</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="CartesianBlock_TestCase"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase">[docs]</a><span class="k">class</span> <span class="nc">CartesianBlock_TestCase</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for blocks with rectangular/square outer shape.&quot;&quot;&quot;</span>

    <span class="n">PITCH</span> <span class="o">=</span> <span class="mi">70</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">caseSetting</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">Settings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CartesianBlock</span><span class="p">(</span><span class="s2">&quot;TestCartesianBlock&quot;</span><span class="p">,</span> <span class="n">caseSetting</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cartesianComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">HoledSquare</span><span class="p">(</span>
            <span class="s2">&quot;duct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;UZr&quot;</span><span class="p">,</span>
            <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
            <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span>
            <span class="n">holeOD</span><span class="o">=</span><span class="mf">68.0</span><span class="p">,</span>
            <span class="n">widthOuter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PITCH</span><span class="p">,</span>
            <span class="n">mult</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cartesianComponent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">components</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span>
                <span class="s2">&quot;clad&quot;</span><span class="p">,</span> <span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="n">Tinput</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">Thot</span><span class="o">=</span><span class="mf">273.0</span><span class="p">,</span> <span class="n">od</span><span class="o">=</span><span class="mf">68.0</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mf">169.0</span>
            <span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="CartesianBlock_TestCase.test_getPitchSquare"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase.test_getPitchSquare">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPitchSquare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">(),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PITCH</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PITCH</span><span class="p">))</span></div>

<div class="viewcode-block" id="CartesianBlock_TestCase.test_getPitchHomogeneousBlock"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase.test_getPitchHomogeneousBlock">[docs]</a>    <span class="k">def</span> <span class="nf">test_getPitchHomogeneousBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Demonstrate how to communicate pitch on a hex block with unshaped components.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This assumes there are 3 materials in the homogeneous block, one with half the area</span>
<span class="sd">        fraction, and 2 with 1/4 each.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">desiredPitch</span> <span class="o">=</span> <span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">)</span>
        <span class="n">rectTotalArea</span> <span class="o">=</span> <span class="n">desiredPitch</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">desiredPitch</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">compArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Tinput&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">,</span> <span class="s2">&quot;Thot&quot;</span><span class="p">:</span> <span class="mf">273.0</span><span class="p">}</span>
        <span class="n">areaFractions</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>
        <span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;HT9&quot;</span><span class="p">,</span> <span class="s2">&quot;UZr&quot;</span><span class="p">,</span> <span class="s2">&quot;Sodium&quot;</span><span class="p">]</span>

        <span class="c1"># There are 2 ways to do this, the first is to pick a component to be the pitch defining</span>
        <span class="c1"># component, and given it the shape of a rectangle to define the pitch. The rectangle outer</span>
        <span class="c1"># dimensions is defined by the pitch of the block/assembly. The inner dimensions is defined</span>
        <span class="c1"># by whatever thickness is necessary to have the desired area fraction. The second way is to</span>
        <span class="c1"># define all physical material components as unshaped, and add an additional infinitely thin</span>
        <span class="c1"># Void component (no area) that defines pitch. See second part of</span>
        <span class="c1"># HexBlock_TestCase.test_getPitchHomogeneousBlock for demonstration.</span>
        <span class="n">cartBlock</span> <span class="o">=</span> <span class="n">blocks</span><span class="o">.</span><span class="n">CartesianBlock</span><span class="p">(</span><span class="s2">&quot;TestCartBlock&quot;</span><span class="p">)</span>

        <span class="n">hexComponentArea</span> <span class="o">=</span> <span class="n">areaFractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rectTotalArea</span>

        <span class="c1"># Picking 1st material to use for the hex component here, but really the choice is</span>
        <span class="c1"># arbitrary.</span>
        <span class="c1"># area grows quadratically with outer dimensions.</span>
        <span class="c1"># Note there are infinitely many inner dims that would preserve area, this is just one.</span>
        <span class="n">innerDims</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span> <span class="o">*</span> <span class="n">areaFractions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">desiredPitch</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">hexComponentArea</span><span class="p">,</span> <span class="n">rectTotalArea</span> <span class="o">-</span> <span class="n">innerDims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">innerDims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">rectArgs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;lengthOuter&quot;</span><span class="p">:</span> <span class="n">desiredPitch</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;lengthInner&quot;</span><span class="p">:</span> <span class="n">innerDims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;widthOuter&quot;</span><span class="p">:</span> <span class="n">desiredPitch</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;widthInner&quot;</span><span class="p">:</span> <span class="n">innerDims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="s2">&quot;mult&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">rectArgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compArgs</span><span class="p">)</span>
        <span class="n">pitchDefiningComponent</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
            <span class="s2">&quot;pitchComp&quot;</span><span class="p">,</span> <span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">**</span><span class="n">rectArgs</span>
        <span class="p">)</span>
        <span class="n">cartBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pitchDefiningComponent</span><span class="p">)</span>

        <span class="c1"># Rectangle component is added, now add the rest as unshaped.</span>
        <span class="k">for</span> <span class="n">aFrac</span><span class="p">,</span> <span class="n">material</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">areaFractions</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">materials</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">unshapedArgs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">rectTotalArea</span> <span class="o">*</span> <span class="n">aFrac</span><span class="p">}</span>
            <span class="n">unshapedArgs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compArgs</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;unshaped </span><span class="si">{</span><span class="n">material</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">components</span><span class="o">.</span><span class="n">UnshapedComponent</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="o">**</span><span class="n">unshapedArgs</span><span class="p">)</span>
            <span class="n">cartBlock</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">desiredPitch</span><span class="p">,</span> <span class="n">cartBlock</span><span class="o">.</span><span class="n">getPitch</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">rectTotalArea</span><span class="p">,</span> <span class="n">cartBlock</span><span class="o">.</span><span class="n">getMaxArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cartBlock</span><span class="p">),</span> <span class="n">rectTotalArea</span><span class="p">)</span></div>

<div class="viewcode-block" id="CartesianBlock_TestCase.test_getCartesianGrid"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase.test_getCartesianGrid">[docs]</a>    <span class="k">def</span> <span class="nf">test_getCartesianGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Since not applicable to Cartesian Grids.&quot;&quot;&quot;</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">b</span><span class="o">.</span><span class="n">autoCreateSpatialGrids</span><span class="p">()</span></div>

<div class="viewcode-block" id="CartesianBlock_TestCase.test_getWettedPerimeter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase.test_getWettedPerimeter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getWettedPerimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span><span class="o">.</span><span class="n">getWettedPerimeter</span><span class="p">()</span></div>

<div class="viewcode-block" id="CartesianBlock_TestCase.test_getHydraulicDiameter"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.CartesianBlock_TestCase.test_getHydraulicDiameter">[docs]</a>    <span class="k">def</span> <span class="nf">test_getHydraulicDiameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cartesianBlock</span><span class="o">.</span><span class="n">getHydraulicDiameter</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MassConservationTests"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests">[docs]</a><span class="k">class</span> <span class="nc">MassConservationTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests designed to verify mass conservation during thermal expansion.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">buildSimpleFuelBlock</span><span class="p">()</span>

<div class="viewcode-block" id="MassConservationTests.test_heightExpansionDifferences"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_heightExpansionDifferences">[docs]</a>    <span class="k">def</span> <span class="nf">test_heightExpansionDifferences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The point of this test is to determine if the number densities stay the same with two</span>
<span class="sd">        different heights of the same block.  Since we want to expand a block from cold temperatures</span>
<span class="sd">        to hot using the fuel expansion coefficient (most important neutronicall), other components</span>
<span class="sd">        are not grown correctly. This means that on the block level, axial expansion will NOT</span>
<span class="sd">        conserve mass of non-fuel components. However, the excess mass is simply added to the top of</span>
<span class="sd">        the reactor in the plenum regions (or any non fueled region).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Assume the default block height is &#39;cold&#39; height.  Now we must determine what the hot</span>
        <span class="c1"># height should be based on thermal expansion.  Change the height of the block based on the</span>
        <span class="c1"># different thermal expansions of the components then see the effect on number densities.</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
        <span class="n">Thot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">temperatureInC</span>
        <span class="n">Tcold</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">inputTemperatureInC</span>

        <span class="n">dllHot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">linearExpansionFactor</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">Thot</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">Tcold</span><span class="p">)</span>
        <span class="n">hotFuelHeight</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dllHot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">hotFuelHeight</span><span class="p">)</span>

        <span class="n">hotFuelU238</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="n">hotFuelIRON</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;FE&quot;</span><span class="p">)</span>

        <span class="c1"># look at clad</span>
        <span class="n">clad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">)</span>

        <span class="n">Thot</span> <span class="o">=</span> <span class="n">clad</span><span class="o">.</span><span class="n">temperatureInC</span>
        <span class="n">Tcold</span> <span class="o">=</span> <span class="n">clad</span><span class="o">.</span><span class="n">inputTemperatureInC</span>

        <span class="n">dllHot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">linearExpansionFactor</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">Thot</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">Tcold</span><span class="p">)</span>
        <span class="n">hotCladHeight</span> <span class="o">=</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dllHot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="n">hotCladHeight</span><span class="p">)</span>

        <span class="n">hotCladU238</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;U238&quot;</span><span class="p">)</span>
        <span class="n">hotCladIRON</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getNumberDensity</span><span class="p">(</span><span class="s2">&quot;FE&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">hotFuelU238</span><span class="p">,</span>
            <span class="n">hotCladU238</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Number Density of fuel in one height (</span><span class="si">{0}</span><span class="s2">) != number density of fuel at another &quot;</span>
            <span class="s2">&quot;height </span><span class="si">{1}</span><span class="s2">. Number density conservation violated during thermal &quot;</span>
            <span class="s2">&quot;expansion&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hotFuelU238</span><span class="p">,</span> <span class="n">hotCladU238</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">hotFuelIRON</span><span class="p">,</span>
            <span class="n">hotCladIRON</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Number Density of clad in one height (</span><span class="si">{0}</span><span class="s2">) != number density of clad at another &quot;</span>
            <span class="s2">&quot;height </span><span class="si">{1}</span><span class="s2">. Number density conservation violated during thermal &quot;</span>
            <span class="s2">&quot;expansion&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hotFuelIRON</span><span class="p">,</span> <span class="n">hotCladIRON</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_massFuelHeatup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_massFuelHeatup">[docs]</a>    <span class="k">def</span> <span class="nf">test_massFuelHeatup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">massCold</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">fuel</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">massHot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">massCold</span><span class="p">,</span>
            <span class="n">massHot</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Cold mass of fuel (</span><span class="si">{0}</span><span class="s2">) != hot mass </span><span class="si">{1}</span><span class="s2">. Mass conservation violated during thermal &quot;</span>
            <span class="s2">&quot;expansion&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massCold</span><span class="p">,</span> <span class="n">massHot</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_massCladHeatup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_massCladHeatup">[docs]</a>    <span class="k">def</span> <span class="nf">test_massCladHeatup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cladding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">CLAD</span><span class="p">)</span>
        <span class="n">massCold</span> <span class="o">=</span> <span class="n">cladding</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">cladding</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">massHot</span> <span class="o">=</span> <span class="n">cladding</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">massCold</span><span class="p">,</span>
            <span class="n">massHot</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Cold mass of clad (</span><span class="si">{0}</span><span class="s2">) != hot mass </span><span class="si">{1}</span><span class="s2">. Mass conservation violated during thermal &quot;</span>
            <span class="s2">&quot;expansion&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massCold</span><span class="p">,</span> <span class="n">massHot</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_massDuctHeatup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_massDuctHeatup">[docs]</a>    <span class="k">def</span> <span class="nf">test_massDuctHeatup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">duct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)</span>
        <span class="n">massCold</span> <span class="o">=</span> <span class="n">duct</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">duct</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">massHot</span> <span class="o">=</span> <span class="n">duct</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">massCold</span><span class="p">,</span>
            <span class="n">massHot</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Cold mass of duct (</span><span class="si">{0}</span><span class="s2">) != hot mass </span><span class="si">{1}</span><span class="s2">. Mass conservation &quot;</span>
            <span class="s2">&quot;violated during thermal expansion&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massCold</span><span class="p">,</span> <span class="n">massHot</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_massCoolHeatup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_massCoolHeatup">[docs]</a>    <span class="k">def</span> <span class="nf">test_massCoolHeatup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure mass of coolant goes down when it heats up.&quot;&quot;&quot;</span>
        <span class="n">coolant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">COOLANT</span><span class="p">)</span>
        <span class="n">massCold</span> <span class="o">=</span> <span class="n">coolant</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">coolant</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="n">coolant</span><span class="o">.</span><span class="n">temperatureInC</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">massHot</span> <span class="o">=</span> <span class="n">coolant</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span>
            <span class="n">massCold</span><span class="p">,</span>
            <span class="n">massHot</span><span class="p">,</span>
            <span class="s2">&quot;Cold mass of coolant (</span><span class="si">{0}</span><span class="s2">) &lt;= hot mass </span><span class="si">{1}</span><span class="s2">. Mass conservation not violated during &quot;</span>
            <span class="s2">&quot;thermal expansion of coolant&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massCold</span><span class="p">,</span> <span class="n">massHot</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_dimensionDuctHeatup"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_dimensionDuctHeatup">[docs]</a>    <span class="k">def</span> <span class="nf">test_dimensionDuctHeatup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">duct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">DUCT</span><span class="p">)</span>
        <span class="n">pitchCold</span> <span class="o">=</span> <span class="n">duct</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">,</span> <span class="n">cold</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">duct</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">pitchHot</span> <span class="o">=</span> <span class="n">duct</span><span class="o">.</span><span class="n">getDimension</span><span class="p">(</span><span class="s2">&quot;op&quot;</span><span class="p">)</span>
        <span class="n">dLL</span> <span class="o">=</span> <span class="n">duct</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">linearExpansionFactor</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">correctHot</span> <span class="o">=</span> <span class="n">pitchCold</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dLL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">correctHot</span><span class="p">,</span>
            <span class="n">pitchHot</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Theoretical pitch of duct (</span><span class="si">{0}</span><span class="s2">) != hot pitch </span><span class="si">{1}</span><span class="s2">. Linear expansion violated during &quot;</span>
            <span class="s2">&quot;heatup. </span><span class="se">\n</span><span class="s2">Tc=</span><span class="si">{tc}</span><span class="s2"> Tref=</span><span class="si">{tref}</span><span class="s2"> dLL=</span><span class="si">{dLL}</span><span class="s2"> cold=</span><span class="si">{pcold}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">correctHot</span><span class="p">,</span>
                <span class="n">pitchHot</span><span class="p">,</span>
                <span class="n">tc</span><span class="o">=</span><span class="n">duct</span><span class="o">.</span><span class="n">temperatureInC</span><span class="p">,</span>
                <span class="n">tref</span><span class="o">=</span><span class="n">duct</span><span class="o">.</span><span class="n">inputTemperatureInC</span><span class="p">,</span>
                <span class="n">dLL</span><span class="o">=</span><span class="n">dLL</span><span class="p">,</span>
                <span class="n">pcold</span><span class="o">=</span><span class="n">pitchCold</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_coldMass"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_coldMass">[docs]</a>    <span class="k">def</span> <span class="nf">test_coldMass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the cold mass is what it should be, even though the hot height is input.</span>

<span class="sd">        At the cold temperature (but with hot height), the mass should be the same as at hot</span>
<span class="sd">        temperature and hot height.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fuel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="c1"># set ref (input/cold) temperature.</span>
        <span class="n">Thot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">temperatureInC</span>
        <span class="n">Tcold</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">inputTemperatureInC</span>

        <span class="c1"># change temp to cold</span>
        <span class="n">fuel</span><span class="o">.</span><span class="n">setTemperature</span><span class="p">(</span><span class="n">Tcold</span><span class="p">)</span>
        <span class="n">massCold</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">fuelArea</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
        <span class="c1"># we are at cold temp so cold and hot area are equal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">fuel</span><span class="o">.</span><span class="n">getArea</span><span class="p">(</span><span class="n">cold</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getArea</span><span class="p">())</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>  <span class="c1"># hot height.</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">Tcold</span><span class="p">)</span>
        <span class="c1"># can&#39;t use getThermalExpansionFactor since hot=cold so it would be 0</span>
        <span class="n">dllHot</span> <span class="o">=</span> <span class="n">fuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span><span class="o">.</span><span class="n">linearExpansionFactor</span><span class="p">(</span><span class="n">Tc</span><span class="o">=</span><span class="n">Thot</span><span class="p">,</span> <span class="n">T0</span><span class="o">=</span><span class="n">Tcold</span><span class="p">)</span>
        <span class="n">coldHeight</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dllHot</span><span class="p">)</span>
        <span class="n">theoreticalMass</span> <span class="o">=</span> <span class="n">fuelArea</span> <span class="o">*</span> <span class="n">coldHeight</span> <span class="o">*</span> <span class="n">rho</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">massCold</span><span class="p">,</span>
            <span class="n">theoreticalMass</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">,</span>
            <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Cold mass of fuel (</span><span class="si">{0}</span><span class="s2">) != theoretical mass </span><span class="si">{1}</span><span class="s2">.  &quot;</span>
            <span class="s2">&quot;Check calculation of cold mass&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massCold</span><span class="p">,</span> <span class="n">theoreticalMass</span><span class="p">),</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MassConservationTests.test_massConsistency"><a class="viewcode-back" href="../../../../.apidocs/armi.reactor.tests.test_blocks.html#armi.reactor.tests.test_blocks.MassConservationTests.test_massConsistency">[docs]</a>    <span class="k">def</span> <span class="nf">test_massConsistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify that the sum of the component masses equals the total mass.&quot;&quot;&quot;</span>
        <span class="n">tMass</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">:</span>
            <span class="n">tMass</span> <span class="o">+=</span> <span class="n">child</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="n">bMass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">getMass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
            <span class="n">tMass</span><span class="p">,</span>
            <span class="n">bMass</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;Sum of component mass </span><span class="si">{0}</span><span class="s2"> != total block mass </span><span class="si">{1}</span><span class="s2">. &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tMass</span><span class="p">,</span> <span class="n">bMass</span><span class="p">),</span>
        <span class="p">)</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2024, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2024-08-27.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>