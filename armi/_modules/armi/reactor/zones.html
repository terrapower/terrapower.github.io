

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.reactor.zones &mdash; ARMI 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../blog/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../armi.html">armi</a> &raquo;</li>
        
          <li><a href="../reactor.html">armi.reactor</a> &raquo;</li>
        
      <li>armi.reactor.zones</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for armi.reactor.zones</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Zones are collections of locations.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">tabulate</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">grids</span>
<span class="kn">from</span> <span class="nn">armi.reactor.flags</span> <span class="kn">import</span> <span class="n">Flags</span>
<span class="kn">from</span> <span class="nn">armi.settings.fwSettings</span> <span class="kn">import</span> <span class="n">globalSettings</span>


<div class="viewcode-block" id="Zone"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone">[docs]</a><span class="k">class</span> <span class="nc">Zone</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A group of locations labels useful for choosing where to shuffle from or where to compute</span>
<span class="sd">    reactivity coefficients.</span>
<span class="sd">    locations if specified should be provided as a list of assembly locations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">locations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="n">symmetry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">locations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locList</span> <span class="o">=</span> <span class="n">locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hotZone</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostZone</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Zone </span><span class="si">{0}</span><span class="s2"> with </span><span class="si">{1}</span><span class="s2"> locations&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">locStr</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">locStr</span>

<div class="viewcode-block" id="Zone.extend"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locList</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">locList</span><span class="p">)</span></div>

<div class="viewcode-block" id="Zone.index"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns all the blocks in both assemblies.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">locList</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">locList</span>

<div class="viewcode-block" id="Zone.append"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="p">:</span>
            <span class="c1"># locations must be unique</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2"> is already in this zone: </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span></div>

<div class="viewcode-block" id="Zone.addAssemblyLocations"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone.addAssemblyLocations">[docs]</a>    <span class="k">def</span> <span class="nf">addAssemblyLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aList</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds the locations of a list of assemblies to a zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aList : list</span>
<span class="sd">            List of assembly objects</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">aList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span></div>

    <span class="c1"># TODO: p0, p1 are only used in testing</span>
<div class="viewcode-block" id="Zone.addRing"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zone.addRing">[docs]</a>    <span class="k">def</span> <span class="nf">addRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ring</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a section of a ring (or a whole ring) to the zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ring : int</span>
<span class="sd">            The ring to add</span>

<span class="sd">        p0 : int, optional</span>
<span class="sd">            beginning position within ring. Default: None (full ring)</span>

<span class="sd">        p1 : int, optional</span>
<span class="sd">            Ending position within ring.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p0</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">p1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">posList</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">allPositionsInThird</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">posList</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Zones are not written to handle </span><span class="si">{0}</span><span class="s2">-fold symmetry yet&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetry</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">posList</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="n">posList</span><span class="p">:</span>
            <span class="n">newLoc</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">(</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">getLocatorFromRingAndPos</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">newLoc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locList</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newLoc</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Zones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones">[docs]</a><span class="k">class</span> <span class="nc">Zones</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Collection of Zone objects.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a Zones object.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span> <span class="o">=</span> <span class="n">core</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ordered names of contained zones.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Access a zone by name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="c1"># Now delete the corresponding zone name from the names list</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ee</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loop through the zones in order.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">nm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span>

<div class="viewcode-block" id="Zones.update"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zones</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge with another Zones.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span></div>

<div class="viewcode-block" id="Zones.add"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a zone to the collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zone</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot add </span><span class="si">{}</span><span class="s2"> because a zone of that name already exists.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">zone</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zones</span><span class="p">[</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">zone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="Zones.removeZone"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.removeZone">[docs]</a>    <span class="k">def</span> <span class="nf">removeZone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;delete a zone by name.&quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="Zones.summary"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoneNames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print out power distribution of fuel assemblies this/these zone.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">zoneNames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">zoneNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Zone Summary&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; at Cycle </span><span class="si">{0}</span><span class="s2">, timenode </span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">cycle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">timeNode</span>
            <span class="p">)</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">totalPower</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">zoneName</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">zoneNames</span><span class="p">):</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;zone </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zoneName</span><span class="p">))</span>
            <span class="n">massFlow</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1"># find the maximum power to flow in each zone</span>
            <span class="n">maxPower</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">maxPowerAssem</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">fuelAssemsInZone</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">zones</span><span class="o">=</span><span class="n">zoneName</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fuelAssemsInZone</span><span class="p">:</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmassFlowRate</span> <span class="o">*</span> <span class="n">a</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span>
                <span class="n">aPow</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">calcTotalParam</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">,</span> <span class="n">calcBasedOnFullObj</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">aPow</span> <span class="o">&gt;</span> <span class="n">maxPower</span><span class="p">:</span>
                    <span class="n">maxPower</span> <span class="o">=</span> <span class="n">aPow</span>
                    <span class="n">maxPowerAssem</span> <span class="o">=</span> <span class="n">a</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flow</span><span class="p">:</span>
                    <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span>
                        <span class="s2">&quot;No TH data. Run with thermal hydraulics activated. &quot;</span>
                        <span class="s2">&quot;Zone report will have flow rate of zero&quot;</span><span class="p">,</span>
                        <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cannot summarize ring zone T/H&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># no TH for some reason</span>
                    <span class="n">flow</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">massFlow</span> <span class="o">+=</span> <span class="n">flow</span>

            <span class="c1"># Get power from the extracted power method.</span>
            <span class="n">slabPowList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getZoneAxialPowerDistribution</span><span class="p">(</span><span class="n">zoneName</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">slabPowList</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">fuelAssemsInZone</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span>
                    <span class="s2">&quot;No fuel assemblies exist in zone </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zoneName</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># loop over the last assembly to produce the final output.</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">totalZonePower</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">slabHeight</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getHeight</span><span class="p">()</span>
                <span class="n">thisSlabPow</span> <span class="o">=</span> <span class="n">slabPowList</span><span class="p">[</span><span class="n">zi</span><span class="p">]</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;  Power of </span><span class="si">{0:8.3f}</span><span class="s2"> cm slab at z=</span><span class="si">{1:8.3f}</span><span class="s2"> (W): </span><span class="si">{2:12.5E}</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slabHeight</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">thisSlabPow</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">z</span> <span class="o">+=</span> <span class="n">slabHeight</span>
                <span class="n">totalZonePower</span> <span class="o">+=</span> <span class="n">thisSlabPow</span>

            <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Total Zone Power (Watts): </span><span class="si">{0:.3E}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">totalZonePower</span><span class="p">))</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;  Zone Average Flow rate (kg/s): </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">massFlow</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">fuelAssemsInZone</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;  There are </span><span class="si">{0}</span><span class="s2"> assemblies in this zone&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fuelAssemsInZone</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">powerMultiplier</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;doOrificedTH&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">maxPowerAssem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmaxLifeTimePower</span><span class="p">:</span>
                <span class="c1"># print on the maximum power to flow in each ring zone.  This only has any meaning in</span>
                <span class="c1"># an orficedTH case, no reason to use it otherwise.</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;  The maximum power to flow is </span><span class="si">{}</span><span class="s2"> from assembly </span><span class="si">{}</span><span class="s2"> in this zone&quot;</span>
                    <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">maxPower</span> <span class="o">/</span> <span class="n">maxPowerAssem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmaxLifeTimePower</span><span class="p">,</span> <span class="n">maxPowerAssem</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="c1"># runLog.info(&#39;Flow rate  (m/s): {0:.3f}&#39;.format())</span>
            <span class="n">totalPower</span> <span class="o">+=</span> <span class="n">totalZonePower</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Total power of fuel in all zones is </span><span class="si">{0:.6E}</span><span class="s2"> Watts&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">totalPower</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="Zones.getZoneAxialPowerDistribution"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.getZoneAxialPowerDistribution">[docs]</a>    <span class="k">def</span> <span class="nf">getZoneAxialPowerDistribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zone</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of powers in watts of the axial levels of zone.&quot;&quot;&quot;</span>
        <span class="n">slabPower</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">,</span> <span class="n">zones</span><span class="o">=</span><span class="n">zone</span><span class="p">):</span>
            <span class="c1"># Add up slab power and flow rates</span>
            <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="n">slabPower</span><span class="p">[</span><span class="n">zi</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">slabPower</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">zi</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">power</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">getSymmetryFactor</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">powerMultiplier</span>
                <span class="p">)</span>

        <span class="c1"># reorder the dictionary into a list, knowing that zi is stopped at the highest block</span>
        <span class="n">slabPowList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zi</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">slabPowList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slabPower</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;slabPower </span><span class="si">{}</span><span class="s2"> zone </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slabPower</span><span class="p">,</span> <span class="n">zone</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">slabPowList</span></div>

<div class="viewcode-block" id="Zones.getZoneLocations"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.getZoneLocations">[docs]</a>    <span class="k">def</span> <span class="nf">getZoneLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zoneNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the location labels of a particular (or a few) zone(s).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        zoneNames : str or list</span>
<span class="sd">            the zone name or list of names</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zoneLocs : list</span>
<span class="sd">            List of location labels of this/these zone(s)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">zoneNames</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">zoneNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">zoneNames</span><span class="p">]</span>

        <span class="n">zoneLocs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">zn</span> <span class="ow">in</span> <span class="n">zoneNames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">thisZoneLocs</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">zn</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;The zone </span><span class="si">{0}</span><span class="s2"> does not exist. Please define it.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zn</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span>
            <span class="n">zoneLocs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">thisZoneLocs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">zoneLocs</span></div>

<div class="viewcode-block" id="Zones.getRingZoneRings"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.getRingZoneRings">[docs]</a>    <span class="k">def</span> <span class="nf">getRingZoneRings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get rings in each ring zone as a list of lists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ringZones : list</span>
<span class="sd">            List of lists. Each entry is the ring numbers in a ring zone.</span>
<span class="sd">            If there are no ring zones defined, returns a list of all rings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">core</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">core</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">]:</span>
            <span class="c1"># no ring zones defined. Return all rings.</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">getNumRings</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>

        <span class="c1"># ringZones are upper limits, defining ring zones from the center. so if they&#39;re</span>
        <span class="c1">#  [3, 5, 8, 90] then the ring zones are from 1 to 3, 4 to 5, 6 to 8, etc.</span>
        <span class="c1"># AKA, the upper bound is included in that particular zone.</span>

        <span class="c1"># check validity of ringZones. Increasing order and integers.</span>
        <span class="n">ring0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ring</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">ring</span> <span class="o">&lt;=</span> <span class="n">ring0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;ring zones </span><span class="si">{0}</span><span class="s2"> are invalid. Must be integers, increasing in order. &quot;</span>
                    <span class="s2">&quot;Can not return ring zone rings.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="k">return</span>
            <span class="n">ring0</span> <span class="o">=</span> <span class="n">ring</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># this is the final ring zone</span>
                <span class="k">if</span> <span class="n">ring</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">getNumRings</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">finalRing</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">getNumRings</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">finalRing</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># modify the ringZones to definitely include all assemblies</span>
        <span class="k">if</span> <span class="n">finalRing</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Modifying final ring zone definition to include all assemblies. New max: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">finalRing</span>
                <span class="p">),</span>
                <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Modified ring zone definition&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">finalRing</span>

        <span class="c1"># build the ringZone list</span>
        <span class="n">ring0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ringZones</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">upperRing</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;ringZones&quot;</span><span class="p">]:</span>
            <span class="n">ringsInThisZone</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span>
                <span class="n">ring0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">upperRing</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>  <span class="c1"># the rings in this ring zone as defined above.</span>

            <span class="n">ringZones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ringsInThisZone</span><span class="p">)</span>
            <span class="n">ring0</span> <span class="o">=</span> <span class="n">upperRing</span>

        <span class="k">return</span> <span class="n">ringZones</span></div>

<div class="viewcode-block" id="Zones.findZoneAssemblyIsIn"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.Zones.findZoneAssemblyIsIn">[docs]</a>    <span class="k">def</span> <span class="nf">findZoneAssemblyIsIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the zone object that this assembly is in.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : assembly</span>
<span class="sd">           The assembly to locate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        zone : Zone object that the input assembly resides in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">aLoc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">()</span>
        <span class="n">zoneFound</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aLoc</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">locList</span><span class="p">:</span>
                <span class="n">zoneFound</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="n">zone</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">zoneFound</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Was not able to find which zone </span><span class="si">{}</span><span class="s2"> is in&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="buildZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.buildZones">[docs]</a><span class="k">def</span> <span class="nf">buildZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build/update the zones.</span>

<span class="sd">    Zones are groups of assembly locations used for various purposes such as defining SASSYS channels and</span>
<span class="sd">    reactivity coefficients.</span>

<span class="sd">    The zoning option is determined by the ``zoningStrategy`` setting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="n">zoneOption</span> <span class="o">=</span> <span class="n">cs</span><span class="p">[</span><span class="n">globalSettings</span><span class="o">.</span><span class="n">CONF_ZONING_STRATEGY</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;byRingZone&quot;</span> <span class="ow">in</span> <span class="n">zoneOption</span><span class="p">:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildRingZoneZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">in</span> <span class="n">zoneOption</span><span class="p">:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildManualZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s2">&quot;byFuelType&quot;</span> <span class="ow">in</span> <span class="n">zoneOption</span><span class="p">:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildAssemTypeZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s2">&quot;byOrifice&quot;</span> <span class="ow">in</span> <span class="n">zoneOption</span><span class="p">:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildZonesByOrifice</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
    <span class="k">elif</span> <span class="s2">&quot;everyFA&quot;</span> <span class="ow">in</span> <span class="n">zoneOption</span><span class="p">:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildZonesforEachFA</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid `zoningStrategy` grouping option </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zoneOption</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">cs</span><span class="p">[</span><span class="s2">&quot;createAssemblyTypeZones&quot;</span><span class="p">]:</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_buildAssemTypeZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">))</span>

    <span class="c1"># Summarize the zone information</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Zone</span><span class="se">\n</span><span class="s2">Number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Assemblies&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Locations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Symmetry</span><span class="se">\n</span><span class="s2">Factor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Hot</span><span class="se">\n</span><span class="s2">Zone&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">zoneSummaryData</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">zone</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">assemLocations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">createFormattedStrWithDelimiter</span><span class="p">(</span>
            <span class="n">zone</span><span class="p">,</span> <span class="n">maxNumberOfValuesBeforeDelimiter</span><span class="o">=</span><span class="mi">6</span>
        <span class="p">)</span>
        <span class="n">zoneSummaryData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">zi</span><span class="p">,</span> <span class="n">zone</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span> <span class="n">assemLocations</span><span class="p">,</span> <span class="n">zone</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span> <span class="n">zone</span><span class="o">.</span><span class="n">hotZone</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Assembly zone definitions:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
            <span class="n">tabular_data</span><span class="o">=</span><span class="n">zoneSummaryData</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;armi&quot;</span>
        <span class="p">),</span>
        <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<div class="viewcode-block" id="_buildZonesByOrifice"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones._buildZonesByOrifice">[docs]</a><span class="k">def</span> <span class="nf">_buildZonesByOrifice</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Group fuel assemblies by orifice zones.</span>

<span class="sd">    Each zone will contain all FAs with in same orifice coefficients.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    faZonesForSafety : dict</span>
<span class="sd">        dictionary of zone name and list of FAs name in that zone</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    It separate oxide and LTA assembly into their own zones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="s2">&quot;Building Zones by Orifice zone&quot;</span><span class="p">)</span>
    <span class="n">orificeZones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>

    <span class="c1"># first get all different orifice setting zones</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">getAssembliesOfType</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">):</span>
        <span class="n">orificeSetting</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THorificeZone</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getFirstBlock</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">cFuel</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">fuelMaterial</span> <span class="o">=</span> <span class="n">cFuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span>
        <span class="k">if</span> <span class="s2">&quot;lta&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">getType</span><span class="p">():</span>
            <span class="n">orificeSetting</span> <span class="o">=</span> <span class="s2">&quot;lta&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">orificeSetting</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s2">&quot;Oxide&quot;</span> <span class="ow">in</span> <span class="n">fuelMaterial</span><span class="o">.</span><span class="n">getName</span><span class="p">():</span>
            <span class="n">orificeSetting</span> <span class="o">=</span> <span class="s2">&quot;Oxide&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">orificeSetting</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">orificeSetting</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">orificeZones</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">orificeZones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Zone</span><span class="p">(</span><span class="n">orificeSetting</span><span class="p">))</span>

    <span class="c1"># now put FAs of the same orifice zone in to one channel</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">getAssembliesOfType</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">):</span>
        <span class="n">orificeSetting</span> <span class="o">=</span> <span class="s2">&quot;zone&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THorificeZone</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getFirstBlock</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">cFuel</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">getComponent</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)</span>
        <span class="n">fuelMaterial</span> <span class="o">=</span> <span class="n">cFuel</span><span class="o">.</span><span class="n">getProperties</span><span class="p">()</span>
        <span class="c1"># get channel for lta</span>
        <span class="k">if</span> <span class="s2">&quot;lta&quot;</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">getType</span><span class="p">():</span>
            <span class="n">orificeZones</span><span class="p">[</span><span class="s2">&quot;lta&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">orificeSetting</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
        <span class="c1"># account for oxide fuel</span>
        <span class="k">elif</span> <span class="s2">&quot;Oxide&quot;</span> <span class="ow">in</span> <span class="n">fuelMaterial</span><span class="o">.</span><span class="n">getName</span><span class="p">():</span>
            <span class="n">orificeZones</span><span class="p">[</span><span class="s2">&quot;Oxide&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">orificeSetting</span><span class="p">)]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
        <span class="c1"># account for LTA</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">orificeZones</span><span class="p">[</span><span class="n">orificeSetting</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">orificeZones</span></div>


<div class="viewcode-block" id="_buildManualZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones._buildManualZones">[docs]</a><span class="k">def</span> <span class="nf">_buildManualZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span>
        <span class="s2">&quot;Building Zones by manual zone definitions in `zoneDefinitions` setting&quot;</span>
    <span class="p">)</span>
    <span class="n">stripper</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">zones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="c1"># read input zones, which are special strings like this: &quot;zoneName: loc1,loc2,loc3,loc4,...&quot;</span>
    <span class="k">for</span> <span class="n">zoneString</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">[</span><span class="s2">&quot;zoneDefinitions&quot;</span><span class="p">]:</span>
        <span class="n">zoneName</span><span class="p">,</span> <span class="n">zoneLocs</span> <span class="o">=</span> <span class="n">zoneString</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">zoneLocs</span> <span class="o">=</span> <span class="n">zoneLocs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">zone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">zoneName</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">stripper</span><span class="p">,</span> <span class="n">zoneLocs</span><span class="p">))</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<div class="viewcode-block" id="_buildZonesforEachFA"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones._buildZonesforEachFA">[docs]</a><span class="k">def</span> <span class="nf">_buildZonesforEachFA</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split every fuel assembly in to a zones for safety analysis.</span>

<span class="sd">    Returns</span>
<span class="sd">    ------</span>
<span class="sd">        reactorChannelZones : dict</span>
<span class="sd">            dictionary of each channel as a zone</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">extra</span><span class="p">(</span><span class="s2">&quot;Creating zones for `everyFA`&quot;</span><span class="p">)</span>
    <span class="n">reactorChannelZones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">getAssembliesOfType</span><span class="p">(</span><span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">)):</span>
        <span class="n">reactorChannelZones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Zone</span><span class="p">(</span><span class="s2">&quot;channel &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">()]))</span>
    <span class="k">return</span> <span class="n">reactorChannelZones</span></div>


<div class="viewcode-block" id="_buildRingZoneZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones._buildRingZoneZones">[docs]</a><span class="k">def</span> <span class="nf">_buildRingZoneZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build zones based on annular rings.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Originally, there were ringZones. These were defined by a user-input list of</span>
<span class="sd">    upper bound rings and the zones were just annular regions between rings.</span>
<span class="sd">    They were used to compute reactivity coefficients and whatnot. Then</span>
<span class="sd">    one day, it became clear that more general zones were required. To support</span>
<span class="sd">    old code that used ringZones, this code produces modern zones out</span>
<span class="sd">    of the ringZone input.</span>

<span class="sd">    It creates zones called ring-0, ring-1, etc. for each zone.</span>

<span class="sd">    If no zones are defined, one big ringzone comprising the whole core will be built.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    getRingZoneAssemblies : gets assemblies in a ringzone</span>
<span class="sd">    getRingZoneRings : computes rings in a ringzone</span>
<span class="sd">    getAssembly : accesses assemblies in a zone the new way.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="n">zoneRings</span> <span class="o">=</span> <span class="n">zones</span><span class="o">.</span><span class="n">getRingZoneRings</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ringZone</span><span class="p">,</span> <span class="n">rings</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zoneRings</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">zoneName</span> <span class="o">=</span> <span class="s2">&quot;ring-</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ringZone</span><span class="p">)</span>
        <span class="n">zone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">zoneName</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">addRing</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<div class="viewcode-block" id="_buildAssemTypeZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones._buildAssemTypeZones">[docs]</a><span class="k">def</span> <span class="nf">_buildAssemTypeZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">typeSpec</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds zones based on assembly type labels.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Creates a zone for each assembly type. All locations occupied by</span>
<span class="sd">    a certain type of assembly become a new zone based on that type.</span>

<span class="sd">    For example, after this call, all &#39;feed fuel a&#39; assemblies will reside</span>
<span class="sd">    in the &#39;feed fuel a&#39; zone.</span>

<span class="sd">    Useful for building static zones based on some BOL core layout.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    core : Core</span>
<span class="sd">        The core</span>

<span class="sd">    typeSpec : Flags or list of Flags, optional</span>
<span class="sd">        Assembly types to consider (e.g. Flags.FUEL)</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    zones : Zones</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">zones</span> <span class="o">=</span> <span class="n">Zones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">(</span><span class="n">typeSpec</span><span class="p">):</span>
        <span class="n">zoneName</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">zone</span> <span class="o">=</span> <span class="n">zones</span><span class="p">[</span><span class="n">zoneName</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">zone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">zoneName</span><span class="p">)</span>
            <span class="n">zones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
        <span class="n">zone</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<div class="viewcode-block" id="splitZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.splitZones">[docs]</a><span class="k">def</span> <span class="nf">splitZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">zones</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split the existing zone style into smaller zones via number of blocks and assembly type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    core:  Core</span>
<span class="sd">        The Core object to which the Zones belong</span>
<span class="sd">    cs: Case settings</span>
<span class="sd">        The case settings for the run</span>
<span class="sd">    zones: Zones</span>
<span class="sd">        The Zones to split</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    zones: Zones</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Zones are collections of locations grouped by some user input.</span>
<span class="sd">    Calling this method transforms a collection of zones into another collection of zones</span>
<span class="sd">    further broken down by assembly type and number of blocks.</span>
<span class="sd">    Each new zone only contains assemblies of the same type and block count.</span>
<span class="sd">    any other arbitrary grouping method. A subZone is a further breakdown of a zone.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    If the original zone was ringZone3 and ringZone3 contained three assemblies, one of them being a burner with</span>
<span class="sd">    nine blocks, one being a burner with 8 blocks and one control assembly with 3 blocks three splitZones</span>
<span class="sd">    would be produced and ringZone3 would be deleted. The the zones would be named ringZone3_Burner_8,</span>
<span class="sd">    ringZone3_Burner_9, ringZone3_Control_3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cs</span><span class="p">[</span><span class="s2">&quot;splitZones&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">zones</span>

    <span class="c1"># We should make this unchangeable</span>
    <span class="n">originalZoneNames</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">])</span>
    <span class="n">splitZoneToOriginalZonesMap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">subZoneNameSeparator</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">originalZoneNames</span><span class="p">:</span>

        <span class="n">assems</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">(</span><span class="n">zones</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assems</span><span class="p">:</span>
            <span class="c1"># figure out what type of assembly we have</span>
            <span class="n">flavor</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">subZoneNameSeparator</span><span class="p">)</span>  <span class="c1"># replace spaces</span>
            <span class="n">subZoneName</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">name</span>
                <span class="o">+</span> <span class="n">subZoneNameSeparator</span>
                <span class="o">+</span> <span class="n">flavor</span>
                <span class="o">+</span> <span class="n">subZoneNameSeparator</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">splitZoneToOriginalZonesMap</span><span class="p">[</span><span class="n">subZoneName</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">zone</span> <span class="o">=</span> <span class="n">zones</span><span class="p">[</span><span class="n">subZoneName</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">zone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">subZoneName</span><span class="p">)</span>
                <span class="n">zones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">zone</span><span class="p">)</span>
            <span class="n">zone</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">())</span>
        <span class="c1"># now remove the original non separated zone</span>
        <span class="n">zones</span><span class="o">.</span><span class="n">removeZone</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c1"># Summarize the zone information</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Zone</span><span class="se">\n</span><span class="s2">Number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Original</span><span class="se">\n</span><span class="s2">Name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Assemblies&quot;</span><span class="p">,</span>
        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Locations&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Symmetry</span><span class="se">\n</span><span class="s2">Factor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Hot</span><span class="se">\n</span><span class="s2">Zone&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">zoneSummaryData</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">zi</span><span class="p">,</span> <span class="n">zone</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zones</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">assemLocations</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">createFormattedStrWithDelimiter</span><span class="p">(</span>
            <span class="n">zone</span><span class="p">,</span> <span class="n">maxNumberOfValuesBeforeDelimiter</span><span class="o">=</span><span class="mi">6</span>
        <span class="p">)</span>
        <span class="n">zoneSummaryData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">zi</span><span class="p">,</span>
                <span class="n">zone</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">splitZoneToOriginalZonesMap</span><span class="p">[</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span><span class="p">],</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">zone</span><span class="p">),</span>
                <span class="n">assemLocations</span><span class="p">,</span>
                <span class="n">zone</span><span class="o">.</span><span class="n">symmetry</span><span class="p">,</span>
                <span class="n">zone</span><span class="o">.</span><span class="n">hotZone</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;The setting `splitZones` is enabled. Building subzones from core zones:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
            <span class="n">tabular_data</span><span class="o">=</span><span class="n">zoneSummaryData</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;armi&quot;</span>
        <span class="p">),</span>
        <span class="n">single</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>


<div class="viewcode-block" id="createHotZones"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.zones.html#armi.reactor.zones.createHotZones">[docs]</a><span class="k">def</span> <span class="nf">createHotZones</span><span class="p">(</span><span class="n">core</span><span class="p">,</span> <span class="n">zones</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make new zones from assemblies with the max power to flow ratio in a zone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    core : Core</span>
<span class="sd">        The core object</span>
<span class="sd">    zones: Zones</span>
<span class="sd">        Zones</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    zones: zones object</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This method determines which assembly has the highest power to flow ratio in each zone.</span>
<span class="sd">    This method then removes that assembly from its original zone and places it in a new zone.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">originalZoneNames</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">zone</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="n">zones</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">originalZoneNames</span><span class="p">:</span>
        <span class="n">assems</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">getAssemblies</span><span class="p">(</span><span class="n">zones</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># don&#39;t create hot zones from zones with only one assembly</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">assems</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">maxPOverF</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">hotLocation</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assems</span><span class="p">:</span>
                <span class="c1"># Check to make sure power and TH calcs were performed for this zon</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pOverF</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">calcTotalParam</span><span class="p">(</span><span class="s2">&quot;power&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">THmassFlowRate</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">getLocation</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">pOverF</span> <span class="o">&gt;=</span> <span class="n">maxPOverF</span><span class="p">:</span>
                        <span class="n">maxPOverF</span> <span class="o">=</span> <span class="n">pOverF</span>
                        <span class="n">hotLocation</span> <span class="o">=</span> <span class="n">loc</span>
                <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
                    <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> has no flow. Skipping </span><span class="si">{}</span><span class="s2"> in hot channel generation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">a</span><span class="p">,</span> <span class="n">name</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
            <span class="c1"># If we were able to identify the hot location, create a hot zone.</span>
            <span class="k">if</span> <span class="n">hotLocation</span><span class="p">:</span>
                <span class="n">zones</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">locList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hotLocation</span><span class="p">)</span>
                <span class="n">hotZoneName</span> <span class="o">=</span> <span class="s2">&quot;hot_&quot;</span> <span class="o">+</span> <span class="n">name</span>
                <span class="n">hotZone</span> <span class="o">=</span> <span class="n">Zone</span><span class="p">(</span><span class="n">hotZoneName</span><span class="p">)</span>
                <span class="n">zones</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hotZone</span><span class="p">)</span>
                <span class="n">zones</span><span class="p">[</span><span class="n">hotZoneName</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hotLocation</span><span class="p">)</span>
                <span class="n">zones</span><span class="p">[</span><span class="n">hotZoneName</span><span class="p">]</span><span class="o">.</span><span class="n">hotZone</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">zones</span><span class="p">[</span><span class="n">hotZoneName</span><span class="p">]</span><span class="o">.</span><span class="n">hostZone</span> <span class="o">=</span> <span class="n">name</span>
            <span class="c1"># Now remove the original zone if its does not store any locations anymore.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">zones</span><span class="o">.</span><span class="n">removeZone</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">zones</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2021, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2021-11-30.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>