

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.reactor.parameters &mdash; ARMI 0.2.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../armi.html">armi</a> &raquo;</li>
        
          <li><a href="../reactor.html">armi.reactor</a> &raquo;</li>
        
      <li>armi.reactor.parameters</li>
    
    
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for armi.reactor.parameters</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The parameters system holds state information for everything within ARMI&#39;s composite</span>
<span class="sd">structure:</span>

<span class="sd">.. list-table:: Example Parameters</span>
<span class="sd">    :widths: 50 50</span>
<span class="sd">    :header-rows: 1</span>

<span class="sd">    * - Object</span>
<span class="sd">      - Parameters</span>
<span class="sd">    * - :py:class:`~armi.reactor.reactors.Reactor`</span>
<span class="sd">      - :py:mod:`Reactor Parameters &lt;armi.reactor.reactorParameters&gt;`</span>
<span class="sd">    * - :py:class:`~armi.reactor.assemblies.Assembly`</span>
<span class="sd">      - :py:mod:`Assembly Parameters &lt;armi.reactor.assemblyParameters&gt;`</span>
<span class="sd">    * - :py:class:`~armi.reactor.blocks.Block`</span>
<span class="sd">      - :py:mod:`Block Parameters &lt;armi.reactor.blockParameters&gt;`</span>
<span class="sd">    * - :py:class:`~armi.reactor.components.Component`</span>
<span class="sd">      - :py:mod:`Component Parameters &lt;armi.reactor.components.componentParameters&gt;`</span>

<span class="sd">Basic Usage</span>
<span class="sd">===========</span>
<span class="sd">Given an ARMI reactor model object such as ``r``, one may set or get a parameter just</span>
<span class="sd">like any other instance attribute on ``r.p``::</span>

<span class="sd">    &gt;&gt;&gt; r.p.cycleLength</span>
<span class="sd">    350.0</span>

<span class="sd">Alternatively, dictionary-like access is supported::</span>

<span class="sd">    &gt;&gt;&gt; r.p[&quot;cycleLength&quot;]</span>
<span class="sd">    350.0</span>

<span class="sd">.. note::</span>

<span class="sd">    The data themselves are stored in special hidden fields, which are typically</span>
<span class="sd">    accessed through the ``Parameter`` definition that describes them. The name for such</span>
<span class="sd">    a parameter field looks like ``&quot;_p_&quot; + paramName``. For example, to get</span>
<span class="sd">    ``cycleLength`` one could do::</span>

<span class="sd">        &gt;&gt;&gt; r.core.p._p_cycleLength</span>
<span class="sd">        350.0</span>

<span class="sd">    However, it is not recommended to access parameters in this way, as it circumvents</span>
<span class="sd">    the setters and getters that may have been implemented for a given parameter. One</span>
<span class="sd">    should always use the style from the first two examples to access parameter values.</span>

<span class="sd">    Furthermore, ``ParameterCollection`` classes have some extra controls to make sure</span>
<span class="sd">    that someone doesn&#39;t try to set random extra attributes on them. Only parameters</span>
<span class="sd">    that were defined before a particular ``ParameterCollection`` class is instantiated</span>
<span class="sd">    may be accessed.The rationale behind this is documented in the Design</span>
<span class="sd">    Considerations section below.</span>

<span class="sd">Most parameters in ARMI are block parameters. These include flux, power, temperatures,</span>
<span class="sd">number densities, etc. Parameters can be any basic type (float, int, str), or an array</span>
<span class="sd">of any such types. The type within a given array should be homogeneous. Examples::</span>

<span class="sd">    &gt;&gt;&gt; b.p.flux = 2.5e13</span>
<span class="sd">    &gt;&gt;&gt; b.p.fuelTemp = numpy.array(range(217), dtype=float)</span>
<span class="sd">    &gt;&gt;&gt; b.p.fuelTemp[58] = 600</span>


<span class="sd">.. note::</span>

<span class="sd">    There have been many discussions on what the specific name of this module/system</span>
<span class="sd">    should be. After great deliberation, the definition of parameter seemed very</span>
<span class="sd">    suitable:</span>

<span class="sd">        One of a set of measurable factors, such as temperature and pressure, that</span>
<span class="sd">        define a system and determine its behavior and are varied in an experiment ~</span>
<span class="sd">        `thefreedictionary`_</span>

<span class="sd">        any of a set of physical properties whose values determine the characteristics</span>
<span class="sd">        or behavior of something &lt;parameters of the atmosphere such as temperature,</span>
<span class="sd">        pressure, and density&gt; ~ `Meriam-Webster`_</span>

<span class="sd">The parameters system is composed of several classes:</span>

<span class="sd">:py:class:`~armi.reactor.parameters.parameterDefinitions.Parameter` :</span>
<span class="sd">    These store metadata about each parameter including the name, description, its</span>
<span class="sd">    units, etc. :py:class:`Parameters &lt;parameterDefinitions.Parameter&gt;` also define some</span>
<span class="sd">    behaviors such as setters/getters, and what to do when retrieving a value that has</span>
<span class="sd">    not been set, and whether or not to store the parameter in the database. The</span>
<span class="sd">    :py:class:`parameterDefinitions.Parameter` object implement the Python descriptor</span>
<span class="sd">    protocol (the magic behind ``@property``), and are stored on corresponding</span>
<span class="sd">    :py:class:`parameterCollections.ParameterCollection` classes to access their</span>
<span class="sd">    underlying values.</span>

<span class="sd">:py:class:`~armi.reactor.parameters.parameterDefinitions.ParameterDefinitionCollection` :</span>
<span class="sd">    As the name suggests, these represent a collection of parameter definitions. Each</span>
<span class="sd">    :py:class:`ParameterCollection` gets a :py:class:`ParameterDefinitionCollection`,</span>
<span class="sd">    and there are also module-global collections, such as ``ALL_DEFINITIONS``</span>
<span class="sd">    (containing all defined parameters over all ``ArmiObject`` classes), and others</span>
<span class="sd">    which break parameters down by their categories, associated composite types, etc.</span>

<span class="sd">:py:class:`~armi.reactor.parameters.parameterDefinitions.ParameterBuilder` :</span>
<span class="sd">    These are used to aid in the creation of :py:class:`Parameter` instances, and store</span>
<span class="sd">    default arguments to the :py:class:`Parameter` constructor.</span>

<span class="sd">:py:class:`~armi.reactor.parameters.parameterCollections.ParameterCollection` :</span>
<span class="sd">    These are used to store parameter values for a specific instance of an item in the</span>
<span class="sd">    ARMI composite structure, and have features for accessing those parameters and their</span>
<span class="sd">    definitions. The actual parameter values are stored in secret `&quot;_p_&quot;+paramName`</span>
<span class="sd">    fields, and accessed through the Parameter definition, which functions as a</span>
<span class="sd">    descriptor. Parameter definitions are stored as class attributes so that they can be</span>
<span class="sd">    shared amongst instances. All parameter fields are filled with an initial value in</span>
<span class="sd">    their ``__init__()`` to benefit from the split-key dictionaries introduced in</span>
<span class="sd">    PEP-412. This and protections to prevent setting any other attributes form a sort of</span>
<span class="sd">    &quot;``__slots__`` lite&quot;.</span>

<span class="sd">:py:class:`~armi.reactor.parameters.resolveCollections.ResolveParametersMeta` :</span>
<span class="sd">    This metaclass is used by the base ``ArmiObject`` class to aid in the creation of a</span>
<span class="sd">    hierarchy of ``ParameterCollection`` classes that appropriately represent a specific</span>
<span class="sd">    ``ArmiObject`` subclass&#39;s parameters. In short, it looks at the class attributes of</span>
<span class="sd">    an ``ArmiObject`` subclass to see if there is a ``pDefs`` attribute (which should be</span>
<span class="sd">    an instance of ``ParameterDefinitionCollection``). If the ``pDefs`` attribute</span>
<span class="sd">    exists, the class will get its own ``ParameterCollection`` class, which will itself</span>
<span class="sd">    be a subclass of the parameter collection class associated with the most immediate</span>
<span class="sd">    ancestor that also had its own ``pDefs``. If an ``ArmiObject`` subclass has not</span>
<span class="sd">    ``pDefs`` attribute of its own, it will simply be associated with the parameter</span>
<span class="sd">    collection class of its parent.</span>

<span class="sd">This rather roundabout approach is used to address many of the design considerations</span>
<span class="sd">laid out below.  Namely that pains be taken to minimize memory consumption, properties</span>
<span class="sd">be used to control data access, and that it be relatively difficult to introduce</span>
<span class="sd">programming errors related to improperly-defined or colliding parameters.</span>

<span class="sd">Design Considerations</span>
<span class="sd">=====================</span>

<span class="sd">.. list-table:: Design considerations</span>
<span class="sd">    :header-rows: 1</span>

<span class="sd">    * - Issue</span>
<span class="sd">      - Resolution/Consequences</span>
<span class="sd">    * - Metadata about parameters is necessary for determining whether a parameter</span>
<span class="sd">        should be stored in the database, and to allow the user to toggle this switch.</span>
<span class="sd">      - Parameters must uniquely named within a ``Composite`` subclass.</span>

<span class="sd">        Also, we need to have :py:class:`Parameter` classes to store this metadata.</span>
<span class="sd">    * - There should not be any naming restrictions between different ``Composite`` subclasses.</span>
<span class="sd">      - Parameters must be defined or associated with a specific ``ParameterCollection`` subclass.</span>
<span class="sd">    * - PyLint cannot find programming errors related to incorrect strings.</span>
<span class="sd">      - We would like to use methods/functions for controlling state information.</span>

<span class="sd">        This also eliminated the possibility of using resource files to define the</span>
<span class="sd">        properties, otherwise we would be mapping names between some resource file and</span>
<span class="sd">        the associated parameter/property definition.</span>
<span class="sd">    * - Creating getters and setters for every parameter would be overwhelming and</span>
<span class="sd">        unsustainable.</span>
<span class="sd">      - We will use Python descriptors, which have *most* of the functionality used in</span>
<span class="sd">        getters and setters.</span>

<span class="sd">        :py:class:`ParameterCollection` knows how to generate descriptors for itself,</span>
<span class="sd">        based on a :py:class:`ParameterDefinitionCollection`.</span>
<span class="sd">    * - The majority of memory consumption occurs in parameters, strings and</span>
<span class="sd">        dictionaries.  Minimizing the storage requirements of the parameters is desirable.</span>
<span class="sd">      - Python ``__slots__`` are a language feature which eliminates the need for each</span>
<span class="sd">        class instance to have a ``__dict__``. This saves memory when there are many</span>
<span class="sd">        instances of a class. Slot access can sometimes be faster as well.</span>

<span class="sd">        In the past, ``__slots__`` were used to store parameter values. This became</span>
<span class="sd">        rather onerous when we wanted to support parameter definitions from plugins. We</span>
<span class="sd">        now use the traditional ``__dict__``, but take pains to make sure that we can</span>
<span class="sd">        get the memory savings from the key-sharing dicts provided by PEP-412. Namely,</span>
<span class="sd">        all attributes from the parameter definitions and other state are initialized to</span>
<span class="sd">        __something__ within the ``__init__()`` routine.</span>
<span class="sd">    * - Parameters are just fancy properties with meta data.</span>
<span class="sd">      - Implementing the descriptor interface on a :py:class:`Parameter` removes the</span>
<span class="sd">        need to construct a :py:class:`Parameter` without a name, then come back through</span>
<span class="sd">        with the ``applyParameters()`` class method to apply the</span>
<span class="sd">        :py:class:`Parameter` as a descriptor.</span>

<span class="sd">.. _thefreedictionary: http://www.thefreedictionary.com/parameter</span>
<span class="sd">.. _Meriam-Webster: http://www.merriam-webster.com/dictionary/parameter</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">armi.reactor.parameters.parameterCollections</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ParameterCollection</span><span class="p">,</span>
    <span class="n">collectPluginParameters</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">armi.reactor.parameters.parameterCollections</span> <span class="kn">import</span> <span class="n">applyAllParameters</span>
<span class="kn">from</span> <span class="nn">armi.reactor.parameters.parameterDefinitions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ParameterDefinitionCollection</span><span class="p">,</span>
    <span class="n">Parameter</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">armi.reactor.parameters.parameterDefinitions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SINCE_INITIALIZATION</span><span class="p">,</span>
    <span class="n">SINCE_LAST_DISTRIBUTE_STATE</span><span class="p">,</span>
    <span class="n">SINCE_LAST_GEOMETRY_TRANSFORMATION</span><span class="p">,</span>
    <span class="n">SINCE_BACKUP</span><span class="p">,</span>
    <span class="n">SINCE_ANYTHING</span><span class="p">,</span>
    <span class="n">NEVER</span><span class="p">,</span>
    <span class="n">Serializer</span><span class="p">,</span>
    <span class="n">Category</span><span class="p">,</span>
    <span class="n">ParamLocation</span><span class="p">,</span>
    <span class="n">NoDefault</span><span class="p">,</span>
    <span class="n">ALL_DEFINITIONS</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">armi.reactor.parameters.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ParameterDefinitionError</span><span class="p">,</span>
    <span class="n">ParameterError</span><span class="p">,</span>
    <span class="n">UnknownParameterError</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">forType</span> <span class="o">=</span> <span class="n">ALL_DEFINITIONS</span><span class="o">.</span><span class="n">forType</span>
<span class="n">inCategory</span> <span class="o">=</span> <span class="n">ALL_DEFINITIONS</span><span class="o">.</span><span class="n">inCategory</span>
<span class="n">byNameAndType</span> <span class="o">=</span> <span class="n">ALL_DEFINITIONS</span><span class="o">.</span><span class="n">byNameAndType</span>
<span class="n">resetAssignmentFlag</span> <span class="o">=</span> <span class="n">ALL_DEFINITIONS</span><span class="o">.</span><span class="n">resetAssignmentFlag</span>
<span class="n">since</span> <span class="o">=</span> <span class="n">ALL_DEFINITIONS</span><span class="o">.</span><span class="n">since</span>


<div class="viewcode-block" id="reset"><a class="viewcode-back" href="../../../.apidocs/armi.reactor.parameters.html#armi.reactor.parameters.reset">[docs]</a><span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Reset the status of all parameter definintions.</span>

<span class="sd">    This may become necessary when the state of the global parameter definitions becomes</span>
<span class="sd">    invalid.  Typically this happens when running multiple cases for the same import of</span>
<span class="sd">    this module, e.g. in unit tests. In this case things like the assigned flags will</span>
<span class="sd">    persist across test cases, leading to strange and incorrect behavior.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">pd</span> <span class="ow">in</span> <span class="n">ALL_DEFINITIONS</span><span class="p">:</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">assigned</span> <span class="o">=</span> <span class="n">NEVER</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2022, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2022-02-03.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>