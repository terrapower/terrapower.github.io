

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.reactor.grids.tests.test_grids &mdash; ARMI 0.6.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme_fixes.css?v=2b77b304" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sg_gallery-dataframe.css?v=e5fbc548" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/common_css/need_style.css?v=678fb11e" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-needs/modern.css?v=803738c0" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/sphinx-test-results/common.css?v=9ec2c1d5" />

  
    <link rel="shortcut icon" href="../../../../../_static/armiicon_16x16.ico"/>
      <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../../_static/documentation_options.js?v=b8503983"></script>
      <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
      <script src="../../../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
      <script src="../../../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
      <script src="../../../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
      <script src="../../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../qa_docs/index.html">QA Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../../../reactor.html">armi.reactor</a></li>
          <li class="breadcrumb-item"><a href="../../grids.html">armi.reactor.grids</a></li>
      <li class="breadcrumb-item active">armi.reactor.grids.tests.test_grids</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.reactor.grids.tests.test_grids</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2023 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;Tests for grids.&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">numpy.testing</span><span class="w"> </span><span class="kn">import</span> <span class="n">assert_allclose</span><span class="p">,</span> <span class="n">assert_array_equal</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor</span><span class="w"> </span><span class="kn">import</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">grids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">hexagon</span>


<div class="viewcode-block" id="MockLocator">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.MockLocator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockLocator</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Locator subclass that with direct location -&gt; location paternity (to avoid</span>
<span class="sd">    needing blocks, assems).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parentLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>



<div class="viewcode-block" id="MockCoordLocator">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.MockCoordLocator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockCoordLocator</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">parentLocation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span></div>



<div class="viewcode-block" id="MockArmiObject">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.MockArmiObject">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockArmiObject</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Any sort of object that can serve as a grid&#39;s armiObject attribute.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span></div>



<div class="viewcode-block" id="MockStructuredGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.MockStructuredGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MockStructuredGrid</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Need a concrete class to test a lot of inherited methods.</span>

<span class="sd">    Abstract methods from the parent now raise ``NotImplementedError``</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<span class="c1"># De-abstract the mock structured grid to test some basic</span>
<span class="c1"># properties, but let the abstract methods error</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_throwsNotImplemented</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">MockStructuredGrid</span><span class="o">.</span><span class="n">__abstractmethods__</span><span class="p">:</span>
    <span class="nb">setattr</span><span class="p">(</span><span class="n">MockStructuredGrid</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">_throwsNotImplemented</span><span class="p">)</span>

<span class="n">MockStructuredGrid</span><span class="o">.</span><span class="n">__abstractmethods__</span> <span class="o">=</span> <span class="p">()</span>


<div class="viewcode-block" id="TestSpatialLocator">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestSpatialLocator</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestSpatialLocator.test_add">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_add">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">loc2</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loc1</span> <span class="o">+</span> <span class="n">loc2</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_multiIndexEq">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_multiIndexEq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_multiIndexEq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check multi index locations are only true if they live on the same grid and have the same locations.&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_multiIndexEqWithLocations">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_multiIndexEqWithLocations">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_multiIndexEqWithLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Two multi index locators on the same grid are equal.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">a</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1"># If the order differs but all the locations are the same, the locators are considered not equal</span>
        <span class="n">locs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">locs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">locs</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_coordinateLocationEq">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_coordinateLocationEq">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_coordinateLocationEq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for equality on the coordinate location object.&quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MockStructuredGrid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># Pick some points with different indices in one dimension</span>
        <span class="c1"># Offsets are arbitrary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">k</span> <span class="o">+</span> <span class="mi">13</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_coordinateLocationHash">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_coordinateLocationHash">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_coordinateLocationHash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure we can hash the location based on it&#39;s position, not the grid.&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">MockStructuredGrid</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">hash</span><span class="p">((</span><span class="n">a</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">k</span><span class="p">)))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="nb">hash</span><span class="p">(</span><span class="n">a</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_recursion">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_recursion">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_recursion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure things work as expected with a chain of locators/grids/locators.</span>

<span class="sd">        This makes a Cartesian-like reactor out of unit cubes. The origin</span>
<span class="sd">        is in the center of the central cube radially and the bottom axially due</span>
<span class="sd">        to the different way steps and bounds are set up.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">()</span>
        <span class="n">assem</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">(</span><span class="n">assem</span><span class="p">)</span>

        <span class="c1"># build meshes just like how they&#39;re used on a regular system.</span>
        <span class="c1"># 2-D grid</span>
        <span class="n">coreGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">core</span><span class="p">)</span>

        <span class="c1"># 1-D z-mesh</span>
        <span class="n">assemblyGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">assem</span><span class="p">)</span>

        <span class="c1"># pins sit in this 2-D grid.</span>
        <span class="n">blockGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>

        <span class="n">coreLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">core</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">coreLoc</span>

        <span class="n">assemblyLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coreGrid</span><span class="p">)</span>
        <span class="n">assem</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">assemblyLoc</span>

        <span class="n">blockLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">assemblyGrid</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">blockLoc</span>

        <span class="n">pinIndexLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">blockGrid</span><span class="p">)</span>
        <span class="n">pinFree</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">blockGrid</span><span class="p">)</span>

        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">blockLoc</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">blockLoc</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">(),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">blockLoc</span><span class="o">.</span><span class="n">getGlobalCellBase</span><span class="p">(),</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">blockLoc</span><span class="o">.</span><span class="n">getGlobalCellTop</span><span class="p">(),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># check coordinates of pins in block</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">pinFree</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">(),</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.5</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">))</span>  <span class="c1"># epic</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">pinIndexLoc</span><span class="o">.</span><span class="n">getGlobalCoordinates</span><span class="p">(),</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">3.0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>  <span class="c1"># wow</span>

        <span class="c1"># pin indices should not combine with the parent indices.</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">pinIndexLoc</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">(),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestSpatialLocator.test_recursionPin">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestSpatialLocator.test_recursionPin">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_recursionPin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure pin the center assem has axial coordinates consistent with a pin in</span>
<span class="sd">        an off-center assembly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">core</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">()</span>
        <span class="n">assem</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">MockArmiObject</span><span class="p">(</span><span class="n">assem</span><span class="p">)</span>

        <span class="c1"># 2-D grid</span>
        <span class="n">coreGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">core</span><span class="p">)</span>
        <span class="c1"># 1-D z-mesh</span>
        <span class="n">assemblyGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">assem</span><span class="p">)</span>
        <span class="c1"># pins sit in this 2-D grid.</span>
        <span class="n">blockGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">armiObject</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>

        <span class="n">coreLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CoordinateLocation</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">core</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">coreLoc</span>
        <span class="n">assemblyLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coreGrid</span><span class="p">)</span>
        <span class="n">assem</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">assemblyLoc</span>
        <span class="n">blockLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">assemblyGrid</span><span class="p">)</span>
        <span class="n">block</span><span class="o">.</span><span class="n">spatialLocator</span> <span class="o">=</span> <span class="n">blockLoc</span>
        <span class="n">pinIndexLoc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">blockGrid</span><span class="p">)</span>

        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">pinIndexLoc</span><span class="o">.</span><span class="n">getCompleteIndices</span><span class="p">(),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="TestGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestGrid.test_basicPosition">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_basicPosition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_basicPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure a basic Cartesian grid works as expected.</span>

<span class="sd">        The default stepped grid defines zero at the center of the (0,0,0)th cell.</span>
<span class="sd">        Its centroid is 0., 0., 0). This convention is nicely compatible with 120-degree hex grid.</span>

<span class="sd">        Full core Cartesian meshes will want to be shifted to bottom left of 0th cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestGrid.test_neighbors">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_neighbors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span>
        <span class="n">neighbs</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getNeighboringCellIndices</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbs</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestGrid.test_label">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_label">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="s2">&quot;001-001-002&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestGrid.test_isAxialOnly">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_isAxialOnly">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_isAxialOnly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isAxialOnly</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">grid2</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid2</span><span class="o">.</span><span class="n">isAxialOnly</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestGrid.test_lookupFactory">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_lookupFactory">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_lookupFactory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestGrid.test_quasiReduce">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_quasiReduce">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_quasiReduce</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure our DB-friendly version of reduce works.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">reduction</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">reduce</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">reduction</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestGrid.test_generateSortedHexLocationList">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_generateSortedHexLocationList">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_generateSortedHexLocationList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">pitch</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">rings</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
                <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="n">rings</span><span class="p">)</span>

                <span class="n">lst</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">generateSortedHexLocationList</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

                <span class="n">lst</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">generateSortedHexLocationList</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

                <span class="n">lst</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">generateSortedHexLocationList</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestGrid.test_getitem">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_getitem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test that locations are created on demand, and the multi-index locations are</span>
<span class="sd">        returned when necessary.</span>

<span class="sd">        .. test:: Return the locations of grid items with multiplicity greater than one.</span>
<span class="sd">            :id: T_ARMI_GRID_ELEM_LOC</span>
<span class="sd">            :tests: R_ARMI_GRID_ELEM_LOC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">grid</span><span class="o">.</span><span class="n">_locations</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">grid</span><span class="o">.</span><span class="n">_locations</span><span class="p">)</span>

        <span class="n">multiLoc</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsInstance</span><span class="p">(</span><span class="n">multiLoc</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">MultiIndexLocation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">grid</span><span class="o">.</span><span class="n">_locations</span><span class="p">)</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">multiLoc</span><span class="o">.</span><span class="n">indices</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="n">ii</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span></div>


<div class="viewcode-block" id="TestGrid.test_ringPosFromIndicesIncorrect">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestGrid.test_ringPosFromIndicesIncorrect">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_ringPosFromIndicesIncorrect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the getRingPos fails if there is no armiObect or parent.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span>

        <span class="n">grid</span><span class="o">.</span><span class="n">armiObject</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span></div>
</div>



<div class="viewcode-block" id="TestHexGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestHexGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of tests for the Hexagonal Grid.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestHexGrid.test_getCoordinatesFlatsUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getCoordinatesFlatsUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getCoordinatesFlatsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test getCoordinates() for flats up hex grids.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">side</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="n">unitSteps</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">reduce</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iDirection</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">unitSteps</span><span class="p">)</span>
        <span class="n">jDirection</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">unitSteps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">directionVector</span> <span class="ow">in</span> <span class="p">(</span><span class="n">iDirection</span><span class="p">,</span> <span class="n">jDirection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">val</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">directionVector</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Direction vector </span><span class="si">{</span><span class="n">directionVector</span><span class="si">}</span><span class="s2"> should have magnitude 1 for pitch 1.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">iDirection</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">jDirection</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getCoordinatesCornersUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getCoordinatesCornersUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getCoordinatesCornersUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test getCoordinates() for corners up hex grids.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">side</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">side</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

        <span class="n">unitSteps</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">reduce</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iDirection</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">unitSteps</span><span class="p">)</span>
        <span class="n">jDirection</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">direction</span> <span class="ow">in</span> <span class="n">unitSteps</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">directionVector</span> <span class="ow">in</span> <span class="p">(</span><span class="n">iDirection</span><span class="p">,</span> <span class="n">jDirection</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">val</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">directionVector</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="mf">1.0</span><span class="p">,</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Direction vector </span><span class="si">{</span><span class="n">directionVector</span><span class="si">}</span><span class="s2"> should have magnitude 1 for pitch 1.&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">iDirection</span><span class="p">)</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">jDirection</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getLocalCoordinatesHex">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getLocalCoordinatesHex">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getLocalCoordinatesHex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test getLocalCoordinates() is different for corners up vs flats up hex grids.&quot;&quot;&quot;</span>
        <span class="n">grid0</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">grid1</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">coords0</span> <span class="o">=</span> <span class="n">grid0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
                <span class="n">coords1</span> <span class="o">=</span> <span class="n">grid1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">coords0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;X @ (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">coords0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Y @ (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">coords0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">coords1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Z @ (</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getLocalCoordinatesCornersUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getLocalCoordinatesCornersUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getLocalCoordinatesCornersUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test getLocalCoordinates() for corners up hex grids.&quot;&quot;&quot;</span>
        <span class="c1"># validate the first ring of a corners-up hex grid</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">())</span>

        <span class="c1"># short in Y</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">maxY</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="o">-</span><span class="n">val</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>

        <span class="c1"># long in X</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getLocalCoordinatesFlatsUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getLocalCoordinatesFlatsUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getLocalCoordinatesFlatsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test getLocalCoordinates() for flats up hex grids.&quot;&quot;&quot;</span>
        <span class="c1"># validate the first ring of a flats-up hex grid</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">())</span>

        <span class="c1"># long in Y</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">minY</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">maxY</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">minY</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># short in X</span>
        <span class="n">maxX</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">minX</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">maxX</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">minX</span><span class="p">,</span> <span class="o">-</span><span class="n">val</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_neighbors">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_neighbors">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">neighbs</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getNeighboringCellIndices</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbs</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">neighbs</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_ringPosFromIndices">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_ringPosFromIndices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_ringPosFromIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test conversion from&lt;--&gt;to ring/position based on hand-prepared right answers.&quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indices</span><span class="p">,</span> <span class="n">ringPos</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">60</span><span class="p">)),</span>
            <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">)),</span>
            <span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">)),</span>
            <span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">)),</span>
        <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="o">*</span><span class="n">ringPos</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ringPos</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestHexGrid.test_label">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_label">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">label1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">label1</span><span class="p">,</span> <span class="s2">&quot;012-005&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">locatorLabelToIndices</span><span class="p">(</span><span class="n">label1</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="n">label2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getLabel</span><span class="p">(</span><span class="n">indices</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span><span class="p">,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">label2</span><span class="p">,</span> <span class="s2">&quot;012-005-005&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grids</span><span class="o">.</span><span class="n">locatorLabelToIndices</span><span class="p">(</span><span class="n">label2</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestHexGrid.test_overlapsWhichSymmetryLine">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_overlapsWhichSymmetryLine">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_overlapsWhichSymmetryLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">overlapsWhichSymmetryLine</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="n">grids</span><span class="o">.</span><span class="n">BOUNDARY_60_DEGREES</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">overlapsWhichSymmetryLine</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">23</span><span class="p">)),</span>
            <span class="n">grids</span><span class="o">.</span><span class="n">BOUNDARY_0_DEGREES</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">overlapsWhichSymmetryLine</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
            <span class="n">grids</span><span class="o">.</span><span class="n">BOUNDARY_120_DEGREES</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getSymmetricIdenticalsThird">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getSymmetricIdenticalsThird">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getSymmetricIdenticalsThird</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve equivalent contents based on third symmetry.</span>

<span class="sd">        .. test:: Equivalent contents in third geometry are retrievable.</span>
<span class="sd">            :id: T_ARMI_GRID_EQUIVALENTS</span>
<span class="sd">            :tests: R_ARMI_GRID_EQUIVALENTS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">[(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)])</span>

        <span class="n">symmetrics</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">19</span><span class="p">)],</span> <span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">symmetrics</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestHexGrid.test_thirdAndFullSymmetry">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_thirdAndFullSymmetry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_thirdAndFullSymmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that we can construct a full and a 1/3 core grid.</span>

<span class="sd">        .. test:: Test 1/3 and full cores have the correct positions and rings.</span>
<span class="sd">            :id: T_ARMI_GRID_SYMMETRY</span>
<span class="sd">            :tests: R_ARMI_GRID_SYMMETRY</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;full core&quot;</span><span class="p">)</span>
        <span class="n">third</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">symmetry</span><span class="o">=</span><span class="s2">&quot;third core periodic&quot;</span><span class="p">)</span>

        <span class="c1"># check full core</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">getMinimumRings</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">full</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="p">[])</span>

        <span class="c1"># check 1/3 core</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">third</span><span class="o">.</span><span class="n">getMinimumRings</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">third</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">third</span><span class="o">.</span><span class="n">getPositionsInRing</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">third</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span> <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestHexGrid.test_cornersUpFlatsUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_cornersUpFlatsUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_cornersUpFlatsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the cornersUp attribute of the fromPitch method.</span>

<span class="sd">        .. test:: Build a points-up and a flats-up hexagonal grids.</span>
<span class="sd">            :id: T_ARMI_GRID_HEX_TYPE</span>
<span class="sd">            :tests: R_ARMI_GRID_HEX_TYPE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flatsUp</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">flatsUp</span><span class="o">.</span><span class="n">_unitSteps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">flatsUp</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">cornersUp</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cornersUp</span><span class="o">.</span><span class="n">_unitSteps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">cornersUp</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_triangleCoords">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_triangleCoords">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_triangleCoords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">8.15</span><span class="p">)</span>
        <span class="n">indices1</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="n">indices2</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="n">indices3</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">triangleCoords</span><span class="p">(</span><span class="n">indices1</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">16.468_916_428_634_078</span><span class="p">,</span> <span class="mf">25.808_333_333_333_337</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">14.116_214_081_686_351</span><span class="p">,</span> <span class="mf">27.166_666_666_666_67</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">11.763_511_734_738_627</span><span class="p">,</span> <span class="mf">25.808_333_333_333_337</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">11.763_511_734_738_627</span><span class="p">,</span> <span class="mf">23.091_666_666_666_67</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">14.116_214_081_686_351</span><span class="p">,</span> <span class="mf">21.733_333_333_333_334</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">16.468_916_428_634_078</span><span class="p">,</span> <span class="mf">23.091_666_666_666_67</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span><span class="o">.</span><span class="n">triangleCoords</span><span class="p">(</span><span class="n">indices2</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mf">9.381_941_874_331_42</span><span class="p">,</span> <span class="mf">0.416_666_666_666_666_7</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">8.660_254_037_844_387</span><span class="p">,</span> <span class="mf">0.833_333_333_333_333_4</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">7.938_566_201_357_355_5</span><span class="p">,</span> <span class="mf">0.416_666_666_666_666_7</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">7.938_566_201_357_355_5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.416_666_666_666_666_7</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">8.660_254_037_844_387</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.833_333_333_333_333_4</span><span class="p">),</span>
            <span class="p">(</span><span class="mf">9.381_941_874_331_42</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.416_666_666_666_666_7</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

        <span class="n">cur</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span><span class="o">.</span><span class="n">triangleCoords</span><span class="p">(</span><span class="n">indices3</span><span class="p">)</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">1.812_879_845_255_425</span><span class="p">,</span> <span class="mf">5.233_333_333_333_333</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">2.719_319_767_883_137_6</span><span class="p">,</span> <span class="mf">5.756_666_666_666_667</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">3.625_759_690_510_850_2</span><span class="p">,</span> <span class="mf">5.233_333_333_333_333</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">3.625_759_690_510_850_2</span><span class="p">,</span> <span class="mf">4.186_666_666_666_666_5</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">2.719_319_767_883_137_6</span><span class="p">,</span> <span class="mf">3.663_333_333_333_333</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mf">1.812_879_845_255_425</span><span class="p">,</span> <span class="mf">4.186_666_666_666_666_5</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getIndexBounds">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getIndexBounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getIndexBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">numRings</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="n">numRings</span><span class="p">)</span>
        <span class="n">boundsIJK</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getIndexBounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">boundsIJK</span><span class="p">,</span> <span class="p">((</span><span class="o">-</span><span class="n">numRings</span><span class="p">,</span> <span class="n">numRings</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">numRings</span><span class="p">,</span> <span class="n">numRings</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span></div>


<div class="viewcode-block" id="TestHexGrid.test_getAllIndices">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_getAllIndices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getAllIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getAllIndices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">indices</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_buildLocations">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_buildLocations">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_buildLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">loc1</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loc1</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loc1</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_is_pickleable">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_is_pickleable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_is_pickleable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">protocol</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">protocol</span><span class="p">)</span>
            <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">newLoc</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
            <span class="n">assert_allclose</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">newLoc</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_adjustPitchFlatsUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_adjustPitchFlatsUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_adjustPitchFlatsUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust the pitch of a hexagonal lattice, for a flats up grid.</span>

<span class="sd">        .. test:: Construct a hexagonal lattice with three rings.</span>
<span class="sd">            :id: T_ARMI_GRID_HEX0</span>
<span class="sd">            :tests: R_ARMI_GRID_HEX</span>

<span class="sd">        .. test:: Return the grid coordinates of different locations.</span>
<span class="sd">            :id: T_ARMI_GRID_GLOBAL_POS0</span>
<span class="sd">            :tests: R_ARMI_GRID_GLOBAL_POS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># run this test for a grid with no offset, and then a few random offset values</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.123</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">]:</span>
            <span class="c1"># build a hex grid with pitch=1, 3 rings, and the above offset</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="p">(</span>
                <span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.5</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
                <span class="n">unitStepLimits</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset</span><span class="p">]),</span>
            <span class="p">)</span>

            <span class="c1"># test number of rings before converting pitch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitStepLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># test that we CAN change the pitch, and it scales the grid (but not the offset)</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">changePitch</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">assert_allclose</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v1</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>

            <span class="c1"># basic sanity: test number of rings has not changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitStepLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># basic sanity: check the offset exists and is correct</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">offset</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_adjustPitchCornersUp">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_adjustPitchCornersUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_adjustPitchCornersUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adjust the pich of a hexagonal lattice, for a &quot;corners up&quot; grid.</span>

<span class="sd">        .. test:: Construct a hexagonal lattice with three rings.</span>
<span class="sd">            :id: T_ARMI_GRID_HEX1</span>
<span class="sd">            :tests: R_ARMI_GRID_HEX</span>

<span class="sd">        .. test:: Return the grid coordinates of different locations.</span>
<span class="sd">            :id: T_ARMI_GRID_GLOBAL_POS1</span>
<span class="sd">            :tests: R_ARMI_GRID_GLOBAL_POS</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># run this test for a grid with no offset, and then a few random offset values</span>
        <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.123</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">]:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="c1"># build a hex grid with pitch=1, 3 rings, and the above offset</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="p">(</span>
                <span class="n">unitSteps</span><span class="o">=</span><span class="p">(</span>
                    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="p">(</span><span class="mf">1.5</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mf">1.5</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">unitStepLimits</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                <span class="n">offset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">offsets</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># test number of rings before converting pitch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitStepLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># test that we CAN change the pitch, and it scales the grid (but not the offset)</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">changePitch</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">)</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">correction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">assert_allclose</span><span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">correction</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>

            <span class="c1"># basic sanity: test number of rings has not changed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitStepLimits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

            <span class="c1"># basic sanity: check the offset exists and is correct</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">off</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">off</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_badIndices">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_badIndices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_badIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

        <span class="c1"># this is actually ok because step-defined grids are infinite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">))[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">):</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestHexGrid.test_isInFirstThird">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_isInFirstThird">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_isInFirstThird</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if grid is in the first third.</span>

<span class="sd">        .. test:: Determine if grid is in the first third.</span>
<span class="sd">            :id: T_ARMI_GRID_SYMMETRY_LOC</span>
<span class="sd">            :tests: R_ARMI_GRID_SYMMETRY_LOC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">isInFirstThird</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="TestHexGrid.test_indicesAndEdgeFromRingAndPos">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_indicesAndEdgeFromRingAndPos">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">edge</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">_indicesAndEdgeFromRingAndPos</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_rotatedIndices">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_rotatedIndices">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_rotatedIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that a hex grid can produce a rotated cell location.&quot;&quot;&quot;</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">center</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">notRotated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">notRotated</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>

        <span class="c1"># One rotation for a trivial check</span>
        <span class="n">northEast</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">dueNorth</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">northWest</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">northEast</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">dueNorth</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">dueNorth</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">(),</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

        <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">dueNorth</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">northWest</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">northWest</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">(),</span> <span class="p">[</span><span class="o">-</span><span class="n">hexagon</span><span class="o">.</span><span class="n">SQRT3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Two rotations from the &quot;first&quot; object in the first full ring</span>
        <span class="n">actual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">northEast</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">northWest</span><span class="p">)</span>

        <span class="c1"># Fuzzy rotation: if we rotate an location, and then rotate it back, we get the same location</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">startI</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">startJ</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="n">startI</span><span class="p">,</span> <span class="n">startJ</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">postRotate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">rotations</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">startI</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">startJ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">postRotate</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">rotations</span> <span class="o">%</span> <span class="mi">6</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">postRotate</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">rotations</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">postRotate</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">rotations</span><span class="p">)</span>
            <span class="nb">reversed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotateAndCheckAngle</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">postRotate</span><span class="p">,</span> <span class="o">-</span><span class="n">rotations</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">reversed</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_rotateAndCheckAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">,</span> <span class="n">rotations</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rotate a location and verify it lands where we expected.&quot;&quot;&quot;</span>
        <span class="n">finish</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">rotations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_checkAngle</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">,</span> <span class="n">rotations</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">finish</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_checkAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">,</span> <span class="n">finish</span><span class="p">:</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">,</span> <span class="n">rotations</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare two locations that should be some number of 60 degree CCW rotations apart.&quot;&quot;&quot;</span>
        <span class="n">startXY</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">rotations</span>
        <span class="n">rotationMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">rotationMatrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">startXY</span><span class="p">)</span>
        <span class="n">finishXY</span> <span class="o">=</span> <span class="n">finish</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">finishXY</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>

<div class="viewcode-block" id="TestHexGrid.test_inconsistentRotationGrids">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_inconsistentRotationGrids">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_inconsistentRotationGrids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that only locations in consistent grids are rotatable.&quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">larger</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">pitch</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">cornersUp</span><span class="p">)</span>
        <span class="n">fromLarger</span> <span class="o">=</span> <span class="n">larger</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">base</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">fromLarger</span><span class="p">)</span>

        <span class="n">differentOrientation</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="ow">not</span> <span class="n">base</span><span class="o">.</span><span class="n">cornersUp</span><span class="p">)</span>
        <span class="n">fromDiffOrientation</span> <span class="o">=</span> <span class="n">differentOrientation</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">base</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">fromDiffOrientation</span><span class="p">)</span>

        <span class="n">axialGrid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">fromAxial</span> <span class="o">=</span> <span class="n">axialGrid</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span>
            <span class="n">base</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">fromAxial</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_rotatedIndexGridAssignment">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_rotatedIndexGridAssignment">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_rotatedIndexGridAssignment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that the grid of the rotated index is identical through rotation.&quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">pitch</span><span class="p">,</span> <span class="n">cornersUp</span><span class="o">=</span><span class="n">base</span><span class="o">.</span><span class="n">cornersUp</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">other</span><span class="p">)</span>
            <span class="n">postRotate</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">postRotate</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">loc</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestHexGrid.test_rotatedIndexRoughEqualPitch">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestHexGrid.test_rotatedIndexRoughEqualPitch">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_rotatedIndexRoughEqualPitch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test indices can be rotated in close but not exactly equal grids.&quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mf">1.345</span><span class="p">)</span>
        <span class="n">other</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">pitch</span> <span class="o">*</span> <span class="mf">1.00001</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)):</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">IndexLocation</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">base</span><span class="p">)</span>
            <span class="n">fromBase</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fromOther</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">rotateIndex</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">rotations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">fromBase</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">fromBase</span><span class="o">.</span><span class="n">j</span><span class="p">),</span> <span class="p">(</span><span class="n">fromOther</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">fromOther</span><span class="o">.</span><span class="n">j</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="TestBoundsDefinedGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestBoundsDefinedGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestBoundsDefinedGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestBoundsDefinedGrid.test_positions">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestBoundsDefinedGrid.test_positions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">]))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestBoundsDefinedGrid.test_base">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestBoundsDefinedGrid.test_base">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">]))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCellBase</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestBoundsDefinedGrid.test_positionsMixedDefinition">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestBoundsDefinedGrid.test_positionsMixedDefinition">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_positionsMixedDefinition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">unitSteps</span><span class="o">=</span><span class="p">((</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">]))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestBoundsDefinedGrid.test_getIndexBounds">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestBoundsDefinedGrid.test_getIndexBounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getIndexBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">MockStructuredGrid</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">]))</span>
        <span class="n">boundsIJK</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndexBounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">boundsIJK</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span></div>
</div>



<div class="viewcode-block" id="TestThetaRZGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestThetaRZGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestThetaRZGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of tests for the RZTheta Grid.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestThetaRZGrid.test_positions">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestThetaRZGrid.test_positions">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">ThetaRZGrid</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]))</span>
        <span class="n">assert_allclose</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">))</span>

        <span class="c1"># test round trip ring position</span>
        <span class="n">ringPos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getIndicesFromRingAndPos</span><span class="p">(</span><span class="o">*</span><span class="n">ringPos</span><span class="p">)</span>
        <span class="n">ringPosFromIndices</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ringPos</span><span class="p">,</span> <span class="n">ringPosFromIndices</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestCartesianGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestCartesianGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestCartesianGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A set of tests for the Cartesian Grid.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestCartesianGrid.test_ringPosNoSplit">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestCartesianGrid.test_ringPosNoSplit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_ringPosNoSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">isOffset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">expectedRing</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">expectedPos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">expectedPos</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
                <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">expectedRing</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">expectedPos</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>

        <span class="c1"># Bonus test of getMinimumRings() using the above grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getMinimumRings</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getMinimumRings</span><span class="p">(</span><span class="mi">17</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestCartesianGrid.test_ringPosSplit">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestCartesianGrid.test_ringPosSplit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_ringPosSplit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">expectedRing</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">expectedPos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">24</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">22</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">21</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">expectedPos</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
                <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">expectedRing</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">expectedPos</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">3</span><span class="p">][</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestCartesianGrid.test_symmetry">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestCartesianGrid.test_symmetry">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># PERIODIC, no split</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">QUARTER_CORE</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">expectedEq</span> <span class="ow">in</span> <span class="n">expected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">equivalents</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">idx</span><span class="p">)}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectedEq</span><span class="p">,</span> <span class="n">equivalents</span><span class="p">)</span>

        <span class="c1"># PERIODIC, split</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">QUARTER_CORE</span><span class="p">,</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span><span class="p">,</span>
                <span class="n">throughCenterAssembly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="nb">set</span><span class="p">(),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)},</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">expectedEq</span> <span class="ow">in</span> <span class="n">expected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">equivalents</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">idx</span><span class="p">)}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectedEq</span><span class="p">,</span> <span class="n">equivalents</span><span class="p">)</span>

        <span class="c1"># REFLECTIVE, no split</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">QUARTER_CORE</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">REFLECTIVE</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)},</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)},</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">expectedEq</span> <span class="ow">in</span> <span class="n">expected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">equivalents</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">idx</span><span class="p">)}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectedEq</span><span class="p">,</span> <span class="n">equivalents</span><span class="p">)</span>

        <span class="c1"># REFLECTIVE, split</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">QUARTER_CORE</span><span class="p">,</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">REFLECTIVE</span><span class="p">,</span>
                <span class="n">throughCenterAssembly</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="nb">set</span><span class="p">(),</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)},</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="p">{(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)},</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">expectedEq</span> <span class="ow">in</span> <span class="n">expected</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">equivalents</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">(</span><span class="n">idx</span><span class="p">)}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectedEq</span><span class="p">,</span> <span class="n">equivalents</span><span class="p">)</span>

        <span class="c1"># Full core</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">FULL_CORE</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span> <span class="p">[])</span>

        <span class="c1"># 1/8 core not supported yet</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">symmetry</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">EIGHTH_CORE</span><span class="p">,</span>
                <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">REFLECTIVE</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">getSymmetricEquivalents</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="TestAxialGrid">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestAxialGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestAxialGrid</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestAxialGrid.test_simpleBounds">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestAxialGrid.test_simpleBounds">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_simpleBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N_CELLS</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="n">N_CELLS</span><span class="p">)</span>
        <span class="n">_x</span><span class="p">,</span> <span class="n">_y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">getBounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">N_CELLS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">assert_array_equal</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">isAxialOnly</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestAxialGrid.test_getLocations">
<a class="viewcode-back" href="../../../../../.apidocs/armi.reactor.grids.tests.test_grids.html#armi.reactor.grids.tests.test_grids.TestAxialGrid.test_getLocations">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_getLocations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N_CELLS</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">AxialGrid</span><span class="o">.</span><span class="n">fromNCells</span><span class="p">(</span><span class="n">N_CELLS</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N_CELLS</span><span class="p">):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">g</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count</span><span class="p">)]</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">getLocalCoordinates</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2026, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2026-01-14.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>