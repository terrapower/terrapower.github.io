

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.nuclearDataIO.cccc.cccc &mdash; ARMI 0.2.5 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../../../_static/assets/jsonview_loader.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../requirements/index.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../armi.html">armi</a> &raquo;</li>
        
          <li><a href="../../nuclearDataIO.html">armi.nuclearDataIO</a> &raquo;</li>
        
      <li>armi.nuclearDataIO.cccc.cccc</li>
    
    
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for armi.nuclearDataIO.cccc.cccc</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines containers for the reading and writing standard interface files </span>
<span class="sd">for reactor physics codes.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>

<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">nuclearFileMetadata</span>

<span class="n">IMPLICIT_INT</span> <span class="o">=</span> <span class="s2">&quot;IJKLMN&quot;</span>
<span class="sd">&quot;&quot;&quot;Letters that trigger implicit integer types in old FORTRAN 77 codes&quot;&quot;&quot;</span>


<div class="viewcode-block" id="IORecord"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord">[docs]</a><span class="k">class</span> <span class="nc">IORecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single CCCC record.</span>

<span class="sd">    Reads or writes information to or from a stream.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stream</span>
<span class="sd">        A collection of data to be read or written</span>

<span class="sd">    hasRecordBoundaries : bool</span>
<span class="sd">        A True value means the fortran file was written using access=&#39;sequential&#39; and contains</span>
<span class="sd">        a 4 byte int count at the beginning and end of each record. Otherwise, if False the</span>
<span class="sd">        fortran file was written using access=&#39;direct&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The methods in this object often have `rw` prefixes, meaning the same method</span>
<span class="sd">    can be used for both reading and writing. We consider this a significant</span>
<span class="sd">    achievement that enforces consistency between the code for reading and writing</span>
<span class="sd">    CCCC records. The tradeoff is that it&#39;s a bit challenging to comprehend at first.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_intSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">)</span>
    <span class="n">_longSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
    <span class="n">maxsize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># limit to max short even though Python3 can go bigger.</span>
    <span class="n">_intFormat</span> <span class="o">=</span> <span class="s2">&quot; {{:&gt;+</span><span class="si">{}</span><span class="s2">}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">maxsize</span><span class="p">)</span>
    <span class="n">_intLength</span> <span class="o">=</span> <span class="n">maxsize</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">_floatSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">)</span>
    <span class="n">_floatFormat</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">{:+.16E}</span><span class="s2">&quot;</span>
    <span class="n">_floatLength</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">4</span>

    <span class="n">_characterSize</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">IORecord</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="n">stream</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hasRecordBoundaries</span> <span class="o">=</span> <span class="n">hasRecordBoundaries</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the stream for reading/writing and return :code:`self`.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        armi.nuclearDataIO.cccc.IORecord.open</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ee</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to close CCCC record.&quot;</span><span class="p">)</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">ee</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">BufferError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to close record, </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;It is possible too much data was read from the &quot;</span>
                <span class="s2">&quot;record, and the end of the stream was reached.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee</span><span class="p">)</span>
            <span class="p">)</span>

<div class="viewcode-block" id="IORecord.open"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for opening the stream.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.close"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for closing the stream.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.rwInt"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwInt">[docs]</a>    <span class="k">def</span> <span class="nf">rwInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for reading or writing an integer.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`val` should have value, but when the record is being read,</span>
<span class="sd">        :code:`val` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.rwBool"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwBool">[docs]</a>    <span class="k">def</span> <span class="nf">rwBool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read or write a boolean value from an integer.&quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span></div>

<div class="viewcode-block" id="IORecord.rwFloat"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwFloat">[docs]</a>    <span class="k">def</span> <span class="nf">rwFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for reading or writing a floating point (single precision) value.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`val` should have value, but when the record is being read,</span>
<span class="sd">        :code:`val` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.rwDouble"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwDouble">[docs]</a>    <span class="k">def</span> <span class="nf">rwDouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for reading or writing a floating point (double precision) value.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`val` should have value, but when the record is being read,</span>
<span class="sd">        :code:`val` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.rwString"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwString">[docs]</a>    <span class="k">def</span> <span class="nf">rwString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Abstract method for reading or writing a string.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`val` should have value, but when the record is being read,</span>
<span class="sd">        :code:`val` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="IORecord.rwList"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwList">[docs]</a>    <span class="k">def</span> <span class="nf">rwList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">containedType</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">strLength</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A method for reading and writing a (array) of items of a specific type.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`contents` should have value, but when the record is being read,</span>
<span class="sd">        :code:`contents` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If a :code:`contents` evaluates to :code:`True`, the array must be the same size as</span>
<span class="sd">        :code:`length`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;int&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">,</span>
            <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwFloat</span><span class="p">,</span>
            <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">val</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwString</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">strLength</span><span class="p">),</span>
            <span class="s2">&quot;double&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwDouble</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">actions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">containedType</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Cannot pack or unpack the type &quot;</span><span class="si">{}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">containedType</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># this little trick will make this work for both reading and writing, yay!</span>
        <span class="k">if</span> <span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">action</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)])</span></div>

<div class="viewcode-block" id="IORecord.rwMatrix"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">rwMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method for reading and writing a matrix of floating point values.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`contents` should have value, but when the record is being read,</span>
<span class="sd">        :code:`contents` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If a :code:`contents` is not :code:`None`, the array must be the same shape as</span>
<span class="sd">        :code:`*shape`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rwMatrix</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwFloat</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="IORecord.rwDoubleMatrix"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwDoubleMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">rwDoubleMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read or write a matrix of floating point values.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method has a seemingly odd signature, because it is used for both reading and writing.</span>
<span class="sd">        When writing, the :code:`contents` should have value, but when the record is being read,</span>
<span class="sd">        :code:`contents` can be :code:`None` or anything else; it is ignored.</span>

<span class="sd">        Warning</span>
<span class="sd">        -------</span>
<span class="sd">        If a :code:`contents` is not :code:`None`, the array must be the same shape as</span>
<span class="sd">        :code:`*shape`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rwMatrix</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwDouble</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span></div>

<div class="viewcode-block" id="IORecord.rwIntMatrix"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwIntMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">rwIntMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read or write a matrix of int values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rwMatrix</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rwMatrix</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read/write a matrix.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This can be important for performance when reading large matrices (e.g. scatter</span>
<span class="sd">        matrices). It may be worth investigating ``numpy.frombuffer`` on read and</span>
<span class="sd">        something similar on write.</span>

<span class="sd">        With shape, the first shape argument should be the outermost loop because</span>
<span class="sd">        these are stored in column major order (the FORTRAN way).</span>

<span class="sd">        Note that numpy.ndarrays can be built with ``order=&quot;F&quot;`` to have column-major ordering.</span>

<span class="sd">        So if you have ``((MR(I,J),I=1,NCINTI),J=1,NCINTJ)`` you would pass in</span>
<span class="sd">        the shape as (NCINTJ, NCINTI).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fortranShape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">contents</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">contents</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">fortranShape</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">shape</span><span class="p">]):</span>
            <span class="n">fortranIndex</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
            <span class="n">contents</span><span class="p">[</span><span class="n">fortranIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="n">fortranIndex</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">contents</span>

<div class="viewcode-block" id="IORecord.rwImplicitlyTypedMap"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.IORecord.rwImplicitlyTypedMap">[docs]</a>    <span class="k">def</span> <span class="nf">rwImplicitlyTypedMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">contents</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a dict of floats and/or ints with FORTRAN77-style implicit typing.</span>

<span class="sd">        Length of list is determined by length of list of keys passed in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="c1"># ready for some implicit madness from the FORTRAN 77 days?</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">IMPLICIT_INT</span><span class="p">:</span>
                <span class="n">contents</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">contents</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwFloat</span><span class="p">(</span><span class="n">contents</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">contents</span></div></div>


<div class="viewcode-block" id="BinaryRecordReader"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader">[docs]</a><span class="k">class</span> <span class="nc">BinaryRecordReader</span><span class="p">(</span><span class="n">IORecord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes a single CCCC record in binary format.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This class reads a single CCCC record in binary format. A CCCC record consists of a leading and</span>
<span class="sd">    ending integer indicating how many bytes the record is. The data contained within the record may</span>
<span class="sd">    be integer, float, double, or string.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BinaryRecordReader.open"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the record by reading the number of bytes in the record, this value will be used</span>
<span class="sd">        to ensure the entire record was read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasRecordBoundaries</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">-=</span> <span class="mi">4</span></div>

<div class="viewcode-block" id="BinaryRecordReader.close"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the record by reading the number of bytes from then end of the record, if it</span>
<span class="sd">        does not match the initial value, an exception will be raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasRecordBoundaries</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># now read end of record</span>
        <span class="n">numBytes2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwInt</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">-=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">numBytes2</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">BufferError</span><span class="p">(</span>
                <span class="s2">&quot;Number of bytes specified at end the of record, </span><span class="si">{}</span><span class="s2">, &quot;</span>
                <span class="s2">&quot;does not match the originally specified number, </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Read </span><span class="si">{}</span><span class="s2"> bytes.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numBytes2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span><span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwInt"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwInt">[docs]</a>    <span class="k">def</span> <span class="nf">rwInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads an integer value from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intSize</span>
        <span class="p">(</span><span class="n">i</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_intSize</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">i</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwBool"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwBool">[docs]</a>    <span class="k">def</span> <span class="nf">rwBool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read or write a boolean value from an integer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">IORecord</span><span class="o">.</span><span class="n">rwBool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwLong"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwLong">[docs]</a>    <span class="k">def</span> <span class="nf">rwLong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads an integer value from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longSize</span>
        <span class="p">(</span><span class="n">ll</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_longSize</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ll</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwFloat"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwFloat">[docs]</a>    <span class="k">def</span> <span class="nf">rwFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a single precision floating point value from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span>
        <span class="p">(</span><span class="n">f</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwDouble"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwDouble">[docs]</a>    <span class="k">def</span> <span class="nf">rwDouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a double precision floating point value from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="p">(</span><span class="n">d</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="BinaryRecordReader.rwString"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordReader.rwString">[docs]</a>    <span class="k">def</span> <span class="nf">rwString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a string of specified length from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="n">length</span>
        <span class="p">(</span><span class="n">s</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>  <span class="c1"># convert bytes to string on reading.</span></div></div>


<div class="viewcode-block" id="BinaryRecordWriter"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter">[docs]</a><span class="k">class</span> <span class="nc">BinaryRecordWriter</span><span class="p">(</span><span class="n">IORecord</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;a single record from a CCCC file</span>

<span class="sd">    Reads binary information sequentially.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">IORecord</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="BinaryRecordWriter.open"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.close"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasRecordBoundaries</span><span class="p">:</span>
            <span class="n">packedNumBytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPackedNumBytes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">packedNumBytes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_write_buffer_to_stream</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hasRecordBoundaries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">packedNumBytes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_getPackedNumBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write_buffer_to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">]))</span>

<div class="viewcode-block" id="BinaryRecordWriter.rwInt"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwInt">[docs]</a>    <span class="k">def</span> <span class="nf">rwInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.rwBool"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwBool">[docs]</a>    <span class="k">def</span> <span class="nf">rwBool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read or write a boolean value from an integer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">IORecord</span><span class="o">.</span><span class="n">rwBool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.rwLong"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwLong">[docs]</a>    <span class="k">def</span> <span class="nf">rwLong</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads an integer value from the binary stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">byteCount</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.rwFloat"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwFloat">[docs]</a>    <span class="k">def</span> <span class="nf">rwFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.rwDouble"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwDouble">[docs]</a>    <span class="k">def</span> <span class="nf">rwDouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="BinaryRecordWriter.rwString"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.BinaryRecordWriter.rwString">[docs]</a>    <span class="k">def</span> <span class="nf">rwString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="n">length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_characterSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">length</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">val</span></div></div>


<div class="viewcode-block" id="AsciiRecordReader"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader">[docs]</a><span class="k">class</span> <span class="nc">AsciiRecordReader</span><span class="p">(</span><span class="n">BinaryRecordReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads a single CCCC record in ASCII format.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    AsciiRecordWriter</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AsciiRecordReader.close"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">BinaryRecordReader</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># read one extra character for the new line \n... python somehow correctly figures out</span>
        <span class="c1"># that on windows \r\n is really just a \n... no idea how.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getPackedNumBytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span>

    <span class="k">def</span> <span class="nf">_write_buffer_to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">]))</span>

<div class="viewcode-block" id="AsciiRecordReader.rwInt"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader.rwInt">[docs]</a>    <span class="k">def</span> <span class="nf">rwInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_intLength</span><span class="p">))</span></div>

<div class="viewcode-block" id="AsciiRecordReader.rwFloat"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader.rwFloat">[docs]</a>    <span class="k">def</span> <span class="nf">rwFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_floatLength</span><span class="p">))</span></div>

<div class="viewcode-block" id="AsciiRecordReader.rwDouble"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader.rwDouble">[docs]</a>    <span class="k">def</span> <span class="nf">rwDouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rwFloat</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="AsciiRecordReader.rwString"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordReader.rwString">[docs]</a>    <span class="k">def</span> <span class="nf">rwString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="c1"># read one space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AsciiRecordWriter"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter">[docs]</a><span class="k">class</span> <span class="nc">AsciiRecordWriter</span><span class="p">(</span><span class="n">IORecord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Writes a single CCCC record in ASCII format.</span>

<span class="sd">    Since there is no specific format of an ASCII CCCC record, the format is roughly the same as</span>
<span class="sd">    the :py:class:`BinaryRecordWriter`, except that the :class:`AsciiRecordReader` puts a space in</span>
<span class="sd">    front of all values (ints, floats, and strings), and puts a newline character :code:`\\n` at the</span>
<span class="sd">    end of all records.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">IORecord</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="AsciiRecordWriter.open"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="AsciiRecordWriter.close"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_intFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_intFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="AsciiRecordWriter.rwInt"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.rwInt">[docs]</a>    <span class="k">def</span> <span class="nf">rwInt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_intFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="AsciiRecordWriter.rwFloat"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.rwFloat">[docs]</a>    <span class="k">def</span> <span class="nf">rwFloat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_floatFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="AsciiRecordWriter.rwDouble"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.rwDouble">[docs]</a>    <span class="k">def</span> <span class="nf">rwDouble</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floatSize</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_floatFormat</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="AsciiRecordWriter.rwString"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.AsciiRecordWriter.rwString">[docs]</a>    <span class="k">def</span> <span class="nf">rwString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numBytes</span> <span class="o">+=</span> <span class="n">length</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_characterSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; {value:&lt;</span><span class="si">{length}</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span></div></div>


<div class="viewcode-block" id="DataContainer"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.DataContainer">[docs]</a><span class="k">class</span> <span class="nc">DataContainer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data representation that can be read/written to/from with a cccc.Stream.</span>

<span class="sd">    This is an optional convenience class expected to be used in</span>
<span class="sd">    concert with :py:class:`StreamWithDataStructure`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Need Metadata subclass for default keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">nuclearFileMetadata</span><span class="o">.</span><span class="n">_Metadata</span><span class="p">()</span></div>


<div class="viewcode-block" id="Stream"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream">[docs]</a><span class="k">class</span> <span class="nc">Stream</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract CCCC IO stream.</span>

<span class="sd">    .. warning:: This is more of a stream Parser/Serializer than an actual stream.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A concrete instance of this class should implement the</span>
<span class="sd">    :py:meth:`~armi.nuclearDataIO.cccc.Stream.readWrite` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_fileModes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;rb&quot;</span><span class="p">:</span> <span class="n">BinaryRecordReader</span><span class="p">,</span>
        <span class="s2">&quot;wb&quot;</span><span class="p">:</span> <span class="n">BinaryRecordWriter</span><span class="p">,</span>
        <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">AsciiRecordReader</span><span class="p">,</span>
        <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="n">AsciiRecordWriter</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an instance of a :py:class:`~armi.nuclearDataIO.cccc.Stream`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fileName : str</span>
<span class="sd">            name of the file to be read</span>
<span class="sd">        fileMode : str</span>
<span class="sd">            the file mode, i.e. &#39;w&#39; for writing ASCII, &#39;r&#39; for reading ASCII, &#39;wb&#39; for writing</span>
<span class="sd">            binary, and &#39;rb&#39; for reading binary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span> <span class="o">=</span> <span class="n">fileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fileMode</span> <span class="o">=</span> <span class="n">fileMode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">fileMode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileModes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> not in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;fileMode&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileModes</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open file objects can&#39;t be deepcopied so we clear them before copying.&quot;&quot;&quot;</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">memo</span><span class="p">[</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;_stream&quot;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">memo</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;At the inception of a with command, open up the file for a read/write.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileMode</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cannot find </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileName</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
            <span class="k">raise</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;At the termination of a with command, close the file.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Stream.readWrite"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.readWrite">[docs]</a>    <span class="k">def</span> <span class="nf">readWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method should be implemented on any sub-classes to specify the order of records.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Stream.createRecord"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.createRecord">[docs]</a>    <span class="k">def</span> <span class="nf">createRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">recordClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileModes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileMode</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">recordClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stream</span><span class="p">,</span> <span class="n">hasRecordBoundaries</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stream.readBinary"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.readBinary">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">readBinary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data from a binary file into a data structure&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stream.readAscii"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.readAscii">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">readAscii</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read data from an ASCII file into a data structure&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<div class="viewcode-block" id="Stream.writeBinary"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.writeBinary">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">writeBinary</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the contents of a data container to a binary file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Stream.writeAscii"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.Stream.writeAscii">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">writeAscii</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the contents of a data container to an ASCII file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>


<div class="viewcode-block" id="StreamWithDataContainer"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.StreamWithDataContainer">[docs]</a><span class="k">class</span> <span class="nc">StreamWithDataContainer</span><span class="p">(</span><span class="n">Stream</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A cccc.Stream that reads/writes to a specialized data container.</span>

<span class="sd">    This is a relatively common pattern so some of the boilerplate</span>
<span class="sd">    is handled here.</span>

<span class="sd">    .. warning:: This is more of a stream Parser/Serializer than an actual stream.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    It should be possible to fully merge this with ``Stream``, which may make</span>
<span class="sd">    this a little less confusing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">Stream</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">metadata</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_getDataContainer</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">DataContainer</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_getDataContainer</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_readWrite</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span>
            <span class="n">fileName</span><span class="p">,</span>
            <span class="n">fileMode</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># pylint: disable=arguments-differ</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_readWrite</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_readWrite</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">fileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fileName</span><span class="p">,</span> <span class="n">fileMode</span><span class="p">)</span> <span class="k">as</span> <span class="n">rw</span><span class="p">:</span>
            <span class="n">rw</span><span class="o">.</span><span class="n">readWrite</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="getBlockBandwidth"><a class="viewcode-back" href="../../../../.apidocs/armi.nuclearDataIO.cccc.cccc.html#armi.nuclearDataIO.cccc.cccc.getBlockBandwidth">[docs]</a><span class="k">def</span> <span class="nf">getBlockBandwidth</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nintj</span><span class="p">,</span> <span class="n">nblok</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return block bandwidth JL, JU from CCCC interface files.</span>

<span class="sd">    It is common for CCCC files to block data in various records with</span>
<span class="sd">    a description along the lines of::</span>

<span class="sd">        WITH M AS THE BLOCK INDEX, JL=(M-1)*((NINTJ-1)/NBLOK +1)+1</span>
<span class="sd">        AND JU=MIN0(NINTJ,JUP) WHERE JUP=M*((NINTJ-1)/NBLOK +1)</span>

<span class="sd">    This function computes JL and JU for these purposes. It also converts</span>
<span class="sd">    JL and JU to zero based indices rather than 1 based ones, as is almost</span>
<span class="sd">    always wanted when dealing with python/numpy matrices.</span>

<span class="sd">    The term *bandwidth* refers to a kind of sparse matrix representation.</span>
<span class="sd">    Some rows only have columns JL to JH in them rather than 0 to JMAX.</span>
<span class="sd">    The non-zero band from JL to JH is what we&#39;re talking about here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">nintj</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">nblok</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">jLow</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">jHigh</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nintj</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jLow</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jHigh</span> <span class="o">-</span> <span class="mi">1</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2022, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2022-11-11.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>