

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.cases.case &mdash; ARMI 0.6.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme_fixes.css?v=2b77b304" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=e5fbc548" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_style.css?v=678fb11e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/modern.css?v=803738c0" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-test-results/common.css?v=9ec2c1d5" />

  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=b8503983"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
      <script src="../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
      <script src="../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
      <script src="../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
      <script src="../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qa_docs/index.html">QA Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../armi.html">armi</a></li>
      <li class="breadcrumb-item active">armi.cases.case</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.cases.case</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The ``Case`` object is responsible for running, and executing a set of user inputs. Many entry</span>
<span class="sd">points redirect into ``Case`` methods, such as ``clone``, ``compare``, and ``run``.</span>

<span class="sd">The ``Case`` object provides an abstraction around ARMI inputs to allow for manipulation and</span>
<span class="sd">collection of cases.</span>

<span class="sd">See Also</span>
<span class="sd">--------</span>
<span class="sd">armi.cases.suite : A collection of Cases</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cProfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pstats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">trace</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">coverage</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi</span><span class="w"> </span><span class="kn">import</span> <span class="n">context</span><span class="p">,</span> <span class="n">getPluginManager</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">operators</span><span class="p">,</span> <span class="n">runLog</span><span class="p">,</span> <span class="n">settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.bookkeeping.db</span><span class="w"> </span><span class="kn">import</span> <span class="n">compareDatabases</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.nucDirectory</span><span class="w"> </span><span class="kn">import</span> <span class="n">nuclideBases</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.physics.neutronics.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">CONF_LOADING_FILE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor</span><span class="w"> </span><span class="kn">import</span> <span class="n">blueprints</span><span class="p">,</span> <span class="n">reactors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">pathTools</span><span class="p">,</span> <span class="n">tabulate</span><span class="p">,</span> <span class="n">textProcessors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils.customExceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NonexistentSetting</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils.directoryChangers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DirectoryChanger</span><span class="p">,</span>
    <span class="n">ForcedCreationDirectoryChanger</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Change from default .coverage to help with Windows dotfile issues.</span>
<span class="c1"># Must correspond with data_file entry in `pyproject.toml`!</span>
<span class="n">COVERAGE_RESULTS_FILE</span> <span class="o">=</span> <span class="s2">&quot;coverage_results.cov&quot;</span>


<div class="viewcode-block" id="Case">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Case</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An ARMI Case that can be used for suite set up and post-analysis.</span>

<span class="sd">    A Case is capable of loading inputs, checking that they are valid, and initializing a reactor</span>
<span class="sd">    model. Cases can also compare against other cases and be collected into multiple</span>
<span class="sd">    :py:class:`armi.cases.suite.CaseSuite`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">,</span> <span class="n">caseSuite</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a Case from user input.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cs : Settings</span>
<span class="sd">            Settings for this Case</span>
<span class="sd">        caseSuite : CaseSuite, optional</span>
<span class="sd">            CaseSuite this particular case belongs. Passing this in allows dependency tracking</span>
<span class="sd">            across the other cases (e.g. if one case uses the output of another as input, as happens</span>
<span class="sd">            in in-use testing for reactivity coefficient snapshot testing or more complex analysis</span>
<span class="sd">            sequences).</span>
<span class="sd">        bp : Blueprints, optional</span>
<span class="sd">            :py:class:`armi.reactor.blueprints.Blueprints` object containing the assembly</span>
<span class="sd">            definitions and other information. If not supplied, it will be loaded from the ``cs`` as</span>
<span class="sd">            needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_caseSuite</span> <span class="o">=</span> <span class="n">caseSuite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependencies</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Case</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># set the signal if the user passes in a blueprint object, instead of a file</span>
        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cs</span><span class="o">.</span><span class="n">filelessBP</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># NOTE: in order to prevent slow submission times for loading massively large blueprints</span>
        <span class="c1"># (e.g. certain computer-generated input files), self.bp can be None.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="o">=</span> <span class="n">bp</span>

        <span class="c1"># this is used in parameter sweeps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_independentVariables</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">independentVariables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get dictionary of independent variables and their values.</span>

<span class="sd">        This unpacks independent variables from the cs object&#39;s independentVariables setting the</span>
<span class="sd">        first time it is run. This is used in parameter sweeps.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        writeInputs : writes the ``independentVariabls`` setting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independentVariables</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">indepStr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;independentVariables&quot;</span><span class="p">]:</span>
                <span class="n">indepName</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">indepStr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_independentVariables</span><span class="p">[</span><span class="n">indepName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_independentVariables</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;Case cs: </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Blueprint object for this case.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This property allows lazy loading.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="o">=</span> <span class="n">blueprints</span><span class="o">.</span><span class="n">loadFromCs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">roundTrip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span>

    <span class="nd">@bp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="o">=</span> <span class="n">bp</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of parent Case objects.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is performed on demand so that if someone changes the underlying Settings, the case</span>
<span class="sd">        will reflect the correct dependencies. As a result, if this is being done iteratively,</span>
<span class="sd">        you may want to cache it somehow (in a dict?).</span>

<span class="sd">        Ideally, this should not be the responsibility of the Case, but rather the suite!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dependencies</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_caseSuite</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="n">getPluginManager</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">pluginDependencies</span> <span class="ow">in</span> <span class="n">pm</span><span class="o">.</span><span class="n">hook</span><span class="o">.</span><span class="n">defineCaseDependencies</span><span class="p">(</span><span class="n">case</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">suite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_caseSuite</span><span class="p">):</span>
                    <span class="n">dependencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">pluginDependencies</span><span class="p">)</span>

            <span class="c1"># the ([^\/]) capture basically gets the file name portion and excludes any</span>
            <span class="c1"># directory separator</span>
            <span class="n">dependencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getPotentialParentFromSettingValue</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;explicitRepeatShuffles&quot;</span><span class="p">],</span>
                    <span class="sa">r</span><span class="s2">&quot;^(?P&lt;dirName&gt;.*[\/</span><span class="se">\\</span><span class="s2">])?(?P&lt;title&gt;[^\/</span><span class="se">\\</span><span class="s2">]+)-SHUFFLES\.txt$&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># ensure that a case doesn&#39;t appear to be its own dependency</span>
        <span class="n">dependencies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dependencies</span><span class="p">)</span>
        <span class="n">dependencies</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dependencies</span>

<div class="viewcode-block" id="Case.addExplicitDependency">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.addExplicitDependency">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">addExplicitDependency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">case</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register an explicit dependency.</span>

<span class="sd">        When evaluating the ``dependency`` property, dynamic dependencies are probed</span>
<span class="sd">        using the current case settings and plugin hooks. Sometimes, it is necessary to</span>
<span class="sd">        impose dependencies that are not expressed through settings and hooks. This</span>
<span class="sd">        method stores another case as an explicit dependency, which will be included</span>
<span class="sd">        with the other, implicitly discovered, dependencies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">case</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dependencies</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The case </span><span class="si">{}</span><span class="s2"> is already explicitly specified as a dependency of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">case</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dependencies</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">case</span><span class="p">)</span></div>


<div class="viewcode-block" id="Case.getPotentialParentFromSettingValue">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.getPotentialParentFromSettingValue">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getPotentialParentFromSettingValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settingValue</span><span class="p">,</span> <span class="n">filePattern</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a parent case based on a setting value and a pattern.</span>

<span class="sd">        This is a convenient way for a plugin to express a dependency. It uses the</span>
<span class="sd">        ``match.groupdict`` functionality to pull the directory and case name out of a</span>
<span class="sd">        specific setting value an regular expression.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        settingValue : str</span>
<span class="sd">            A particular setting value that might contain a reference to an input that</span>
<span class="sd">            is produced by a dependency.</span>
<span class="sd">        filePattern : str</span>
<span class="sd">            A regular expression for extracting the location and name of the dependency.</span>
<span class="sd">            If the ``settingValue`` matches the passed pattern, this function will</span>
<span class="sd">            attempt to extract the ``dirName`` and ``title`` groups to find the dependency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">filePattern</span><span class="p">,</span> <span class="n">settingValue</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPotentialDependencies</span><span class="p">(</span><span class="o">**</span><span class="n">m</span><span class="o">.</span><span class="n">groupdict</span><span class="p">())</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Found more than one case matching </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">settingValue</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">deps</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getPotentialDependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a parent case based on a directory and case title.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dirName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dirName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">dirName</span><span class="p">):</span>
            <span class="n">dirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">dirName</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">caseMatches</span><span class="p">(</span><span class="n">case</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">title</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">directory</span><span class="p">))</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normcase</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dirName</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="n">case</span> <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_caseSuite</span> <span class="k">if</span> <span class="n">caseMatches</span><span class="p">(</span><span class="n">case</span><span class="p">)}</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The case title.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">caseTitle</span>

    <span class="nd">@title</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">caseTitle</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">dbName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The case output database name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">directory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The working directory of the case.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">that</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compares two cases to determine if they are equivalent by looking at the ``title`` and</span>
<span class="sd">        ``directory``.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        No other attributes except those stated above are used for the comparison; the above stated</span>
<span class="sd">        attributes can be considered the &quot;primary key&quot; for a Case object and identify it as being</span>
<span class="sd">        unique. Both of these comparisons are simple string comparisons, so a reference and an</span>
<span class="sd">        absolute path to the same case would be considered different.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">==</span> <span class="n">that</span><span class="o">.</span><span class="n">title</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">==</span> <span class="n">that</span><span class="o">.</span><span class="n">directory</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes the hash of a Case object.</span>

<span class="sd">        This is required when __eq__ is been defined. Take the hash of the tuple of the &quot;primary key&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">))</span>

<div class="viewcode-block" id="Case.setUpTaskDependence">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.setUpTaskDependence">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUpTaskDependence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the task dependence based on the :code:`dependencies`.</span>

<span class="sd">        This accounts for whether or not the dependency is enabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">dependency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dependencies</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dependency</span><span class="o">.</span><span class="n">enabled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">add_parent</span><span class="p">(</span><span class="n">dependency</span><span class="o">.</span><span class="n">_tasks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="Case.run">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run an ARMI case.</span>

<span class="sd">        .. impl:: The case class allows for a generic ARMI simulation.</span>
<span class="sd">            :id: I_ARMI_CASE</span>
<span class="sd">            :implements: R_ARMI_CASE</span>

<span class="sd">            This method is responsible for &quot;running&quot; the ARMI simulation instigated by the inputted</span>
<span class="sd">            settings. This initializes an :py:class:`~armi.operators.operator.Operator`, a</span>
<span class="sd">            :py:class:`~armi.reactor.reactors.Reactor` and invokes</span>
<span class="sd">            :py:meth:`Operator.operate &lt;armi.operators.operator.Operator.operate&gt;`. It also</span>
<span class="sd">            activates supervisory things like code coverage checking, profiling, or tracing, if</span>
<span class="sd">            requested by users during debugging.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Room for improvement: The coverage, profiling, etc. stuff can probably be moved out of here</span>
<span class="sd">        to a more elegant place (like a context manager?).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Start the log here so that the verbosities for the head and workers can be configured</span>
        <span class="c1"># based on the user settings for the rest of the run.</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">LOG</span><span class="o">.</span><span class="n">startLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">caseTitle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">setVerbosity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;verbosity&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">setVerbosity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;branchVerbosity&quot;</span><span class="p">])</span>

        <span class="c1"># if in the settings, start the coverage and profiling</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startCoverage</span><span class="p">()</span>
        <span class="n">profiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startProfiling</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">checkInputs</span><span class="p">()</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializeOperator</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">o</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;trace&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># only trace primary node.</span>
                <span class="n">tracer</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span><span class="n">ignoredirs</span><span class="o">=</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exec_prefix</span><span class="p">],</span> <span class="n">trace</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">tracer</span><span class="o">.</span><span class="n">runctx</span><span class="p">(</span><span class="s2">&quot;o.operate()&quot;</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">o</span><span class="o">.</span><span class="n">operate</span><span class="p">()</span>

        <span class="c1"># if in the settings, report the coverage and profiling</span>
        <span class="n">Case</span><span class="o">.</span><span class="n">_endCoverage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;coverageConfigFile&quot;</span><span class="p">],</span> <span class="n">cov</span><span class="p">)</span>
        <span class="n">Case</span><span class="o">.</span><span class="n">_endProfiling</span><span class="p">(</span><span class="n">profiler</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_startCoverage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to the Case.run: spin up the code coverage tooling, if the Settings file says to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        coverage.Coverage</span>
<span class="sd">            Coverage object for pytest or unittest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;coverage&quot;</span><span class="p">]:</span>
            <span class="n">cov</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">Coverage</span><span class="p">(</span>
                <span class="n">config_file</span><span class="o">=</span><span class="n">Case</span><span class="o">.</span><span class="n">_getCoverageRcFile</span><span class="p">(</span><span class="n">userCovFile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;coverageConfigFile&quot;</span><span class="p">],</span> <span class="n">makeCopy</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">debug</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dataio&quot;</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_SIZE</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># interestingly, you cannot set the parallel flag in the constructor without</span>
                <span class="c1"># auto-specifying the data suffix. This should enable parallel coverage with</span>
                <span class="c1"># auto-generated data file suffixes and combinations.</span>
                <span class="n">cov</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cov</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">cov</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_endCoverage</span><span class="p">(</span><span class="n">userCovFile</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to the Case.run(): stop and report code coverage, if the Settings file says to.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        userCovFile : str</span>
<span class="sd">            File path to user-supplied coverage configuration file (default setting is empty string)</span>
<span class="sd">        cov: coverage.Coverage (optional)</span>
<span class="sd">            Hopefully, a valid and non-empty set of coverage data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">cov</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">cov</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_SIZE</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">context</span><span class="o">.</span><span class="n">MPI_COMM</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>  <span class="c1"># force waiting for everyone to finish</span>

        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_SIZE</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># combine all the parallel coverage data files into one and make the XML and HTML</span>
            <span class="c1"># reports for the whole run.</span>
            <span class="n">combinedCoverage</span> <span class="o">=</span> <span class="n">coverage</span><span class="o">.</span><span class="n">Coverage</span><span class="p">(</span><span class="n">config_file</span><span class="o">=</span><span class="n">Case</span><span class="o">.</span><span class="n">_getCoverageRcFile</span><span class="p">(</span><span class="n">userCovFile</span><span class="p">),</span> <span class="n">debug</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dataio&quot;</span><span class="p">])</span>
            <span class="n">combinedCoverage</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># combine does delete the files it merges</span>
            <span class="n">combinedCoverage</span><span class="o">.</span><span class="n">combine</span><span class="p">()</span>
            <span class="n">combinedCoverage</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">combinedCoverage</span><span class="o">.</span><span class="n">html_report</span><span class="p">()</span>
            <span class="n">combinedCoverage</span><span class="o">.</span><span class="n">xml_report</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_getCoverageRcFile</span><span class="p">(</span><span class="n">userCovFile</span><span class="p">,</span> <span class="n">makeCopy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to provide the coverage configuration file according to the OS. A user-supplied</span>
<span class="sd">        file will take precedence, and is not checked for a dot-filename.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        ARMI replaced the &quot;.coveragerc&quot; file has been replaced by &quot;pyproject.toml&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        userCovFile : str</span>
<span class="sd">            File path to user-supplied coverage configuration file (default setting is empty string)</span>
<span class="sd">        makeCopy : bool (optional)</span>
<span class="sd">            Whether or not to copy the coverage config file to an alternate file path</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        covFile : str</span>
<span class="sd">            path of pyprojec.toml file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># User-defined file takes precedence.</span>
        <span class="k">if</span> <span class="n">userCovFile</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">userCovFile</span><span class="p">)</span>

        <span class="n">covRcDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">PROJECT_ROOT</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">covRcDir</span><span class="p">,</span> <span class="s2">&quot;pyproject.toml&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_startProfiling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to the Case.run(): start the Python profiling, if the Settings file says to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cProfile.Profile</span>
<span class="sd">            Standard Python profiling object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">profiler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;profile&quot;</span><span class="p">]:</span>
            <span class="n">profiler</span> <span class="o">=</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">()</span>
            <span class="n">profiler</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">subcalls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">builtins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">profiler</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_endProfiling</span><span class="p">(</span><span class="n">profiler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper to the Case.run(): stop and report python profiling,</span>
<span class="sd">        if the Settings file says to.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        profiler: cProfile.Profile (optional)</span>
<span class="sd">            Hopefully, a valid and non-empty set of profiling data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">profiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">profiler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
        <span class="n">profiler</span><span class="o">.</span><span class="n">dump_stats</span><span class="p">(</span><span class="s2">&quot;profiler.</span><span class="si">{:0&gt;3}</span><span class="s2">.stats&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span><span class="p">))</span>
        <span class="n">statsStream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="n">profiler</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">statsStream</span><span class="p">)</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s2">&quot;cumulative&quot;</span><span class="p">)</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_SIZE</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_COMM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">allStats</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_COMM</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">statsStream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rank</span><span class="p">,</span> <span class="n">statsString</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">allStats</span><span class="p">):</span>
                    <span class="c1"># using print statements because the logger has been turned off</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:^100}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot; Profiler statistics for RANK=</span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rank</span><span class="p">)))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">statsString</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">statsStream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<div class="viewcode-block" id="Case.initializeOperator">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.initializeOperator">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">initializeOperator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates and returns an Operator.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">DirectoryChanger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">,</span> <span class="n">dumpOnException</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initBurnChain</span><span class="p">()</span>
            <span class="n">o</span> <span class="o">=</span> <span class="n">operators</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">reactors</span><span class="o">.</span><span class="n">factory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">)</span>
            <span class="n">o</span><span class="o">.</span><span class="n">initializeInterfaces</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="c1"># Set this here to make sure the full duration of initialization is properly captured.</span>
            <span class="c1"># Cannot be done in reactors since the above self.bp call implicitly initializes blueprints.</span>
            <span class="n">r</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">timeOfStart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startTime</span>
            <span class="k">return</span> <span class="n">o</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_initBurnChain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the burn chain setting to the nucDir.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This is admittedly an odd place for this but the burn chain info must be applied sometime</span>
<span class="sd">        after user-input has been loaded (for custom burn chains) but not long after (because nucDir</span>
<span class="sd">        is framework-level and expected to be up-to-date by lots of modules).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;initializeBurnChain&quot;</span><span class="p">]:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping burn-chain initialization since `initializeBurnChain` setting is disabled.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;burnChainFileName&quot;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The burn-chain file </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s1">&#39;burnChainFileName&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> does not exist. The &quot;</span>
                <span class="s2">&quot;data cannot be loaded. Fix this path or disable burn-chain initialization using &quot;</span>
                <span class="s2">&quot;the `initializeBurnChain` setting.&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="s2">&quot;burnChainFileName&quot;</span><span class="p">])</span> <span class="k">as</span> <span class="n">burnChainStream</span><span class="p">:</span>
            <span class="n">nuclideBases</span><span class="o">.</span><span class="n">imposeBurnChain</span><span class="p">(</span><span class="n">burnChainStream</span><span class="p">)</span>

<div class="viewcode-block" id="Case.checkInputs">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.checkInputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">checkInputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks ARMI inputs for consistency.</span>

<span class="sd">        .. impl:: Perform validity checks on case inputs.</span>
<span class="sd">            :id: I_ARMI_CASE_CHECK</span>
<span class="sd">            :implements: R_ARMI_CASE_CHECK</span>

<span class="sd">            This method checks the validity of the current settings. It relies on an</span>
<span class="sd">            :py:class:`~armi.settings.settingsValidation.Inspector` object from the</span>
<span class="sd">            :py:class:`~armi.operators.operator.Operator` to generate a list of</span>
<span class="sd">            :py:class:`~armi.settings.settingsValidation.Query` objects that represent potential</span>
<span class="sd">            issues in the settings. After gathering the queries, this method prints a table of query</span>
<span class="sd">            &quot;statements&quot; and &quot;questions&quot; to the console. If running in an interactive mode, the user</span>
<span class="sd">            then has the opportunity to address the questions posed by the queries by either</span>
<span class="sd">            addressing the potential issue or ignoring it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the inputs are all good, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;=========== Settings Validation Checks ===========&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">DirectoryChanger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">,</span> <span class="n">dumpOnException</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">operatorClass</span> <span class="o">=</span> <span class="n">operators</span><span class="o">.</span><span class="n">getOperatorClassFromSettings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">inspector</span> <span class="o">=</span> <span class="n">operatorClass</span><span class="o">.</span><span class="n">inspector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">inspectorIssues</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span> <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">inspector</span><span class="o">.</span><span class="n">queries</span> <span class="k">if</span> <span class="n">query</span><span class="p">]</span>

            <span class="c1"># Write out the settings validation issues that will be prompted for resolution if in an</span>
            <span class="c1"># interactive session or forced to be resolved otherwise.</span>
            <span class="n">queryData</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">query</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">inspectorIssues</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">queryData</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span>
                        <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">statement</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                        <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">query</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">break_long_words</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">queryData</span> <span class="ow">and</span> <span class="n">context</span><span class="o">.</span><span class="n">MPI_RANK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span>
                        <span class="n">queryData</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Number&quot;</span><span class="p">,</span> <span class="s2">&quot;Statement&quot;</span><span class="p">,</span> <span class="s2">&quot;Question&quot;</span><span class="p">],</span>
                        <span class="n">tableFmt</span><span class="o">=</span><span class="s2">&quot;armi&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">CURRENT_MODE</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">INTERACTIVE</span><span class="p">:</span>
                <span class="c1"># if interactive, ask user to deal with settings issues</span>
                <span class="n">inspector</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

            <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">inspectorIssues</span><span class="p">)</span></div>


<div class="viewcode-block" id="Case.clone">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.clone">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">additionalFiles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">modifiedSettings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">writeStyle</span><span class="o">=</span><span class="s2">&quot;short&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clone existing ARMI inputs to current directory with optional settings modifications.</span>

<span class="sd">        Since each case depends on multiple inputs, this is a safer way to move cases around without</span>
<span class="sd">        having to wonder if you copied all the files appropriately.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        additionalFiles : list (optional)</span>
<span class="sd">            additional file paths to copy to cloned case</span>
<span class="sd">        title : str (optional)</span>
<span class="sd">            title of new case</span>
<span class="sd">        modifiedSettings : dict (optional)</span>
<span class="sd">            settings to set/modify before creating the cloned case</span>
<span class="sd">        writeStyle : str (optional)</span>
<span class="sd">            Writing style for which settings get written back to the settings files</span>
<span class="sd">            (short, medium, or full).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If the source and destination are the same</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloneCS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">duplicate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modifiedSettings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cloneCS</span> <span class="o">=</span> <span class="n">cloneCS</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">modifiedSettings</span><span class="p">)</span>

        <span class="n">clone</span> <span class="o">=</span> <span class="n">Case</span><span class="p">(</span><span class="n">cloneCS</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">pathTools</span><span class="o">.</span><span class="n">armiAbsPath</span><span class="p">(</span><span class="n">title</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span>

        <span class="k">if</span> <span class="n">pathTools</span><span class="o">.</span><span class="n">armiAbsPath</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="n">pathTools</span><span class="o">.</span><span class="n">armiAbsPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;The source file and destination file are the same: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">Cannot use armi-clone to &quot;</span>
                <span class="s2">&quot;modify armi settings file.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pathTools</span><span class="o">.</span><span class="n">armiAbsPath</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">newSettings</span> <span class="o">=</span> <span class="n">copyInterfaceInputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">)</span>
        <span class="n">newCs</span> <span class="o">=</span> <span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">newCs</span>

        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;writing settings file </span><span class="si">{</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">writeToYamlFile</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">writeStyle</span><span class="p">,</span> <span class="n">fromFile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;finished writing </span><span class="si">{</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fromPath</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">pathTools</span><span class="o">.</span><span class="n">armiAbsPath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fileName</span><span class="p">:</span>
            <span class="n">pathTools</span><span class="o">.</span><span class="n">copyOrWarn</span><span class="p">(</span>
                <span class="n">CONF_LOADING_FILE</span><span class="p">,</span>
                <span class="n">fromPath</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">,</span> <span class="n">fileName</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;skipping </span><span class="si">{</span><span class="n">CONF_LOADING_FILE</span><span class="si">}</span><span class="s2">, there is no file specified&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># The root for handling YAML includes is relative to the YAML file, not the</span>
            <span class="c1"># settings file</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">)</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">cloneRoot</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">)</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">])</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">for</span> <span class="n">includePath</span><span class="p">,</span> <span class="n">mark</span> <span class="ow">in</span> <span class="n">textProcessors</span><span class="o">.</span><span class="n">findYamlInclusions</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">includePath</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
                    <span class="n">includeSrc</span> <span class="o">=</span> <span class="n">root</span> <span class="o">/</span> <span class="n">includePath</span>
                    <span class="n">includeDest</span> <span class="o">=</span> <span class="n">cloneRoot</span> <span class="o">/</span> <span class="n">includePath</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># don&#39;t bother copying absolute files</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">includeSrc</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">OSError</span><span class="p">(</span><span class="s2">&quot;The input file file `</span><span class="si">{}</span><span class="s2">` referenced at </span><span class="si">{}</span><span class="s2"> does not exist.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">includeSrc</span><span class="p">,</span> <span class="n">mark</span><span class="p">))</span>
                <span class="n">pathTools</span><span class="o">.</span><span class="n">copyOrWarn</span><span class="p">(</span>
                    <span class="s2">&quot;auxiliary input file `</span><span class="si">{}</span><span class="s2">` referenced at </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">includeSrc</span><span class="p">,</span> <span class="n">mark</span><span class="p">),</span>
                    <span class="n">includeSrc</span><span class="p">,</span>
                    <span class="n">includeDest</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">fileName</span> <span class="ow">in</span> <span class="n">additionalFiles</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="n">pathTools</span><span class="o">.</span><span class="n">copyOrWarn</span><span class="p">(</span><span class="s2">&quot;additional file&quot;</span><span class="p">,</span> <span class="n">fromPath</span><span class="p">(</span><span class="n">fileName</span><span class="p">),</span> <span class="n">clone</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">clone</span></div>


<div class="viewcode-block" id="Case.compare">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.compare">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compare</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">that</span><span class="p">,</span>
        <span class="n">exclusion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
        <span class="n">timestepCompare</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare the output databases from two run cases. Return number of differences.</span>

<span class="sd">        This is useful both for in-use testing and engineering analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Comparing the following databases:</span><span class="se">\n</span><span class="s2">REF: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">SRC: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span> <span class="n">that</span><span class="o">.</span><span class="n">dbName</span><span class="p">))</span>
        <span class="n">diffResults</span> <span class="o">=</span> <span class="n">compareDatabases</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
            <span class="n">that</span><span class="o">.</span><span class="n">dbName</span><span class="p">,</span>
            <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="p">,</span>
            <span class="n">exclusions</span><span class="o">=</span><span class="n">exclusion</span><span class="p">,</span>
            <span class="n">timestepCompare</span><span class="o">=</span><span class="n">timestepCompare</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">code</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">diffResults</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">diffResults</span><span class="o">.</span><span class="n">nDiffs</span><span class="p">()</span>

        <span class="n">sameOrDifferent</span> <span class="o">=</span> <span class="s2">&quot;different&quot;</span> <span class="k">if</span> <span class="n">diffResults</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">diffResults</span><span class="o">.</span><span class="n">nDiffs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;the same&quot;</span>
        <span class="n">runLog</span><span class="o">.</span><span class="n">important</span><span class="p">(</span><span class="s2">&quot;Cases are </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sameOrDifferent</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">code</span></div>


<div class="viewcode-block" id="Case.writeInputs">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.Case.writeInputs">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">writeInputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourceDir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">writeStyle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;short&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the inputs to disk.</span>

<span class="sd">        This allows input objects that have been modified in memory (e.g. for a parameter sweep or</span>
<span class="sd">        migration) to be written out as input for a forthcoming case.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sourceDir : str (optional)</span>
<span class="sd">            The path to copy inputs from (if different from the cs.path). Needed</span>
<span class="sd">            in SuiteBuilder cases to find the baseline inputs from plugins (e.g. shuffleLogic)</span>
<span class="sd">        writeStyle : str (optional)</span>
<span class="sd">            Writing style for which settings get written back to the settings files</span>
<span class="sd">            (short, medium, or full).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This will rename the ``loadingFile`` to ``title-blueprints + &#39;.yaml&#39;``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        independentVariables</span>
<span class="sd">            parses/reads the independentVariables setting</span>

<span class="sd">        clone</span>
<span class="sd">            Similar to this but doesn&#39;t let you write out new/modified blueprints objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">ForcedCreationDirectoryChanger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span><span class="p">,</span> <span class="n">dumpOnException</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="c1"># These seemingly no-ops load the bp via properties if they are not yet initialized.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bp</span>

            <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">newSettings</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;-blueprints.yaml&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">independentVariables</span><span class="p">:</span>
                <span class="n">newSettings</span><span class="p">[</span><span class="s2">&quot;independentVariables&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">varName</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">varName</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">independentVariables</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">newSettings</span><span class="p">[</span><span class="n">CONF_LOADING_FILE</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">loadingFile</span><span class="p">:</span>
                <span class="n">blueprints</span><span class="o">.</span><span class="n">Blueprints</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">,</span> <span class="n">loadingFile</span><span class="p">)</span>

            <span class="c1"># copy input files from other modules/plugins</span>
            <span class="n">interfaceSettings</span> <span class="o">=</span> <span class="n">copyInterfaceInputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">sourceDir</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">settingName</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">interfaceSettings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">newSettings</span><span class="p">[</span><span class="n">settingName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">newSettings</span><span class="o">=</span><span class="n">newSettings</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sourceDir</span><span class="p">:</span>
                <span class="n">fromPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sourceDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fromPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">writeToYamlFile</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">.yaml&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">writeStyle</span><span class="p">,</span> <span class="n">fromFile</span><span class="o">=</span><span class="n">fromPath</span><span class="p">)</span></div>
</div>



<span class="k">def</span><span class="w"> </span><span class="nf">_copyInputsHelper</span><span class="p">(</span><span class="n">fileDescription</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">destPath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">origFile</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for copyInterfaceInputs: Creates an absolute file path, and copies the file to</span>
<span class="sd">    that location. If that file path does not exist, returns the file path from the original</span>
<span class="sd">    settings file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fileDescription : str</span>
<span class="sd">        A file description for the copyOrWarn method</span>
<span class="sd">    sourcePath : str</span>
<span class="sd">        The absolute file path of the file to copy</span>
<span class="sd">    destPath : str</span>
<span class="sd">        The target directory to copy input files to</span>
<span class="sd">    origFile : str</span>
<span class="sd">        File path as defined in the original settings file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    destFilePath (or origFile) : str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sourceName</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sourcePath</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    <span class="n">destFilePath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destPath</span><span class="p">,</span> <span class="n">sourceName</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">pathTools</span><span class="o">.</span><span class="n">copyOrWarn</span><span class="p">(</span><span class="n">fileDescription</span><span class="p">,</span> <span class="n">sourcePath</span><span class="p">,</span> <span class="n">destFilePath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">destFilePath</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="c1"># the basename gets written back to the settings file to protect against potential</span>
            <span class="c1"># future dir structure changes</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">destFilePath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># keep original filepath in the settings file if file copy was unsuccessful</span>
            <span class="k">return</span> <span class="n">origFile</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">origFile</span>


<div class="viewcode-block" id="copyInterfaceInputs">
<a class="viewcode-back" href="../../../.apidocs/armi.cases.case.html#armi.cases.case.copyInterfaceInputs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">copyInterfaceInputs</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sourceDir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ping active interfaces to determine which files are considered &quot;input&quot;. This enables developers</span>
<span class="sd">    to add new inputs in a plugin-dependent/ modular way.</span>

<span class="sd">    This function should now be able to handle the updating of:</span>

<span class="sd">      - a single file (relative or absolute)</span>
<span class="sd">      - a list of files (relative or absolute)</span>
<span class="sd">      - a file entry that has a wildcard processing into multiple files. Glob is used to offer</span>
<span class="sd">        support for wildcards.</span>
<span class="sd">      - a directory and its contents</span>

<span class="sd">    If the file paths are absolute, do nothing. The case will be able to find the file.</span>

<span class="sd">    In case suites or parameter sweeps, these files often have a sourceDir associated with them that</span>
<span class="sd">    is different from the cs.inputDirectory. So, if relative or wildcard, update the file paths to</span>
<span class="sd">    be absolute in the case settings and copy the file to the destination directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cs : Settings</span>
<span class="sd">        The source case settings to find input files</span>
<span class="sd">    destination : str</span>
<span class="sd">        The target directory to copy input files to</span>
<span class="sd">    sourceDir : str, optional</span>
<span class="sd">        The directory from which to copy files. Defaults to cs.inputDirectory</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A new settings object that contains settings for the keys and values that are either an</span>
<span class="sd">        absolute file path, a list of absolute file paths, or the original file path if absolute</span>
<span class="sd">        paths could not be resolved.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Regarding the handling of relative file paths: In the future this could be simplified by adding</span>
<span class="sd">    a concept for a suite root directory, below which it is safe to copy files without needing to</span>
<span class="sd">    update settings that point with a relative path to files that are below it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">activeInterfaces</span> <span class="o">=</span> <span class="n">interfaces</span><span class="o">.</span><span class="n">getActiveInterfaceInfo</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
    <span class="n">sourceDir</span> <span class="o">=</span> <span class="n">sourceDir</span> <span class="ow">or</span> <span class="n">cs</span><span class="o">.</span><span class="n">inputDirectory</span>
    <span class="n">sourceDirPath</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">sourceDir</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>

    <span class="n">newSettings</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">klass</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">activeInterfaces</span><span class="p">:</span>
        <span class="n">interfaceFileNames</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">specifyInputs</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">interfaceFileNames</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">settings</span><span class="o">.</span><span class="n">Setting</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">cs</span><span class="o">.</span><span class="n">getSetting</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">isSetting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="n">NonexistentSetting</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                    <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is not a valid setting; continuing on anyway.&quot;</span><span class="p">)</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">isSetting</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">isSetting</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span>

            <span class="n">newFiles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">WILDCARD</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">EMPTY</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">ABSOLUTE</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">WILDCARD</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># beware: pathlib.path(&quot;&quot;) returns &quot;.&quot; which can be bad news, so we handle empty</span>
                    <span class="c1"># strings as their own category</span>
                    <span class="n">EMPTY</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">EMPTY</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
                    <span class="n">ABSOLUTE</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="c1"># Attempt to construct an absolute file path</span>
                <span class="n">srcFullPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sourceDirPath</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                <span class="n">destFilePath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">WILDCARD</span><span class="p">:</span>
                    <span class="n">globFilePaths</span> <span class="o">=</span> <span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sourceDirPath</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">srcFullPath</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">globFilePaths</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">destFilePath</span> <span class="o">=</span> <span class="n">f</span>
                        <span class="n">newFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">destFilePath</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">gFile</span> <span class="ow">in</span> <span class="n">globFilePaths</span><span class="p">:</span>
                            <span class="n">destFilePath</span> <span class="o">=</span> <span class="n">_copyInputsHelper</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">gFile</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                            <span class="n">newFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">destFilePath</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">EMPTY</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">ABSOLUTE</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="c1"># Path is absolute, no settings modification or filecopy needed</span>
                        <span class="n">newFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># treat as a relative path</span>
                    <span class="n">destFilePath</span> <span class="o">=</span> <span class="n">_copyInputsHelper</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">srcFullPath</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="n">newFiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">destFilePath</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">destFilePath</span> <span class="o">==</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">runLog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;No input files for `</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">` could be resolved with the following path: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">srcFullPath</span><span class="si">}</span><span class="s2">`. Will not update `</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">`.&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># Some settings are a single filename. Others are lists of files. Make</span>
            <span class="c1"># sure we are returning what the setting expects</span>
            <span class="k">if</span> <span class="n">isSetting</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">newFiles</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">WILDCARD</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cs</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">newSettings</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">newFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newSettings</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">newFiles</span>

    <span class="k">return</span> <span class="n">newSettings</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2026, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2026-01-05.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>