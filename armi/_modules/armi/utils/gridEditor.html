

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.utils.gridEditor &mdash; ARMI 0.5.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme_fixes.css?v=2b77b304" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=61a4c737" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=e5fbc548" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-data-viewer/jsonview.bundle.css?v=f6ef2277" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/libs/html/datatables.min.css?v=4b4fd840" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_links.css?v=2150a916" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_toggle.css?v=5c6620df" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_style.css?v=678fb11e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/needstable.css?v=5e1b6797" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/common_css/need_core.css?v=f5b60a78" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-needs/modern.css?v=803738c0" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-test-results/common.css?v=9ec2c1d5" />

  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=b9afe91b"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script src="../../../_static/sphinx-data-viewer/jsonview.bundle.js?v=18cd53c5"></script>
      <script src="../../../_static/sphinx-data-viewer/jsonview_loader.js?v=f7ff7e7d"></script>
      <script src="../../../_static/sphinx-needs/libs/html/datatables.min.js?v=8a4aee21"></script>
      <script src="../../../_static/sphinx-needs/libs/html/datatables_loader.js?v=a2cae175"></script>
      <script src="../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js?v=dca66431"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../qa_docs/index.html">QA Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../utils.html">armi.utils</a></li>
      <li class="breadcrumb-item active">armi.utils.gridEditor</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.utils.gridEditor</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2019 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GUI elements for manipulating grid layout and contents.</span>

<span class="sd">This provides a handful of classes which provide wxPython Controls for manipulating grids and grid</span>
<span class="sd">Blueprints.</span>

<span class="sd">The grid editor may be invoked with the :py:mod:`armi.cli.gridGui` entry point::</span>

<span class="sd">    $ python -m armi grids</span>

<span class="sd">If you have an existing set of input files, pass in the blueprints input file as the first argument</span>
<span class="sd">and the system will load up the associated grid, e.g.::</span>

<span class="sd">    $ python -m armi grids FFTF-blueprints.yaml</span>


<span class="sd">.. figure:: /.static/gridEditor.png</span>
<span class="sd">    :align: center</span>

<span class="sd">    An example of the Grid Editor being used on a FFTF input file</span>

<span class="sd">**Known Issues**</span>

<span class="sd">* There is no action stack or undo functionality. Save frequently if you want to recover previous</span>
<span class="sd">  states</span>

<span class="sd">* Cartesian grids are supported, but not rendered as nicely as their Hex counterparts. The &quot;through</span>
<span class="sd">  center assembly&quot; case is not rendered properly with the half-assemblies that lie along the edges.</span>

<span class="sd">* The controls are optimized for manipulating a Core layout, displaying an &quot;Assembly palette&quot; that</span>
<span class="sd">  contains the Assembly designs found in the top-level blueprints. A little extra work and this</span>
<span class="sd">  could also be made to manipulate block grids or other things.</span>

<span class="sd">* Assembly colors are derived from the set of flags applied to them, but the mapping of colors to</span>
<span class="sd">  flags is not particularly rich, and there isn&#39;t anything to disambiguate between assemblies of</span>
<span class="sd">  different design, but the same flags.</span>

<span class="sd">* No proper zoom support, and object sizes are fixed and don&#39;t accommodate long specifiers.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">colorsys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy.linalg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">wx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">wx.adv</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor</span><span class="w"> </span><span class="kn">import</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">grids</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.blueprints</span><span class="w"> </span><span class="kn">import</span> <span class="n">Blueprints</span><span class="p">,</span> <span class="n">gridBlueprint</span><span class="p">,</span> <span class="n">migrate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.blueprints.assemblyBlueprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssemblyBlueprint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.blueprints.gridBlueprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridBlueprint</span><span class="p">,</span> <span class="n">saveToStream</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.reactor.flags</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flags</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.settings.caseSettings</span><span class="w"> </span><span class="kn">import</span> <span class="n">Settings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">armi.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">hexagon</span><span class="p">,</span> <span class="n">textProcessors</span>

<span class="n">UNIT_SIZE</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># pixels per assembly</span>
<span class="n">UNIT_MARGIN</span> <span class="o">=</span> <span class="mi">40</span>  <span class="c1"># offset applied to the draw area margins</span>

<span class="c1"># The color to use for each object is based on the flags that that object has. All applicable colors</span>
<span class="c1"># will be blended together to produce the final color for the object. There are also plans to apply</span>
<span class="c1"># brush styles like cross-hatching or the like, which is what the Nones are for below. Future work</span>
<span class="c1"># to employ these. Colors are RGB fractions.</span>
<span class="n">FLAG_STYLES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Red</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">FUEL</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># Green</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">CONTROL</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># Gray</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">SHIELD</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># Yellow</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">REFLECTOR</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># Paisley?</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">INNER</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># We shouldn&#39;t see many SECONDARY, OUTER, MIDDLE, etc. on their own, so these</span>
    <span class="c1"># will just darken or brighten whatever color we would otherwise get)</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">SECONDARY</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">OUTER</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="c1"># WHITE (same as above, this will just lighten anything that it accompanies)</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">MIDDLE</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">ANNULAR</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">IGNITER</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">STARTER</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">FEED</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">Flags</span><span class="o">.</span><span class="n">DRIVER</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]),</span> <span class="kc">None</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># RGB weights for calculating luminance. We use this to decide whether we should put white or black</span>
<span class="c1"># text on top of the color. These come from CCIR 601</span>
<span class="n">LUMINANCE_WEIGHTS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_translationMatrix</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return an affine transformation matrix representing an x- and y-translation.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_boundingBox</span><span class="p">(</span><span class="n">points</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">wx</span><span class="o">.</span><span class="n">Rect</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the smallest wx.Rect that contains all of the passed points.&quot;&quot;&quot;</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>

    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ymin</span><span class="p">)),</span> <span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ymax</span><span class="p">)))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_desaturate</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">hue</span><span class="p">,</span> <span class="n">lig</span><span class="p">,</span> <span class="n">sat</span> <span class="o">=</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">rgb_to_hls</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">lig</span> <span class="o">=</span> <span class="n">lig</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lig</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colorsys</span><span class="o">.</span><span class="n">hls_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">lig</span><span class="p">,</span> <span class="n">sat</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_getColorAndBrushFromFlags</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a set of Flags, return a wx.Pen and wx.Brush with which to draw a shape.&quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="n">nColors</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">styleFlag</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">FLAG_STYLES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">styleFlag</span> <span class="o">&amp;</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">color</span><span class="p">,</span> <span class="n">brush</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">+=</span> <span class="n">color</span>
            <span class="n">nColors</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">nColors</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">/=</span> <span class="n">nColors</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">bold</span><span class="p">:</span>
        <span class="c1"># round-trip the rgb color through hsv so that we can desaturate</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">_desaturate</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="n">luminance</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">LUMINANCE_WEIGHTS</span><span class="p">)</span>
    <span class="n">dark</span> <span class="o">=</span> <span class="n">luminance</span> <span class="o">&lt;</span> <span class="mf">0.5</span>

    <span class="n">c</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">ci</span><span class="p">)</span> <span class="k">for</span> <span class="n">ci</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>

    <span class="n">brush</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">pen</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span> <span class="k">if</span> <span class="n">dark</span> <span class="k">else</span> <span class="n">wx</span><span class="o">.</span><span class="n">BLACK</span>

    <span class="k">return</span> <span class="n">pen</span><span class="p">,</span> <span class="n">brush</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_drawShape</span><span class="p">(</span>
    <span class="n">dc</span><span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">DC</span><span class="p">,</span>
    <span class="n">geom</span><span class="p">:</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="p">,</span>
    <span class="n">view</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">bold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw a shape to the passed DC, given its GeomType and other relevant information. Return the</span>
<span class="sd">    bounding box.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dc: wx.DC</span>
<span class="sd">        The device context to draw to</span>
<span class="sd">    geom: geometry.GeomType</span>
<span class="sd">        The geometry type, which defines the shape to be drawn</span>
<span class="sd">    view: np.ndarray</span>
<span class="sd">        A 3x3 matrix defining the world transform</span>
<span class="sd">    model: np.ndarray, optional</span>
<span class="sd">        A 3x3 matrix defining the model transform. No transform is made to the &quot;unit&quot;</span>
<span class="sd">        shape if no model transform is provided.</span>
<span class="sd">    label: str, optional</span>
<span class="sd">        A string label to draw on the shape</span>
<span class="sd">    description: str, optional</span>
<span class="sd">        A string containing metadata for determining how to style to shape</span>
<span class="sd">    bold: bool, optional</span>
<span class="sd">        Whether the object should be drawn with full saturation. Default ``True``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">255</span><span class="p">)))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BLACK</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">aFlags</span> <span class="o">=</span> <span class="n">Flags</span><span class="o">.</span><span class="n">fromStringIgnoreErrors</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
        <span class="n">color</span><span class="p">,</span> <span class="n">brush</span> <span class="o">=</span> <span class="n">_getColorAndBrushFromFlags</span><span class="p">(</span><span class="n">aFlags</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="n">bold</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
        <span class="n">primitive</span> <span class="o">=</span> <span class="n">hexagon</span><span class="o">.</span><span class="n">corners</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">:</span>
        <span class="n">primitive</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Geom type `</span><span class="si">{}</span><span class="s2">` unsupported&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">geom</span><span class="p">))</span>

    <span class="c1"># Appending 1 to each coordinate since the transformation matrix is 3x3</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">primitive</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">vertex</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">poly</span><span class="p">]</span>

    <span class="n">boundingBox</span> <span class="o">=</span> <span class="n">_boundingBox</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

    <span class="n">dc</span><span class="o">.</span><span class="n">SetTextForeground</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">dc</span><span class="o">.</span><span class="n">DrawPolygon</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">dc</span><span class="o">.</span><span class="n">DrawLabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">boundingBox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">boundingBox</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_GridControls</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collection of controls for the main Grid editor. Save/Open, num rings, etc.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ringControl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringControl</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="s2">&quot;Select how many rings of the grid to display&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringApply</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Apply&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringApply</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Apply the number of rings to the current grid. &quot;</span>
            <span class="s2">&quot;Assemblies outside of the displayed region will not be removed.&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expandButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Expand to full core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[</span>
                <span class="n">mode</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span> <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span>
            <span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="s2">&quot;Select what to display in each grid region.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saveButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Save grid blueprints...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveButton</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="s2">&quot;Save just the grids section to its own file. &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Open blueprints...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openButton</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Open a new top-level blueprints file. Top-level is &quot;</span>
            <span class="s2">&quot;needed to populate the assembly palette on the right.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;New grid blueprints...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newButton</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="s2">&quot;Create a new Grid blueptint.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Help&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveImgButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Save image...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveImgButton</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="s2">&quot;Save the grid layout to an image file.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onChangeRings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ringApply</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onExpand</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">expandButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSave</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onOpen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">openButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onNew</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onHelp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSaveImage</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveImgButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onLabelMode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="n">HelpDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">ringBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">ringLabel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Num. Rings&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE_HORIZONTAL</span>
        <span class="p">)</span>
        <span class="n">ringBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ringLabel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">ringBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringControl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">ringBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringApply</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ringBox</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">auxButtons</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">auxButtons</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expandButton</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">auxButtons</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">auxButtons</span><span class="p">)</span>

        <span class="n">fileBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">fileBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveButton</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">fileBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openButton</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">fileBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newButton</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">fileBox</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">helpButton</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveImgButton</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizerAndFit</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numRings</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ringControl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">numRings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onChangeRings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ringControl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onLabelMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
        <span class="n">newMode</span> <span class="o">=</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelMode</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span><span class="n">newMode</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onExpand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">expandToFullCore</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onSaveImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">saveImage</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onNew</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_PathControl</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collection of controls for manipulating fuel shuffling paths.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">viewer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>

        <span class="c1"># Direct link to the main viz control. This avoids having to reach up and back down for an</span>
        <span class="c1"># instance, with all of the structural assumptions that that requires.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_needsIncrement</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fuel Path&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Remove From Path&quot;</span><span class="p">)</span>
        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="n">pathSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">indexSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pathSpinner</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoIncrement</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Increment&quot;</span><span class="p">)</span>

        <span class="n">pathSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Path: &quot;</span><span class="p">))</span>
        <span class="n">pathSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathSpinner</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">indexSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Index: &quot;</span><span class="p">))</span>
        <span class="n">indexSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">buttonSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">buttonSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span><span class="p">)</span>
        <span class="n">buttonSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span><span class="p">)</span>
        <span class="n">buttonSizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">buttonSizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">pathSizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">indexSizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoIncrement</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOGGLEBUTTON</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">onToggle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOGGLEBUTTON</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">onToggle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAutoIncrement</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoIncrement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onPathChange</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathSpinner</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizerAndFit</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onPathChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span><span class="o">.</span><span class="n">drawGrid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span><span class="o">.</span><span class="n">drawArrows</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onAutoIncrement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoIncrement</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getActivateButtons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span><span class="o">.</span><span class="n">GetId</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span><span class="o">.</span><span class="n">GetId</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getIndices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clearButton</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> <span class="ow">and</span> <span class="n">clear</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathSpinner</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_needsIncrement</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_needsIncrement</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indexSpinner</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">maybeIncrement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_needsIncrement</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoIncrement</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">activateButton</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_AssemblyPalette</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collection of toggle controls for each defined AssemblyBlueprint, as well as some extra controls</span>
<span class="sd">    for configuring fuel shuffling paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">parent</span><span class="p">,</span>
        <span class="n">geomType</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="p">],</span>
        <span class="n">assemDesigns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">viewer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="n">geomType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemDesigns</span> <span class="o">=</span> <span class="n">assemDesigns</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetScrollRate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># None -&gt; None is useful for propagating a None to other components without</span>
        <span class="c1"># special branching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AssemblyBlueprint</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="kc">None</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Assemblies:&quot;</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># keyed on ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buttonIdBySpecifier</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">design</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemDesigns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># flip y-coordinates, enlarge, offset</span>
            <span class="n">flip_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="n">UNIT_SIZE</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">UNIT_SIZE</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">translate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">UNIT_SIZE</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">UNIT_SIZE</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">flip_y</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>

            <span class="n">bmap</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">UNIT_SIZE</span><span class="p">,</span> <span class="n">UNIT_SIZE</span><span class="p">)</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MemoryDC</span><span class="p">()</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">bmap</span><span class="p">)</span>
            <span class="n">brush</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetBackgroundColour</span><span class="p">())</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>

            <span class="n">_drawShape</span><span class="p">(</span>
                <span class="n">dc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">,</span>
                <span class="n">transform</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">design</span><span class="o">.</span><span class="n">specifier</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">design</span><span class="o">.</span><span class="n">flags</span> <span class="ow">or</span> <span class="n">key</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NullBitmap</span><span class="p">)</span>

            <span class="n">img</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBitmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bitmap</span><span class="o">=</span><span class="n">bmap</span><span class="p">)</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToggleButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span><span class="p">[</span><span class="n">button</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonIdBySpecifier</span><span class="p">[</span><span class="n">design</span><span class="o">.</span><span class="n">specifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOGGLEBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onToggle</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>

            <span class="n">buttonSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">buttonSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">buttonSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="n">buttonSizer</span><span class="o">.</span><span class="n">AddSpacer</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

            <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">buttonSizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">[</span><span class="n">button</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">design</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Equilibrium Fuel Path:&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span> <span class="o">=</span> <span class="n">_PathControl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getActivateButtons</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizerAndFit</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setActiveAssemID</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure the appropriate button is on, but none others.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="o">!=</span> <span class="nb">id</span><span class="p">:</span>
            <span class="c1"># there is currently an active assem, and it isn&#39;t the requested one. Turn</span>
            <span class="c1"># its button off.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># we are activating an assem ID. Turn its button on</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">onToggle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Respond to toggle events.</span>

<span class="sd">        This makes sure that the right selector button is activated, and switches the</span>
<span class="sd">        GUI mode into the proper one based on whether an assembly design is selected, or</span>
<span class="sd">        the fuel path controls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemButtons</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># The button that generated the event is &quot;on&quot; (the ToggleButton assumes its new value</span>
            <span class="c1"># before the event is propagated). We need to select whichever button it was.</span>
            <span class="n">setTo</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># The button that generated the event is off, implying that the user clicked on the</span>
            <span class="c1"># previously-selected button. Clear the active selection</span>
            <span class="n">setTo</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setActiveAssemID</span><span class="p">(</span><span class="n">setTo</span><span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getActivateButtons</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">setTo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setMode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">editorClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">maybeIncrement</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getSelectedAssem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AssemblyBlueprint</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the currently-selected assembly design or fuel path indices.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">:</span>
            <span class="c1"># We have an assembly design activated. return it</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getActivateButtons</span><span class="p">():</span>
            <span class="c1"># we are in path selection mode, return stuff from the pathControl</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getIndices</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">getAssemToSet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AssemblyBlueprint</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the assembly design of fuel path tuple that a client should set.</span>

<span class="sd">        This differs from ``getSelectedAssem`` in that it can incorporate more logic to enforce</span>
<span class="sd">        certain rules, such as performing increments, masking things off based on other state etc.,</span>
<span class="sd">        whereas ``getSelectedAssem`` should be more dumb and just return the state of the controls</span>
<span class="sd">        themselves.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">:</span>
            <span class="c1"># We have an assembly design activated. return it</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemDesignsById</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeAssemID</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getActivateButtons</span><span class="p">():</span>
            <span class="c1"># we are in path selection mode, return stuff from the pathControl</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">getIndices</span><span class="p">(</span><span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setActiveAssem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assemDesign</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AssemblyBlueprint</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override the selected assembly design from above.&quot;&quot;&quot;</span>
        <span class="n">specifier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assemDesign</span><span class="p">,</span> <span class="n">AssemblyBlueprint</span><span class="p">):</span>
            <span class="n">specifier</span> <span class="o">=</span> <span class="n">assemDesign</span><span class="o">.</span><span class="n">specifier</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setActiveAssemID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buttonIdBySpecifier</span><span class="p">[</span><span class="n">specifier</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assemDesign</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setActiveAssemID</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pathControl</span><span class="o">.</span><span class="n">activateButton</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">assemDesign</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setActiveAssemID</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>


<div class="viewcode-block" id="GridGui">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GridGui</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visual editor for grid blueprints.</span>

<span class="sd">    This is the actual viewer that displays the grid and grid blueprints contents, and responds to</span>
<span class="sd">    mouse events. Under the hood, it uses a wx.PseudoDC to handle the drawing, which provides the</span>
<span class="sd">    following benefits over a regular DC:</span>

<span class="sd">     * Drawn objects can be associated with an ID, allowing parts of the drawing to be modified or</span>
<span class="sd">       cleared without having to re-draw everything.</span>
<span class="sd">     * The IDs associated with the objects can be used to distinguish what was clicked on in a mouse</span>
<span class="sd">       event (though the support for this isn&#39;t super great, so we do have to do some of our own</span>
<span class="sd">       object disambiguation).</span>

<span class="sd">    The ``drawGrid()`` method is used to re-draw the entire geometry, whereas the ``applyAssem()``</span>
<span class="sd">    method may be used to update a single assembly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GridGui.Mode">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.Mode">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">Mode</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enumeration for what type of objects are currently being manipulated.</span>

<span class="sd">        This can either be SPECIFIER, for laying out the initial core layout, or PATH for</span>
<span class="sd">        manipulating fuel shuffling paths.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We use these values to map between selections in GUI elements, so do not go changing them</span>
        <span class="c1"># willy-nilly.</span>
        <span class="n">SPECIFIER</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">POSITION_IJ</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">POSITION_RINGPOS</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">PATH</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="nd">@property</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SPECIFIER</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Specifier&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PATH</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;Shuffle Path&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">POSITION_IJ</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;(i, j)&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;(Ring, Position)&quot;</span>

        <span class="nd">@property</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">isPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">POSITION_IJ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">POSITION_RINGPOS</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">bp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaultGeom</span><span class="o">=</span><span class="n">geometry</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new GridGui.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parent : wx.Window</span>
<span class="sd">            The parent control</span>

<span class="sd">        bp : set of grid blueprints, optional</span>
<span class="sd">            This should be the ``gridDesigns`` section of a root Blueprints object. If</span>
<span class="sd">            not provided, a dictionary will be created with an empty &quot;core&quot; grid blueprint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BORDER_DEFAULT</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bp</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;core&quot;</span><span class="p">:</span> <span class="n">GridBlueprint</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">,</span> <span class="n">gridContents</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">geom</span><span class="o">=</span><span class="n">defaultGeom</span>
                <span class="p">)</span>
            <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bp</span> <span class="o">=</span> <span class="n">bp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span> <span class="o">=</span> <span class="n">bp</span><span class="p">[</span><span class="s2">&quot;core&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span> <span class="o">=</span> <span class="n">bp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;coreEqPath&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span> <span class="o">=</span> <span class="mi">7</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geomType</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># What are we displaying/modifying</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span>

        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">construct</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">gridContents</span><span class="p">:</span>
            <span class="n">maxRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">idx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">maxRings</span><span class="p">)</span>

        <span class="c1"># Need to assign this after setting numRings, since we need a grid to</span>
        <span class="c1"># determine numRings, but need numRings to properly set the self.grid</span>
        <span class="c1"># property.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>

        <span class="c1"># If we are in the middle of handling some click events, what are the indices of</span>
        <span class="c1"># the clicked-on region</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_PAINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onPaint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MOUSE_EVENTS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onMouse</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuIDs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NewIdRef</span><span class="p">(),</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Select assembly type&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSelectAssembly</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Make ring like this&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onFillRing</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Clear ring&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onClearRing</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">text</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuIDs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">adv</span><span class="o">.</span><span class="n">PseudoDC</span><span class="p">()</span>

        <span class="c1"># Might be a good idea to implement this with bidict, but maybe not worth the</span>
        <span class="c1"># dependency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indicesToPdcId</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># map from a PeudoDC ID (e.g. a hex) to the pixel location of the shapes</span>
        <span class="c1"># center. This is used to distinguish between a multi-object hit on click</span>
        <span class="c1"># events. While the FindObjects docs purport to distinguish objects</span>
        <span class="c1"># pixel-by-pixel, it seems like this is a lie, and that they simply use the</span>
        <span class="c1"># bounding boxes provided by the drawer. Laaaaame.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToCenter</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># The ID to use for all arrow drawing. lets us clear and re-draw easily</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arrowPdcId</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewIdRef</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawGrid</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span>

    <span class="nd">@grid</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newGrid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span> <span class="o">=</span> <span class="n">newGrid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geomType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">geomType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idxByRing</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numRings</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ring</span><span class="p">,</span> <span class="n">_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grid</span><span class="o">.</span><span class="n">locatorInDomain</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">symmetryOverlap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span>
            <span class="p">):</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idxByRing</span><span class="p">[</span><span class="n">ring</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>

    <span class="nd">@mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newMode</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">newMode</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">newMode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drawGrid</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawArrows</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">activeBlueprints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">isPosition</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported mode `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>

<div class="viewcode-block" id="GridGui.growToFullCore">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.growToFullCore">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">growToFullCore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">geometry</span><span class="o">.</span><span class="n">FULL_CORE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">symmetry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">expandToFull</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span><span class="o">.</span><span class="n">expandToFull</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">construct</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drawGrid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getWindowCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetViewStart</span><span class="p">()</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetScrollPixelsPerUnit</span><span class="p">()</span>
        <span class="n">xOffset</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">xv</span>
        <span class="n">yOffset</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">yv</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">xScrolled</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">xOffset</span>
        <span class="n">yScrolled</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">yOffset</span>

        <span class="k">return</span> <span class="n">xScrolled</span><span class="p">,</span> <span class="n">yScrolled</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getIndicesFromEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getObjectFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span><span class="p">[</span><span class="n">obj</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_getObjectFromEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_distanceish</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">p2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getWindowCoordinates</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">FindObjects</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">objs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">objs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># list of tuples with (distance, ID)</span>
        <span class="n">sortableObjectIds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">_distanceish</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">RealPoint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToCenter</span><span class="p">[</span><span class="n">obj</span><span class="p">]),</span> <span class="n">obj</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">objs</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">sortableObjectIds</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="GridGui.drawGrid">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.drawGrid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wipe out anything in the drawing and re-draw everything.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">RemoveAll</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indicesToPdcId</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToCenter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="s2">&quot;BLACK&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="n">gridScale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gridScale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>

        <span class="c1"># flip y-coordinates, enlarge</span>
        <span class="n">flip_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">UNIT_SIZE</span> <span class="o">/</span> <span class="n">gridScale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">UNIT_SIZE</span> <span class="o">/</span> <span class="n">gridScale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># uniform grid, so all shapes have the same scale</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">gridScale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">gridScale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">flip_y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calcGridBounds</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetVirtualSize</span><span class="p">((</span><span class="n">rect</span><span class="o">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">Height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetScrollRate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="c1"># Global translation used to center the view</span>
        <span class="n">translate</span> <span class="o">=</span> <span class="n">_translationMatrix</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">rect</span><span class="o">.</span><span class="n">Left</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">rect</span><span class="o">.</span><span class="n">Top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">translate</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

        <span class="n">brush</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">brush</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ring</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">locatorInDomain</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ring</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="nb">id</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewIdRef</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indicesToPdcId</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

            <span class="n">label</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">bold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabel</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">idx</span><span class="p">))[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">_translationMatrix</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">)</span>

            <span class="n">boundingBox</span> <span class="o">=</span> <span class="n">_drawShape</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_geomType</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">offset</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="p">),</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
                <span class="n">bold</span><span class="o">=</span><span class="n">bold</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">TopLeft</span> <span class="o">+</span> <span class="n">boundingBox</span><span class="o">.</span><span class="n">BottomRight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToCenter</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">center</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetIdBounds</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">boundingBox</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridGui.drawArrows">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.drawArrows">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">drawArrows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw fuel path arrows.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">ClearId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrowPdcId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_arrowPdcId</span><span class="p">)</span>

        <span class="n">goodPen</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">PENSTYLE_DOT</span><span class="p">)</span>
        <span class="n">badPen</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">thisPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getSelectedPath</span><span class="p">()</span>

        <span class="n">stuffInPath</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">thisPath</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">touchedIndices</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">stuffInPath</span><span class="p">}</span>
        <span class="n">indexGraph</span> <span class="o">=</span> <span class="p">{</span><span class="n">index</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">touchedIndices</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">stuffInPath</span><span class="p">:</span>
            <span class="n">indexGraph</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>

        <span class="c1"># python 3.6+ should maintain key order from the sorted stuffInPath</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">indexGraph</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="n">goodPen</span>
            <span class="k">if</span> <span class="n">i2</span> <span class="o">-</span> <span class="n">i1</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">badPen</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexGraph</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">indexGraph</span><span class="p">[</span><span class="n">i2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">badPen</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">fromIdx</span> <span class="ow">in</span> <span class="n">indexGraph</span><span class="p">[</span><span class="n">i1</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">toIdx</span> <span class="ow">in</span> <span class="n">indexGraph</span><span class="p">[</span><span class="n">i2</span><span class="p">]:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">fromIdx</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">toIdx</span> <span class="o">+</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>

                    <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

                    <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p1</span><span class="p">]</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">p2</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">DrawLines</span><span class="p">([</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">p1</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">p2</span><span class="p">)])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_getLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given (i, j, k) indices, return information about the object at that location.</span>

<span class="sd">        This will return a tuple containing:</span>
<span class="sd">         - The label to actually display in the GUI</span>
<span class="sd">         - Optionally, a description that can be turned into Flags and used to determine</span>
<span class="sd">           what the object should look like</span>
<span class="sd">         - Whether the object should be drawn in its full/bold representation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ring</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">specifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">aDesign</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">bold</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">specifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">aDesign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAssemDesignBySpecifier</span><span class="p">(</span><span class="n">specifier</span><span class="p">)</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">aDesign</span><span class="o">.</span><span class="n">flags</span> <span class="ow">or</span> <span class="n">aDesign</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">aDesign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">specifier</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span><span class="p">:</span>
            <span class="n">selectedPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getSelectedPath</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># We need to add a grid blueprint for the equilibrium fuel path</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">[</span><span class="s2">&quot;coreEqPath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GridBlueprint</span><span class="p">(</span><span class="s2">&quot;coreEqPath&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">[</span><span class="s2">&quot;coreEqPath&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span><span class="o">.</span><span class="n">gridContents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span><span class="o">.</span><span class="n">construct</span><span class="p">()</span>

            <span class="n">path</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eqFuelPathBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="n">selectedPath</span><span class="p">:</span>
                <span class="n">bold</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">POSITION_RINGPOS</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">POSITION_IJ</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported mode `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">label</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">bold</span>

<div class="viewcode-block" id="GridGui.setNumRings">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.setNumRings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the number of rings that should be drawn.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="o">.</span><span class="n">fromPitch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">numRings</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geomType</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">:</span>
            <span class="n">rectangle</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">latticeDimensions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rectangle</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">latticeDimensions</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">latticeDimensions</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="o">.</span><span class="n">fromRectangle</span><span class="p">(</span><span class="o">*</span><span class="n">rectangle</span><span class="p">,</span> <span class="n">numRings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">numRings</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Only support Hex and Cartesian grids, not </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geomType</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">grid</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">symmetry</span>
        <span class="n">grid</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">geomType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawGrid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridGui.onPaint">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onPaint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onPaint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">selfPaint</span> <span class="o">=</span> <span class="n">dc</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="n">dc</span> <span class="ow">or</span> <span class="n">wx</span><span class="o">.</span><span class="n">BufferedPaintDC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetBackground</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)))</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DoPrepareDC</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">selfPaint</span><span class="p">:</span>
            <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetViewStart</span><span class="p">()</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetScrollPixelsPerUnit</span><span class="p">()</span>
            <span class="n">region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetUpdateRegion</span><span class="p">()</span>
            <span class="n">region</span><span class="o">.</span><span class="n">Offset</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">xv</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">yv</span><span class="p">)</span>

            <span class="n">_</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">GetBox</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">DrawToDC</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridGui.onMouse">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onMouse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onMouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">RightUp</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onContextMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">LeftDown</span><span class="p">():</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>

            <span class="n">objId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getObjectFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">objId</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

            <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span><span class="p">[</span><span class="n">objId</span><span class="p">])[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">objectClicked</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">assem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAssemToSet</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applyAssem</span><span class="p">(</span><span class="n">objId</span><span class="p">,</span> <span class="n">assem</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">LeftUp</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridGui.onContextMenu">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onContextMenu">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getIndicesFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopupMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="GridGui.onSelectAssembly">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onSelectAssembly">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onSelectAssembly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">specifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">aDesign</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAssemDesignBySpecifier</span><span class="p">(</span><span class="n">specifier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">specifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">setActiveAssem</span><span class="p">(</span><span class="n">aDesign</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridGui.onFillRing">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onFillRing">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onFillRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">ring</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span><span class="p">)</span>
        <span class="n">specifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coreBp</span><span class="o">.</span><span class="n">gridContents</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">aDesign</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">getAssemDesignBySpecifier</span><span class="p">(</span><span class="n">specifier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">specifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxByRing</span><span class="p">[</span><span class="n">ring</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applyAssem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indicesToPdcId</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">aDesign</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridGui.onClearRing">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.onClearRing">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onClearRing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">ring</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickIndices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idxByRing</span><span class="p">[</span><span class="n">ring</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applyAssem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indicesToPdcId</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridGui.applyAssem">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridGui.applyAssem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">applyAssem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">pdcId</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">AssemblyBlueprint</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the passed assembly design or equilibrium path indices for the desired</span>
<span class="sd">        object and redraw it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeBlueprints</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># uniform grid, so all shapes have the same scale</span>
        <span class="n">gridScale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gridScale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">gridScale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">gridScale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
        <span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdcIdToIndices</span><span class="p">[</span><span class="n">pdcId</span><span class="p">])</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">AssemblyBlueprint</span><span class="p">):</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">{</span>
                    <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span><span class="p">,</span>
                    <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">POSITION_IJ</span><span class="p">,</span>
                    <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">POSITION_RINGPOS</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activeBlueprints</span><span class="o">.</span><span class="n">gridContents</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">specifier</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activeBlueprints</span><span class="o">.</span><span class="n">gridContents</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Clear whatever we clicked on</span>
            <span class="k">if</span> <span class="n">idx2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeBlueprints</span><span class="o">.</span><span class="n">gridContents</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">activeBlueprints</span><span class="o">.</span><span class="n">gridContents</span><span class="p">[</span><span class="n">idx2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">ClearId</span><span class="p">(</span><span class="n">pdcId</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetId</span><span class="p">(</span><span class="n">pdcId</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">_translationMatrix</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="n">label</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">bold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getLabel</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="n">boundingBox</span> <span class="o">=</span> <span class="n">_drawShape</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_geomType</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
            <span class="n">bold</span><span class="o">=</span><span class="n">bold</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdc</span><span class="o">.</span><span class="n">SetIdBounds</span><span class="p">(</span><span class="n">pdcId</span><span class="p">,</span> <span class="n">boundingBox</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">drawArrows</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_gridScale</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">HexGrid</span><span class="p">):</span>
            <span class="c1"># Unit steps aren&#39;t aligned with the x,y coordinate system for Hex, so just</span>
            <span class="c1"># use the y dimension, assuming that&#39;s the proper flat-to-flat dimension</span>
            <span class="n">coordScale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitSteps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">grids</span><span class="o">.</span><span class="n">CartesianGrid</span><span class="p">):</span>
            <span class="c1"># Cartesian grids align with the GUI coordinates, so just use unit steps</span>
            <span class="c1"># directly</span>
            <span class="n">coordScale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid</span><span class="o">.</span><span class="n">_unitSteps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">grid</span><span class="o">.</span><span class="n">_unitSteps</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">coordScale</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calcGridBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">wx</span><span class="o">.</span><span class="n">Rect</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the width and height (in pixels) that are needed to display the passed grid.</span>

<span class="sd">        This allows us to dynamically size the scrolled area, and to offset the geometry</span>
<span class="sd">        properly into the center of the screen.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">inDomain</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">idx</span><span class="p">:</span> <span class="n">loc</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">locatorInDomain</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getRingPos</span><span class="p">(</span><span class="n">loc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numRings</span>
        <span class="p">}</span>

        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gridScale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>

        <span class="n">allCenters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">getCoordinates</span><span class="p">(</span><span class="n">idx</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">inDomain</span><span class="p">])</span>
        <span class="n">minXY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">allCenters</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">maxXY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">allCenters</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">topRight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">maxXY</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">maxXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">bottomLeft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">minXY</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">minXY</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">nudge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">UNIT_MARGIN</span><span class="p">,</span> <span class="o">-</span><span class="n">UNIT_MARGIN</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

        <span class="n">bottomRight</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">topRight</span><span class="p">)</span> <span class="o">+</span> <span class="n">nudge</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">topLeft</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bottomLeft</span><span class="p">)</span> <span class="o">-</span> <span class="n">nudge</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">bottomRight</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bottomRight</span><span class="p">]</span>
        <span class="n">topLeft</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">topLeft</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">Rect</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">topLeft</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="o">*</span><span class="n">bottomRight</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span></div>



<div class="viewcode-block" id="GridBlueprintControl">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GridBlueprintControl</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GUI for manipulating core layouts.</span>

<span class="sd">    The original intent of this is to serve as a stand-in replacement for the current</span>
<span class="sd">    &quot;HexDragger&quot;. With further work, this could be made to function as a more general</span>
<span class="sd">    tool for manipulating grids of any sort.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_wildcard</span> <span class="o">=</span> <span class="s2">&quot;YAML blueprints (*.yaml)|*.yaml|All files (*.*)|*.*&quot;</span>

    <span class="n">_defaultGeom</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">CARTESIAN</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

        <span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprints</span><span class="p">()</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span> <span class="o">=</span> <span class="n">gridBlueprint</span><span class="o">.</span><span class="n">Grids</span><span class="p">()</span>

        <span class="c1"># cs only needed for migrations. Realistically, this would be set from a</span>
        <span class="c1"># higher-level GUI container. If it is not set and migrations are needed</span>
        <span class="c1"># anyways, the user will be prompted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="o">=</span> <span class="n">bp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span> <span class="o">=</span> <span class="n">GridGui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaultGeom</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_defaultGeom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span> <span class="o">=</span> <span class="n">_AssemblyPalette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="n">_GridControls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">numRings</span><span class="p">)</span>

        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="n">hsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">hsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">hsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">hsizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span> <span class="o">=</span> <span class="n">sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizerAndFit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span>

    <span class="nd">@bp</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">bp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bp</span> <span class="o">=</span> <span class="n">bp</span>

        <span class="n">geomType</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">fromStr</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span><span class="p">[</span><span class="s2">&quot;core&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">geom</span><span class="p">)</span>

        <span class="c1"># Make new assembly palette and editor</span>
        <span class="n">newClicker</span> <span class="o">=</span> <span class="n">GridGui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span><span class="p">)</span>
        <span class="n">newPalette</span> <span class="o">=</span> <span class="n">_AssemblyPalette</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geomType</span><span class="p">,</span> <span class="n">bp</span><span class="o">.</span><span class="n">assemDesigns</span><span class="p">,</span> <span class="n">newClicker</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="p">,</span> <span class="n">newPalette</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="o">.</span><span class="n">Replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="p">,</span> <span class="n">newClicker</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span> <span class="o">=</span> <span class="n">newPalette</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span> <span class="o">=</span> <span class="n">newClicker</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">numRings</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SendSizeEventToParent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">grid</span>

<div class="viewcode-block" id="GridBlueprintControl.setNumRings">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.setNumRings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setNumRings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">setNumRings</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.setActiveAssem">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.setActiveAssem">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setActiveAssem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aDesign</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">setActiveAssem</span><span class="p">(</span><span class="n">aDesign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">SPECIFIER</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aDesign</span><span class="p">,</span> <span class="p">(</span><span class="n">AssemblyBlueprint</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
            <span class="k">else</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">PATH</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.setMode">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.setMode">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>

        <span class="c1"># make sure that gui elements that have to do with mode setting are consistent</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">GridGui</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">isPosition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">setActiveAssem</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">labelMode</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.expandToFullCore">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.expandToFullCore">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">expandToFullCore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">growToFullCore</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridBlueprintControl.objectClicked">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.objectClicked">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">objectClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Notify relevant controls that the object at the passed indices has been</span>
<span class="sd">        activated.</span>

<span class="sd">        This is needed to make the auto-increment stuff work in the fuel path editor.</span>
<span class="sd">        Without some sort of event that provides a positive assertion that the user is</span>
<span class="sd">        trying to interact with the layout, we can&#39;t know when to increment.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">editorClicked</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridBlueprintControl.saveImage">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.saveImage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">saveImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the core layout to an image.</span>

<span class="sd">        Currently this only supports PNG images for simplicity. wxpython does not</span>
<span class="sd">        attempt to infer the file type based on extension, so we would need to make a</span>
<span class="sd">        file extension-to-format mapping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Save image to...&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="p">,</span>
            <span class="n">wildcard</span><span class="o">=</span><span class="s2">&quot;PNG images (.png)|*.png&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">GetVirtualSize</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="n">dc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MemoryDC</span><span class="p">()</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clicker</span><span class="o">.</span><span class="n">onPaint</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">dc</span><span class="o">=</span><span class="n">dc</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NullBitmap</span><span class="p">)</span>
        <span class="n">image</span><span class="o">.</span><span class="n">SaveFile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_PNG</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.save">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.save">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the blueprints to the passed stream, if provided. Otherwise prompt for a</span>
<span class="sd">        file to save to.</span>

<span class="sd">        This can save either the entire blueprints, or just the `grids:` section of the</span>
<span class="sd">        blueprints, based on the passed ``full`` argument. Saving just the grid</span>
<span class="sd">        blueprints can be useful when cobbling blueprints together with !include flags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">stream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_saveNoStream</span><span class="p">(</span><span class="n">full</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">saveToStream</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">tryMap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_saveNoStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prompt for a file to save to.</span>

<span class="sd">        This can save either the entire blueprints, or just the `grids:` section of the</span>
<span class="sd">        blueprints, based on the passed ``full`` argument. Saving just the grid</span>
<span class="sd">        blueprints can be useful when cobbling blueprints together with !include flags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prompt the user for a file name, open it, and call ourself again with that</span>
        <span class="c1"># as the stream argument</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Don&#39;t use the blueprints filename as the default if we are only saving the</span>
        <span class="c1"># grids section; doing so may encourage users to overwrite their main</span>
        <span class="c1"># blueprints file.</span>
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="n">fName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fName</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Save blueprints to...&quot;</span> <span class="k">if</span> <span class="n">full</span> <span class="k">else</span> <span class="s2">&quot;Save grid designs to...&quot;</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span>
            <span class="n">defaultFile</span><span class="o">=</span><span class="n">fName</span><span class="p">,</span>
            <span class="n">wildcard</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wildcard</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Disallow overwriting the main blueprints with the grids section</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">full</span>
            <span class="ow">and</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
            <span class="ow">and</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">samefile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fName</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;The chosen path, `</span><span class="si">{}</span><span class="s2">` is the same as the main blueprints &quot;</span>
                <span class="s1">&#39;file. This tool only saves the &quot;grids&quot; section of the &#39;</span>
                <span class="s2">&quot;blueprints file, so saving over the original top-level blueprints &quot;</span>
                <span class="s2">&quot;will lead to data loss. Try again with a different name.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">with</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">message</span><span class="p">,</span>
                <span class="s2">&quot;Overwriting top-level blueprints!&quot;</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ICON_WARNING</span><span class="p">,</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">dlg</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="c1"># Try writing to an internal buffer before opening the file for write. This</span>
        <span class="c1"># way to don&#39;t destroy anything unless we know we have something with which</span>
        <span class="c1"># to replace it.</span>
        <span class="n">bpStream</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">saveToStream</span><span class="p">(</span><span class="n">bpStream</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="p">,</span> <span class="n">full</span><span class="p">,</span> <span class="n">tryMap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bpStream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>

<div class="viewcode-block" id="GridBlueprintControl.open">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.open">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Open blueprints file...&quot;</span><span class="p">,</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span>
            <span class="n">defaultFile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">wildcard</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_wildcard</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_FILE_MUST_EXIST</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.new">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.new">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a Dialog with options to make a new grid blueprint, then make it and</span>
<span class="sd">        rejigger everything to use it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">NewGridBlueprintDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">dlg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="c1"># Make new bp</span>
                <span class="n">gridBp</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getGridBlueprint</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span><span class="p">[</span><span class="n">gridBp</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">gridBp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span></div>


<div class="viewcode-block" id="GridBlueprintControl.loadFile">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.loadFile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">loadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fName</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a new blueprints file, refreshing pretty much everything.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="o">=</span> <span class="n">fName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="o">=</span> <span class="n">cs</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bpYaml</span><span class="p">:</span>
            <span class="n">bpYaml</span> <span class="o">=</span> <span class="n">textProcessors</span><span class="o">.</span><span class="n">resolveMarkupInclusions</span><span class="p">(</span>
                <span class="n">bpYaml</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
            <span class="p">)</span>
            <span class="n">bp</span> <span class="o">=</span> <span class="n">Blueprints</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">bpYaml</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s2">&quot;core&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bp</span><span class="o">.</span><span class="n">gridDesigns</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cs</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_promptForCs</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># We didn&#39;t get a CS from the user, so cannot migrate old</span>
                    <span class="c1"># blueprints. Give up.</span>
                    <span class="k">return</span>

                <span class="n">migrate</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bp</span> <span class="o">=</span> <span class="n">bp</span></div>


<div class="viewcode-block" id="GridBlueprintControl.getAssemDesignBySpecifier">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.getAssemDesignBySpecifier">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getAssemDesignBySpecifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specifier</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">_key</span><span class="p">,</span> <span class="n">design</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bp</span><span class="o">.</span><span class="n">assemDesigns</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">design</span><span class="o">.</span><span class="n">specifier</span> <span class="o">==</span> <span class="n">specifier</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">design</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="s2">&quot;Could not find an Assembly design with specifier `</span><span class="si">{}</span><span class="s2">`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">specifier</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="GridBlueprintControl.getAssemToSet">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.getAssemToSet">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getAssemToSet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">getAssemToSet</span><span class="p">()</span></div>


<div class="viewcode-block" id="GridBlueprintControl.getSelectedPath">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.GridBlueprintControl.getSelectedPath">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getSelectedPath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the fuel path index that is currently selected.</span>

<span class="sd">        This is used to route the state of the _AssemblyPalette controls to things that</span>
<span class="sd">        need to know about such things (arrow drawing, whether objects should be bold,</span>
<span class="sd">        etc.)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">assem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assemblyPalette</span><span class="o">.</span><span class="n">getSelectedAssem</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">assem</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">assem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_promptForCs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Settings</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ask the user for a case settings file to locate the appropriate geom file to</span>
<span class="sd">        perform blueprint migrations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fName</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Migrations needed. Please provide a settings file...&quot;</span><span class="p">,</span>
            <span class="n">defaultDir</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span>
            <span class="n">defaultFile</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">FD_FILE_MUST_EXIST</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Settings</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="HelpDialog">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.HelpDialog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HelpDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;About the grid editor...&quot;</span><span class="p">)</span>

        <span class="n">helpTxt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">The Grid Editor is a rudimentary tool for manipulating the contents and basic structure</span>
<span class="s2">of Grid Blueprints. Rather than being a full-featured reactor editor GUI, it intends to</span>
<span class="s2">help in the specific task of laying objects out in a grid, which can be frustrating or</span>
<span class="s2">tedious to do by hand in a text editor.</span>

<span class="s2">Since this is not a general-purpose blueprint editor, this will only save the &quot;grids&quot;</span>
<span class="s2">section of a blueprints file, which will then need to be incorporated into a top-level</span>
<span class="s2">blueprints input, typically by !include-ing from the host blueprints.</span>

<span class="s2">When opening a blueprints file, the root blueprints should be provided, since the Editor</span>
<span class="s2">uses the assembly designs to populate the assembly palette on the right.</span>

<span class="s2">Controls</span>
<span class="s2">--------</span>
<span class="s2">Left-click in map: Apply the selected assembly design to the clicked location. If no</span>
<span class="s2">assembly is selected, clear the assembly design in the licked location.</span>

<span class="s2">Right-click in map: Summon context menu with useful tools.</span>

<span class="s2">&quot;Num. Rings&quot; spinner: Modify the number of rings that the displayed grid should span.</span>
<span class="s2">Reducing the number of rings below the region with defined assemblies *will not* clear</span>
<span class="s2">those regions.</span>

<span class="s2">&quot;Expand to full core&quot;: Expand a 1/N-th reactor map into full symmetry. This will honor</span>
<span class="s2">the periodic/reflective boundary conditions as specified.</span>

<span class="s2">Label display drop-down: Select what should be displayed at each grid location.</span>

<span class="s2">Save grid blueprints: Save just the grid blueprints to a file. This will need to be</span>
<span class="s2">incorporated into a top-level blueprints file. To prevent loss of data, it will try to</span>
<span class="s2">prevent overwriting the original blueprints file that was opened.</span>

<span class="s2">Open blueprints: Open a new top-level blueprints file.</span>

<span class="s2">New grid blueprints: Create a new grid blueprint, allowing configuration of the geometry</span>
<span class="s2">type, domain, and boundary conditions.</span>

<span class="s2">&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">helpTxt</span><span class="p">)</span>
        <span class="n">ok</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span></div>



<div class="viewcode-block" id="NewGridBlueprintDialog">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.NewGridBlueprintDialog">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">NewGridBlueprintDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dialog box for configuring a new grid blueprint.&quot;&quot;&quot;</span>

    <span class="c1"># these provide stable mappings from the wx.Choice control indices to the respective geom types</span>
    <span class="n">_geomFromIdx</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">i</span><span class="p">:</span> <span class="n">geomType</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">geomType</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
            <span class="p">{</span><span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">,</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>
    <span class="n">_idxFromGeom</span> <span class="o">=</span> <span class="p">{</span><span class="n">geomType</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">geomType</span> <span class="ow">in</span> <span class="n">_geomFromIdx</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;New Grid Blueprint...&quot;</span><span class="p">)</span>

        <span class="n">nameLabel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Grid name:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridName</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;core&quot;</span><span class="p">)</span>
        <span class="n">nameSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">nameSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">nameLabel</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">nameSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gridName</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="n">gt</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">gt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geomFromIdx</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSelectGeomType</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">)</span>

        <span class="c1"># Domain controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throughCenter</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Through Center Assembly&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Full Core&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">RB_GROUP</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1/3 Core&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1/4 Core&quot;</span><span class="p">)</span>

        <span class="n">domainBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Domain&quot;</span><span class="p">)</span>
        <span class="n">domainBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">domainBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">domainBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">domainBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">throughCenter</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onDomainChange</span><span class="p">)</span>

        <span class="c1"># Symmetry controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">RB_GROUP</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Full&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Periodic&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflective</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Reflective&quot;</span><span class="p">)</span>

        <span class="n">symmetryBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Symmetry&quot;</span><span class="p">)</span>
        <span class="n">symmetryBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">symmetryBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">symmetryBox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reflective</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># arrange the two boxes horizontally</span>
        <span class="n">gridControls</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">gridControls</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">domainBox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">gridControls</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">symmetryBox</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">ok</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>
        <span class="n">cancel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">nameSizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">gridControls</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="n">okCancelSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">okCancelSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ok</span><span class="p">)</span>
        <span class="n">okCancelSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cancel</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">okCancelSizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">selectGeomType</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

<div class="viewcode-block" id="NewGridBlueprintDialog.selectGeomType">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.NewGridBlueprintDialog.selectGeomType">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">selectGeomType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">geom</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable/disable relevant controls for the selected geom type.&quot;&quot;&quot;</span>
        <span class="c1"># make sure the geom type Choice is in sync. This function doesn&#39;t have to be</span>
        <span class="c1"># called from the event handler.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_idxFromGeom</span><span class="p">[</span><span class="n">geom</span><span class="p">])</span>
        <span class="c1"># switch to full-core, since it&#39;s always available</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toggleControls</span><span class="p">()</span></div>


<div class="viewcode-block" id="NewGridBlueprintDialog.onSelectGeomType">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.NewGridBlueprintDialog.onSelectGeomType">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onSelectGeomType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectGeomType</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_geomFromIdx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_toggleControls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure that the appropriate controls are enabled/disabled.&quot;&quot;&quot;</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geomFromIdx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()]</span>
        <span class="n">full</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">throughCenter</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="n">full</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain3</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">HEX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">domain4</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="ow">not</span> <span class="n">full</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflective</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="ow">not</span> <span class="n">full</span> <span class="ow">and</span> <span class="n">geom</span> <span class="o">==</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GeomType</span><span class="o">.</span><span class="n">CARTESIAN</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">full</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="NewGridBlueprintDialog.onDomainChange">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.NewGridBlueprintDialog.onDomainChange">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">onDomainChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">EventObject</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain4</span><span class="p">}:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">symmetryFull</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toggleControls</span><span class="p">()</span></div>


<div class="viewcode-block" id="NewGridBlueprintDialog.getGridBlueprint">
<a class="viewcode-back" href="../../../.apidocs/armi.utils.gridEditor.html#armi.utils.gridEditor.NewGridBlueprintDialog.getGridBlueprint">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">getGridBlueprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Using the state of the dialog controls, return a corresponding GridBlueprint.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gridName</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geomFromIdx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">geomType</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">domainFull</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">FULL_CORE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain3</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">THIRD_CORE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain4</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">DomainType</span><span class="o">.</span><span class="n">QUARTER_CORE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t map selection to supported fractional domain&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">PERIODIC</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflective</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">REFLECTIVE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bc</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">BoundaryType</span><span class="o">.</span><span class="n">NO_SYMMETRY</span>

        <span class="n">symmetry</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">SymmetryType</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">throughCenter</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="k">assert</span> <span class="n">symmetry</span><span class="o">.</span><span class="n">checkValidSymmetry</span><span class="p">()</span>

        <span class="n">bp</span> <span class="o">=</span> <span class="n">GridBlueprint</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">geom</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="n">symmetry</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">symmetry</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bp</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">()</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Grid Blueprints GUI&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="n">gui</span> <span class="o">=</span> <span class="n">GridBlueprintControl</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">loadFile</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2025, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2025-05-21.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>