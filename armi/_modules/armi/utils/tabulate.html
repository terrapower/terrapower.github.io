<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>armi.utils.tabulate &mdash; ARMI 0.4.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme_fixes.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ARMI
              <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #233C5B" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../armi.html">armi</a></li>
          <li class="breadcrumb-item"><a href="../utils.html">armi.utils</a></li>
      <li class="breadcrumb-item active">armi.utils.tabulate</li>
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for armi.utils.tabulate</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2024 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sa">r</span><span class="sd">&quot;&quot;&quot;Pretty-print tabular data.</span>

<span class="sd">This file started out as the MIT-licensed &quot;tabulate&quot;. Though we have made, and will continue to</span>
<span class="sd">make, many arbitrary changes as we need. Thanks to the tabulate team.</span>

<span class="sd">https://github.com/astanin/python-tabulate</span>

<span class="sd">Usage</span>
<span class="sd">-----</span>
<span class="sd">The module provides just one function, `tabulate`, which takes a list of lists or other tabular data</span>
<span class="sd">type as the first argument, and outputs anicely-formatted plain-text table::</span>

<span class="sd">    &gt;&gt;&gt; from armi.utils.tabulate import tabulate</span>

<span class="sd">    &gt;&gt;&gt; table = [[&quot;Sun&quot;,696000,1989100000],[&quot;Earth&quot;,6371,5973.6],</span>
<span class="sd">    ...          [&quot;Moon&quot;,1737,73.5],[&quot;Mars&quot;,3390,641.85]]</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate(table))</span>
<span class="sd">    -----  ------  -------------</span>
<span class="sd">    Sun    696000     1.9891e+09</span>
<span class="sd">    Earth    6371  5973.6</span>
<span class="sd">    Moon     1737    73.5</span>
<span class="sd">    Mars     3390   641.85</span>
<span class="sd">    -----  ------  -------------</span>

<span class="sd">The following tabular data types are supported:</span>

<span class="sd">- list of lists or another iterable of iterables</span>
<span class="sd">- list or another iterable of dicts (keys as columns)</span>
<span class="sd">- dict of iterables (keys as columns)</span>
<span class="sd">- list of dataclasses (field names as columns)</span>
<span class="sd">- two-dimensional NumPy array</span>
<span class="sd">- NumPy record arrays (names as columns)</span>

<span class="sd">Table headers</span>
<span class="sd">-------------</span>
<span class="sd">To print nice column headers, supply the second argument (`headers`):</span>

<span class="sd">  - `headers` can be an explicit list of column headers</span>
<span class="sd">  - if `headers=&quot;firstrow&quot;`, then the first row of data is used</span>
<span class="sd">  - if `headers=&quot;keys&quot;`, then dictionary keys or column indices are used</span>

<span class="sd">Otherwise a headerless table is produced.</span>

<span class="sd">If the number of headers is less than the number of columns, they are supposed to be names of</span>
<span class="sd">the last columns. This is consistent with the plain-text format of R::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;sex&quot;,&quot;age&quot;],[&quot;Alice&quot;,&quot;F&quot;,24],[&quot;Bob&quot;,&quot;M&quot;,19]],</span>
<span class="sd">    ...       headers=&quot;firstrow&quot;))</span>
<span class="sd">           sex      age</span>
<span class="sd">    -----  -----  -----</span>
<span class="sd">    Alice  F         24</span>
<span class="sd">    Bob    M         19</span>

<span class="sd">Column and Headers alignment</span>
<span class="sd">----------------------------</span>
<span class="sd">`tabulate` tries to detect column types automatically, and aligns the values properly. By</span>
<span class="sd">default it aligns decimal points of the numbers (or flushes integer numbers to the right), and</span>
<span class="sd">flushes everything else to the left. Possible column alignments (`numAlign`, `strAlign`) are:</span>
<span class="sd">&quot;right&quot;, &quot;center&quot;, &quot;left&quot;, &quot;decimal&quot; (only for `numAlign`), and None (to disable alignment).</span>

<span class="sd">`colGlobalAlign` allows for global alignment of columns, before any specific override from</span>
<span class="sd">    `colAlign`. Possible values are: None (defaults according to coltype), &quot;right&quot;, &quot;center&quot;,</span>
<span class="sd">    &quot;decimal&quot;, &quot;left&quot;.</span>
<span class="sd">`colAlign` allows for column-wise override starting from left-most column. Possible values are:</span>
<span class="sd">    &quot;global&quot; (no override), &quot;right&quot;, &quot;center&quot;, &quot;decimal&quot;, &quot;left&quot;.</span>
<span class="sd">`headersGlobalAlign` allows for global headers alignment, before any specific override from</span>
<span class="sd">    `headersAlign`. Possible values are: None (follow columns alignment), &quot;right&quot;, &quot;center&quot;,</span>
<span class="sd">    &quot;left&quot;.</span>
<span class="sd">`headersAlign` allows for header-wise override starting from left-most given header. Possible</span>
<span class="sd">    values are: &quot;global&quot; (no override), &quot;same&quot; (follow column alignment), &quot;right&quot;, &quot;center&quot;,</span>
<span class="sd">    &quot;left&quot;.</span>

<span class="sd">Note on intended behaviour: If there is no `data`, any column alignment argument is ignored. Hence,</span>
<span class="sd">in this case, header alignment cannot be inferred from column alignment.</span>

<span class="sd">Table formats</span>
<span class="sd">-------------</span>
<span class="sd">`intFmt` is a format specification used for columns which contain numeric data without a decimal</span>
<span class="sd">point. This can also be a list or tuple of format strings, one per column.</span>

<span class="sd">`floatFmt` is a format specification used for columns which contain numeric data with a decimal</span>
<span class="sd">point. This can also be a list or tuple of format strings, one per column.</span>

<span class="sd">`None` values are replaced with a `missingVal` string (like `floatFmt`, this can also be a list</span>
<span class="sd">of values for different columns)::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 1, None],</span>
<span class="sd">    ...                 [&quot;eggs&quot;, 42, 3.14],</span>
<span class="sd">    ...                 [&quot;other&quot;, None, 2.7]], missingVal=&quot;?&quot;))</span>
<span class="sd">    -----  --  ----</span>
<span class="sd">    spam    1  ?</span>
<span class="sd">    eggs   42  3.14</span>
<span class="sd">    other   ?  2.7</span>
<span class="sd">    -----  --  ----</span>

<span class="sd">Various plain-text table formats (`tableFmt`) are supported: &#39;plain&#39;, &#39;simple&#39;, &#39;grid&#39;, &#39;rst&#39;, and</span>
<span class="sd">`tsv`. Variable `tabulateFormats` contains the list of currently supported formats.</span>

<span class="sd">&quot;plain&quot; format doesn&#39;t use any pseudographics to draw tables, it separates columns with a double</span>
<span class="sd">space::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                 [&quot;strings&quot;, &quot;numbers&quot;], &quot;plain&quot;))</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tableFmt=&quot;plain&quot;))</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>

<span class="sd">&quot;simple&quot; format is like Pandoc simple_tables::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                 [&quot;strings&quot;, &quot;numbers&quot;], &quot;simple&quot;))</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    ---------  ---------</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tableFmt=&quot;simple&quot;))</span>
<span class="sd">    ----  --------</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>
<span class="sd">    ----  --------</span>

<span class="sd">&quot;grid&quot; is similar to tables produced by Emacs table.el package or Pandoc grid_tables::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;grid&quot;))</span>
<span class="sd">    +-----------+-----------+</span>
<span class="sd">    | strings   |   numbers |</span>
<span class="sd">    +===========+===========+</span>
<span class="sd">    | spam      |   41.9999 |</span>
<span class="sd">    +-----------+-----------+</span>
<span class="sd">    | eggs      |  451      |</span>
<span class="sd">    +-----------+-----------+</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tableFmt=&quot;grid&quot;))</span>
<span class="sd">    +------+----------+</span>
<span class="sd">    | spam |  41.9999 |</span>
<span class="sd">    +------+----------+</span>
<span class="sd">    | eggs | 451      |</span>
<span class="sd">    +------+----------+</span>

<span class="sd">&quot;rst&quot; is like a simple table format from reStructuredText; please note that reStructuredText</span>
<span class="sd">accepts also &quot;grid&quot; tables::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;rst&quot;))</span>
<span class="sd">    =========  =========</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    =========  =========</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>
<span class="sd">    =========  =========</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tableFmt=&quot;rst&quot;))</span>
<span class="sd">    ====  ========</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>
<span class="sd">    ====  ========</span>

<span class="sd">Number parsing</span>
<span class="sd">--------------</span>
<span class="sd">By default, anything which can be parsed as a number is a number. This ensures numbers represented</span>
<span class="sd">as strings are aligned properly. This can lead to weird results for particular strings such as</span>
<span class="sd">specific git SHAs e.g. &quot;42992e1&quot; will be parsed into the number 429920 and aligned as such.</span>

<span class="sd">To completely disable number parsing (and alignment), use `disableNumParse=True`. For more fine</span>
<span class="sd">grained control, a list column indices is used to disable number parsing only on those columns e.g.</span>
<span class="sd">`disableNumParse=[0, 2]` would disable number parsing only on the first and third columns.</span>

<span class="sd">Column Widths and Auto Line Wrapping</span>
<span class="sd">------------------------------------</span>
<span class="sd">Tabulate will, by default, set the width of each column to the length of the longest element in that</span>
<span class="sd">column. However, in situations where fields are expected to reasonably be too long to look good as a</span>
<span class="sd">single line, tabulate can help automate word wrapping long fields for you. Use the parameter</span>
<span class="sd">`maxcolwidth` to provide a list of maximal column widths::</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate( \</span>
<span class="sd">          [(&#39;1&#39;, &#39;John Smith&#39;, \</span>
<span class="sd">            &#39;This is a rather long description that might look better if it is wrapped a bit&#39;)], \</span>
<span class="sd">          headers=(&quot;Issue Id&quot;, &quot;Author&quot;, &quot;Description&quot;), \</span>
<span class="sd">          maxColWidths=[None, None, 30], \</span>
<span class="sd">          tableFmt=&quot;grid&quot;  \</span>
<span class="sd">        ))</span>
<span class="sd">    +------------+------------+-------------------------------+</span>
<span class="sd">    |   Issue Id | Author     | Description                   |</span>
<span class="sd">    +============+============+===============================+</span>
<span class="sd">    |          1 | John Smith | This is a rather long         |</span>
<span class="sd">    |            |            | description that might look   |</span>
<span class="sd">    |            |            | better if it is wrapped a bit |</span>
<span class="sd">    +------------+------------+-------------------------------+</span>

<span class="sd">Header column width can be specified in a similar way using `maxheadercolwidth`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sized</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">zip_longest</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">TextWrapper</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tabulate&quot;</span><span class="p">,</span> <span class="s2">&quot;tabulateFormats&quot;</span><span class="p">]</span>


<span class="c1"># minimum extra space in headers</span>
<span class="n">MIN_PADDING</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Whether or not to preserve leading/trailing whitespace in data.</span>
<span class="n">PRESERVE_WHITESPACE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">_DEFAULT_FLOAT_FMT</span> <span class="o">=</span> <span class="s2">&quot;g&quot;</span>
<span class="n">_DEFAULT_INT_FMT</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">_DEFAULT_MISSING_VAL</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="c1"># default align will be overwritten by &quot;left&quot;, &quot;center&quot; or &quot;decimal&quot; depending on the formatter</span>
<span class="n">_DEFAULT_ALIGN</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>

<span class="c1"># Constant that can be used as part of passed rows to generate a separating line. It is purposely an</span>
<span class="c1"># unprintable character, very unlikely to be used in a table</span>
<span class="n">SEPARATING_LINE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\001</span><span class="s2">&quot;</span>

<span class="n">Line</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;hline&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>
<span class="n">DataRow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;DataRow&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>

<span class="c1"># A table structure is supposed to be:</span>
<span class="c1">#</span>
<span class="c1">#     --- lineabove ---------</span>
<span class="c1">#         headerrow</span>
<span class="c1">#     --- linebelowheader ---</span>
<span class="c1">#         datarow</span>
<span class="c1">#     --- linebetweenrows ---</span>
<span class="c1">#     ... (more datarows) ...</span>
<span class="c1">#     --- linebetweenrows ---</span>
<span class="c1">#         last datarow</span>
<span class="c1">#     --- linebelow ---------</span>
<span class="c1">#</span>
<span class="c1"># TableFormat&#39;s line* elements can be</span>
<span class="c1">#</span>
<span class="c1">#   - either None, if the element is not used,</span>
<span class="c1">#   - or a Line tuple,</span>
<span class="c1">#   - or a function: [col_widths], [col_alignments] -&gt; string.</span>
<span class="c1">#</span>
<span class="c1"># TableFormat&#39;s *row elements can be</span>
<span class="c1">#</span>
<span class="c1">#   - either None, if the element is not used,</span>
<span class="c1">#   - or a DataRow tuple,</span>
<span class="c1">#   - or a function: [cell_values], [col_widths], [col_alignments] -&gt; string.</span>
<span class="c1">#</span>
<span class="c1"># padding (an integer) is the amount of white space around data values.</span>
<span class="c1">#</span>
<span class="c1"># withHeaderHide:</span>
<span class="c1">#</span>
<span class="c1">#   - either None, to display all table elements unconditionally,</span>
<span class="c1">#   - or a list of elements not to be displayed if the table has column headers.</span>
<span class="c1">#</span>
<span class="n">TableFormat</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TableFormat&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;lineabove&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebelowheader&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebetweenrows&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebelow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;headerrow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;datarow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;padding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;withHeaderHide&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_isSeparatingLine</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">rowType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">isSl</span> <span class="o">=</span> <span class="p">(</span><span class="n">rowType</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">rowType</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">isSl</span>


<span class="k">def</span> <span class="nf">_rstEscapeFirstColumn</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">escapeEmpty</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;..&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span>

    <span class="n">newHeaders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">newRows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">newHeaders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">escapeEmpty</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">newRow</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">newRow</span><span class="p">:</span>
            <span class="n">newRow</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">escapeEmpty</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">newRows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newRow</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newRows</span><span class="p">,</span> <span class="n">newHeaders</span>


<span class="n">_tableFormats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;armi&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;simple&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">,</span> <span class="s2">&quot;linebelow&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;github&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;psql&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;rst&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;tsv&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">withHeaderHide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">}</span>


<span class="n">tabulateFormats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_tableFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="c1"># The table formats for which multiline cells will be folded into subsequent table rows. The key is</span>
<span class="c1"># the original format, the value is the format that will be used to represent it.</span>
<span class="n">multilineFormats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;armi&quot;</span><span class="p">:</span> <span class="s2">&quot;armi&quot;</span><span class="p">,</span>
    <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="s2">&quot;plain&quot;</span><span class="p">,</span>
    <span class="s2">&quot;simple&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="s2">&quot;pretty&quot;</span><span class="p">,</span>
    <span class="s2">&quot;psql&quot;</span><span class="p">:</span> <span class="s2">&quot;psql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rst&quot;</span><span class="p">:</span> <span class="s2">&quot;rst&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">_multilineCodes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\r|\n|\r\n&quot;</span><span class="p">)</span>
<span class="n">_multilineCodesBytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Handle ANSI escape sequences for both control sequence introducer (CSI) and operating system</span>
<span class="c1"># command (OSC). Both of these begin with 0x1b (or octal 033), which will be shown below as ESC.</span>
<span class="c1">#</span>
<span class="c1"># CSI ANSI escape codes have the following format, defined in section 5.4 of ECMA-48:</span>
<span class="c1">#</span>
<span class="c1"># CSI: ESC followed by the &#39;[&#39; character (0x5b)</span>
<span class="c1"># Parameter Bytes: 0..n bytes in the range 0x30-0x3f</span>
<span class="c1"># Intermediate Bytes: 0..n bytes in the range 0x20-0x2f</span>
<span class="c1"># Final Byte: a single byte in the range 0x40-0x7e</span>
<span class="c1">#</span>
<span class="c1"># Also include the terminal hyperlink sequences as described here:</span>
<span class="c1"># https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9f3cb5feda</span>
<span class="c1">#</span>
<span class="c1"># OSC 8 ; params ; uri ST display_text OSC 8 ;; ST</span>
<span class="c1">#</span>
<span class="c1"># Example: \x1b]8;;https://example.com\x5ctext to show\x1b]8;;\x5c</span>
<span class="c1">#</span>
<span class="c1"># Where:</span>
<span class="c1"># OSC: ESC followed by the &#39;]&#39; character (0x5d)</span>
<span class="c1"># params: 0..n optional key value pairs separated by &#39;:&#39; (e.g. foo=bar:baz=qux:abc=123)</span>
<span class="c1"># URI: the actual URI with protocol scheme (e.g. https://, file://, ftp://)</span>
<span class="c1"># ST: ESC followed by the &#39;\&#39; character (0x5c)</span>
<span class="n">_esc</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\x1b&quot;</span>
<span class="n">_csi</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">\[&quot;</span>
<span class="n">_osc</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">\]&quot;</span>
<span class="n">_st</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="se">\\</span><span class="s2">&quot;</span>

<span class="n">_ansiEscapePat</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (</span>
<span class="s2">        # terminal colors, etc</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_csi</span><span class="si">}</span><span class="s2">        # CSI</span>
<span class="s2">        [\x30-\x3f]*  # parameter bytes</span>
<span class="s2">        [\x20-\x2f]*  # intermediate bytes</span>
<span class="s2">        [\x40-\x7e]   # final byte</span>
<span class="s2">    |</span>
<span class="s2">        # terminal hyperlinks</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_osc</span><span class="si">}</span><span class="s2">8;        # OSC opening</span>
<span class="s2">        (\w+=\w+:?)*    # key=value params list (submatch 2)</span>
<span class="s2">        ;               # delimiter</span>
<span class="s2">        ([^</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">]+)    # URI - anything but ESC (submatch 3)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_st</span><span class="si">}</span><span class="s2">           # ST</span>
<span class="s2">        ([^</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">]+)    # link text - anything but ESC (submatch 4)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_osc</span><span class="si">}</span><span class="s2">8;;</span><span class="si">{</span><span class="n">_st</span><span class="si">}</span><span class="s2">  # &quot;closing&quot; OSC sequence</span>
<span class="s2">    )</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">_ansiCodes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_ansiEscapePat</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">_ansiCodesBytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_ansiEscapePat</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">_floatWithThousandsSeparators</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;^(([+-]?[0-9]{1,3})(?:,([0-9]</span><span class="si">{3}</span><span class="s2">))*)?(?(1)\.[0-9]*|\.[0-9]+)?$&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_isnumberWithThousandsSeparator</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to test of a string is a number with a thousands separator.</span>

<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;.&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;1&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;1.&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;.1&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;1000&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;1,000&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;1,0000&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(b&quot;1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;+1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumberWithThousandsSeparator(&quot;-1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_floatWithThousandsSeparators</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_isconvertible</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conv</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function; is this string a number.</span>

<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123.45&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;spam&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123e45678&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;inf&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_isconvertible</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inf&quot;</span><span class="p">,</span> <span class="s2">&quot;-inf&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">inttype</span><span class="o">=</span><span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a string is an integer.</span>

<span class="sd">    &gt;&gt;&gt; _isint(&quot;123&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isint(&quot;123.45&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="n">inttype</span>
        <span class="ow">or</span> <span class="p">(</span>
            <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;is_integer&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;__array__&quot;</span><span class="p">))</span>
            <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">))</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&lt;class &#39;numpy.int&quot;</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># numpy.int64 and similar</span>
        <span class="ow">or</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="n">_isconvertible</span><span class="p">(</span><span class="n">inttype</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># integer as string</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_isbool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test if a string is a boolean.</span>

<span class="sd">    &gt;&gt;&gt; _isbool(True)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isbool(&quot;False&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isbool(1)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_type</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The least generic type (type(None), int, float, str, unicode).</span>

<span class="sd">    &gt;&gt;&gt; _type(None) is type(None)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&quot;foo&quot;) is type(&quot;&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&quot;1&quot;) is type(1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&#39;\x1b[31m42\x1b[0m&#39;) is type(42)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&#39;\x1b[31m42\x1b[0m&#39;) is type(42)</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hasInvisible</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">_stripAnsi</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;isoformat&quot;</span><span class="p">):</span>
        <span class="c1"># datetime.datetime, date, and time</span>
        <span class="k">return</span> <span class="nb">str</span>
    <span class="k">elif</span> <span class="n">_isbool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span>
    <span class="k">elif</span> <span class="n">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span>
    <span class="k">elif</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bytes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span>


<span class="k">def</span> <span class="nf">_afterpoint</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbols after a decimal point, -1 if the string lacks the decimal point.</span>

<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123.45&quot;)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;1001&quot;)</span>
<span class="sd">    -1</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;eggs&quot;)</span>
<span class="sd">    -1</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123e45&quot;)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123,456.78&quot;)</span>
<span class="sd">    2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_isnumberWithThousandsSeparator</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">pos</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># no point</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># not a number</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>


<span class="k">def</span> <span class="nf">_padleft</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Flush right.</span>

<span class="sd">    &gt;&gt;&gt; _padleft(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39;  \u044f\u0439\u0446\u0430&#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:&gt;</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padright</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Flush left.</span>

<span class="sd">    &gt;&gt;&gt; _padright(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39;\u044f\u0439\u0446\u0430  &#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:&lt;</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padboth</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Center string.</span>

<span class="sd">    &gt;&gt;&gt; _padboth(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39; \u044f\u0439\u0446\u0430 &#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:^</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padnone</span><span class="p">(</span><span class="n">ignoreWidth</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">_stripAnsi</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Remove ANSI escape sequences, both CSI and OSC hyperlinks.</span>

<span class="sd">    CSI sequences are simply removed from the output, while OSC hyperlinks are replaced with the</span>
<span class="sd">    link text. Note: it may be desirable to show the URI instead but this is not supported.</span>

<span class="sd">        &gt;&gt;&gt; repr(_stripAnsi(&#39;\x1B]8;;https://example.com\x1B\\This is a link\x1B]8;;\x1B\\&#39;))</span>
<span class="sd">        &quot;&#39;This is a link&#39;&quot;</span>

<span class="sd">        &gt;&gt;&gt; repr(_stripAnsi(&#39;\x1b[31mred\x1b[0m text&#39;))</span>
<span class="sd">        &quot;&#39;red text&#39;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_ansiCodes</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\4&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># a bytestring</span>
        <span class="k">return</span> <span class="n">_ansiCodesBytes</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\4&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_visibleWidth</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Visible width of a printed string.</span>

<span class="sd">    &gt;&gt;&gt; _visibleWidth(&#39;\x1b[31mhello\x1b[0m&#39;), _visibleWidth(&quot;world&quot;)</span>
<span class="sd">    (5, 5)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">_stripAnsi</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_isMultiline</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">_multilineCodes</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># a bytestring</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">_multilineCodesBytes</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_multilineWidth</span><span class="p">(</span><span class="n">multilineS</span><span class="p">,</span> <span class="n">lineWidthFn</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible width of a potentially multiline content.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">lineWidthFn</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">multilineS</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_chooseWidthFn</span><span class="p">(</span><span class="n">hasInvisible</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a function to calculate visible cell width.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">hasInvisible</span><span class="p">:</span>
        <span class="n">lineWidthFn</span> <span class="o">=</span> <span class="n">_visibleWidth</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lineWidthFn</span> <span class="o">=</span> <span class="nb">len</span>

    <span class="k">if</span> <span class="n">isMultiline</span><span class="p">:</span>
        <span class="n">widthFn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">_multilineWidth</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lineWidthFn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">widthFn</span> <span class="o">=</span> <span class="n">lineWidthFn</span>

    <span class="k">return</span> <span class="n">widthFn</span>


<span class="k">def</span> <span class="nf">_alignColumnChoosePadfn</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padleft</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padboth</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;decimal&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hasInvisible</span><span class="p">:</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="p">[</span><span class="n">_afterpoint</span><span class="p">(</span><span class="n">_stripAnsi</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="p">[</span><span class="n">_afterpoint</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">maxdecimals</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxdecimals</span> <span class="o">-</span> <span class="n">decs</span><span class="p">)</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">decs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padleft</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">alignment</span><span class="p">:</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padnone</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padright</span>
    <span class="k">return</span> <span class="n">strings</span><span class="p">,</span> <span class="n">padfn</span>


<span class="k">def</span> <span class="nf">_alignColumnChooseWidthFn</span><span class="p">(</span><span class="n">hasInvisible</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">hasInvisible</span><span class="p">:</span>
        <span class="n">lineWidthFn</span> <span class="o">=</span> <span class="n">_visibleWidth</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lineWidthFn</span> <span class="o">=</span> <span class="nb">len</span>

    <span class="k">if</span> <span class="n">isMultiline</span><span class="p">:</span>
        <span class="n">widthFn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">_alignColumnMultilineWidth</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">lineWidthFn</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">widthFn</span> <span class="o">=</span> <span class="n">lineWidthFn</span>

    <span class="k">return</span> <span class="n">widthFn</span>


<span class="k">def</span> <span class="nf">_alignColumnMultilineWidth</span><span class="p">(</span><span class="n">multilineS</span><span class="p">,</span> <span class="n">lineWidthFn</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible width of a potentially multiline content.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">lineWidthFn</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">multilineS</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_flatList</span><span class="p">(</span><span class="n">nestedList</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nestedList</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span> <span class="nf">_alignColumn</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">minwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">isMultiline</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[string] -&gt; [padded_string].&quot;&quot;&quot;</span>
    <span class="n">strings</span><span class="p">,</span> <span class="n">padfn</span> <span class="o">=</span> <span class="n">_alignColumnChoosePadfn</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="p">)</span>
    <span class="n">widthFn</span> <span class="o">=</span> <span class="n">_alignColumnChooseWidthFn</span><span class="p">(</span><span class="n">hasInvisible</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">)</span>

    <span class="n">sWidths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">widthFn</span><span class="p">,</span> <span class="n">strings</span><span class="p">))</span>
    <span class="n">maxwidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_flatList</span><span class="p">(</span><span class="n">sWidths</span><span class="p">)),</span> <span class="n">minwidth</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">isMultiline</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hasInvisible</span><span class="p">:</span>
            <span class="n">paddedStrings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">padfn</span><span class="p">(</span><span class="n">maxwidth</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()])</span>
                <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">strings</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># enable wide-character width corrections</span>
            <span class="n">sLens</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
            <span class="n">visibleWidths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">maxwidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">ll</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">ml</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">mw</span><span class="p">,</span> <span class="n">ml</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sWidths</span><span class="p">,</span> <span class="n">sLens</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># wcswidth and _visibleWidth don&#39;t count invisible characters;</span>
            <span class="c1"># padfn doesn&#39;t need to apply another correction</span>
            <span class="n">paddedStrings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">padfn</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="n">ms</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="ow">or</span> <span class="n">ms</span><span class="p">),</span> <span class="n">mw</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">ms</span><span class="p">,</span> <span class="n">mw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">visibleWidths</span><span class="p">)</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># single-line cell values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hasInvisible</span><span class="p">:</span>
            <span class="n">paddedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">padfn</span><span class="p">(</span><span class="n">maxwidth</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># enable wide-character width corrections</span>
            <span class="n">sLens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">strings</span><span class="p">))</span>
            <span class="n">visibleWidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxwidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">ll</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">ll</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sWidths</span><span class="p">,</span> <span class="n">sLens</span><span class="p">)]</span>
            <span class="c1"># wcswidth and _visibleWidth don&#39;t count invisible characters;</span>
            <span class="c1"># padfn doesn&#39;t need to apply another correction</span>
            <span class="n">paddedStrings</span> <span class="o">=</span> <span class="p">[</span><span class="n">padfn</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">visibleWidths</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">paddedStrings</span>


<span class="k">def</span> <span class="nf">_moreGeneric</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="n">type2</span><span class="p">):</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nb">bool</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nb">float</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">invtypes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">5</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">moregeneric</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">invtypes</span><span class="p">[</span><span class="n">moregeneric</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_columnType</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The least generic type all column values are convertible to.</span>

<span class="sd">    &gt;&gt;&gt; _columnType([True, False]) is bool</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([&quot;1&quot;, &quot;2&quot;]) is int</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([&quot;1&quot;, &quot;2.3&quot;]) is float</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([&quot;1&quot;, &quot;2.3&quot;, &quot;four&quot;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([&quot;four&quot;, &#39;\u043f\u044f\u0442\u044c&#39;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([None, &quot;brux&quot;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _columnType([1, 2, None]) is int</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; import datetime as dt</span>
<span class="sd">    &gt;&gt;&gt; _columnType([dt.datetime(1991,2,19), dt.time(17,35)]) is str</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="p">,</span> <span class="n">numparse</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_moreGeneric</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">valtype</span><span class="p">,</span> <span class="n">floatFmt</span><span class="p">,</span> <span class="n">intFmt</span><span class="p">,</span> <span class="n">missingVal</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Format a value according to its type.</span>

<span class="sd">    Unicode is supported::</span>

<span class="sd">        &gt;&gt;&gt; hrow = [&#39;\u0431\u0443\u043a\u0432\u0430&#39;, &#39;\u0446\u0438\u0444\u0440\u0430&#39;] ; \</span>
<span class="sd">            tbl = [[&#39;\u0430\u0437&#39;, 2], [&#39;\u0431\u0443\u043a\u0438&#39;, 4]] ; \</span>
<span class="sd">            good_result = &#39;\\u0431\\u0443\\u043a\\u0432\\u0430      \\u0446\\u0438\\u0444\\u0440\\u0430\\n-------  -------\\n\\u0430\\u0437             2\\n\\u0431\\u0443\\u043a\\u0438           4&#39; ; \</span>
<span class="sd">            tabulate(tbl, headers=hrow) == good_result</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missingVal</span>

    <span class="k">if</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">intFmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">isAColoredNumber</span> <span class="o">=</span> <span class="n">hasInvisible</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">isAColoredNumber</span><span class="p">:</span>
            <span class="n">rawVal</span> <span class="o">=</span> <span class="n">_stripAnsi</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">formattedVal</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">rawVal</span><span class="p">),</span> <span class="n">floatFmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">rawVal</span><span class="p">,</span> <span class="n">formattedVal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">floatFmt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">_alignHeader</span><span class="p">(</span>
    <span class="n">header</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">visibleWidth</span><span class="p">,</span> <span class="n">isMultiline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">widthFn</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pad string header to width chars given known visibleWidth of the header.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">isMultiline</span><span class="p">:</span>
        <span class="n">headerLines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_multilineCodes</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">paddedLines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_alignHeader</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">widthFn</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headerLines</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paddedLines</span><span class="p">)</span>
    <span class="c1"># else: not multiline</span>
    <span class="n">ninvisible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="n">visibleWidth</span>
    <span class="n">width</span> <span class="o">+=</span> <span class="n">ninvisible</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padright</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padboth</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">alignment</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padleft</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_removeSeparatingLines</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">separatingLines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sansRows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_isSeparatingLine</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">separatingLines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sansRows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sansRows</span><span class="p">,</span> <span class="n">separatingLines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_reinsertSeparatingLines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separatingLines</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">separatingLines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">separatingLines</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_prependRowIndex</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a left-most index column.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rows</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Sized</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;index must be as long as the number of data rows: &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;len(index)=</span><span class="si">{}</span><span class="s2"> len(rows)=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="n">sansRows</span><span class="p">,</span> <span class="n">separatingLines</span> <span class="o">=</span> <span class="n">_removeSeparatingLines</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">newRows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">indexIter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sansRows</span><span class="p">:</span>
        <span class="n">indexV</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">indexIter</span><span class="p">)</span>
        <span class="n">newRows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">indexV</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">newRows</span>
    <span class="n">_reinsertSeparatingLines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separatingLines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows</span>


<span class="k">def</span> <span class="nf">_bool</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A wrapper around standard bool() which doesn&#39;t throw on NumPy arrays.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># val is likely to be a numpy array with many elements</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_normalizeTabularData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">showIndex</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform a supported data type to a list of lists &amp; a list of headers, with header padding.</span>

<span class="sd">    Supported tabular data types:</span>

<span class="sd">    * list-of-lists or another iterable of iterables</span>
<span class="sd">    * list of named tuples (usually used with headers=&quot;keys&quot;)</span>
<span class="sd">    * list of dicts (usually used with headers=&quot;keys&quot;)</span>
<span class="sd">    * list of OrderedDicts (usually used with headers=&quot;keys&quot;)</span>
<span class="sd">    * list of dataclasses (Python 3.7+ only, usually used with headers=&quot;keys&quot;)</span>
<span class="sd">    * 2D NumPy arrays</span>
<span class="sd">    * NumPy record arrays (usually used with headers=&quot;keys&quot;)</span>
<span class="sd">    * dict of iterables (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    The first row can be used as headers if headers=&quot;firstrow&quot;, column indices can be used as</span>
<span class="sd">    headers if headers=&quot;keys&quot;.</span>

<span class="sd">    If showIndex=&quot;always&quot;, show row indices for all types of data.</span>
<span class="sd">    If showIndex=&quot;never&quot;, don&#39;t show row indices for all types of data.</span>
<span class="sd">    If showIndex is an iterable, show its values as row indices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">bool</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="c1"># numpy.ndarray, ...</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;keys&quot;</span><span class="p">):</span>
        <span class="c1"># dict-like</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="c1"># fill out default values, to ensure all data lists are the same length</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">maxLen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vv</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxLen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">))</span> <span class="k">for</span> <span class="n">vv</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxLen</span><span class="p">)]</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
            <span class="c1"># headers should be strings</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">keys</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># it&#39;s a usual iterable of iterables, or a NumPy array, or an iterable of dataclasses</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c1"># an empty table</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;names&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># numpy record array</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;_fields&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># namedtuple</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;values&quot;</span><span class="p">):</span>
            <span class="c1"># dict-like object</span>
            <span class="n">uniqKeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># implements hashed lookup</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># storage for set</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
                <span class="n">firstdict</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">firstdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">uniqKeys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># Save unique items in input order</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniqKeys</span><span class="p">:</span>
                        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="n">uniqKeys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">keys</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># a dict of headers for a list of dicts</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">headers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;headers for a list of dicts is not a dict or a keyword&quot;</span>
                <span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># Python 3.7+&#39;s dataclass</span>
            <span class="n">fieldNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">fieldNames</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fieldNames</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># keys are column indices</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>

    <span class="c1"># take headers from the first row if necessary</span>
    <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>  <span class="c1"># headers should be strings</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span> <span class="k">if</span> <span class="n">_isSeparatingLine</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">rows</span><span class="p">))</span>

    <span class="c1"># add or remove an index column</span>
    <span class="n">showIndexIsSStr</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">showIndex</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">showIndex</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prependRowIndex</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">showIndex</span><span class="p">,</span> <span class="n">Sized</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showIndexIsSStr</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prependRowIndex</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">showIndex</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">showIndex</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showIndexIsSStr</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prependRowIndex</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">showIndex</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">showIndex</span> <span class="o">==</span> <span class="s2">&quot;always&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_bool</span><span class="p">(</span><span class="n">showIndex</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showIndexIsSStr</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prependRowIndex</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="c1"># pad with empty headers for initial columns if necessary</span>
    <span class="n">headersPad</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">headers</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">headersPad</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">))</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">headersPad</span> <span class="o">+</span> <span class="n">headers</span>

    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">headersPad</span>


<span class="k">def</span> <span class="nf">_wrapTextToColWidths</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">):</span>
        <span class="n">numCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numCols</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span><span class="n">numparses</span><span class="p">,</span> <span class="n">numCols</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listOfLists</span><span class="p">:</span>
        <span class="n">newRow</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">numparse</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
                <span class="n">newRow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrapper</span> <span class="o">=</span> <span class="n">TextWrapper</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
                <span class="c1"># Cast based on our internal type handling. Any future custom formatting of types</span>
                <span class="c1"># (such as datetimes) may need to be more explicit than just `str` of the object</span>
                <span class="n">castedCell</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">else</span> <span class="n">_type</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">numparse</span><span class="p">)(</span><span class="n">cell</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">wrapped</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapper</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">castedCell</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>
                <span class="p">]</span>
                <span class="n">newRow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">newRow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newRow</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_toStr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A type safe wrapper for converting a bytestring to str.</span>

<span class="sd">    This is essentially just a wrapper around .decode() intended for use with things like map(), but</span>
<span class="sd">    with some specific behavior:</span>

<span class="sd">    1. if the given parameter is not a bytestring, it is returned unmodified</span>
<span class="sd">    2. decode() is called for the given parameter and assumes utf8 encoding, but the default error</span>
<span class="sd">       behavior is changed from &#39;strict&#39; to &#39;ignore&#39;</span>

<span class="sd">        &gt;&gt;&gt; repr(_toStr(b&#39;foo&#39;))</span>
<span class="sd">        &quot;&#39;foo&#39;&quot;</span>

<span class="sd">        &gt;&gt;&gt; repr(_toStr(&#39;foo&#39;))</span>
<span class="sd">        &quot;&#39;foo&#39;&quot;</span>

<span class="sd">        &gt;&gt;&gt; repr(_toStr(42))</span>
<span class="sd">        &quot;&#39;42&#39;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<div class="viewcode-block" id="tabulate"><a class="viewcode-back" href="../../../.apidocs/armi.utils.tabulate.html#armi.utils.tabulate.tabulate">[docs]</a><span class="k">def</span> <span class="nf">tabulate</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">tableFmt</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">,</span>
    <span class="n">floatFmt</span><span class="o">=</span><span class="n">_DEFAULT_FLOAT_FMT</span><span class="p">,</span>
    <span class="n">intFmt</span><span class="o">=</span><span class="n">_DEFAULT_INT_FMT</span><span class="p">,</span>
    <span class="n">numAlign</span><span class="o">=</span><span class="n">_DEFAULT_ALIGN</span><span class="p">,</span>
    <span class="n">strAlign</span><span class="o">=</span><span class="n">_DEFAULT_ALIGN</span><span class="p">,</span>
    <span class="n">missingVal</span><span class="o">=</span><span class="n">_DEFAULT_MISSING_VAL</span><span class="p">,</span>
    <span class="n">showIndex</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">disableNumParse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colGlobalAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxColWidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">headersGlobalAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">headersAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rowAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxHeaderColWidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a fixed width table for pretty printing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : object</span>
<span class="sd">        The tabular data you want to print. This can be a list-of-lists/iterables, dict-of-lists/</span>
<span class="sd">        iterables, 2D numpy arrays, or list of dataclasses.</span>
<span class="sd">    headers=(), optional</span>
<span class="sd">        Nice column names. If this is &quot;firstrow&quot;, the first row of the data will be used. If it is</span>
<span class="sd">        &quot;keys&quot;m, then dictionary keys or column indices are used.</span>
<span class="sd">    tableFmt : str, optional</span>
<span class="sd">        There are custom table formats defined in this file, and you can choose between them with</span>
<span class="sd">        this string: &quot;armi&quot;, &quot;simple&quot;, &quot;plain&quot;, &quot;grid&quot;, &quot;github&quot;, &quot;pretty&quot;, &quot;psql&quot;, &quot;rst&quot;, &quot;tsv&quot;.</span>
<span class="sd">    floatFmt : str, optional</span>
<span class="sd">        A format specification used for columns which contain numeric data with a decimal point.</span>
<span class="sd">        This can also be a list or tuple of format strings, one per column.</span>
<span class="sd">    intFmt : str, optional</span>
<span class="sd">        A format specification used for columns which contain numeric data without a decimal point.</span>
<span class="sd">        This can also be a list or tuple of format strings, one per column.</span>
<span class="sd">    numAlign : str, optional</span>
<span class="sd">        Specially align numbers, options: &quot;right&quot;, &quot;center&quot;, &quot;left&quot;, &quot;decimal&quot;.</span>
<span class="sd">    strAlign : str, optional</span>
<span class="sd">        Specially align strings, options: &quot;right&quot;, &quot;center&quot;, &quot;left&quot;.</span>
<span class="sd">    missingVal : str, optional</span>
<span class="sd">        `None` values are replaced with a `missingVal` string.</span>
<span class="sd">    showIndex : str, optional</span>
<span class="sd">        Show these rows of data. If &quot;always&quot;, show row indices for all types of data. If &quot;never&quot;,</span>
<span class="sd">        don&#39;t show row indices for all types of data. If showIndex is an iterable, show its values..</span>
<span class="sd">    disableNumParse : bool, optional</span>
<span class="sd">        To disable number parsing (and alignment), use `disableNumParse=True`. For more fine grained</span>
<span class="sd">        control, `[0, 2]` would disable number parsing on the first and third columns.</span>
<span class="sd">    colGlobalAlign : str, optional</span>
<span class="sd">        Allows for global alignment of columns, before any specific override from `colAlign`.</span>
<span class="sd">        Possible values are: None, &quot;right&quot;, &quot;center&quot;, &quot;decimal&quot;, &quot;left&quot;.</span>
<span class="sd">    colAlign : str, optional</span>
<span class="sd">        Allows for column-wise override starting from left-most column. Possible values are:</span>
<span class="sd">        &quot;global&quot; (no override), &quot;right&quot;, &quot;center&quot;, &quot;decimal&quot;, &quot;left&quot;.</span>
<span class="sd">    maxColWidths : list, optional</span>
<span class="sd">        A list of the maximum column widths.</span>
<span class="sd">    headersGlobalAlign : str, optional</span>
<span class="sd">        Allows for global headers alignment, before any specific override from `headersAlign`.</span>
<span class="sd">        Possible values are: None (follow columns alignment), &quot;right&quot;, &quot;center&quot;, &quot;left&quot;.</span>
<span class="sd">    headersAlign : str, optional</span>
<span class="sd">        Allows for header-wise override starting from left-most given header. Possible values are:</span>
<span class="sd">        &quot;global&quot; (no override), &quot;same&quot; (follow column alignment), &quot;right&quot;, &quot;center&quot;, &quot;left&quot;.</span>
<span class="sd">    rowAlign : str, optional</span>
<span class="sd">        How do you want to align rows: &quot;right&quot;, &quot;center&quot;, &quot;decimal&quot;, &quot;left&quot;.</span>
<span class="sd">    maxHeaderColWidths : list, optional</span>
<span class="sd">        List of column widths for the header.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A text representation of the tabular data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">listOfLists</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">headersPad</span> <span class="o">=</span> <span class="n">_normalizeTabularData</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">showIndex</span><span class="o">=</span><span class="n">showIndex</span>
    <span class="p">)</span>
    <span class="n">listOfLists</span><span class="p">,</span> <span class="n">separatingLines</span> <span class="o">=</span> <span class="n">_removeSeparatingLines</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">maxColWidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">):</span>
            <span class="n">numCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numCols</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxColWidths</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Expand scalar for all columns</span>
            <span class="n">maxColWidths</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span><span class="n">maxColWidths</span><span class="p">,</span> <span class="n">numCols</span><span class="p">,</span> <span class="n">maxColWidths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Ignore col width for any &#39;trailing&#39; columns</span>
            <span class="n">maxColWidths</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span><span class="n">maxColWidths</span><span class="p">,</span> <span class="n">numCols</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expandNumparse</span><span class="p">(</span><span class="n">disableNumParse</span><span class="p">,</span> <span class="n">numCols</span><span class="p">)</span>
        <span class="n">listOfLists</span> <span class="o">=</span> <span class="n">_wrapTextToColWidths</span><span class="p">(</span>
            <span class="n">listOfLists</span><span class="p">,</span> <span class="n">maxColWidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="n">numparses</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">maxHeaderColWidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">numCols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxHeaderColWidths</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Expand scalar for all columns</span>
            <span class="n">maxHeaderColWidths</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span>
                <span class="n">maxHeaderColWidths</span><span class="p">,</span> <span class="n">numCols</span><span class="p">,</span> <span class="n">maxHeaderColWidths</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Ignore col width for any &#39;trailing&#39; columns</span>
            <span class="n">maxHeaderColWidths</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span><span class="n">maxHeaderColWidths</span><span class="p">,</span> <span class="n">numCols</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expandNumparse</span><span class="p">(</span><span class="n">disableNumParse</span><span class="p">,</span> <span class="n">numCols</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">_wrapTextToColWidths</span><span class="p">(</span>
            <span class="p">[</span><span class="n">headers</span><span class="p">],</span> <span class="n">maxHeaderColWidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="n">numparses</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># empty values in the first column of RST tables should be escaped</span>
    <span class="c1"># &quot;&quot; should be escaped as &quot;\\ &quot; or &quot;..&quot;</span>
    <span class="k">if</span> <span class="n">tableFmt</span> <span class="o">==</span> <span class="s2">&quot;rst&quot;</span><span class="p">:</span>
        <span class="n">listOfLists</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">_rstEscapeFirstColumn</span><span class="p">(</span><span class="n">listOfLists</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="c1"># Pretty table formatting does not use any extra padding. Numbers are not parsed and are treated</span>
    <span class="c1"># the same as strings for alignment. Check if pretty is the format being used and override the</span>
    <span class="c1"># defaults so it does not impact other formats.</span>
    <span class="n">minPadding</span> <span class="o">=</span> <span class="n">MIN_PADDING</span>
    <span class="k">if</span> <span class="n">tableFmt</span> <span class="o">==</span> <span class="s2">&quot;pretty&quot;</span><span class="p">:</span>
        <span class="n">minPadding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">disableNumParse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">numAlign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">numAlign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">numAlign</span>
        <span class="n">strAlign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">strAlign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">strAlign</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numAlign</span> <span class="o">=</span> <span class="s2">&quot;decimal&quot;</span> <span class="k">if</span> <span class="n">numAlign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">numAlign</span>
        <span class="n">strAlign</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span> <span class="k">if</span> <span class="n">strAlign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">strAlign</span>

    <span class="c1"># optimization: look for ANSI control codes once, enable smart width functions only if a control</span>
    <span class="c1"># code is found</span>
    <span class="c1">#</span>
    <span class="c1"># convert the headers and rows into a single, tab-delimited string ensuring that any bytestrings</span>
    <span class="c1"># are decoded safely (i.e. errors ignored)</span>
    <span class="n">plainText</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">chain</span><span class="p">(</span>
            <span class="c1"># headers</span>
            <span class="nb">map</span><span class="p">(</span><span class="n">_toStr</span><span class="p">,</span> <span class="n">headers</span><span class="p">),</span>
            <span class="c1"># rows: chain the rows together into a single iterable after mapping the bytestring</span>
            <span class="c1"># conversion to each cell value</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_toStr</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">listOfLists</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">hasInvisible</span> <span class="o">=</span> <span class="n">_ansiCodes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">plainText</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tableFmt</span><span class="p">,</span> <span class="n">TableFormat</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">tableFmt</span> <span class="ow">in</span> <span class="n">multilineFormats</span>
        <span class="ow">and</span> <span class="n">_isMultiline</span><span class="p">(</span><span class="n">plainText</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">tableFmt</span> <span class="o">=</span> <span class="n">multilineFormats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tableFmt</span><span class="p">,</span> <span class="n">tableFmt</span><span class="p">)</span>
        <span class="n">isMultiline</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">isMultiline</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">widthFn</span> <span class="o">=</span> <span class="n">_chooseWidthFn</span><span class="p">(</span><span class="n">hasInvisible</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">)</span>

    <span class="c1"># format rows and columns, convert numeric values to strings</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">zip_longest</span><span class="p">(</span><span class="o">*</span><span class="n">listOfLists</span><span class="p">))</span>
    <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expandNumparse</span><span class="p">(</span><span class="n">disableNumParse</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
    <span class="n">coltypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_columnType</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="n">np</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">np</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">numparses</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">floatFmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># old version: just duplicate the string to use in each column</span>
        <span class="n">floatFormats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">floatFmt</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if floatFmt is list, tuple etc we have one per column</span>
        <span class="n">floatFormats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">floatFmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">floatFormats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">floatFormats</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">floatFormats</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_FLOAT_FMT</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intFmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># old version: just duplicate the string to use in each column</span>
        <span class="n">intFormats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">intFmt</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if intFmt is list, tuple etc we have one per column</span>
        <span class="n">intFormats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">intFmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intFormats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">intFormats</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">intFormats</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_INT_FMT</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">missingVal</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">missingVals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">missingVal</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">missingVals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missingVal</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missingVals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">missingVals</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">missingVals</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_MISSING_VAL</span><span class="p">])</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">_format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">flFmt</span><span class="p">,</span> <span class="n">intFmt</span><span class="p">,</span> <span class="n">missV</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">flFmt</span><span class="p">,</span> <span class="n">intFmt</span><span class="p">,</span> <span class="n">missV</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">cols</span><span class="p">,</span> <span class="n">coltypes</span><span class="p">,</span> <span class="n">floatFormats</span><span class="p">,</span> <span class="n">intFormats</span><span class="p">,</span> <span class="n">missingVals</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># align columns</span>
    <span class="c1"># first set global alignment</span>
    <span class="k">if</span> <span class="n">colGlobalAlign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if global alignment provided</span>
        <span class="n">aligns</span> <span class="o">=</span> <span class="p">[</span><span class="n">colGlobalAlign</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># default</span>
        <span class="n">aligns</span> <span class="o">=</span> <span class="p">[</span><span class="n">numAlign</span> <span class="k">if</span> <span class="n">ct</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="k">else</span> <span class="n">strAlign</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">coltypes</span><span class="p">]</span>

    <span class="c1"># then specific alignements</span>
    <span class="k">if</span> <span class="n">colAlign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colAlign</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colAlign</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;As a string, `colAlign` is interpreted as </span><span class="si">{</span><span class="p">[</span><span class="n">c</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">colAlign</span><span class="p">]</span><span class="si">}</span><span class="s2">. Did you &quot;</span>
                <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;mean `colGlobalAlign = &quot;</span><span class="si">{</span><span class="n">colAlign</span><span class="si">}</span><span class="s1">&quot;` or `colAlign = (&quot;</span><span class="si">{</span><span class="n">colAlign</span><span class="si">}</span><span class="s1">&quot;,)`?&#39;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">align</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colAlign</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">aligns</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">align</span> <span class="o">!=</span> <span class="s2">&quot;global&quot;</span><span class="p">:</span>
                <span class="n">aligns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">align</span>
    <span class="n">minwidths</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">widthFn</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">minPadding</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_alignColumn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span><span class="p">,</span> <span class="n">hasInvisible</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">aligns</span><span class="p">,</span> <span class="n">minwidths</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">alignsHeaders</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="c1"># align headers and add headers</span>
        <span class="n">tCols</span> <span class="o">=</span> <span class="n">cols</span> <span class="ow">or</span> <span class="p">[[</span><span class="s2">&quot;&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="c1"># first set global alignment</span>
        <span class="k">if</span> <span class="n">headersGlobalAlign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if global alignment provided</span>
            <span class="n">alignsHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="n">headersGlobalAlign</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tCols</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># default</span>
            <span class="n">alignsHeaders</span> <span class="o">=</span> <span class="n">aligns</span> <span class="ow">or</span> <span class="p">[</span><span class="n">strAlign</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="c1"># then specific header alignements</span>
        <span class="k">if</span> <span class="n">headersAlign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headersAlign</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headersAlign</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;As a string, `headersAlign` is interpreted as </span><span class="si">{</span><span class="p">[</span><span class="n">c</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">headersAlign</span><span class="p">]</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;Did you mean `headersGlobalAlign = &quot;</span><span class="si">{</span><span class="n">headersAlign</span><span class="si">}</span><span class="s1">&quot;` or `headersAlign = &#39;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(&quot;</span><span class="si">{</span><span class="n">headersAlign</span><span class="si">}</span><span class="s1">&quot;,)`?&#39;</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">align</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">headersAlign</span><span class="p">):</span>
                <span class="n">hidx</span> <span class="o">=</span> <span class="n">headersPad</span> <span class="o">+</span> <span class="n">idx</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">hidx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">alignsHeaders</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;same&quot;</span> <span class="ow">and</span> <span class="n">hidx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">aligns</span><span class="p">):</span>  <span class="c1"># same as column align</span>
                    <span class="n">alignsHeaders</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">aligns</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">align</span> <span class="o">!=</span> <span class="s2">&quot;global&quot;</span><span class="p">:</span>
                    <span class="n">alignsHeaders</span><span class="p">[</span><span class="n">hidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">align</span>
        <span class="n">minwidths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">minw</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">widthFn</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">minw</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">minwidths</span><span class="p">,</span> <span class="n">tCols</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_alignHeader</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span><span class="p">,</span> <span class="n">widthFn</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">isMultiline</span><span class="p">,</span> <span class="n">widthFn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">alignsHeaders</span><span class="p">,</span> <span class="n">minwidths</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minwidths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">widthFn</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tableFmt</span><span class="p">,</span> <span class="n">TableFormat</span><span class="p">):</span>
        <span class="n">tableFmt</span> <span class="o">=</span> <span class="n">_tableFormats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tableFmt</span><span class="p">,</span> <span class="n">_tableFormats</span><span class="p">[</span><span class="s2">&quot;simple&quot;</span><span class="p">])</span>

    <span class="n">raDefault</span> <span class="o">=</span> <span class="n">rowAlign</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rowAlign</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">rowAligns</span> <span class="o">=</span> <span class="n">_expandIterable</span><span class="p">(</span><span class="n">rowAlign</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="n">raDefault</span><span class="p">)</span>
    <span class="n">_reinsertSeparatingLines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separatingLines</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_formatTable</span><span class="p">(</span>
        <span class="n">tableFmt</span><span class="p">,</span>
        <span class="n">headers</span><span class="p">,</span>
        <span class="n">alignsHeaders</span><span class="p">,</span>
        <span class="n">rows</span><span class="p">,</span>
        <span class="n">minwidths</span><span class="p">,</span>
        <span class="n">aligns</span><span class="p">,</span>
        <span class="n">isMultiline</span><span class="p">,</span>
        <span class="n">rowAligns</span><span class="o">=</span><span class="n">rowAligns</span><span class="p">,</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_expandNumparse</span><span class="p">(</span><span class="n">disableNumParse</span><span class="p">,</span> <span class="n">columnCount</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of bools of length `columnCount` which indicates whether number parsing should be</span>
<span class="sd">    used on each column.</span>

<span class="sd">    If `disableNumParse` is a list of indices, each of those indices are False, and everything else</span>
<span class="sd">    is True. If `disableNumParse` is a bool, then the returned list is all the same.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disableNumParse</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="n">numparses</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">columnCount</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">disableNumParse</span><span class="p">:</span>
            <span class="n">numparses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">numparses</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="ow">not</span> <span class="n">disableNumParse</span><span class="p">]</span> <span class="o">*</span> <span class="n">columnCount</span>


<span class="k">def</span> <span class="nf">_expandIterable</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">numDesired</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expands the `original` argument to return a return a list of length `numDesired`. If `original`</span>
<span class="sd">    is shorter than `numDesired`, it will be padded with the value in `default`.</span>

<span class="sd">    If `original` is not a list to begin with (i.e. scalar value) a list of length `numDesired`</span>
<span class="sd">    completely populated with `default` will be returned</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">original</span> <span class="o">+</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">numDesired</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">original</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span> <span class="o">*</span> <span class="n">numDesired</span>


<span class="k">def</span> <span class="nf">_padRow</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">padding</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">padding</span>
        <span class="n">paddedCells</span> <span class="o">=</span> <span class="p">[</span><span class="n">pad</span> <span class="o">+</span> <span class="n">cell</span> <span class="o">+</span> <span class="n">pad</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">paddedCells</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cells</span>


<span class="k">def</span> <span class="nf">_buildSimpleRow</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format row according to DataRow format without padding.&quot;&quot;&quot;</span>
    <span class="n">begin</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">rowfmt</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">begin</span> <span class="o">+</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_buildRow</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string which represents a row of data cells.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rowfmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rowfmt</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rowfmt</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_buildSimpleRow</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_appendBasicRow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedCells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">,</span> <span class="n">rowAlign</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># NOTE: rowAlign is ignored and exists for api compatibility with _appendMultilineRow</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_buildRow</span><span class="p">(</span><span class="n">paddedCells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_alignCellVeritically</span><span class="p">(</span><span class="n">textLines</span><span class="p">,</span> <span class="n">numLines</span><span class="p">,</span> <span class="n">columnWidth</span><span class="p">,</span> <span class="n">rowAlignment</span><span class="p">):</span>
    <span class="n">deltaLines</span> <span class="o">=</span> <span class="n">numLines</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">textLines</span><span class="p">)</span>
    <span class="n">blank</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">columnWidth</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">rowAlignment</span> <span class="o">==</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blank</span> <span class="o">*</span> <span class="n">deltaLines</span> <span class="o">+</span> <span class="n">textLines</span>
    <span class="k">elif</span> <span class="n">rowAlignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="n">topDelta</span> <span class="o">=</span> <span class="n">deltaLines</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">bottomDelta</span> <span class="o">=</span> <span class="n">deltaLines</span> <span class="o">-</span> <span class="n">topDelta</span>
        <span class="k">return</span> <span class="n">topDelta</span> <span class="o">*</span> <span class="n">blank</span> <span class="o">+</span> <span class="n">textLines</span> <span class="o">+</span> <span class="n">bottomDelta</span> <span class="o">*</span> <span class="n">blank</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">textLines</span> <span class="o">+</span> <span class="n">blank</span> <span class="o">*</span> <span class="n">deltaLines</span>


<span class="k">def</span> <span class="nf">_appendMultilineRow</span><span class="p">(</span>
    <span class="n">lines</span><span class="p">,</span> <span class="n">paddedMultilineCells</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">rowAlign</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">colwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">paddedWidths</span><span class="p">]</span>
    <span class="n">cellsLines</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">paddedMultilineCells</span><span class="p">]</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">cellsLines</span><span class="p">))</span>  <span class="c1"># number of lines in the row</span>

    <span class="n">cellsLines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_alignCellVeritically</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">nlines</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rowAlign</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cellsLines</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">linesCells</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">cellsLines</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">linesCells</span><span class="p">:</span>
        <span class="n">paddedLn</span> <span class="o">=</span> <span class="n">_padRow</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span>
        <span class="n">_appendBasicRow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedLn</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_buildLine</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a string which represents a horizontal line.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">linefmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">linefmt</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">linefmt</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">begin</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">linefmt</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">fill</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">colwidths</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_buildSimpleRow</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">):</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_buildLine</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_formatTable</span><span class="p">(</span>
    <span class="n">fmt</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">headersAligns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">isMultiline</span><span class="p">,</span> <span class="n">rowAligns</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce a plain-text representation of the table.&quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">withHeaderHide</span> <span class="k">if</span> <span class="p">(</span><span class="n">headers</span> <span class="ow">and</span> <span class="n">fmt</span><span class="o">.</span><span class="n">withHeaderHide</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">padding</span>
    <span class="n">headerrow</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">headerrow</span>

    <span class="n">paddedWidths</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">colwidths</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">isMultiline</span><span class="p">:</span>
        <span class="n">padRow</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">row</span>
        <span class="n">appendRow</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_appendMultilineRow</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">padRow</span> <span class="o">=</span> <span class="n">_padRow</span>
        <span class="n">appendRow</span> <span class="o">=</span> <span class="n">_appendBasicRow</span>

    <span class="n">paddedHeaders</span> <span class="o">=</span> <span class="n">padRow</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span>
    <span class="n">paddedRows</span> <span class="o">=</span> <span class="p">[</span><span class="n">padRow</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span> <span class="ow">and</span> <span class="s2">&quot;lineabove&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="n">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">paddedHeaders</span><span class="p">:</span>
        <span class="n">appendRow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedHeaders</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">headersAligns</span><span class="p">,</span> <span class="n">headerrow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span> <span class="ow">and</span> <span class="s2">&quot;linebelowheader&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
            <span class="n">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">paddedRows</span> <span class="ow">and</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span> <span class="ow">and</span> <span class="s2">&quot;linebetweenrows&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="c1"># initial rows with a line below</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">ralign</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paddedRows</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rowAligns</span><span class="p">):</span>
            <span class="n">appendRow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">,</span> <span class="n">rowAlign</span><span class="o">=</span><span class="n">ralign</span><span class="p">)</span>
            <span class="n">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span><span class="p">)</span>
        <span class="c1"># the last row without a line below</span>
        <span class="n">appendRow</span><span class="p">(</span>
            <span class="n">lines</span><span class="p">,</span>
            <span class="n">paddedRows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">paddedWidths</span><span class="p">,</span>
            <span class="n">colAligns</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">,</span>
            <span class="n">rowAlign</span><span class="o">=</span><span class="n">rowAligns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">separatingLine</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span>
            <span class="ow">or</span> <span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">paddedRows</span><span class="p">:</span>
            <span class="c1"># test to see if either the 1st column or the 2nd column has the SEPARATING_LINE flag</span>
            <span class="k">if</span> <span class="n">_isSeparatingLine</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">separatingLine</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">appendRow</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span> <span class="ow">and</span> <span class="s2">&quot;linebelow&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="n">_appendLine</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">paddedWidths</span><span class="p">,</span> <span class="n">colAligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">headers</span> <span class="ow">or</span> <span class="n">rows</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2009-2024, TerraPower, LLC.
      <span class="lastupdated">Last updated on 2024-08-29.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>