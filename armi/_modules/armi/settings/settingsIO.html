

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>armi.settings.settingsIO &mdash; ARMI 0.2.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_fixes.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../_static/armiicon_16x16.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="../../../_static/assets/jsonview.bundle.js"></script>
        <script src="../../../_static/assets/jsonview_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables.min.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/datatables_loader.js"></script>
        <script src="../../../_static/sphinx-needs/libs/html/sphinx_needs_collapse.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #233C5B" >
          

          
            <a href="../../../index.html" class="icon icon-home"> ARMI
          

          
            
            <img src="../../../_static/armiicon_24x24.ico" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.2.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../user/index.html">User Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../requirements/index.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../.apidocs/modules.html">API Docs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ARMI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../armi.html">armi</a> &raquo;</li>
        
          <li><a href="../settings.html">armi.settings</a> &raquo;</li>
        
      <li>armi.settings.settingsIO</li>
    
    
  <li class="wy-breadcrumbs-aside">
    
  </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for armi.settings.settingsIO</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2020 TerraPower, LLC</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="sd">&quot;&quot;&quot;This module contains classes and methods for reading and writing</span>
<span class="sd">:py:class:`~armi.settings.caseSettings.Settings`, and the contained</span>
<span class="sd">:py:class:`~armi.settings.setting.Setting`.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">ruamel.yaml</span> <span class="kn">import</span> <span class="n">YAML</span>
<span class="kn">import</span> <span class="nn">ruamel.yaml.comments</span>

<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">runLog</span>
<span class="kn">from</span> <span class="nn">armi.meta</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">armi</span> <span class="kn">import</span> <span class="n">context</span>
<span class="kn">from</span> <span class="nn">armi.settings.setting</span> <span class="kn">import</span> <span class="n">Setting</span>
<span class="kn">from</span> <span class="nn">armi.settings</span> <span class="kn">import</span> <span class="n">settingsRules</span>
<span class="kn">from</span> <span class="nn">armi.reactor</span> <span class="kn">import</span> <span class="n">systemLayoutInput</span>
<span class="kn">from</span> <span class="nn">armi.utils.customExceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">InvalidSettingsFileError</span><span class="p">,</span>
    <span class="n">SettingException</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Roots"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.Roots">[docs]</a><span class="k">class</span> <span class="nc">Roots</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;XML tree root node common strings&quot;&quot;&quot;</span>

    <span class="n">CUSTOM</span> <span class="o">=</span> <span class="s2">&quot;settings&quot;</span>
    <span class="n">VERSION</span> <span class="o">=</span> <span class="s2">&quot;version&quot;</span></div>


<div class="viewcode-block" id="SettingRenamer"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingRenamer">[docs]</a><span class="k">class</span> <span class="nc">SettingRenamer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility class to help with setting rename migrations.</span>

<span class="sd">    This class stores a cache of renaming maps, derived from the ``Setting.oldNames``</span>
<span class="sd">    values of the passed ``settings``. Expired renames are retained, so that meaningful</span>
<span class="sd">    warning messages can be generated if one attempts to use one of them. The renaming</span>
<span class="sd">    logic follows the rules described in :py:meth:`renameSetting`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Setting</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentNames</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_activeRenames</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expiredRenames</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currentNames</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">oldName</span><span class="p">,</span> <span class="n">expiry</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">oldNames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">expiry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">expired</span> <span class="o">=</span> <span class="n">expiry</span> <span class="o">&lt;=</span> <span class="n">today</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expired</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">expired</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_expiredRenames</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">oldName</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">expiry</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oldName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activeRenames</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SettingException</span><span class="p">(</span>
                            <span class="s2">&quot;The setting rename from </span><span class="si">{0}</span><span class="s2">-&gt;</span><span class="si">{1}</span><span class="s2"> collides with another &quot;</span>
                            <span class="s2">&quot;rename </span><span class="si">{0}</span><span class="s2">-&gt;</span><span class="si">{2}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                <span class="n">oldName</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activeRenames</span><span class="p">[</span><span class="n">oldName</span><span class="p">]</span>
                            <span class="p">)</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_activeRenames</span><span class="p">[</span><span class="n">oldName</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="SettingRenamer.renameSetting"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingRenamer.renameSetting">[docs]</a>    <span class="k">def</span> <span class="nf">renameSetting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to rename a candidate setting.</span>

<span class="sd">        Renaming follows these rules:</span>
<span class="sd">         - If the ``name`` corresponds to a current setting name, do not attempt to</span>
<span class="sd">           rename it.</span>
<span class="sd">         - If the ``name`` does not correspond to a current setting name, but is one of</span>
<span class="sd">           the active renames, return the corresponding active rename.</span>
<span class="sd">         - If the ``name`` does not correspond to a current setting name, but is one of</span>
<span class="sd">           the expired renames, produce a warning and do not rename it.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The candidate setting name to potentially rename.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        name : str</span>
<span class="sd">            The potentially-renamed setting</span>
<span class="sd">        renamed : bool</span>
<span class="sd">            Whether the setting was actually renamed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentNames</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="kc">False</span>

        <span class="n">activeRename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_activeRenames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">activeRename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Invalid setting </span><span class="si">{}</span><span class="s2"> found. Renaming to </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">activeRename</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">activeRename</span><span class="p">,</span> <span class="kc">True</span>

        <span class="n">expiredCandidates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expiredRenames</span> <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">expiredCandidates</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;   </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expiredRename</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">expiredRename</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">expiredCandidates</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Encountered an invalid setting `</span><span class="si">{}</span><span class="s2">`. There are expired &quot;</span>
                <span class="s2">&quot;renames to newer setting names:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="SettingsReader"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader">[docs]</a><span class="k">class</span> <span class="nc">SettingsReader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Abstract class for processing settings files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cs : CaseSettings</span>
<span class="sd">        The settings object to read into</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SettingsReader.SettingsInputFormat"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader.SettingsInputFormat">[docs]</a>    <span class="k">class</span> <span class="nc">SettingsInputFormat</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
        <span class="n">YAML</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">auto</span><span class="p">()</span>

        <span class="c1"># TODO: Is this method still necessary?</span>
<div class="viewcode-block" id="SettingsReader.SettingsInputFormat.fromExt"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader.SettingsInputFormat.fromExt">[docs]</a>        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">fromExt</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;.yaml&quot;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">YAML</span><span class="p">}[</span><span class="n">ext</span><span class="p">]</span></div></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SettingsInputFormat</span><span class="o">.</span><span class="n">YAML</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span> <span class="o">=</span> <span class="s2">&quot;&lt;stream&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">invalidSettings</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settingsAlreadyRead</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">liveVersion</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputVersion</span> <span class="o">=</span> <span class="n">version</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_renamer</span> <span class="o">=</span> <span class="n">SettingRenamer</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

        <span class="c1"># the input version will be overwritten if explicitly stated in input file.</span>
        <span class="c1"># otherwise, it&#39;s assumed to precede the version inclusion change and should be</span>
        <span class="c1"># treated as alright</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span><span class="p">)</span>

<div class="viewcode-block" id="SettingsReader.readFromFile"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader.readFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">readFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">handleInvalids</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load file and read it.&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="c1"># make sure that we can actually open the file before trying to guess its</span>
            <span class="c1"># format. This will yield better error messages when things go awry.</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SettingsInputFormat</span><span class="o">.</span><span class="n">fromExt</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span> <span class="o">=</span> <span class="n">path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">readFromStream</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">handleInvalids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ee</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidSettingsFileError</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ee</span><span class="p">))</span></div>

<div class="viewcode-block" id="SettingsReader.readFromStream"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader.readFromStream">[docs]</a>    <span class="k">def</span> <span class="nf">readFromStream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">handleInvalids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">SettingsInputFormat</span><span class="o">.</span><span class="n">YAML</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read from a file-like stream.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">fmt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">SettingsInputFormat</span><span class="o">.</span><span class="n">YAML</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_readYaml</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handleInvalids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_checkInvalidSettings</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_readYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read settings from a YAML stream.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">armi.physics.thermalHydraulics</span> <span class="kn">import</span> <span class="n">const</span>  <span class="c1"># avoid circular import</span>

        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;settings&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSettingsFileError</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span>
                <span class="s2">&quot;Missing the `settings:` header required in YAML settings&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">const</span><span class="o">.</span><span class="n">ORIFICE_SETTING_ZONE_MAP</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSettingsFileError</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> <span class="s2">&quot;Appears to be an orifice_settings file&quot;</span>
            <span class="p">)</span>
        <span class="n">caseSettings</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">Roots</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputVersion</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">][</span><span class="n">Roots</span><span class="o">.</span><span class="n">VERSION</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">settingName</span><span class="p">,</span> <span class="n">settingVal</span> <span class="ow">in</span> <span class="n">caseSettings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_applySettings</span><span class="p">(</span><span class="n">settingName</span><span class="p">,</span> <span class="n">settingVal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_checkInvalidSettings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalidSettings</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">invalidNames</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalidSettings</span><span class="p">)</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="n">prompt</span><span class="p">(</span>
                <span class="s2">&quot;Found </span><span class="si">{}</span><span class="s2"> invalid settings in </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invalidSettings</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputPath</span><span class="p">,</span> <span class="n">invalidNames</span>
                <span class="p">),</span>
                <span class="s2">&quot;Invalid settings will be ignored. Continue running the case?&quot;</span><span class="p">,</span>
                <span class="s2">&quot;YES_NO&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">RunLogPromptUnresolvable</span><span class="p">:</span>
            <span class="c1"># proceed with invalid settings (they&#39;ll be ignored).</span>
            <span class="n">proceed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">proceed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSettingsStopProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Ignoring invalid settings: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">invalidNames</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_applySettings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">nameToSet</span><span class="p">,</span> <span class="n">_wasRenamed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_renamer</span><span class="o">.</span><span class="n">renameSetting</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">settingsToApply</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applyConversions</span><span class="p">(</span><span class="n">nameToSet</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">settingName</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">settingsToApply</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">settingName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invalidSettings</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">settingName</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># apply validations</span>
                <span class="n">settingObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">getSetting</span><span class="p">(</span><span class="n">settingName</span><span class="p">)</span>

                <span class="c1"># The value is automatically coerced into the expected type</span>
                <span class="c1"># when set using either the default or user-defined schema</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">settingName</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="SettingsReader.applyConversions"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsReader.applyConversions">[docs]</a>    <span class="k">def</span> <span class="nf">applyConversions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Applies conversion rules to give special behavior to certain named settings.</span>

<span class="sd">        Intended to be applied on setting names and attributes as soon as they&#39;re read</span>
<span class="sd">        in keep in mind everything in the attributes dictionary is still a string even</span>
<span class="sd">        if it&#39;s intended to be something else later, that happens at a later stage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># general needs to come first for things like renaming.</span>
        <span class="n">settingsToApply</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">settingsRules</span><span class="o">.</span><span class="n">GENERAL_CONVERSIONS</span><span class="p">:</span>
            <span class="n">settingsToApply</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="n">func</span> <span class="o">=</span> <span class="n">settingsRules</span><span class="o">.</span><span class="n">TARGETED_CONVERSIONS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settingsToApply</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">settingsToApply</span></div></div>


<div class="viewcode-block" id="SettingsWriter"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsWriter">[docs]</a><span class="k">class</span> <span class="nc">SettingsWriter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Writes settings out to files.</span>

<span class="sd">    This can write in two styles:</span>

<span class="sd">    short</span>
<span class="sd">        setting values that are not their defaults only</span>
<span class="sd">    full</span>
<span class="sd">        all setting values regardless of default status</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SettingsWriter.Styles"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsWriter.Styles">[docs]</a>    <span class="k">class</span> <span class="nc">Styles</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Enumeration of valid output styles&quot;&quot;&quot;</span>

        <span class="n">short</span> <span class="o">=</span> <span class="s2">&quot;short&quot;</span>
        <span class="n">full</span> <span class="o">=</span> <span class="s2">&quot;full&quot;</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_instance</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;short&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">settings_instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">short</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">full</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid supplied setting writing style </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_getVersion</span><span class="p">():</span>
        <span class="n">tag</span><span class="p">,</span> <span class="n">attrib</span> <span class="o">=</span> <span class="n">Roots</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">,</span> <span class="p">{</span><span class="n">Roots</span><span class="o">.</span><span class="n">VERSION</span><span class="p">:</span> <span class="n">version</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrib</span>

<div class="viewcode-block" id="SettingsWriter.writeYaml"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.SettingsWriter.writeYaml">[docs]</a>    <span class="k">def</span> <span class="nf">writeYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write settings to YAML file.&quot;&quot;&quot;</span>
        <span class="n">settingData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getSettingDataToWrite</span><span class="p">()</span>
        <span class="n">settingData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessYaml</span><span class="p">(</span><span class="n">settingData</span><span class="p">)</span>
        <span class="n">yaml</span> <span class="o">=</span> <span class="n">YAML</span><span class="p">()</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">default_flow_style</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sequence</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">settingData</span><span class="p">,</span> <span class="n">stream</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_preprocessYaml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settingData</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean up the dict before dumping to yaml.</span>

<span class="sd">        If it has just a value attrib it flattens it for brevity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tag</span><span class="p">,</span> <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getVersion</span><span class="p">()</span>
        <span class="n">yamlData</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">attrib</span><span class="p">}</span>  <span class="c1"># put version info in</span>
        <span class="n">cleanedData</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">settingObj</span><span class="p">,</span> <span class="n">settingDatum</span> <span class="ow">in</span> <span class="n">settingData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;value&quot;</span> <span class="ow">in</span> <span class="n">settingDatum</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">settingDatum</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># ok to flatten</span>
                <span class="n">cleanedData</span><span class="p">[</span><span class="n">settingObj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">settingObj</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleanedData</span><span class="p">[</span><span class="n">settingObj</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">settingDatum</span>

        <span class="c1"># this gets rid of a !!omap associated with ordered dicts</span>
        <span class="n">yamlData</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">tag</span><span class="p">:</span> <span class="n">ruamel</span><span class="o">.</span><span class="n">yaml</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">CommentedMap</span><span class="p">(</span><span class="n">cleanedData</span><span class="p">)})</span>
        <span class="k">return</span> <span class="n">yamlData</span>

    <span class="k">def</span> <span class="nf">_getSettingDataToWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make an ordered dict with all settings slated for being written.</span>

<span class="sd">        This is general so it can be dumped to whatever file format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">settingData</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_settingName</span><span class="p">,</span> <span class="n">settingObject</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cs</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Styles</span><span class="o">.</span><span class="n">short</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">settingObject</span><span class="o">.</span><span class="n">offDefault</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">attribs</span> <span class="o">=</span> <span class="n">settingObject</span><span class="o">.</span><span class="n">getCustomAttributes</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="n">settingDatum</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">attribName</span><span class="p">,</span> <span class="n">attribValue</span><span class="p">)</span> <span class="ow">in</span> <span class="n">attribs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attribValue</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                    <span class="n">attribValue</span> <span class="o">=</span> <span class="n">attribValue</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="n">settingDatum</span><span class="p">[</span><span class="n">attribName</span><span class="p">]</span> <span class="o">=</span> <span class="n">attribValue</span>
            <span class="n">settingData</span><span class="p">[</span><span class="n">settingObject</span><span class="p">]</span> <span class="o">=</span> <span class="n">settingDatum</span>
        <span class="k">return</span> <span class="n">settingData</span></div>


<div class="viewcode-block" id="prompt"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.prompt">[docs]</a><span class="k">def</span> <span class="nf">prompt</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="n">question</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prompt the user for some information.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">CURRENT_MODE</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">GUI</span><span class="p">:</span>
        <span class="c1"># avoid hard dependency on wx</span>
        <span class="kn">import</span> <span class="nn">wx</span>  <span class="c1"># pylint: disable=import-error</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="n">statement</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">question</span>
        <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CENTER</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
            <span class="n">style</span> <span class="o">|=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">wx</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RunLogPromptCancel</span><span class="p">(</span><span class="s2">&quot;Manual cancellation of GUI prompt&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">context</span><span class="o">.</span><span class="n">CURRENT_MODE</span> <span class="o">==</span> <span class="n">context</span><span class="o">.</span><span class="n">Mode</span><span class="o">.</span><span class="n">INTERACTIVE</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">opt</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">options</span> <span class="k">if</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;YES_NO&quot;</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">,</span> <span class="s2">&quot;NO&quot;</span><span class="p">,</span> <span class="s2">&quot;CANCEL&quot;</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;YES_NO&quot;</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">responses</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;YES_NO&quot;</span><span class="p">)</span>
            <span class="n">responses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;NO&quot;</span>
            <span class="n">responses</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;YES&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">responses</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No suitable responses in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">responses</span><span class="p">))</span>

        <span class="c1"># highly requested shorthand responses</span>
        <span class="k">if</span> <span class="s2">&quot;YES&quot;</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;NO&quot;</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">)</span>

        <span class="c1"># Use the logger tools to handle user prompts (runLog supports this).</span>
        <span class="k">while</span> <span class="n">response</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
            <span class="n">runLog</span><span class="o">.</span><span class="n">LOG</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2">): &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">question</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">responses</span><span class="p">)))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s2">&quot;CANCEL&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RunLogPromptCancel</span><span class="p">(</span><span class="s2">&quot;Manual cancellation of interactive prompt&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;YES&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="s2">&quot;OK&quot;</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RunLogPromptUnresolvable</span><span class="p">(</span>
            <span class="s2">&quot;Incorrect CURRENT_MODE for prompting user: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">CURRENT_MODE</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="RunLogPromptCancel"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.RunLogPromptCancel">[docs]</a><span class="k">class</span> <span class="nc">RunLogPromptCancel</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An error that occurs when the user submits a cancel on a runLog prompt which allows for cancellation&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="RunLogPromptUnresolvable"><a class="viewcode-back" href="../../../.apidocs/armi.settings.settingsIO.html#armi.settings.settingsIO.RunLogPromptUnresolvable">[docs]</a><span class="k">class</span> <span class="nc">RunLogPromptUnresolvable</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An error that occurs when the current mode enum in armi.__init__ suggests the user cannot be communicated with from</span>
<span class="sd">    the current process.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2009-2022, TerraPower, LLC.
      <span class="lastupdated">
        Last updated on 2022-05-04.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>